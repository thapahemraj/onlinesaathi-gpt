const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BookmarkNav.CM8dWCHL.js","./vendor.CphWSTLN.js","./markdown_highlight.YFvJ8PVJ.js","./react-interactions.C2rPp_t4.js","./validation.xig1VQ4I.js","./math-katex.steiuUVT.js","./math-katex.sdXCKFqw.css","./radix-ui.DdkHAinG.js","./utilities.BTNfF1ni.js","./tanstack-vendor.DVV4vUjY.js","./headlessui.Dg00_BJ1.js","./http-client.DhyQNT5o.js","./locales.DcNwsKmV.js","./i18n.CE40c5bP.js","./routing.CVoMIF_b.js","./date-utils.j-oxXFG2.js","./forms.DHEhur4C.js","./security-ui.DXoq3Ng6.js","./heic-converter.Cz_Prg7D.js","./animations.BUCsF4W9.js","./markdown-processing.6SqW5JNx.js","./codemirror-core.Db-SEkBm.js","./codemirror-state.BpbzyhTO.js","./codemirror-view.BXpYK4Vr.js","./codemirror-language.BxChQYYl.js","./sandpack.pmh-9YB0.js","./virtualization.B4GvZnf2.js","./AccountSettings.-B2YI5yP.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,n,a)=>((t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a)(t,"symbol"!=typeof n?n+"":n,a);import{o as n,aY as a,aZ as s,a_ as r,F as o,a$ as i,a1 as l,b0 as c,b1 as d,b2 as u,b3 as m,b4 as p,b5 as h,b6 as g,b7 as x,b8 as f,b9 as v,ba as _,bb as b,bc as y,bd as j,be as w,bf as N,bg as k,bh as C,bi as S,aj as T,ak as E,bj as I,bk as R,bl as A,bm as P,bn as O,bo as L,bp as M,bq as D,br as F,bs as U,bt as z,bu as V,bv as $,bw as B,bx as H,by as G,bz as K,bA as W,bB as q,bC as Q,bD as Y,bE as X,bF as J,bG as Z,bH as ee,bI as te,bJ as ne,bK as ae,bL as se,bM as re,bN as oe,bO as ie,bP as le,bQ as ce,bR as de,bS as ue,bT as me,bU as pe,bV as he,bW as ge,bX as xe,bY as fe,bZ as ve,b_ as _e,b$ as be,c0 as ye,c1 as je,c2 as we,c3 as Ne,c4 as ke,c5 as Ce,c6 as Se,c7 as Te,c8 as Ee,c9 as Ie,ca as Re,cb as Ae,cc as Pe,cd as Oe,ce as Le,cf as Me,cg as De,ch as Fe,ci as Ue,cj as ze,ck as Ve,cl as $e,cm as Be,cn as He,co as Ge,cp as Ke,cq as We,cr as qe,cs as Qe,ct as Ye,cu as Xe,cv as Je,cw as Ze,cx as et,cy as tt,cz as nt,cA as at,cB as st,cC as rt,cD as ot,cE as it,cF as lt,cG as ct,cH as dt,cI as ut,O as mt,cJ as pt,cK as ht,cL as gt,cM as xt,cN as ft,cO as vt,cP as _t,cQ as bt,cR as yt,cS as jt,cT as wt,cU as Nt,cV as kt,cW as Ct,cX as St,cY as Tt,cZ as Et,c_ as It,c$ as Rt,d0 as At,d1 as Pt,d2 as Ot,d3 as Lt,d4 as Mt,d5 as Dt,d6 as Ft,d7 as Ut,d8 as zt,d9 as Vt,da as $t,db as Bt,dc as Ht,dd as Gt,de as Kt,df as Wt,dg as qt,dh as Qt,di as Yt,dj as Xt,dk as Jt,dl as Zt,dm as en,dn as tn,dp as nn,dq as an,dr as sn,ds as rn,dt as on,du as ln,dv as cn,dw as dn,dx as un,dy as mn,dz as pn,dA as hn,dB as gn,dC as xn,dD as fn,dE as vn,dF as _n,dG as bn,dH as yn,dI as jn,dJ as wn,dK as Nn,dL as kn,dM as Cn,dN as Sn,dO as Tn,dP as En,dQ as In,dR as Rn,dS as An,dT as Pn,dU as On,dV as Ln,dW as Mn,dX as Dn,dY as Fn,dZ as Un,d_ as zn,d$ as Vn,e0 as $n,e1 as Bn,e2 as Hn,e3 as Gn,e4 as Kn,e5 as Wn,e6 as qn,e7 as Qn,e8 as Yn,e9 as Xn,ea as Jn,eb as Zn,ec as ea,ed as ta}from"./vendor.CphWSTLN.js";import{a as na}from"./http-client.DhyQNT5o.js";import{e as aa,o as sa,s as ra,n as oa,u as ia,b as la,a as ca,r as da,c as ua,l as ma,d as pa,f as ha,g as ga,h as xa,Z as fa}from"./validation.xig1VQ4I.js";import"./locales.DcNwsKmV.js";import*as va from"react";import _a,{useRef as ba,useEffect as ya,useState as ja,createContext as wa,useContext as Na,useCallback as ka,useMemo as Ca,memo as Sa,forwardRef as Ta,useId as Ea,Suspense as Ia,Component as Ra,useLayoutEffect as Aa,useReducer as Pa,Fragment as Oa,lazy as La}from"react";import{c as Ma,u as Da,L as Fa,a as Ua,R as za}from"./routing.CVoMIF_b.js";import{R as Va,I as $a,a as Ba,H as Ha,T as Ga,$ as Ka,b as Wa,c as qa,d as Qa,A as Ya,e as Xa,C as Ja,f as Za,g as es,h as ts,B as ns,i as as,j as ss,k as rs,l as os,m as is}from"./radix-ui.DdkHAinG.js";import{u as ls,F as cs,b as ds,h as us,y as ms,D as ps,H as hs}from"./react-interactions.C2rPp_t4.js";import{u as gs,a as xs,b as fs,c as vs,d as _s,g as bs,f as ys,e as js,h as ws,i as Ns,j as ks,Q as Cs,k as Ss,l as Ts,R as Es}from"./tanstack-vendor.DVV4vUjY.js";import{CodePaths as Is,TextPaths as Rs,SheetPaths as As,VideoPaths as Ps,AudioPaths as Os,FilePaths as Ls,Skeleton as Ms,useToastContext as Ds,ThemeContext as Fs,isDark as Us,CustomMinimalIcon as zs,XAIcon as Vs,GoogleMinimalIcon as $s,AnthropicIcon as Bs,GPTIcon as Hs,AzureMinimalIcon as Gs,BedrockIcon as Ks,AssistantIcon as Ws,Sparkles as qs,applyFontSize as Qs,Button as Ys,Spinner as Xs,OpenIDIcon as Js,ThemeSelector as Zs,Label as er,InputOTP as tr,InputOTPGroup as nr,InputOTPSlot as ar,InputOTPSeparator as sr,OGDialog as rr,OGDialogTrigger as or,OGDialogContent as ir,OGDialogTitle as lr,DropdownPopup as cr,Switch as dr,ResizableHandleAlt as ur,ResizablePanel as mr,TooltipAnchor as pr,OGDialogTemplate as hr,SquirclePlusIcon as gr,InfoHoverCard as xr,ESide as fr,useMediaQuery as vr,OGDialogClose as _r,OGDialogHeader as br,TrashIcon as yr,Checkbox as jr,MCPIcon as wr,GearIcon as Nr,Input as kr,HoverCard as Cr,FormInput as Sr,HoverCardTrigger as Tr,CircleHelpIcon as Er,HoverCardPortal as Ir,HoverCardContent as Rr,CodeyIcon as Ar,GeminiIcon as Pr,PaLMIcon as Or,UserIcon as Lr,ControlCombobox as Mr,Textarea as Dr,OGDialogPortal as Fr,OGDialogOverlay as Ur,useAvatar as zr,OpenAIMinimalIcon as Vr,SelectDropDown as $r,TextareaAutosize as Br,InputNumber as Hr,Slider as Gr,Tag as Kr,FileIcon as Wr,SharePointIcon as qr,AttachmentIcon as Qr,Accordion as Yr,AccordionItem as Xr,AccordionContent as Jr,EditIcon as Zr,TableRow as eo,TableCell as to,Table as no,TableHeader as ao,TableHead as so,TableBody as ro,Dialog as oo,DialogTrigger as io,DialogTemplate as lo,PixelCard as co,CheckMark as uo,Clipboard as mo,InputCombobox as po,Separator as ho,DropdownMenu as go,DropdownMenuTrigger as xo,DropdownMenuContent as fo,DropdownMenuItem as vo,DropdownMenuGroup as _o,Sidebar as bo,Dropdown as yo,AnimatedSearchInput as jo,Blocks as wo,ResizablePanelGroup as No,MessagesSquared as ko,DataIcon as Co,PinIcon as So,NewChatIcon as To,SamlIcon as Eo,AppleIcon as Io,GoogleIcon as Ro,GithubIcon as Ao,FacebookIcon as Po,DiscordIcon as Oo,cn as Lo,SaveIcon as Mo,Breadcrumb as Do,BreadcrumbList as Fo,BreadcrumbItem as Uo,BreadcrumbSeparator as zo,BreadcrumbLink as Vo,CrossIcon as $o,DataTable as Bo,Radio as Ho,DelayedRender as Go,AnimatedTabs as Ko,VolumeMuteIcon as Wo,VolumeIcon as qo,ThumbUpIcon as Qo,ThumbDownIcon as Yo,RegenerateIcon as Xo,ContinueIcon as Jo,FileUpload as Zo,useCombobox as ei,ListeningIcon as ti,SendIcon as ni,Badge as ai,CheckboxButton as si,VectorIcon as ri,MultiSelect as oi,BirthdayIcon as ii,SplitText as li,OGDialogFooter as ci,useOnClickOutside as di,Progress as ui,MobileSidebar as mi,ThemeProvider as pi,ToastProvider as hi,Toast as gi}from"@librechat/client";import{d as xi,_ as fi,l as vi,t as _i,i as bi,k as yi}from"./utilities.BTNfF1ni.js";import{p as ji,i as wi,a as Ni,s as ki,b as Ci,c as Si,f as Ti,g as Ei,d as Ii}from"./date-utils.j-oxXFG2.js";import{useTranslation as Ri,Trans as Ai}from"react-i18next";import{u as Pi,a as Oi,C as Li,F as Mi,b as Di,c as Fi,d as Ui}from"./forms.DHEhur4C.js";import{T as zi,Q as Vi}from"./security-ui.DXoq3Ng6.js";import{L as $i,q as Bi,z as Hi,H as Gi}from"./headlessui.Dg00_BJ1.js";import{v as Ki,E as Wi}from"./heic-converter.Cz_Prg7D.js";import{T as qi,C as Qi,e as Yi}from"./animations.BUCsF4W9.js";import{M as Xi,r as Ji,s as Zi,a as el,b as tl,c as nl,d as al}from"./markdown-processing.6SqW5JNx.js";import{l as sl,m as rl}from"./codemirror-core.Db-SEkBm.js";import{u as ol,S as il,a as ll,b as cl,c as dl,_ as ul}from"./sandpack.pmh-9YB0.js";import{C as ml,a as pl,A as hl,L as gl}from"./virtualization.B4GvZnf2.js";import{AnimatePresence as xl,motion as fl}from"framer-motion";import"./math-katex.steiuUVT.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var vl={},_l=function(){return _l=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},_l.apply(this,arguments)};function bl(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(n[a[s]]=e[a[s]])}return n}function yl(e,t,n,a){return new(n||(n=Promise))((function(t,s){function r(e){try{i(a.next(e))}catch(t){s(t)}}function o(e){try{i(a.throw(e))}catch(t){s(t)}}function i(e){var a;e.done?t(e.value):(a=e.value,a instanceof n?a:new n((function(e){e(a)}))).then(r,o)}i((a=a.apply(e,[])).next())}))}function jl(e,t){var n,a,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(r=0)),r;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,a=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((s=(s=r.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(l){i=[6,l],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function wl(e,t,n){if(n||2===arguments.length)for(var a,s=0,r=t.length;s<r;s++)!a&&s in t||(a||(a=Array.prototype.slice.call(t,0,s)),a[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var Nl,kl,Cl,Sl,Tl,El,Il,Rl=/^\${(.+)}$/;function Al(e){if(!e)return e;var t=e.trim(),n=t.match(Rl);if(n){var a=n[1];return vl[a]||t}for(var s,r=/\${([^}]+)}/g,o=t,i=[];null!==(s=r.exec(t));)i.push({fullMatch:s[0],varName:s[1],index:s.index});for(var l=i.length-1;l>=0;l--){var c=i[l],d=c.fullMatch,u=(a=c.varName,c.index),m=vl[a]||d;o=o.substring(0,u)+m+o.substring(u+d.length)}return o}function Pl(e){return void 0===e&&(e=""),"ollama"===e.toLowerCase()?"ollama":e}(Il=Nl||(Nl={})).execute_code="execute_code",Il.code_interpreter="code_interpreter",Il.file_search="file_search",Il.web_search="web_search",Il.retrieval="retrieval",Il.function="function",Il.memory="memory",Il.ui_resources="ui_resources",function(e){e.code_interpreter="code_interpreter",e.execute_code="execute_code",e.file_search="file_search",e.image_edit="image_edit",e.context="context",e.ocr="ocr"}(kl||(kl={})),function(e){e.FILE_CITATION="file_citation",e.FILE_PATH="file_path"}(Cl||(Cl={})),function(e){e.IN_PROGRESS="in_progress",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(Sl||(Sl={})),function(e){e.TEXT="text",e.IMAGE_FILE="image_file"}(Tl||(Tl={})),function(e){e.QUEUED="queued",e.IN_PROGRESS="in_progress",e.REQUIRES_ACTION="requires_action",e.CANCELLING="cancelling",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(El||(El={}));var Ol,Ll="_action_";!function(e){e.Vision="vision",e.FineTune="fine-tune",e.FineTuneResults="fine-tune-results",e.Assistants="assistants",e.AssistantsOutput="assistants_output"}(Ol||(Ol={}));var Ml,Dl={order:"desc",limit:100};!function(e){e.ThreadCreated="thread.created",e.ThreadRunCreated="thread.run.created",e.ThreadRunQueued="thread.run.queued",e.ThreadRunInProgress="thread.run.in_progress",e.ThreadRunRequiresAction="thread.run.requires_action",e.ThreadRunCompleted="thread.run.completed",e.ThreadRunFailed="thread.run.failed",e.ThreadRunCancelling="thread.run.cancelling",e.ThreadRunCancelled="thread.run.cancelled",e.ThreadRunExpired="thread.run.expired",e.ThreadRunStepCreated="thread.run.step.created",e.ThreadRunStepInProgress="thread.run.step.in_progress",e.ThreadRunStepCompleted="thread.run.step.completed",e.ThreadRunStepFailed="thread.run.step.failed",e.ThreadRunStepCancelled="thread.run.step.cancelled",e.ThreadRunStepExpired="thread.run.step.expired",e.ThreadRunStepDelta="thread.run.step.delta",e.ThreadMessageCreated="thread.message.created",e.ThreadMessageInProgress="thread.message.in_progress",e.ThreadMessageCompleted="thread.message.completed",e.ThreadMessageIncomplete="thread.message.incomplete",e.ThreadMessageDelta="thread.message.delta",e.ErrorEvent="error"}(Ml||(Ml={}));var Fl=[{key:"not_matched",label:"com_ui_feedback_tag_not_matched",direction:"thumbsDown",icon:"AlertCircle"},{key:"inaccurate",label:"com_ui_feedback_tag_inaccurate",direction:"thumbsDown",icon:"AlertCircle"},{key:"bad_style",label:"com_ui_feedback_tag_bad_style",direction:"thumbsDown",icon:"PenTool"},{key:"missing_image",label:"com_ui_feedback_tag_missing_image",direction:"thumbsDown",icon:"ImageOff"},{key:"unjustified_refusal",label:"com_ui_feedback_tag_unjustified_refusal",direction:"thumbsDown",icon:"Ban"},{key:"not_helpful",label:"com_ui_feedback_tag_not_helpful",direction:"thumbsDown",icon:"ThumbsDown"},{key:"other",label:"com_ui_feedback_tag_other",direction:"thumbsDown",icon:"HelpCircle"},{key:"accurate_reliable",label:"com_ui_feedback_tag_accurate_reliable",direction:"thumbsUp",icon:"CheckCircle"},{key:"creative_solution",label:"com_ui_feedback_tag_creative_solution",direction:"thumbsUp",icon:"Lightbulb"},{key:"clear_well_written",label:"com_ui_feedback_tag_clear_well_written",direction:"thumbsUp",icon:"PenTool"},{key:"attention_to_detail",label:"com_ui_feedback_tag_attention_to_detail",direction:"thumbsUp",icon:"Search"}];function Ul(e){return Fl.filter((function(t){return t.direction===e}))}var zl,Vl,$l,Bl,Hl,Gl=aa(["not_matched","inaccurate","bad_style","missing_image","unjustified_refusal","not_helpful","other","accurate_reliable","creative_solution","clear_well_written","attention_to_detail"]),Kl=aa(["thumbsUp","thumbsDown"]),Wl=sa({rating:Kl,tag:Gl,text:ra().max(1024).optional()});function ql(e){if((null==e?void 0:e.rating)&&(null==e?void 0:e.tag)&&e.tag.key)return{rating:e.rating,tag:e.tag.key,text:e.text}}function Ql(e){if(e)return Fl.find((function(t){return t.key===e}))}ra().uuid(),function(e){e.OVERRIDE_AUTH="override_auth",e.USER_PROVIDED="user_provided",e.SYSTEM_DEFINED="system_defined"}(Hl||(Hl={}));var Yl,Xl,Jl=oa(Hl);!function(e){e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.google="google",e.anthropic="anthropic",e.assistants="assistants",e.azureAssistants="azureAssistants",e.agents="agents",e.custom="custom",e.bedrock="bedrock"}(Yl||(Yl={})),function(e){e.OPENAI="openAI",e.ANTHROPIC="anthropic",e.AZURE="azureOpenAI",e.GOOGLE="google",e.VERTEXAI="vertexai",e.BEDROCK="bedrock",e.MISTRALAI="mistralai",e.MISTRAL="mistral",e.DEEPSEEK="deepseek",e.OPENROUTER="openrouter",e.XAI="xai"}(Xl||(Xl={}));var Zl,ec=new Set([Yl.anthropic,Yl.openAI,Yl.custom,Yl.azureOpenAI,Yl.google,Xl.VERTEXAI,Xl.MISTRALAI,Xl.MISTRAL,Xl.DEEPSEEK,Xl.OPENROUTER,Xl.XAI]);Xl.OPENAI,Xl.AZURE,Yl.custom,Xl.MISTRALAI,Xl.MISTRAL,Xl.DEEPSEEK,Xl.OPENROUTER,Xl.XAI;var tc=function(e){return ec.has(null!=e?e:"")},nc=new Set([Yl.agents,Yl.openAI,Yl.bedrock,Yl.azureOpenAI,Yl.anthropic,Yl.custom,Yl.google]);!function(e){e.AI21="ai21",e.Amazon="amazon",e.Anthropic="anthropic",e.Cohere="cohere",e.Meta="meta",e.MistralAI="mistral",e.StabilityAI="stability",e.DeepSeek="deepseek"}(Zl||(Zl={}));var ac,sc,rc,oc,ic=function(e,t){var n=e,a=function(e,t){if(e===Yl.bedrock){var n=t.split("."),a=[n[0],n[1]].find((function(e){return Object.values(Zl).includes(e)}));return null!=a?a:n[0]}return t}(n,t);return["".concat(n,"-").concat(a),n]},lc=function(e){var t=null!=e?e:"";return!!t&&t.toLowerCase().endsWith(Yl.assistants)},cc=function(e){var t=null!=e?e:"";return!!t&&t===Yl.agents},dc=function(e,t){return!!nc.has(e)||null!=t&&nc.has(t)};!function(e){e.low="low",e.auto="auto",e.high="high"}(ac||(ac={})),function(e){e.unset="",e.none="none",e.minimal="minimal",e.low="low",e.medium="medium",e.high="high"}(sc||(sc={})),function(e){e.none="",e.auto="auto",e.concise="concise",e.detailed="detailed"}(rc||(rc={})),function(e){e.none="",e.low="low",e.medium="medium",e.high="high"}(oc||(oc={})),(zl={})[ac.low]=0,zl[ac.auto]=1,zl[ac.high]=2,ac.low,ac.auto,ac.high;var uc=oa(ac),mc=oa(sc),pc=oa(rc),hc=oa(oc),gc={assistant:"",id:"",name:"",description:"",instructions:"",conversation_starters:[],model:"",functions:[],code_interpreter:!1,image_vision:!1,retrieval:!1,append_current_datetime:!1},xc=((Vl={agent:{},id:"",name:"",description:"",instructions:"",model:"",model_parameters:{},tools:[],provider:{},projectIds:[],edges:[],artifacts:"",isCollaborative:!1,recursion_limit:void 0})[Nl.execute_code]=!1,Vl[Nl.file_search]=!1,Vl[Nl.web_search]=!1,Vl.category="general",Vl.support_contact={name:"",email:""},Vl),fc=(($l={type:Nl.function})[Nl.function]={name:"image_vision",description:"Get detailed text descriptions for all current image attachments.",parameters:{type:"object",properties:{},required:[]}},$l),vc=function(e){var t,n;return"function"===e.type&&(null===(t=e.function)||void 0===t?void 0:t.name)===(null===(n=fc.function)||void 0===n?void 0:n.name)},_c={model:{default:"gpt-4o-mini"},temperature:{min:0,max:2,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:ac.auto,min:0,max:2,step:1}},bc={model:{default:"gemini-1.5-flash-latest"},maxOutputTokens:{min:1,max:64e3,step:1,default:8192},temperature:{min:0,max:2,step:.01,default:1},topP:{min:0,max:1,step:.01,default:.95},topK:{min:1,max:40,step:1,default:40},thinking:{default:!0},thinkingBudget:{min:-1,max:32e3,step:1,default:-1}},yc=128e3,jc=64e3,wc=32e3,Nc={model:{default:"claude-3-5-sonnet-latest"},temperature:{min:0,max:1,step:.01,default:1},promptCache:{default:!0},thinking:{default:!0},thinkingBudget:{min:1024,step:100,max:2e5,default:2e3},maxOutputTokens:{min:1,max:yc,step:1,default:8192,reset:function(e){return/claude-(?:sonnet|haiku)[-.]?[4-9]/.test(e)||/claude-opus[-.]?(?:[5-9]|4[-.]?([5-9]|\d{2,}))/.test(e)?jc:/claude-opus[-.]?[4-9]/.test(e)?wc:8192},set:function(e,t){return/claude-(?:sonnet|haiku)[-.]?[4-9]/.test(t)&&e>jc?jc:/claude-opus[-.]?(?:[5-9]|4[-.]?([5-9]|\d{2,}))/.test(t)?e>jc?jc:e:/claude-opus[-.]?[4-9]/.test(t)&&e>wc?wc:e>yc?yc:e}},topP:{min:0,max:1,step:.01,default:.7},topK:{min:1,max:40,step:1,default:5},resendFiles:{default:!0},maxContextTokens:{default:void 0},legacy:{maxOutputTokens:{min:1,max:4096,step:1,default:4096}},web_search:{default:!1}},kc={model:{default:"gpt-3.5-turbo-test"},temperature:{min:0,max:1,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:ac.auto}},Cc=((Bl={})[Yl.openAI]=_c,Bl[Yl.google]=bc,Bl[Yl.anthropic]=Nc,Bl[Yl.agents]=kc,Bl[Yl.bedrock]=kc,Bl),Sc=Cc[Yl.google],Tc=oa(Yl),Ec=ia([Tc,ra()]),Ic=sa({authField:ra(),label:ra(),description:ra()}),Rc=sa({name:ra(),pluginKey:ra(),description:ra().optional(),icon:ra().optional(),authConfig:ca(Ic).optional(),authenticated:la().optional(),chatMenu:la().optional(),isButton:la().optional(),toolkit:la().optional()}),Ac=sa({input:sa({content:ra()}),output:sa({content:ra()})}),Pc=sa({messageId:ra(),endpoint:ra().optional(),clientId:ra().nullable().optional(),conversationId:ra().nullable(),parentMessageId:ra().nullable(),responseMessageId:ra().nullable().optional(),overrideParentMessageId:ra().nullable().optional(),bg:ra().nullable().optional(),model:ra().nullable().optional(),title:ra().nullable().or(ma("New Chat")).default("New Chat"),sender:ra().optional(),text:ra(),generation:ra().nullable().optional(),isCreatedByUser:la(),error:la().optional(),clientTimestamp:ra().optional(),createdAt:ra().optional().default((function(){return(new Date).toISOString()})),updatedAt:ra().optional().default((function(){return(new Date).toISOString()})),current:la().optional(),unfinished:la().optional(),searchResult:la().optional(),finish_reason:ra().optional(),thread_id:ra().optional(),iconURL:ra().nullable().optional(),feedback:Wl.optional(),metadata:da(ua()).optional()}),Oc=ia([pa(),ra()]).transform((function(e){return"string"==typeof e?""===e.trim()?void 0:parseFloat(e):e})),Lc=ha((function(){return ia([ga(),la(),pa(),ra(),ca(ha((function(){return Lc}))),da(ha((function(){return Lc})))])})),Mc=sa({conversationId:ra().nullable(),endpoint:Tc.nullable(),endpointType:Tc.nullable().optional(),isArchived:la().optional(),title:ra().nullable().or(ma("New Chat")).default("New Chat"),user:ra().optional(),messages:ca(ra()).optional(),tools:ia([ca(Rc),ca(ra())]).optional(),modelLabel:ra().nullable().optional(),userLabel:ra().optional(),model:ra().nullable().optional(),promptPrefix:ra().nullable().optional(),temperature:pa().nullable().optional(),topP:pa().optional(),topK:pa().optional(),top_p:pa().optional(),frequency_penalty:pa().optional(),presence_penalty:pa().optional(),parentMessageId:ra().optional(),maxOutputTokens:Oc.nullable().optional(),maxContextTokens:Oc.optional(),max_tokens:Oc.optional(),promptCache:la().optional(),system:ra().optional(),thinking:la().optional(),thinkingBudget:Oc.optional(),stream:la().optional(),artifacts:ra().optional(),context:ra().nullable().optional(),examples:ca(Ac).optional(),tags:ca(ra()).optional(),createdAt:ra(),updatedAt:ra(),resendFiles:la().optional(),file_ids:ca(ra()).optional(),imageDetail:uc.optional(),reasoning_effort:mc.optional().nullable(),reasoning_summary:pc.optional().nullable(),verbosity:hc.optional().nullable(),useResponsesApi:la().optional(),web_search:la().optional(),disableStreaming:la().optional(),assistant_id:ra().optional(),agent_id:ra().optional(),region:ra().optional(),maxTokens:Oc.optional(),additionalModelRequestFields:Lc.optional(),instructions:ra().optional(),additional_instructions:ra().optional(),append_current_datetime:la().optional(),presetOverride:da(ua()).optional(),stop:ca(ra()).optional(),greeting:ra().optional(),spec:ra().nullable().optional(),iconURL:ra().nullable().optional(),expiredAt:ra().nullable().optional(),fileTokenLimit:Oc.optional(),resendImages:la().optional(),chatGptLabel:ra().nullable().optional()}),Dc=Mc.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(sa({conversationId:ra().nullable().optional(),presetId:ra().nullable().optional(),title:ra().nullable().optional(),defaultPreset:la().optional(),order:pa().optional(),endpoint:Ec.nullable()})),Fc=Mc.merge(sa({endpoint:Ec.nullable(),createdAt:ra().optional(),updatedAt:ra().optional()})),Uc=Mc.pick({spec:!0,maxContextTokens:!0,resendFiles:!0,imageDetail:!0,promptPrefix:!0,model:!0,temperature:!0,presence_penalty:!0,frequency_penalty:!0,stop:!0,top_p:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,topP:!0,topK:!0,maxOutputTokens:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,region:!0,maxTokens:!0,agent_id:!0,assistant_id:!0,append_current_datetime:!0,instructions:!0,fileTokenLimit:!0}).merge(sa({endpoint:Ec.nullable()}));sa({conversationId:ra(),shareId:ra(),messages:ca(ra()),isPublic:la(),title:ra(),createdAt:ra(),updatedAt:ra()}),sa({_id:ra(),user:ra(),tag:ra(),description:ra().optional(),createdAt:ra(),updatedAt:ra(),count:pa(),position:pa()});var zc=Mc.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,artifacts:!0,topP:!0,topK:!0,thinking:!0,thinkingBudget:!0,web_search:!0,fileTokenLimit:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0}),Vc=zc.transform((function(e){return $c(e)})).catch((function(){return{}}));function $c(e,t){var n=_l({},e);return Object.keys(n).forEach((function(e){var a=n[e];null==a&&delete n[e],t&&"string"==typeof a&&""===a&&delete n[e]})),n}sa({maxOutputTokens:Oc.optional(),temperature:Oc.optional(),topP:Oc.optional(),topK:Oc.optional(),presencePenalty:Oc.optional(),frequencyPenalty:Oc.optional(),stopSequences:ca(ra()).optional(),thinkingConfig:sa({includeThoughts:la().optional(),thinkingBudget:Oc.optional()}).optional(),web_search:la().optional()}).strip().optional();var Bc,Hc,Gc=Mc.pick({model:!0,assistant_id:!0,instructions:!0,artifacts:!0,promptPrefix:!0,iconURL:!0,greeting:!0,spec:!0,append_current_datetime:!0}).transform((function(e){var t,n,a,s,r,o,i,l;return _l(_l({},e),{model:null!==(t=e.model)&&void 0!==t?t:_c.model.default,assistant_id:null!==(n=e.assistant_id)&&void 0!==n?n:void 0,instructions:null!==(a=e.instructions)&&void 0!==a?a:void 0,promptPrefix:null!==(s=e.promptPrefix)&&void 0!==s?s:null,iconURL:null!==(r=e.iconURL)&&void 0!==r?r:void 0,greeting:null!==(o=e.greeting)&&void 0!==o?o:void 0,spec:null!==(i=e.spec)&&void 0!==i?i:void 0,append_current_datetime:null!==(l=e.append_current_datetime)&&void 0!==l&&l})})).catch((function(){return{model:_c.model.default,assistant_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,spec:void 0,append_current_datetime:!1}})),Kc=Mc.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0}).transform((function(e){return $c(e)})).catch((function(){return{}}));Mc.pick({model:!0,modelLabel:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,imageDetail:!0,agent_id:!0,instructions:!0,promptPrefix:!0,iconURL:!0,greeting:!0,maxContextTokens:!0}).transform((function(e){var t,n,a,s,r,o,i,l,c,d,u,m,p;return _l(_l({},e),{model:null!==(t=e.model)&&void 0!==t?t:kc.model.default,modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,temperature:null!==(a=e.temperature)&&void 0!==a?a:1,top_p:null!==(s=e.top_p)&&void 0!==s?s:1,presence_penalty:null!==(r=e.presence_penalty)&&void 0!==r?r:0,frequency_penalty:null!==(o=e.frequency_penalty)&&void 0!==o?o:0,resendFiles:"boolean"==typeof e.resendFiles?e.resendFiles:kc.resendFiles.default,imageDetail:null!==(i=e.imageDetail)&&void 0!==i?i:ac.auto,agent_id:null!==(l=e.agent_id)&&void 0!==l?l:void 0,instructions:null!==(c=e.instructions)&&void 0!==c?c:void 0,promptPrefix:null!==(d=e.promptPrefix)&&void 0!==d?d:null,iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,maxContextTokens:null!==(p=e.maxContextTokens)&&void 0!==p?p:void 0})})).catch((function(){return{model:kc.model.default,modelLabel:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendFiles:kc.resendFiles.default,imageDetail:ac.auto,agent_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,maxContextTokens:void 0}}));var Wc=Mc.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,artifacts:!0,imageDetail:!0,stop:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,fileTokenLimit:!0}).transform((function(e){return $c(e,!0)})).catch((function(){return{}})),qc=zc.transform((function(e){var t=_l({},e);return t.temperature===Sc.temperature.default&&delete t.temperature,t.maxOutputTokens===Sc.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===Sc.topP.default&&delete t.topP,t.topK===Sc.topK.default&&delete t.topK,$c(t)})).catch((function(){return{}})),Qc=Mc.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0,resendFiles:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,web_search:!0,fileTokenLimit:!0,stop:!0,stream:!0}).transform((function(e){return $c(e)})).catch((function(){return{}}));sa({bannerId:ra(),message:ra(),displayFrom:ra(),displayTo:ra(),createdAt:ra(),updatedAt:ra(),isPublic:la(),persistable:la().default(!1)});var Yc=Mc.pick({spec:!0,iconURL:!0,greeting:!0,agent_id:!0,instructions:!0,additional_instructions:!0}).transform((function(e){return $c(e)})).catch((function(){return{}})),Xc=sa({name:ra(),label:ra(),preset:Dc,order:pa().optional(),default:la().optional(),description:ra().optional(),group:ra().optional(),showIconInMenu:la().optional(),showIconInHeader:la().optional(),iconURL:ia([ra(),Tc]).optional(),authType:Jl.optional(),webSearch:la().optional(),fileSearch:la().optional(),executeCode:la().optional(),mcpServers:ca(ra()).optional()}),Jc=sa({enforce:la().default(!1),prioritize:la().default(!0),list:ca(Xc).min(1),addedEndpoints:ca(ia([ra(),Tc])).optional()}),Zc=((Bc={})[Yl.openAI]=!0,Bc[Yl.google]=!0,Bc[Yl.assistants]=!0,Bc[Yl.azureAssistants]=!0,Bc[Yl.agents]=!0,Bc[Yl.azureOpenAI]=!0,Bc[Yl.anthropic]=!0,Bc[Yl.custom]=!0,Bc[Yl.bedrock]=!0,Bc),ed=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];wl(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/vtt","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/x-sh","application/typescript","application/sql","application/yaml","application/vnd.coffeescript","application/xml","application/zip","image/svg","image/svg+xml","video/mp4","video/avi","video/mov","video/wmv","video/flv","video/webm","video/mkv","video/m4v","video/3gp","video/ogv","audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/aac","audio/flac","audio/wma","audio/opus","audio/mpeg"],ed,!0),wl(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip"],ed,!0);var td=/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i,nd=/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,ad=/^image\/(jpeg|gif|png|webp|heic|heif)$/,sd=/^audio\/(mp3|mpeg|mpeg3|wav|wave|x-wav|ogg|vorbis|mp4|m4a|x-m4a|flac|x-flac|webm|aac|wma|opus)$/,rd=[ad,/^application\/pdf$/,/^application\/vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)$/,/^application\/vnd\.ms-(word|powerpoint|excel)$/,/^application\/epub\+zip$/],od=[sd],id=[/^(text\/(x-c|x-csharp|tab-separated-values|x-c\+\+|x-h|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv|xml))$/,nd,/^(application\/(epub\+zip|csv|json|pdf|x-tar|x-sh|typescript|sql|yaml|vnd\.coffeescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,ad,/^video\/(mp4|avi|mov|wmv|flv|webm|mkv|m4v|3gp|ogv)$/,sd,/^image\/(svg|svg\+xml)$/],ld={c:"text/x-c",cs:"text/x-csharp",cpp:"text/x-c++",h:"text/x-h",md:"text/markdown",php:"text/x-php",py:"text/x-python",rb:"text/x-ruby",tex:"text/x-tex",js:"text/javascript",sh:"application/x-sh",ts:"application/typescript",tar:"application/x-tar",zip:"application/zip",log:"text/plain",tsv:"text/tab-separated-values",yml:"application/yaml",yaml:"application/yaml",sql:"application/sql",dart:"text/plain",coffee:"application/vnd.coffeescript",go:"text/plain",rs:"text/plain",swift:"text/plain",kt:"text/plain",kts:"text/plain",scala:"text/plain",lua:"text/plain",r:"text/plain",pl:"text/plain",pm:"text/plain",groovy:"text/plain",gradle:"text/plain",clj:"text/plain",cljs:"text/plain",cljc:"text/plain",elm:"text/plain",erl:"text/plain",hrl:"text/plain",ex:"text/plain",exs:"text/plain",hs:"text/plain",lhs:"text/plain",ml:"text/plain",mli:"text/plain",fs:"text/plain",fsx:"text/plain",lisp:"text/plain",cl:"text/plain",scm:"text/plain",rkt:"text/plain",jsx:"text/plain",tsx:"text/plain",vue:"text/plain",svelte:"text/plain",astro:"text/plain",scss:"text/plain",sass:"text/plain",less:"text/plain",styl:"text/plain",toml:"text/plain",ini:"text/plain",cfg:"text/plain",conf:"text/plain",env:"text/plain",properties:"text/plain",graphql:"text/plain",gql:"text/plain",proto:"text/plain",dockerfile:"text/plain",makefile:"text/plain",cmake:"text/plain",rake:"text/plain",gemspec:"text/plain",bash:"text/plain",zsh:"text/plain",fish:"text/plain",ps1:"text/plain",psm1:"text/plain",bat:"text/plain",cmd:"text/plain",asm:"text/plain",s:"text/plain",v:"text/plain",zig:"text/plain",nim:"text/plain",cr:"text/plain",d:"text/plain",pas:"text/plain",pp:"text/plain",f90:"text/plain",f95:"text/plain",f03:"text/plain",jl:"text/plain",m:"text/plain",mm:"text/plain",ada:"text/plain",adb:"text/plain",ads:"text/plain",cob:"text/plain",cbl:"text/plain",tcl:"text/plain",awk:"text/plain",sed:"text/plain"},cd={heic:"image/heic",heif:"image/heif"};function dd(e,t){var n,a;if(t)return t;var s=null!==(a=null===(n=e.split(".").pop())||void 0===n?void 0:n.toLowerCase())&&void 0!==a?a:"";return ld[s]||cd[s]||t}var ud=[/^(text\/(x-c|x-c\+\+|x-h|html|x-java|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|vtt|xml))$/,/^(application\/(json|pdf|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation)))$/],md=1048576,pd=function(e){return e*md},hd=pd(512),gd={fileLimit:10,fileSizeLimit:hd,totalSizeLimit:hd,supportedMimeTypes:id,disabled:!1},xd={endpoints:(Hc={},Hc[Yl.assistants]=gd,Hc[Yl.azureAssistants]=gd,Hc[Yl.agents]=gd,Hc[Yl.anthropic]={fileLimit:10,fileSizeLimit:hd,totalSizeLimit:hd,supportedMimeTypes:id,disabled:!1},Hc.default={fileLimit:10,fileSizeLimit:hd,totalSizeLimit:hd,supportedMimeTypes:id,disabled:!1},Hc),serverFileSizeLimit:hd,avatarSizeLimit:pd(2),fileTokenLimit:1e5,clientImageResize:{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},ocr:{supportedMimeTypes:rd},text:{supportedMimeTypes:[/^[\w.-]+\/[\w.-]+$/]},stt:{supportedMimeTypes:od},checkType:function(e,t){return void 0===t&&(t=id),t.some((function(t){return t.test(e)}))}},fd=ca(xa()).optional().refine((function(e){return!e||e.every((function(e){return e instanceof RegExp||"string"==typeof e}))}),{message:"Each mimeType must be a string or a RegExp object."}),vd=sa({disabled:la().optional(),fileLimit:pa().min(0).optional(),fileSizeLimit:pa().min(0).optional(),totalSizeLimit:pa().min(0).optional(),supportedMimeTypes:fd.optional()}),_d=sa({endpoints:da(vd).optional(),serverFileSizeLimit:pa().min(0).optional(),avatarSizeLimit:pa().min(0).optional(),fileTokenLimit:pa().min(0).optional(),imageGeneration:sa({percentage:pa().min(0).max(100).optional(),px:pa().min(0).optional()}).optional(),clientImageResize:sa({enabled:la().optional(),maxWidth:pa().min(0).optional(),maxHeight:pa().min(0).optional(),quality:pa().min(0).max(1).optional()}).optional(),ocr:sa({supportedMimeTypes:fd.optional()}).optional(),text:sa({supportedMimeTypes:fd.optional()}).optional()}),bd=function(e){return e.reduce((function(e,t){try{var n=new RegExp(t);e.push(n)}catch(a){console.error('Invalid regex pattern "'.concat(t,'" skipped.'),a)}return e}),[])};function yd(e,t,n){var a,s,r,o,i,l=tc(n)?id:t.supportedMimeTypes;return{disabled:null!==(a=e.disabled)&&void 0!==a?a:t.disabled,fileLimit:null!==(s=e.fileLimit)&&void 0!==s?s:t.fileLimit,fileSizeLimit:null!==(r=e.fileSizeLimit)&&void 0!==r?r:t.fileSizeLimit,totalSizeLimit:null!==(o=e.totalSizeLimit)&&void 0!==o?o:t.totalSizeLimit,supportedMimeTypes:null!==(i=e.supportedMimeTypes)&&void 0!==i?i:l}}function jd(e){var t=e.fileConfig,n=e.endpoint,a=e.endpointType;if(!(null==t?void 0:t.endpoints))return xd.endpoints.default;var s=xd.endpoints.default,r=t.endpoints.default,o=r?yd(r,s,"default"):s,i=Pl(null!=n?n:""),l=new Set(["default",Yl.agents,Yl.assistants,Yl.azureAssistants,Yl.openAI,Yl.azureOpenAI,Yl.anthropic,Yl.google,Yl.bedrock]),c=Pl(null!=a?a:"");if(a===Yl.custom||!l.has(c)&&i&&!l.has(i)){if(n&&t.endpoints[n])return yd(t.endpoints[n],o,n);for(var d in t.endpoints)if(!l.has(d)&&Pl(d)===i)return yd(t.endpoints[d],o,d);return t.endpoints[Yl.custom]?yd(t.endpoints[Yl.custom],o,n):t.endpoints[Yl.agents]?yd(t.endpoints[Yl.agents],o,n):o}return a&&t.endpoints[a]?yd(t.endpoints[a],o,a):n&&t.endpoints[n]?yd(t.endpoints[n],o,n):i&&t.endpoints[i]?yd(t.endpoints[i],o,i):cc(c||i)&&t.endpoints[Yl.agents]?yd(t.endpoints[Yl.agents],o,Yl.agents):o}function wd(e){var t,n,a,s=_l(_l({},xd),{endpoints:_l({},xd.endpoints),ocr:_l(_l({},xd.ocr),{supportedMimeTypes:(null===(t=xd.ocr)||void 0===t?void 0:t.supportedMimeTypes)||[]}),text:_l(_l({},xd.text),{supportedMimeTypes:(null===(n=xd.text)||void 0===n?void 0:n.supportedMimeTypes)||[]}),stt:_l(_l({},xd.stt),{supportedMimeTypes:(null===(a=xd.stt)||void 0===a?void 0:a.supportedMimeTypes)||[]})});if(!e)return s;if(void 0!==e.serverFileSizeLimit&&(s.serverFileSizeLimit=pd(e.serverFileSizeLimit)),void 0!==e.avatarSizeLimit&&(s.avatarSizeLimit=pd(e.avatarSizeLimit)),void 0!==e.fileTokenLimit&&(s.fileTokenLimit=e.fileTokenLimit),void 0!==e.clientImageResize&&(s.clientImageResize=_l(_l({},s.clientImageResize),e.clientImageResize)),void 0!==e.ocr&&(s.ocr=_l(_l({},s.ocr),e.ocr),e.ocr.supportedMimeTypes&&(s.ocr.supportedMimeTypes=bd(e.ocr.supportedMimeTypes))),void 0!==e.text&&(s.text=_l(_l({},s.text),e.text),e.text.supportedMimeTypes&&(s.text.supportedMimeTypes=bd(e.text.supportedMimeTypes))),!e.endpoints)return s;var r=function(t){var n=e.endpoints[t];s.endpoints[t]?s.endpoints[t]=_l({},s.endpoints[t]):s.endpoints[t]={};var a=s.endpoints[t];if(!0===n.disabled)return a.disabled=!0,a.fileLimit=0,a.fileSizeLimit=0,a.totalSizeLimit=0,a.supportedMimeTypes=[],"continue";void 0!==n.fileSizeLimit&&(a.fileSizeLimit=pd(n.fileSizeLimit)),void 0!==n.totalSizeLimit&&(a.totalSizeLimit=pd(n.totalSizeLimit)),["fileLimit"].forEach((function(e){void 0!==n[e]&&(a[e]=n[e])})),void 0!==n.disabled&&(a.disabled=n.disabled),n.supportedMimeTypes&&(a.supportedMimeTypes=bd(n.supportedMimeTypes))};for(var o in e.endpoints)r(o);return s}var Nd="",kd=function(){try{if("undefined"!=typeof globalThis&&globalThis.__VITE_API_BASE_URL__)return globalThis.__VITE_API_BASE_URL__}catch(Il){}return""}();if(kd)Nd=kd;else if(void 0===n||!0===n.browser){var Cd=document.querySelector("base");Nd=(null==Cd?void 0:Cd.getAttribute("href"))||"/"}Nd&&Nd.endsWith("/")&&(Nd=Nd.slice(0,-1));var Sd,Td=function(){return Nd},Ed=function(e){var t=Object.entries(e).filter((function(e){var t=e[1];return Array.isArray(t)?t.length>0:null!=t&&""!==t})).map((function(e){var t=e[0],n=e[1];return Array.isArray(n)?n.map((function(e){return"".concat(t,"=").concat(encodeURIComponent(e))})).join("&"):"".concat(t,"=").concat(encodeURIComponent(String(n)))})).join("&");return t?"?".concat(t):""},Id="".concat(Nd,"/api/messages"),Rd=function(e){var t=e.conversationId,n=e.messageId,a=bl(e,["conversationId","messageId"]);return t&&n?"".concat(Id,"/").concat(t,"/").concat(n):t?"".concat(Id,"/").concat(t):"".concat(Id).concat(Ed(a))},Ad=function(e){return"".concat(Id,"/artifact/").concat(e)},Pd="".concat(Nd,"/api/share"),Od=function(e){return"".concat(Pd,"/").concat(e)},Ld=function(e,t,n,a,s,r){return"".concat(Pd,"?pageSize=").concat(e,"&isPublic=").concat(t,"&sortBy=").concat(n,"&sortDirection=").concat(a).concat(s?"&search=".concat(s):"").concat(r?"&cursor=".concat(r):"")},Md="".concat(Nd,"/api/keys"),Dd="".concat(Nd,"/api/convos"),Fd=function(e){return"".concat(Dd).concat(Ed(e))},Ud=function(){return"".concat(Dd,"/update")},zd=function(){return"".concat(Nd,"/api/presets")},Vd=function(){return"".concat(Nd,"/login")},$d=function(){return"".concat(Nd,"/api/prompts")},Bd=function(e){var t=e.path,n=void 0===t?"":t,a=e.options,s=e.version,r=e.endpoint,o=!0===e.isAvatar?"".concat(qd(),"/assistants"):"".concat(Nd,"/api/assistants/v").concat(s);if(n&&""!==n&&(o+="/".concat(n)),r&&(a=_l(_l({},null!=a?a:{}),{endpoint:r})),a&&Object.keys(a).length>0){var i=new URLSearchParams(a).toString();o+="?".concat(i)}return o},Hd=function(e){var t=e.path,n=void 0===t?"":t,a=e.options,s="".concat(Nd,"/api/agents");if(n&&""!==n&&(s+="/".concat(n)),a&&Object.keys(a).length>0){var r=new URLSearchParams(a).toString();s+="?".concat(r)}return s},Gd={tools:"".concat(Nd,"/api/mcp/tools"),servers:"".concat(Nd,"/api/mcp/servers")},Kd=function(e){return"".concat(Nd,"/api/mcp/servers/").concat(e)},Wd=function(){return"".concat(Nd,"/api/files")},qd=function(){return"".concat(Wd(),"/images")},Qd=function(){return"".concat(Wd(),"/speech")},Yd=function(){return"".concat(Qd(),"/tts")},Xd=function(e){return"".concat($d(),"/groups/").concat(e)},Jd=function(e){return"".concat($d(),"/").concat(e)},Zd=$d,eu=Xd,tu=Xd,nu=function(e){return"".concat("".concat(Nd,"/api/roles"),"/").concat(e.toLowerCase())},au=function(e){return"".concat(Nd,"/api/tags").concat(null!=e&&e?"/".concat(encodeURIComponent(e)):"")},su=function(){return"".concat(Nd,"/api/memories")},ru=function(e){return"".concat(su(),"/").concat(encodeURIComponent(e))};!function(e){e.local="local",e.firebase="firebase",e.azure="azure",e.azure_blob="azure_blob",e.openai="openai",e.s3="s3",e.vectordb="vectordb",e.execute_code="execute_code",e.mistral_ocr="mistral_ocr",e.azure_mistral_ocr="azure_mistral_ocr",e.vertexai_mistral_ocr="vertexai_mistral_ocr",e.text="text"}(Sd||(Sd={}));var ou,iu,lu,cu,du=function(e){return e===Sd.openai||e===Sd.azure};!function(e){e.avatar="avatar",e.unknown="unknown",e.agents="agents",e.assistants="assistants",e.execute_code="execute_code",e.image_generation="image_generation",e.assistants_output="assistants_output",e.message_attachment="message_attachment",e.filename="filename",e.updatedAt="updatedAt",e.source="source",e.filterSource="filterSource",e.context="context",e.bytes="bytes"}(ou||(ou={})),function(e){e.ServiceHttp="service_http",e.OAuth="oauth",e.None="none"}(iu||(iu={})),function(e){e.Bearer="bearer",e.Basic="basic",e.Custom="custom"}(lu||(lu={})),function(e){e.DefaultPost="default_post",e.BasicAuthHeader="basic_auth_header"}(cu||(cu={}));var uu,mu,pu,hu,gu,xu,fu,vu,_u,bu=sa({title:ra().regex(/^[a-zA-Z0-9 ]+$/,"Title can only contain letters, numbers, and spaces").optional(),description:ra().optional(),startup:la().optional(),iconPath:ra().optional(),timeout:pa().optional(),initTimeout:pa().optional(),chatMenu:la().optional(),serverInstructions:ia([la(),ra()]).optional(),requiresOAuth:la().optional(),oauth:sa({authorization_url:ra().url().optional(),token_url:ra().url().optional(),client_id:ra().optional(),client_secret:ra().optional(),scope:ra().optional(),redirect_uri:ra().url().optional(),token_exchange_method:oa(cu).optional(),grant_types_supported:ca(ra()).optional(),token_endpoint_auth_methods_supported:ca(ra()).optional(),response_types_supported:ca(ra()).optional(),code_challenge_methods_supported:ca(ra()).optional(),skip_code_challenge_check:la().optional(),revocation_endpoint:ra().url().optional(),revocation_endpoint_auth_methods_supported:ca(ra()).optional()}).optional(),oauth_headers:da(ra(),ra()).optional(),apiKey:sa({key:ra().optional(),source:aa(["admin","user"]),authorization_type:aa(["basic","bearer","custom"]),custom_header:ra().optional()}).optional(),customUserVars:da(ra(),sa({title:ra(),description:ra()})).optional()}),yu=bu.extend({type:ma("stdio").optional(),command:ra(),args:ca(ra()),env:da(ra(),ra()).optional().transform((function(e){if(!e)return e;for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var s=a[n],r=s[0],o=s[1];t[r]=Al(o)}return t})),stderr:xa().optional()}),ju=bu.extend({type:ma("websocket").optional(),url:ra().transform((function(e){return Al(e)})).pipe(ra().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"===t||"wss:"===t}),{message:"WebSocket URL must start with ws:// or wss://"})}),wu=bu.extend({type:ma("sse").optional(),headers:da(ra(),ra()).optional(),url:ra().transform((function(e){return Al(e)})).pipe(ra().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"SSE URL must not start with ws:// or wss://"})}),Nu=bu.extend({type:ia([ma("streamable-http"),ma("http")]),headers:da(ra(),ra()).optional(),url:ra().transform((function(e){return Al(e)})).pipe(ra().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"Streamable HTTP URL must not start with ws:// or wss://"})}),ku=ia([yu,ju,wu,Nu]),Cu=da(ra(),ku),Su=function(e){return e.omit({startup:!0,timeout:!0,initTimeout:!0,chatMenu:!0,serverInstructions:!0,requiresOAuth:!0,customUserVars:!0,oauth_headers:!0})};ia([Su(yu),Su(ju),Su(wu),Su(Nu)]);var Tu=new Set(["conversationId","title","iconURL","greeting","endpoint","endpointType","createdAt","updatedAt","expiredAt","messages","isArchived","tags","user","__v","_id","tools","model","files","spec","disableParams"]);!function(e){e.default="default",e.advanced="advanced"}(_u||(_u={}));var Eu=oa(Sd),Iu=sa({default:Eu.optional(),avatar:Eu.optional(),image:Eu.optional(),document:Eu.optional()}).optional();var Ru,Au,Pu=sa({deploymentName:ra().optional(),version:ra().optional(),assistants:la().optional()}).or(la()),Ou=sa({apiKey:ra(),serverless:la().optional(),instanceName:ra().optional(),deploymentName:ra().optional(),assistants:la().optional(),addParams:da(xa()).optional(),dropParams:ca(ra()).optional(),forcePrompt:la().optional(),version:ra().optional(),baseURL:ra().optional(),additionalHeaders:da(xa()).optional()}),Lu=sa({group:ra(),models:da(ra(),Pu)}).required().and(Ou),Mu=ca(Lu).min(1);!function(e){e.code_interpreter="code_interpreter",e.image_vision="image_vision",e.retrieval="retrieval",e.actions="actions",e.tools="tools"}(Ru||(Ru={})),function(e){e.hide_sequential_outputs="hide_sequential_outputs",e.end_after_tools="end_after_tools",e.execute_code="execute_code",e.file_search="file_search",e.web_search="web_search",e.artifacts="artifacts",e.actions="actions",e.context="context",e.tools="tools",e.chain="chain",e.ocr="ocr"}(Au||(Au={}));var Du,Fu=((uu={})[Yl.assistants]=2,uu[Yl.azureAssistants]=1,uu),Uu=sa({streamRate:pa().optional(),baseURL:ra().optional(),titlePrompt:ra().optional(),titleModel:ra().optional(),titleConvo:la().optional(),titleMethod:ia([ma("completion"),ma("functions"),ma("structured")]).optional(),titleEndpoint:ra().optional(),titlePromptTemplate:ra().optional()});Uu.merge(sa({availableRegions:ca(ra()).optional()}));var zu=ia([ra(),sa({name:ra(),description:ra().optional()})]),Vu=Uu.merge(sa({disableBuilder:la().optional(),pollIntervalMs:pa().optional(),timeoutMs:pa().optional(),version:ia([ra(),pa()]).default(2),supportedIds:ca(ra()).min(1).optional(),excludedIds:ca(ra()).min(1).optional(),privateAssistants:la().optional(),retrievalModels:ca(ra()).min(1).optional().default(["gpt-4o","o1-preview-2024-09-12","o1-preview","o1-mini-2024-09-12","o1-mini","o3-mini","chatgpt-4o-latest","gpt-4o-2024-05-13","gpt-4o-2024-08-06","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-turbo-preview","gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-0125","gpt-4-1106"]),capabilities:ca(oa(Ru)).optional().default([Ru.code_interpreter,Ru.image_vision,Ru.retrieval,Ru.actions,Ru.tools]),apiKey:ra().optional(),models:sa({default:ca(zu).min(1),fetch:la().optional(),userIdQuery:la().optional()}).optional(),headers:da(xa()).optional()})),$u=[Au.execute_code,Au.file_search,Au.web_search,Au.artifacts,Au.actions,Au.context,Au.tools,Au.chain,Au.ocr],Bu=Uu.merge(sa({recursionLimit:pa().optional(),disableBuilder:la().optional().default(!1),maxRecursionLimit:pa().optional(),maxCitations:pa().min(1).max(50).optional().default(30),maxCitationsPerFile:pa().min(1).max(10).optional().default(7),minRelevanceScore:pa().min(0).max(1).optional().default(.45),allowedProviders:ca(ia([ra(),Tc])).optional(),capabilities:ca(oa(Au)).optional().default($u)})).default({disableBuilder:!1,capabilities:$u,maxCitations:30,maxCitationsPerFile:7,minRelevanceScore:.45}),Hu=Uu.merge(sa({name:ra().refine((function(e){return!Tc.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(Yl).join(", "))}),apiKey:ra(),baseURL:ra(),models:sa({default:ca(zu).min(1),fetch:la().optional(),userIdQuery:la().optional()}),summarize:la().optional(),summaryModel:ra().optional(),iconURL:ra().optional(),forcePrompt:la().optional(),modelDisplayLabel:ra().optional(),headers:da(xa()).optional(),addParams:da(xa()).optional(),dropParams:ca(ra()).optional(),customParams:sa({defaultParamsEndpoint:ra().default("custom"),paramDefinitions:ca(da(xa())).optional()}).strict().optional(),customOrder:pa().optional(),directEndpoint:la().optional(),titleMessageRole:ra().optional()})),Gu=sa({groups:Mu,plugins:la().optional(),assistants:la().optional()}).and(Hu.pick({streamRate:!0,titleConvo:!0,titleMethod:!0,titleModel:!0,titlePrompt:!0,titlePromptTemplate:!0,summarize:!0,summaryModel:!0,customOrder:!0}).partial()),Ku=sa({url:ra().optional(),apiKey:ra(),model:ra(),voices:ca(ra())}),Wu=sa({instanceName:ra(),apiKey:ra(),deploymentName:ra(),apiVersion:ra(),model:ra(),voices:ca(ra())}),qu=sa({url:ra().optional(),websocketUrl:ra().optional(),apiKey:ra(),model:ra(),voices:ca(ra()),voice_settings:sa({similarity_boost:pa().optional(),stability:pa().optional(),style:pa().optional(),use_speaker_boost:la().optional()}).optional(),pronunciation_dictionary_locators:ca(ra()).optional()}),Qu=sa({url:ra(),apiKey:ra().optional(),voices:ca(ra()),backend:ra()}),Yu=sa({openai:Ku.optional(),azureOpenAI:Wu.optional(),elevenlabs:qu.optional(),localai:Qu.optional()}),Xu=sa({url:ra().optional(),apiKey:ra(),model:ra()}),Ju=sa({instanceName:ra(),apiKey:ra(),deploymentName:ra(),apiVersion:ra()}),Zu=sa({openai:Xu.optional(),azureOpenAI:Ju.optional()}),em=sa({conversationMode:la().optional(),advancedMode:la().optional(),speechToText:la().optional().or(sa({engineSTT:ra().optional(),languageSTT:ra().optional(),autoTranscribeAudio:la().optional(),decibelValue:pa().optional(),autoSendText:pa().optional()})).optional(),textToSpeech:la().optional().or(sa({engineTTS:ra().optional(),voice:ra().optional(),languageTTS:ra().optional(),automaticPlayback:la().optional(),playbackRate:pa().optional(),cacheTTS:la().optional()})).optional()}).optional();!function(e){e.FILE_UPLOAD="FILE_UPLOAD",e.IMPORT="IMPORT",e.TTS="TTS",e.STT="STT"}(Du||(Du={}));var tm,nm=sa({fileUploads:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional(),conversationsImport:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional(),tts:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional(),stt:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional()});!function(e){e.PNG="png",e.WEBP="webp",e.JPEG="jpeg"}(tm||(tm={}));var am,sm,rm,om,im,lm,cm=sa({externalUrl:ra().optional(),openNewTab:la().optional(),modalAcceptance:la().optional(),modalTitle:ra().optional(),modalContent:ra().or(ca(ra())).optional()}),dm=ia([ra(),da(ra())]),um=sa({placeholder:ra().optional(),use:la().optional(),create:la().optional(),share:la().optional(),trustCheckbox:sa({label:dm.optional(),subLabel:dm.optional()}).optional()}).optional(),mm=sa({privacyPolicy:sa({externalUrl:ra().optional(),openNewTab:la().optional()}).optional(),termsOfService:cm.optional(),customWelcome:ra().optional(),mcpServers:um.optional(),endpointsMenu:la().optional(),modelSelect:la().optional(),parameters:la().optional(),sidePanel:la().optional(),multiConvo:la().optional(),bookmarks:la().optional(),memories:la().optional(),presets:la().optional(),prompts:la().optional(),agents:la().optional(),temporaryChat:la().optional(),temporaryChatRetention:pa().min(1).max(8760).optional(),runCode:la().optional(),webSearch:la().optional(),peoplePicker:sa({users:la().optional(),groups:la().optional(),roles:la().optional()}).optional(),marketplace:sa({use:la().optional()}).optional(),fileSearch:la().optional(),fileCitations:la().optional()}).default({endpointsMenu:!0,modelSelect:!0,parameters:!0,sidePanel:!0,presets:!0,multiConvo:!0,bookmarks:!0,memories:!0,prompts:!0,agents:!0,temporaryChat:!0,runCode:!0,webSearch:!0,peoplePicker:{users:!0,groups:!0,roles:!0},marketplace:{use:!1},mcpServers:{use:!0,create:!0,share:!1},fileSearch:!0,fileCitations:!0}),pm=sa({language:ra().default("auto"),size:aa(["normal","compact","flexible","invisible"]).default("normal")}).default({language:"auto",size:"normal"}),hm=sa({siteKey:ra(),options:pm.optional()});!function(e){e.MISTRAL_OCR="mistral_ocr",e.CUSTOM_OCR="custom_ocr",e.AZURE_MISTRAL_OCR="azure_mistral_ocr",e.VERTEXAI_MISTRAL_OCR="vertexai_mistral_ocr"}(am||(am={})),function(e){e.PROVIDERS="providers",e.SCRAPERS="scrapers",e.RERANKERS="rerankers"}(sm||(sm={})),function(e){e.SERPER="serper",e.SEARXNG="searxng"}(rm||(rm={})),function(e){e.FIRECRAWL="firecrawl",e.SERPER="serper"}(om||(om={})),function(e){e.JINA="jina",e.COHERE="cohere"}(im||(im={})),function(e){e[e.OFF=0]="OFF",e[e.MODERATE=1]="MODERATE",e[e.STRICT=2]="STRICT"}(lm||(lm={}));var gm,xm,fm=sa({serperApiKey:ra().optional().default("${SERPER_API_KEY}"),searxngInstanceUrl:ra().optional().default("${SEARXNG_INSTANCE_URL}"),searxngApiKey:ra().optional().default("${SEARXNG_API_KEY}"),firecrawlApiKey:ra().optional().default("${FIRECRAWL_API_KEY}"),firecrawlApiUrl:ra().optional().default("${FIRECRAWL_API_URL}"),firecrawlVersion:ra().optional().default("${FIRECRAWL_VERSION}"),jinaApiKey:ra().optional().default("${JINA_API_KEY}"),jinaApiUrl:ra().optional().default("${JINA_API_URL}"),cohereApiKey:ra().optional().default("${COHERE_API_KEY}"),searchProvider:oa(rm).optional(),scraperProvider:oa(om).optional(),rerankerType:oa(im).optional(),scraperTimeout:pa().optional(),safeSearch:oa(lm).default(lm.MODERATE),firecrawlOptions:sa({formats:ca(ra()).optional(),includeTags:ca(ra()).optional(),excludeTags:ca(ra()).optional(),headers:da(ra()).optional(),waitFor:pa().optional(),timeout:pa().optional(),maxAge:pa().optional(),mobile:la().optional(),skipTlsVerification:la().optional(),blockAds:la().optional(),removeBase64Images:la().optional(),parsePDF:la().optional(),storeInCache:la().optional(),zeroDataRetention:la().optional(),location:sa({country:ra().optional(),languages:ca(ra()).optional()}).optional(),onlyMainContent:la().optional(),changeTrackingOptions:sa({modes:ca(ra()).optional(),schema:da(ua()).optional(),prompt:ra().optional(),tag:ra().nullable().optional()}).optional()}).optional()}),vm=sa({mistralModel:ra().optional(),apiKey:ra().optional().default("${OCR_API_KEY}"),baseURL:ra().optional().default("${OCR_BASEURL}"),strategy:oa(am).default(am.MISTRAL_OCR)}),_m=sa({enabled:la().optional().default(!1),startBalance:pa().optional().default(2e4),autoRefillEnabled:la().optional().default(!1),refillIntervalValue:pa().optional().default(30),refillIntervalUnit:aa(["seconds","minutes","hours","days","weeks","months"]).optional().default("days"),refillAmount:pa().optional().default(1e4)}),bm=sa({enabled:la().optional().default(!0)}),ym=sa({disabled:la().optional(),validKeys:ca(ra()).optional(),tokenLimit:pa().optional(),charLimit:pa().optional().default(1e4),personalize:la().default(!0),messageWindowSize:pa().optional().default(5),agent:ia([sa({id:ra()}),sa({provider:ra(),model:ra(),instructions:ra().optional(),model_parameters:da(xa()).optional()})]).optional()}),jm=ca(Hu.partial()).optional(),wm=sa({version:ra(),cache:la().default(!0),ocr:vm.optional(),webSearch:fm.optional(),memory:ym.optional(),secureImageLinks:la().optional(),imageOutputType:oa(tm).default(tm.PNG),includedTools:ca(ra()).optional(),filteredTools:ca(ra()).optional(),mcpServers:Cu.optional(),mcpSettings:sa({allowedDomains:ca(ra()).optional()}).optional(),interface:mm,turnstile:hm.optional(),fileStrategy:Eu.default(Sd.local),fileStrategies:Iu,actions:sa({allowedDomains:ca(ra()).optional()}).optional(),registration:sa({socialLogins:ca(ra()).optional(),allowedDomains:ca(ra()).optional()}).default({socialLogins:["google","facebook","openid","github","discord","saml"]}),balance:_m.optional(),transactions:bm.optional(),speech:sa({tts:Yu.optional(),stt:Zu.optional(),speechTab:em.optional()}).optional(),rateLimits:nm.optional(),fileConfig:_d.optional(),modelSpecs:Jc.optional(),endpoints:sa((mu={all:Uu.optional()},mu[Yl.openAI]=Uu.optional(),mu[Yl.google]=Uu.optional(),mu[Yl.anthropic]=Uu.optional(),mu[Yl.azureOpenAI]=Gu.optional(),mu[Yl.azureAssistants]=Vu.optional(),mu[Yl.assistants]=Vu.optional(),mu[Yl.agents]=Bu.optional(),mu[Yl.custom]=jm.optional(),mu[Yl.bedrock]=Uu.optional(),mu)).strict().refine((function(e){return Object.keys(e).length>0}),{message:"At least one `endpoints` field must be provided."}).optional()}),Nm=function(){return e=wm.shape,t=Object.entries(e).map((function(e){var t=e[0],n=e[1];return n instanceof fa?[t,n._def.defaultValue()]:[t,void 0]})),Object.fromEntries(t);var e,t};!function(e){e.anyscale="anyscale",e.apipie="apipie",e.cohere="cohere",e.fireworks="fireworks",e.deepseek="deepseek",e.groq="groq",e.helicone="helicone",e.huggingface="huggingface",e.mistral="mistral",e.mlx="mlx",e.ollama="ollama",e.openrouter="openrouter",e.perplexity="perplexity",e.shuttleai="shuttleai",e["together.ai"]="together.ai",e.unify="unify",e.vercel="vercel",e.xai="xai"}(gm||(gm={})),function(e){e.openrouter="openrouter",e.helicone="helicone"}(xm||(xm={}));var km,Cm=[Yl.openAI,Yl.assistants,Yl.azureAssistants,Yl.azureOpenAI,Yl.agents,Yl.google,Yl.anthropic,Yl.custom,Yl.bedrock],Sm=((pu={})[Yl.openAI]="OpenAI",pu[Yl.assistants]="Assistants",pu[Yl.agents]="My Agents",pu[Yl.azureAssistants]="Azure Assistants",pu[Yl.azureOpenAI]="Azure OpenAI",pu[Yl.google]="Google",pu[Yl.anthropic]="Anthropic",pu[Yl.custom]="Custom",pu[Yl.bedrock]="AWS Bedrock",pu[gm.ollama]="Ollama",pu[gm.deepseek]="DeepSeek",pu[gm.xai]="xAI",pu[gm.vercel]="Vercel",pu[gm.helicone]="Helicone",pu),Tm=["gpt-5.1","gpt-5.1-chat-latest","gpt-5.1-codex","gpt-5.1-codex-mini","gpt-5","gpt-5-mini","gpt-5-nano","gpt-5-chat-latest","gpt-4.1","gpt-4.1-mini","gpt-4.1-nano","gpt-4o-mini","gpt-4o","gpt-4.5-preview","gpt-4.5-preview-2025-02-27","gpt-3.5-turbo","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-turbo-2024-04-09","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],Em=((hu={})[Yl.azureAssistants]=Tm,hu[Yl.assistants]=wl(wl([],Tm,!0),["chatgpt-4o-latest"],!1),hu[Yl.agents]=Tm,hu[Yl.google]=["gemini-2.5-pro","gemini-2.5-flash","gemini-2.5-flash-lite","gemini-2.0-flash-001","gemini-2.0-flash-lite"],hu[Yl.anthropic]=["claude-sonnet-4-5","claude-sonnet-4-5-20250929","claude-haiku-4-5","claude-haiku-4-5-20251001","claude-opus-4-1","claude-opus-4-1-20250805","claude-opus-4-5","claude-sonnet-4-20250514","claude-sonnet-4-0","claude-opus-4-20250514","claude-opus-4-0","claude-3-7-sonnet-latest","claude-3-7-sonnet-20250219","claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-5-sonnet-20240620","claude-3-5-sonnet-latest","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307","claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],hu[Yl.openAI]=wl(wl([],Tm,!0),["chatgpt-4o-latest","gpt-4-vision-preview","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-instruct"],!1),hu[Yl.bedrock]=["anthropic.claude-sonnet-4-5-20250929-v1:0","anthropic.claude-haiku-4-5-20251001-v1:0","anthropic.claude-opus-4-1-20250805-v1:0","anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-5-sonnet-20240620-v1:0","anthropic.claude-3-5-haiku-20241022-v1:0","anthropic.claude-3-haiku-20240307-v1:0","anthropic.claude-3-opus-20240229-v1:0","anthropic.claude-3-sonnet-20240229-v1:0","anthropic.claude-v2","anthropic.claude-v2:1","anthropic.claude-instant-v1","cohere.command-r-v1:0","cohere.command-r-plus-v1:0","meta.llama2-13b-chat-v1","meta.llama2-70b-chat-v1","meta.llama3-8b-instruct-v1:0","meta.llama3-70b-instruct-v1:0","meta.llama3-1-8b-instruct-v1:0","meta.llama3-1-70b-instruct-v1:0","meta.llama3-1-405b-instruct-v1:0","mistral.mistral-7b-instruct-v0:2","mistral.mixtral-8x7b-instruct-v0:1","mistral.mistral-large-2402-v1:0","mistral.mistral-large-2407-v1:0","mistral.mistral-small-2402-v1:0","ai21.jamba-instruct-v1:0","amazon.titan-text-lite-v1","amazon.titan-text-express-v1","amazon.titan-text-premier-v1:0"],hu),Im=Em[Yl.openAI];(gu={initial:[]})[Yl.openAI]=Im,gu[Yl.assistants]=Im.filter((function(e){return/gpt-4|gpt-3\\.5/i.test(e)&&!/vision|instruct/i.test(e)})),gu[Yl.agents]=Im,gu[Yl.azureOpenAI]=Im,gu[Yl.google]=Em[Yl.google],gu[Yl.anthropic]=Em[Yl.anthropic],gu[Yl.bedrock]=Em[Yl.bedrock];var Rm=((xu={})[Yl.assistants]="".concat(Td(),"/api/assistants/v2/chat"),xu[Yl.azureAssistants]="".concat(Td(),"/api/assistants/v1/chat"),xu[Yl.agents]="".concat(Td(),"/api/").concat(Yl.agents,"/chat"),xu),Am=new Set([Yl.anthropic,Yl.google,Yl.openAI,Yl.azureOpenAI,Yl.custom,Yl.agents,Yl.bedrock]);(fu={})[Yl.custom]=!0,fu[Yl.openAI]=!0,fu[Yl.anthropic]=!0,fu[Yl.assistants]=!0,fu[Yl.agents]=!0,fu[Yl.azureAssistants]=!0,fu[Yl.azureOpenAI]=!0,fu[Yl.bedrock]=!0,fu[Yl.google]=!0,function(e){e.generative="generative",e.agents="agents"}(km||(km={}));var Pm,Om,Lm,Mm,Dm,Fm,Um,zm,Vm,$m,Bm,Hm,Gm,Km,Wm,qm,Qm,Ym,Xm=new Set(["dalle","dall-e","stable-diffusion","flux"]);!function(e){e.PROMPT_GROUPS="promptGroups",e.SHARED_LINKS="sharedLinks"}(Pm||(Pm={})),function(e){e[e.ONE_DAY=864e5]="ONE_DAY",e[e.TWELVE_HOURS=432e5]="TWELVE_HOURS",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.THIRTY_MINUTES=18e5]="THIRTY_MINUTES",e[e.TEN_MINUTES=6e5]="TEN_MINUTES",e[e.FIVE_MINUTES=3e5]="FIVE_MINUTES",e[e.THREE_MINUTES=18e4]="THREE_MINUTES",e[e.TWO_MINUTES=12e4]="TWO_MINUTES",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.THIRTY_SECONDS=3e4]="THIRTY_SECONDS"}(Om||(Om={})),function(e){e.CONFIG_STORE="CONFIG_STORE",e.ROLES="ROLES",e.GEN_TITLE="GEN_TITLE",e.TOOLS="TOOLS",e.MODELS_CONFIG="MODELS_CONFIG",e.MODEL_QUERIES="MODEL_QUERIES",e.STARTUP_CONFIG="STARTUP_CONFIG",e.ENDPOINT_CONFIG="ENDPOINT_CONFIG",e.TOKEN_CONFIG="TOKEN_CONFIG",e.APP_CONFIG="APP_CONFIG",e.ABORT_KEYS="ABORT_KEYS",e.BANS="BANS",e.ENCODED_DOMAINS="ENCODED_DOMAINS",e.AUDIO_RUNS="AUDIO_RUNS",e.MESSAGES="MESSAGES",e.FLOWS="FLOWS",e.PENDING_REQ="PENDING_REQ",e.S3_EXPIRY_INTERVAL="S3_EXPIRY_INTERVAL",e.OPENID_EXCHANGED_TOKENS="OPENID_EXCHANGED_TOKENS",e.OPENID_SESSION="OPENID_SESSION",e.SAML_SESSION="SAML_SESSION"}(Lm||(Lm={})),function(e){e.FILE_UPLOAD_LIMIT="file_upload_limit",e.ILLEGAL_MODEL_REQUEST="illegal_model_request",e.TOKEN_BALANCE="token_balance",e.BAN="ban",e.TTS_LIMIT="tts_limit",e.STT_LIMIT="stt_limit",e.RESET_PASSWORD_LIMIT="reset_password_limit",e.VERIFY_EMAIL_LIMIT="verify_email_limit",e.CONVO_ACCESS="convo_access",e.TOOL_CALL_LIMIT="tool_call_limit",e.GENERAL="general",e.LOGINS="logins",e.CONCURRENT="concurrent",e.NON_BROWSER="non_browser",e.MESSAGE_LIMIT="message_limit",e.REGISTRATIONS="registrations"}(Mm||(Mm={})),function(e){e.NO_USER_KEY="no_user_key",e.EXPIRED_USER_KEY="expired_user_key",e.INVALID_USER_KEY="invalid_user_key",e.NO_BASE_URL="no_base_url",e.MODERATION="moderation",e.INPUT_LENGTH="INPUT_LENGTH",e.INVALID_REQUEST="invalid_request_error",e.INVALID_ACTION="invalid_action_error",e.NO_SYSTEM_MESSAGES="no_system_messages",e.GOOGLE_ERROR="google_error",e.GOOGLE_TOOL_CONFLICT="google_tool_conflict",e.INVALID_AGENT_PROVIDER="invalid_agent_provider",e.MISSING_MODEL="missing_model",e.MODELS_NOT_LOADED="models_not_loaded",e.ENDPOINT_MODELS_NOT_LOADED="endpoint_models_not_loaded",e.AUTH_FAILED="auth_failed",e.REFUSAL="refusal"}(Dm||(Dm={})),function(e){e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY"}(Fm||(Fm={})),function(e){e[e.LOW=85]="LOW",e[e.HIGH=170]="HIGH",e[e.ADDITIONAL=85]="ADDITIONAL"}(Um||(Um={})),function(e){e.GENERAL="general",e.CHAT="chat",e.SPEECH="speech",e.BETA="beta",e.DATA="data",e.BALANCE="balance",e.ACCOUNT="account",e.COMMANDS="commands",e.PERSONALIZATION="personalization"}(zm||(zm={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI"}(Vm||(Vm={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI",e.ELEVENLABS="elevenlabs",e.LOCALAI="localai"}($m||($m={})),function(e){e.VERSION="v0.8.2-rc1",e.CONFIG_VERSION="1.3.1",e.NO_PARENT="00000000-0000-0000-0000-000000000000",e.USE_PRELIM_RESPONSE_MESSAGE_ID="USE_PRELIM_RESPONSE_MESSAGE_ID",e.NEW_CONVO="new",e.PENDING_CONVO="PENDING",e.SEARCH="search",e[e.ENCODED_DOMAIN_LENGTH=10]="ENCODED_DOMAIN_LENGTH",e.CURRENT_MODEL="current_model",e.COMMON_DIVIDER="__",e[e.COMMANDS_MAX_LENGTH=56]="COMMANDS_MAX_LENGTH",e[e.DEFAULT_STREAM_RATE=1]="DEFAULT_STREAM_RATE",e.SAVED_TAG="Saved",e[e.MAX_CONVO_STARTERS=4]="MAX_CONVO_STARTERS",e.GLOBAL_PROJECT_NAME="instance",e.mcp_delimiter="_mcp_",e.mcp_prefix="mcp_",e.mcp_all="sys__all__sys",e.mcp_clear="sys__clear__sys",e.mcp_server="sys__server__sys",e.LC_TRANSFER_TO_="lc_transfer_to_",e.EPHEMERAL_AGENT_ID="ephemeral"}(Bm||(Bm={})),function(e){e.APP_TITLE="appTitle",e.LAST_CONVO_SETUP="lastConversationSetup",e.LAST_MODEL="lastSelectedModel",e.LAST_TOOLS="lastSelectedTools",e.LAST_SPEC="lastSelectedSpec",e.FILES_TO_DELETE="filesToDelete",e.ASST_ID_PREFIX="assistant_id__",e.AGENT_ID_PREFIX="agent_id__",e.FORK_SETTING="forkSetting",e.REMEMBER_FORK_OPTION="rememberDefaultFork",e.FORK_SPLIT_AT_TARGET="splitAtTarget",e.TEXT_DRAFT="textDraft_",e.FILES_DRAFT="filesDraft_",e.LAST_PROMPT_CATEGORY="lastPromptCategory",e.ENABLE_USER_MSG_MARKDOWN="enableUserMsgMarkdown",e.SHOW_ANALYSIS_CODE="showAnalysisCode",e.LAST_MCP_="LAST_MCP_",e.LAST_CODE_TOGGLE_="LAST_CODE_TOGGLE_",e.LAST_WEB_SEARCH_TOGGLE_="LAST_WEB_SEARCH_TOGGLE_",e.LAST_FILE_SEARCH_TOGGLE_="LAST_FILE_SEARCH_TOGGLE_",e.LAST_ARTIFACTS_TOGGLE_="LAST_ARTIFACTS_TOGGLE_",e.LAST_AGENT_PROVIDER="lastAgentProvider",e.LAST_AGENT_MODEL="lastAgentModel",e.PIN_MCP_="PIN_MCP_",e.PIN_WEB_SEARCH_="PIN_WEB_SEARCH_",e.PIN_CODE_INTERPRETER_="PIN_CODE_INTERPRETER_"}(Hm||(Hm={})),function(e){e.DIRECT_PATH="directPath",e.INCLUDE_BRANCHES="includeBranches",e.TARGET_LEVEL="targetLevel",e.DEFAULT="default"}(Gm||(Gm={})),function(e){e.API_URL="https://api.cohere.ai/v1",e.ROLE_USER="USER",e.ROLE_SYSTEM="SYSTEM",e.ROLE_CHATBOT="CHATBOT",e.TITLE_MESSAGE="TITLE:"}(Km||(Km={})),function(e){e.ALL="sys__all__sys",e.MY_PROMPTS="sys__my__prompts__sys",e.NO_CATEGORY="sys__no__category__sys",e.SHARED_PROMPTS="sys__shared__prompts__sys"}(Wm||(Wm={})),(vu={})[Yl.openAI]=Yl.openAI,vu[Yl.bedrock]=Yl.bedrock,vu[Yl.anthropic]=Yl.anthropic,vu[Yl.azureOpenAI]=Yl.azureOpenAI;var Jm={current_date:!0,current_user:!0,iso_datetime:!0,current_datetime:!0};function Zm(e,t,n){if(e&&null!=t){var a=e[t];if(a)return a[n]}}!function(e){e.TEXT="text",e.THINK="think",e.TEXT_DELTA="text_delta",e.TOOL_CALL="tool_call",e.IMAGE_FILE="image_file",e.IMAGE_URL="image_url",e.AGENT_UPDATE="agent_update",e.ERROR="error"}(qm||(qm={})),function(e){e.TOOL_CALLS="tool_calls",e.MESSAGE_CREATION="message_creation"}(Qm||(Qm={})),function(e){e.FUNCTION="function",e.RETRIEVAL="retrieval",e.FILE_SEARCH="file_search",e.CODE_INTERPRETER="code_interpreter",e.TOOL_CALL="tool_call"}(Ym||(Ym={}));var ep=Mc.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,maxOutputTokens:!0,maxContextTokens:!0,artifacts:!0,region:!0,system:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,promptCache:!0,topK:!0,additionalModelRequestFields:!0}).transform((function(e){var t,n;if(null!=(null===(t=e.additionalModelRequestFields)||void 0===t?void 0:t.thinking)){var a=e;e.thinking=!!a.additionalModelRequestFields.thinking,e.thinkingBudget="object"==typeof a.additionalModelRequestFields.thinking?null===(n=a.additionalModelRequestFields.thinking)||void 0===n?void 0:n.budget_tokens:void 0,delete e.additionalModelRequestFields}return $c(e)})).catch((function(){return{}}));Mc.pick({modelLabel:!0,promptPrefix:!0,resendFiles:!0,iconURL:!0,greeting:!0,spec:!0,artifacts:!0,maxOutputTokens:!0,maxContextTokens:!0,region:!0,model:!0,maxTokens:!0,temperature:!0,topP:!0,stop:!0,thinking:!0,thinkingBudget:!0,promptCache:!0,topK:!0,additionalModelRequestFields:!0}).catchall(xa()).transform((function(e){var t=["modelLabel","promptPrefix","resendFiles","iconURL","greeting","spec","maxOutputTokens","artifacts","additionalModelRequestFields","region","model","maxTokens","temperature","topP","stop","promptCache"],n={},a=e;return Object.entries(a).forEach((function(e){var s=e[0],r=e[1];t.includes(s)||("topK"===s?n.top_k=r:n[s]=r,delete a[s])})),"string"==typeof a.model&&(a.model.includes("anthropic.claude-3-7-sonnet")||/anthropic\.claude-(?:[4-9](?:\.\d+)?(?:-\d+)?-(?:sonnet|opus|haiku)|(?:sonnet|opus|haiku)-[4-9])/.test(a.model))?(void 0===n.thinking?n.thinking=!0:!1===n.thinking&&(delete n.thinking,delete n.thinkingBudget),!0===n.thinking&&void 0===n.thinkingBudget&&(n.thinkingBudget=2e3),n.anthropic_beta=["output-128k-2025-02-19"]):null==n.thinking&&null==n.thinkingBudget||(delete n.thinking,delete n.thinkingBudget),"string"==typeof a.model&&(a.model.includes("claude")||a.model.includes("nova"))&&void 0===a.promptCache&&(a.promptCache=!0),Object.keys(n).length>0&&(a.additionalModelRequestFields=_l(_l({},a.additionalModelRequestFields||{}),n)),void 0!==a.maxOutputTokens?a.maxTokens=a.maxOutputTokens:void 0!==a.maxTokens&&(a.maxOutputTokens=a.maxTokens),$c(a)})).catch((function(){return{}}));var tp,np,ap=((tp={})[Yl.openAI]=Wc,tp[Yl.azureOpenAI]=Wc,tp[Yl.custom]=Wc,tp[Yl.google]=Vc,tp[Yl.anthropic]=Qc,tp[Yl.assistants]=Gc,tp[Yl.azureAssistants]=Gc,tp[Yl.agents]=Yc,tp[Yl.bedrock]=ep,tp);function sp(e){for(var t,n=0,a=e;n<a.length;n++){var s=a[n];if(s){t=s;break}}return t}function rp(e){for(var t=0,n=e;t<n.length;t++){var a=n[t];if(a&&""!==a.trim())return a}}var op,ip=function(e){var t,n=e.endpoint,a=e.endpointType,s=e.conversation,r=e.possibleValues,o=ap[n];if(!o&&!a)throw new Error("Unknown endpoint: ".concat(n));!o&&a&&(o=ap[a]);var i=null==o?void 0:o.parse(s),l=(null!=r?r:{}).models;return l&&i&&(i.model=null!==(t=sp(l))&&void 0!==t?t:i.model),i},lp=function(e){var t=e.match(/gpt-(\d+(?:\.\d+)?)([a-z])?/i);if(t){var n=t[1],a=t[2]||"";return"GPT-".concat(n).concat(a)}return""},cp=function(e){var t=e.match(/\bo(\d+(?:\.\d+)?)\b/i);if(t){var n=t[1];return"o".concat(n)}return""},dp=function(e){var t,n=e.model,a=e.endpoint,s=e.endpointType,r=e.modelDisplayLabel,o=e.chatGptLabel,i=e.modelLabel,l=a,c=null!=n?n:"",d=null!=r?r:"",u=null!=o?o:"",m=null!=i?i:"";return[Yl.openAI,Yl.bedrock,Yl.azureOpenAI].includes(l)?u||m||(c&&cp(c)?cp(c):c&&(c.includes("mistral")||c.includes("codestral"))?"Mistral":c&&c.includes("deepseek")?"Deepseek":c&&c.includes("gpt-")?lp(c)||"GPT":null!==(t=Sm[l])&&void 0!==t?t:"AI"):l===Yl.anthropic?m||"Claude":l===Yl.bedrock?m||Sm[l]:l===Yl.google?m||(!0===(null==c?void 0:c.toLowerCase().includes("gemma"))?"Gemma":"Gemini"):l===Yl.custom||s===Yl.custom?m||u||(c&&cp(c)?cp(c):c&&(c.includes("mistral")||c.includes("codestral"))?"Mistral":c&&c.includes("deepseek")?"Deepseek":c&&c.includes("gpt-")?lp(c)||"GPT":d||"AI"):""},up=((np={})[Yl.openAI]=Wc,np[Yl.azureOpenAI]=Wc,np[Yl.custom]=Wc,np[Yl.assistants]=Kc,np[Yl.azureAssistants]=Kc,np[Yl.agents]=Yc,np[Yl.google]=qc,np[Yl.bedrock]=ep,np[Yl.anthropic]=Qc,np),mp=function(e){var t,n=e.endpoint,a=e.endpointType,s=e.conversation,r=e.possibleValues;if(!n)throw new Error("undefined endpoint: ".concat(n));var o=up[n];if(!o&&!a)throw new Error("Unknown endpoint: ".concat(n));if(!o&&a&&(o=up[a]),!o)throw new Error("Unknown endpointType: ".concat(a));s.iconURL;var i=bl(s,["iconURL"]),l=o.parse(i),c=(null!=r?r:{}).models;return c&&l&&(l.model=null!==(t=sp(c))&&void 0!==t?t:l.model),l};function pp(e,t){var n;void 0===t&&(t=!1);for(var a="",s=0,r=e;s<r.length;s++){var o=r[s];if(o.type)if(o.type===qm.TEXT){var i=("string"==typeof o.text?o.text:null===(n=o.text)||void 0===n?void 0:n.value)||"";a.length>0&&i.length>0&&" "!==a[a.length-1]&&" "!==i[0]&&(a+=" "),a+=i}else o.type!==qm.THINK||t||(i="string"==typeof o.think?o.think:"",a.length>0&&i.length>0&&" "!==a[a.length-1]&&" "!==i[0]&&(a+=" "),a+=i)}return a}function hp(e){var t=e.text,n=e.user,a=t;if(!a)return a;var s=r().format("YYYY-MM-DD"),o=r().day(),i="".concat(s," (").concat(o,")");a=a.replace(/{{current_date}}/gi,i);var l=r().format("YYYY-MM-DD HH:mm:ss");a=a.replace(/{{current_datetime}}/gi,"".concat(l," (").concat(o,")"));var c=r().toISOString();return a=a.replace(/{{iso_datetime}}/gi,c),n&&n.name&&(a=a.replace(/{{current_user}}/gi,n.name)),a}function gp(e){var t=e.messages,n=e.fileMap;if(null===t)return null;var a={},s=[],r={};return t.forEach((function(e){var t;if(e){var o=null!==(t=e.parentMessageId)&&void 0!==t?t:"";r[o]=(r[o]||0)+1;var i=_l(_l({},e),{children:[],depth:0,siblingIndex:r[o]-1});e.files&&n&&(i.files=e.files.map((function(e){var t,a;return null!==(a=n[null!==(t=e.file_id)&&void 0!==t?t:""])&&void 0!==a?a:e}))),a[e.messageId]=i;var l=a[o];l?(l.children.push(i),i.depth=l.depth+1):s.push(i)}})),s}!function(e){e.DEFAULT="default",e.SHADCNUI="shadcnui",e.CUSTOM="custom"}(op||(op={}));var xp,fp,vp,_p,bp,yp,jp,wp,Np,kp,Cp,Sp,Tp,Ep,Ip,Rp,Ap,Pp,Op,Lp={utils:'\nimport { type ClassValue, clsx } from "clsx"\nimport { twMerge } from "tailwind-merge"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n',accordian:'import * as React from "react"\nimport * as AccordionPrimitive from "@radix-ui/react-accordion"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn("border-b", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = "AccordionItem"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className="flex">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"\n    {...props}\n  >\n    <div className={cn("pb-4 pt-0", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n',alertDialog:'import * as React from "react"\nimport * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-2 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = "AlertDialogHeader"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = "AlertDialogFooter"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn("text-lg font-semibold", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: "outline" }),\n      "mt-2 sm:mt-0",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n',alert:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst alertVariants = cva(\n  "relative w-full rounded-lg border border-gray-200 p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 dark:border-gray-800 dark:[&>svg]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role="alert"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = "Alert"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn("mb-1 font-medium leading-none tracking-tight", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = "AlertTitle"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("text-sm [&_p]:leading-relaxed", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = "AlertDescription"\n\nexport { Alert, AlertTitle, AlertDescription }\n\n',avatar:'import * as React from "react"\nimport * as AvatarPrimitive from "@radix-ui/react-avatar"\n\nimport { cn } from "../../lib/utils"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn("aspect-square h-full w-full", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      "flex h-full w-full items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n\n',badge:'import * as React from "react"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst badgeVariants = cva(\n  "inline-flex items-center rounded-full border border-gray-200 px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 dark:border-gray-800 dark:focus:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default:\n          "border-transparent bg-gray-900 text-gray-50 hover:bg-gray-900/80 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/80",\n        secondary:\n          "border-transparent bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        destructive:\n          "border-transparent bg-red-500 text-gray-50 hover:bg-red-500/80 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/80",\n        outline: "text-gray-950 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n\n',breadcrumb:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<"nav"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)\nBreadcrumb.displayName = "Breadcrumb"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<"ol">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      "flex flex-wrap items-center gap-1.5 break-words text-sm text-gray-500 sm:gap-2.5 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = "BreadcrumbList"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<"li">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn("inline-flex items-center gap-1.5", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = "BreadcrumbItem"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<"a"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : "a"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn("transition-colors hover:text-gray-950 dark:hover:text-gray-50", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = "BreadcrumbLink"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<"span">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role="link"\n    aria-disabled="true"\n    aria-current="page"\n    className={cn("font-normal text-gray-950 dark:text-gray-50", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = "BreadcrumbPage"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<"li">) => (\n  <li\n    role="presentation"\n    aria-hidden="true"\n    className={cn("[&>svg]:size-3.5", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = "BreadcrumbSeparator"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    role="presentation"\n    aria-hidden="true"\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = "BreadcrumbElipssis"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n\n',button:'import * as React from "react"\nimport { Slot } from "@radix-ui/react-slot"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from \'../../lib/utils\';\n\nconst buttonVariants = cva(\n  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n  {\n    variants: {\n      variant: {\n        default: "bg-gray-900 text-gray-50 hover:bg-gray-900/90 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50/90",\n        destructive:\n          "bg-red-500 text-gray-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-gray-50 dark:hover:bg-red-900/90",\n        outline:\n          "border border-gray-200 bg-white hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        secondary:\n          "bg-gray-100 text-gray-900 hover:bg-gray-100/80 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-800/80",\n        ghost: "hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n        link: "text-gray-900 underline-offset-4 hover:underline dark:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-4 py-2",\n        sm: "h-9 rounded-md px-3",\n        lg: "h-11 rounded-md px-8",\n        icon: "h-10 w-10",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : "button"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = "Button"\n\nexport { Button, buttonVariants }\n',calendar:'import * as React from "react"\nimport { ChevronLeft, ChevronRight } from "lucide-react"\nimport { DayPicker } from "react-day-picker"\n\nimport { cn } from "../../lib/utils"\nimport { buttonVariants } from "./button"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn("p-3", className)}\n      classNames={{\n        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",\n        month: "space-y-4",\n        caption: "flex justify-center pt-1 relative items-center",\n        caption_label: "text-sm font-medium",\n        nav: "space-x-1 flex items-center",\n        nav_button: cn(\n          buttonVariants({ variant: "outline" }),\n          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"\n        ),\n        nav_button_previous: "absolute left-1",\n        nav_button_next: "absolute right-1",\n        table: "w-full border-collapse space-y-1",\n        head_row: "flex",\n        head_cell:\n          "text-gray-500 rounded-md w-9 font-normal text-[0.8rem] dark:text-gray-400",\n        row: "flex w-full mt-2",\n        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-gray-100/50 [&:has([aria-selected])]:bg-gray-100 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20 dark:[&:has([aria-selected].day-outside)]:bg-gray-800/50 dark:[&:has([aria-selected])]:bg-gray-800",\n        day: cn(\n          buttonVariants({ variant: "ghost" }),\n          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"\n        ),\n        day_range_end: "day-range-end",\n        day_selected:\n          "bg-gray-900 text-gray-50 hover:bg-gray-900 hover:text-gray-50 focus:bg-gray-900 focus:text-gray-50 dark:bg-gray-50 dark:text-gray-900 dark:hover:bg-gray-50 dark:hover:text-gray-900 dark:focus:bg-gray-50 dark:focus:text-gray-900",\n        day_today: "bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-50",\n        day_outside:\n          "day-outside text-gray-500 opacity-50 aria-selected:bg-gray-100/50 aria-selected:text-gray-500 aria-selected:opacity-30 dark:text-gray-400 dark:aria-selected:bg-gray-800/50 dark:aria-selected:text-gray-400",\n        day_disabled: "text-gray-500 opacity-50 dark:text-gray-400",\n        day_range_middle:\n          "aria-selected:bg-gray-100 aria-selected:text-gray-900 dark:aria-selected:bg-gray-800 dark:aria-selected:text-gray-50",\n        day_hidden: "invisible",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className="h-4 w-4" />,\n        IconRight: ({ ...props }) => <ChevronRight className="h-4 w-4" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = "Calendar"\n\nexport { Calendar }\n\n',card:'import * as React from \'react\';\n\nimport { cn } from \'../../lib/utils\';\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      "rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = "Card"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex flex-col space-y-1.5 p-6", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = "CardHeader"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      "text-2xl font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = "CardTitle"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = "CardDescription"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />\n))\nCardContent.displayName = "CardContent"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn("flex items-center p-6 pt-0", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = "CardFooter"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n',carousel:'import * as React from "react"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from "embla-carousel-react"\nimport { ArrowLeft, ArrowRight } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { Button } from "./button"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: "horizontal" | "vertical"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error("useCarousel must be used within a <Carousel />")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = "horizontal",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === "horizontal" ? "x" : "y",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === "ArrowLeft") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === "ArrowRight") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on("reInit", onSelect)\n      api.on("select", onSelect)\n\n      return () => {\n        api?.off("select", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn("relative", className)}\n          role="region"\n          aria-roledescription="carousel"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = "Carousel"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className="overflow-hidden">\n      <div\n        ref={ref}\n        className={cn(\n          "flex",\n          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = "CarouselContent"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role="group"\n      aria-roledescription="slide"\n      className={cn(\n        "min-w-0 shrink-0 grow-0 basis-full",\n        orientation === "horizontal" ? "pl-4" : "pt-4",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = "CarouselItem"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute  h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-left-12 top-1/2 -translate-y-1/2"\n          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className="h-4 w-4" />\n      <span className="sr-only">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = "CarouselPrevious"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = "outline", size = "icon", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        "absolute h-8 w-8 rounded-full",\n        orientation === "horizontal"\n          ? "-right-12 top-1/2 -translate-y-1/2"\n          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className="h-4 w-4" />\n      <span className="sr-only">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = "CarouselNext"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n\n',checkbox:'import * as React from "react"\nimport * as CheckboxPrimitive from "@radix-ui/react-checkbox"\nimport { Check } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      "peer h-4 w-4 shrink-0 rounded-sm border border-gray-200 dark:border-gray-900 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=checked]:text-gray-50  dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=checked]:bg-gray-50 dark:data-[state=checked]:text-gray-900",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn("flex items-center justify-center text-current")}\n    >\n      <Check className="h-4 w-4" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n\n',collapsible:'import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n\n',dialog:'import * as React from "react"\nimport * as DialogPrimitive from "@radix-ui/react-dialog"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-gray-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-gray-100 data-[state=open]:text-gray-500 dark:ring-offset-gray-950 dark:focus:ring-gray-300 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-400">\n        <X className="h-4 w-4" />\n        <span className="sr-only">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col space-y-1.5 text-center sm:text-left",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = "DialogHeader"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = "DialogFooter"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n\n',drawer:'import * as React from "react"\nimport { Drawer as DrawerPrimitive } from "vaul"\n\nimport { cn } from "../../lib/utils"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = "Drawer"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn("fixed inset-0 z-50 bg-black/80", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border border-gray-200 bg-white dark:border-gray-800 dark:bg-gray-950",\n        className\n      )}\n      {...props}\n    >\n      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-gray-100 dark:bg-gray-800" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = "DrawerContent"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = "DrawerHeader"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn("mt-auto flex flex-col gap-2 p-4", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = "DrawerFooter"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      "text-lg font-semibold leading-none tracking-tight",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn("text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n\n',dropdownMenu:'import * as React from "react"\nimport * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 data-[state=open]:bg-gray-100 dark:focus:bg-gray-800 dark:data-[state=open]:bg-gray-800",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = "DropdownMenuShortcut"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n\n',input:'import * as React from "react"\nimport { cn } from "../../lib/utils"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          "flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = "Input"\n\nexport { Input }\n',label:"import * as React from 'react';\nimport * as LabelPrimitive from '@radix-ui/react-label';\nimport { cva, type VariantProps } from 'class-variance-authority';\n\nimport { cn } from '../../lib/utils';\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n",menuBar:'\nimport * as React from "react"\nimport * as MenubarPrimitive from "@radix-ui/react-menubar"\nimport { Check, ChevronRight, Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      "flex h-10 items-center space-x-1 rounded-md border border-gray-200 bg-white p-1 dark:border-gray-800 dark:bg-gray-950",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[state=open]:bg-gray-100 data-[state=open]:text-gray-900 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[state=open]:bg-gray-800 dark:data-[state=open]:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className="ml-auto h-4 w-4" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      "z-50 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          "z-50 min-w-[12rem] overflow-hidden rounded-md border border-gray-200 bg-white p-1 text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className="h-2 w-2 fill-current" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      "px-2 py-1.5 text-sm font-semibold",\n      inset && "pl-8",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        "ml-auto text-xs tracking-widest text-gray-500 dark:text-gray-400",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = "MenubarShortcut"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n\n',navigationMenu:'import * as React from "react"\nimport * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"\nimport { cva } from "class-variance-authority"\nimport { ChevronDown } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative z-10 flex max-w-max flex-1 items-center justify-center",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      "group flex flex-1 list-none items-center justify-center space-x-1",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-white px-4 py-2 text-sm font-medium transition-colors hover:bg-gray-100 hover:text-gray-900 focus:bg-gray-100 focus:text-gray-900 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-gray-100/50 data-[state=open]:bg-gray-100/50 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50 dark:focus:bg-gray-800 dark:focus:text-gray-50 dark:data-[active]:bg-gray-800/50 dark:data-[state=open]:bg-gray-800/50"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), "group", className)}\n    {...props}\n  >\n    {children}{""}\n    <ChevronDown\n      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"\n      aria-hidden="true"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn("absolute left-0 top-full flex justify-center")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)] dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",\n      className\n    )}\n    {...props}\n  >\n    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-gray-200 shadow-md dark:bg-gray-800" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n\n',pagination:'import * as React from "react"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\nimport { ButtonProps, buttonVariants } from "./button"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (\n  <nav\n    role="navigation"\n    aria-label="pagination"\n    className={cn("mx-auto flex w-full justify-center", className)}\n    {...props}\n  />\n)\nPagination.displayName = "Pagination"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<"ul">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn("flex flex-row items-center gap-1", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = "PaginationContent"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<"li">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn("", className)} {...props} />\n))\nPaginationItem.displayName = "PaginationItem"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, "size"> &\n  React.ComponentProps<"a">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = "icon",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? "page" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? "outline" : "ghost",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = "PaginationLink"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to previous page"\n    size="default"\n    className={cn("gap-1 pl-2.5", className)}\n    {...props}\n  >\n    <ChevronLeft className="h-4 w-4" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = "PaginationPrevious"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label="Go to next page"\n    size="default"\n    className={cn("gap-1 pr-2.5", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className="h-4 w-4" />\n  </PaginationLink>\n)\nPaginationNext.displayName = "PaginationNext"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<"span">) => (\n  <span\n    aria-hidden\n    className={cn("flex h-9 w-9 items-center justify-center", className)}\n    {...props}\n  >\n    <MoreHorizontal className="h-4 w-4" />\n    <span className="sr-only">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = "PaginationEllipsis"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n\n',popover:'import * as React from "react"\nimport * as PopoverPrimitive from "@radix-ui/react-popover"\n\nimport { cn } from "../../lib/utils"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        "z-50 w-72 rounded-md border border-gray-200 bg-white p-4 text-gray-950 shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n\n',progress:'import * as React from "react"\nimport * as ProgressPrimitive from "@radix-ui/react-progress"\n\nimport { cn } from "../../lib/utils"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative h-4 w-full overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className="h-full w-full flex-1 bg-gray-900 transition-all dark:bg-gray-50"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n',radioGroup:'import * as React from "react"\nimport * as RadioGroupPrimitive from "@radix-ui/react-radio-group"\nimport { Circle } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn("grid gap-2", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        "aspect-square h-4 w-4 rounded-full border border-gray-200 dark:border-gray-900 text-gray-900 ring-offset-white focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50  dark:text-gray-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">\n        <Circle className="h-2.5 w-2.5 fill-current text-current" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n\n',select:'import * as React from "react"\nimport * as SelectPrimitive from "@radix-ui/react-select"\nimport { Check, ChevronDown, ChevronUp } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "flex h-10 w-full items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus:ring-gray-300",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className="h-4 w-4 opacity-50" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className="h-4 w-4" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      "flex cursor-default items-center justify-center py-1",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className="h-4 w-4" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = "popper", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-gray-200 bg-white text-gray-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n        position === "popper" &&\n          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          "p-1",\n          position === "popper" &&\n            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-gray-800 dark:focus:text-gray-50",\n      className\n    )}\n    {...props}\n  >\n    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">\n      <SelectPrimitive.ItemIndicator>\n        <Check className="h-4 w-4" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn("-mx-1 my-1 h-px bg-gray-100 dark:bg-gray-800", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n\n',separator:'import * as React from "react"\nimport * as SeparatorPrimitive from "@radix-ui/react-separator"\n\nimport { cn } from "../../lib/utils"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = "horizontal", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        "shrink-0 bg-gray-200 dark:bg-gray-800",\n        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n\n',skeleton:'import { cn } from "../../lib/utils"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn("animate-pulse rounded-md bg-gray-100 dark:bg-gray-800", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n',slider:'import * as React from "react"\nimport * as SliderPrimitive from "@radix-ui/react-slider"\n\nimport { cn } from "../../lib/utils"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      "relative flex w-full touch-none select-none items-center",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800">\n      <SliderPrimitive.Range className="absolute h-full bg-gray-900 dark:bg-gray-50" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-gray-900 bg-white ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:border-gray-50 dark:bg-gray-950 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n\n',switchComponent:'import * as React from "react"\nimport * as SwitchPrimitives from "@radix-ui/react-switch"\n\nimport { cn } from "../../lib/utils"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-gray-900 data-[state=unchecked]:bg-gray-200 dark:focus-visible:ring-gray-300 dark:focus-visible:ring-offset-gray-950 dark:data-[state=checked]:bg-gray-50 dark:data-[state=unchecked]:bg-gray-800",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        "pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0 dark:bg-gray-950"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n\n',table:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className="relative w-full overflow-auto">\n    <table\n      ref={ref}\n      className={cn("w-full caption-bottom text-sm", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = "Table"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />\n))\nTableHeader.displayName = "TableHeader"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn("[&_tr:last-child]:border-0", className)}\n    {...props}\n  />\n))\nTableBody.displayName = "TableBody"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      "border-t bg-gray-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-gray-800/50",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = "TableFooter"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      "border-b transition-colors hover:bg-gray-100/50 data-[state=selected]:bg-gray-100 dark:hover:bg-gray-800/50 dark:data-[state=selected]:bg-gray-800",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = "TableRow"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      "h-12 px-4 text-left align-middle font-medium text-gray-500 [&:has([role=checkbox])]:pr-0 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = "TableHead"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}\n    {...props}\n  />\n))\nTableCell.displayName = "TableCell"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn("mt-4 text-sm text-gray-500 dark:text-gray-400", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = "TableCaption"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n\n',tabs:'import * as React from "react"\nimport * as TabsPrimitive from "@radix-ui/react-tabs"\n\nimport { cn } from "../../lib/utils"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      "inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n\n',textarea:'import * as React from "react"\n\nimport { cn } from "../../lib/utils"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          "flex min-h-[80px] w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-gray-300",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = "Textarea"\n\nexport { Textarea }\n\n',toast:'import * as React from "react"\nimport * as ToastPrimitives from "@radix-ui/react-toast"\nimport { cva, type VariantProps } from "class-variance-authority"\nimport { X } from "lucide-react"\n\nimport { cn } from "../../lib/utils"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border border-gray-200 p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full dark:border-gray-800",\n  {\n    variants: {\n      variant: {\n        default: "border bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",\n        destructive:\n          "destructive group border-red-500 bg-red-500 text-gray-50 dark:border-red-900 dark:bg-red-900 dark:text-gray-50",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border border-gray-200 bg-transparent px-3 text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-950 focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-gray-100/40 group-[.destructive]:hover:border-red-500/30 group-[.destructive]:hover:bg-red-500 group-[.destructive]:hover:text-gray-50 group-[.destructive]:focus:ring-red-500 dark:border-gray-800 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:focus:ring-gray-300 dark:group-[.destructive]:border-gray-800/40 dark:group-[.destructive]:hover:border-red-900/30 dark:group-[.destructive]:hover:bg-red-900 dark:group-[.destructive]:hover:text-gray-50 dark:group-[.destructive]:focus:ring-red-900",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      "absolute right-2 top-2 rounded-md p-1 text-gray-950/50 opacity-0 transition-opacity hover:text-gray-950 focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600 dark:text-gray-50/50 dark:hover:text-gray-50",\n      className\n    )}\n    toast-close=""\n    {...props}\n  >\n    <X className="h-4 w-4" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn("text-sm font-semibold", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn("text-sm opacity-90", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n\n',toaster:'import {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from "./toast"\nimport { useToast } from "./use-toast"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className="grid gap-1">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n\n',toggleGroup:'import * as React from "react"\nimport * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"\nimport { type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\nimport { toggleVariants } from "./toggle"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: "default",\n  variant: "default",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn("flex items-center justify-center gap-1", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n\n',toggle:'import * as React from "react"\nimport * as TogglePrimitive from "@radix-ui/react-toggle"\nimport { cva, type VariantProps } from "class-variance-authority"\n\nimport { cn } from "../../lib/utils"\n\nconst toggleVariants = cva(\n  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-white transition-colors hover:bg-gray-100 hover:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-gray-100 data-[state=on]:text-gray-900 dark:ring-offset-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-400 dark:focus-visible:ring-gray-300 dark:data-[state=on]:bg-gray-800 dark:data-[state=on]:text-gray-50",\n  {\n    variants: {\n      variant: {\n        default: "bg-transparent",\n        outline:\n          "border border-gray-200 bg-transparent hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:hover:bg-gray-800 dark:hover:text-gray-50",\n      },\n      size: {\n        default: "h-10 px-3",\n        sm: "h-9 px-2.5",\n        lg: "h-11 px-5",\n      },\n    },\n    defaultVariants: {\n      variant: "default",\n      size: "default",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n\n',tooltip:'import * as React from "react"\nimport * as TooltipPrimitive from "@radix-ui/react-tooltip"\n\nimport { cn } from "../../lib/utils"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      "z-50 overflow-hidden rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm text-gray-950 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n\n',useToast:'import * as React from "react"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from "./toast"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: "ADD_TOAST",\n  UPDATE_TOAST: "UPDATE_TOAST",\n  DISMISS_TOAST: "DISMISS_TOAST",\n  REMOVE_TOAST: "REMOVE_TOAST",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType["ADD_TOAST"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType["UPDATE_TOAST"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType["DISMISS_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n  | {\n      type: ActionType["REMOVE_TOAST"]\n      toastId?: ToasterToast["id"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: "REMOVE_TOAST",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case "ADD_TOAST":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case "UPDATE_TOAST":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case "DISMISS_TOAST": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I\'ll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case "REMOVE_TOAST":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, "id">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: "UPDATE_TOAST",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })\n\n  dispatch({\n    type: "ADD_TOAST",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),\n  }\n}\n\nexport { useToast, toast }\n'};!function(e){e.Input="input",e.Textarea="textarea",e.Slider="slider",e.Checkbox="checkbox",e.Switch="switch",e.Dropdown="dropdown",e.Combobox="combobox",e.Tags="tags"}(xp||(xp={})),function(e){e.Number="number",e.Boolean="boolean",e.String="string",e.Enum="enum",e.Array="array"}(fp||(fp={})),function(e){e.Conversation="conversation",e.Model="model",e.Custom="custom"}(vp||(vp={})),function(e){e.PROMPTS="PROMPTS",e.BOOKMARKS="BOOKMARKS",e.AGENTS="AGENTS",e.MEMORIES="MEMORIES",e.MULTI_CONVO="MULTI_CONVO",e.TEMPORARY_CHAT="TEMPORARY_CHAT",e.RUN_CODE="RUN_CODE",e.WEB_SEARCH="WEB_SEARCH",e.PEOPLE_PICKER="PEOPLE_PICKER",e.MARKETPLACE="MARKETPLACE",e.FILE_SEARCH="FILE_SEARCH",e.FILE_CITATIONS="FILE_CITATIONS",e.MCP_SERVERS="MCP_SERVERS"}(Pp||(Pp={})),function(e){e.SHARED_GLOBAL="SHARED_GLOBAL",e.USE="USE",e.CREATE="CREATE",e.UPDATE="UPDATE",e.READ="READ",e.READ_AUTHOR="READ_AUTHOR",e.SHARE="SHARE",e.OPT_OUT="OPT_OUT",e.VIEW_USERS="VIEW_USERS",e.VIEW_GROUPS="VIEW_GROUPS",e.VIEW_ROLES="VIEW_ROLES"}(Op||(Op={}));var Mp,Dp,Fp,Up,zp,Vp,$p,Bp,Hp,Gp,Kp,Wp,qp,Qp,Yp,Xp,Jp,Zp,eh,th,nh,ah,sh,rh,oh,ih,lh,ch,dh,uh,mh,ph,hh,gh,xh=sa(((_p={})[Op.SHARED_GLOBAL]=la().default(!1),_p[Op.USE]=la().default(!0),_p[Op.CREATE]=la().default(!0),_p)),fh=sa(((bp={})[Op.USE]=la().default(!0),bp)),vh=sa(((yp={})[Op.USE]=la().default(!0),yp[Op.CREATE]=la().default(!0),yp[Op.UPDATE]=la().default(!0),yp[Op.READ]=la().default(!0),yp[Op.OPT_OUT]=la().default(!0),yp)),_h=sa(((jp={})[Op.SHARED_GLOBAL]=la().default(!1),jp[Op.USE]=la().default(!0),jp[Op.CREATE]=la().default(!0),jp)),bh=sa(((wp={})[Op.USE]=la().default(!0),wp)),yh=sa(((Np={})[Op.USE]=la().default(!0),Np)),jh=sa(((kp={})[Op.USE]=la().default(!0),kp)),wh=sa(((Cp={})[Op.USE]=la().default(!0),Cp)),Nh=sa(((Sp={})[Op.VIEW_USERS]=la().default(!0),Sp[Op.VIEW_GROUPS]=la().default(!0),Sp[Op.VIEW_ROLES]=la().default(!0),Sp)),kh=sa(((Tp={})[Op.USE]=la().default(!1),Tp)),Ch=sa(((Ep={})[Op.USE]=la().default(!0),Ep)),Sh=sa(((Ip={})[Op.USE]=la().default(!0),Ip)),Th=sa(((Rp={})[Op.USE]=la().default(!0),Rp[Op.CREATE]=la().default(!0),Rp[Op.SHARE]=la().default(!1),Rp)),Eh=sa(((Ap={})[Pp.PROMPTS]=xh,Ap[Pp.BOOKMARKS]=fh,Ap[Pp.MEMORIES]=vh,Ap[Pp.AGENTS]=_h,Ap[Pp.MULTI_CONVO]=bh,Ap[Pp.TEMPORARY_CHAT]=yh,Ap[Pp.RUN_CODE]=jh,Ap[Pp.WEB_SEARCH]=wh,Ap[Pp.PEOPLE_PICKER]=Nh,Ap[Pp.MARKETPLACE]=kh,Ap[Pp.FILE_SEARCH]=Ch,Ap[Pp.FILE_CITATIONS]=Sh,Ap[Pp.MCP_SERVERS]=Th,Ap));!function(e){e.ADMIN="ADMIN",e.USER="USER"}(gh||(gh={}));var Ih,Rh,Ah,Ph,Oh,Lh,Mh=sa({name:ra(),permissions:Eh}),Dh=sa(((Mp={})[gh.ADMIN]=Mh.extend({name:ma(gh.ADMIN),permissions:Eh.extend((Dp={},Dp[Pp.PROMPTS]=xh.extend((Fp={},Fp[Op.SHARED_GLOBAL]=la().default(!0),Fp[Op.USE]=la().default(!0),Fp[Op.CREATE]=la().default(!0),Fp)),Dp[Pp.BOOKMARKS]=fh.extend((Up={},Up[Op.USE]=la().default(!0),Up)),Dp[Pp.MEMORIES]=vh.extend((zp={},zp[Op.USE]=la().default(!0),zp[Op.CREATE]=la().default(!0),zp[Op.UPDATE]=la().default(!0),zp[Op.READ]=la().default(!0),zp[Op.OPT_OUT]=la().default(!0),zp)),Dp[Pp.AGENTS]=_h.extend((Vp={},Vp[Op.SHARED_GLOBAL]=la().default(!0),Vp[Op.USE]=la().default(!0),Vp[Op.CREATE]=la().default(!0),Vp)),Dp[Pp.MULTI_CONVO]=bh.extend(($p={},$p[Op.USE]=la().default(!0),$p)),Dp[Pp.TEMPORARY_CHAT]=yh.extend((Bp={},Bp[Op.USE]=la().default(!0),Bp)),Dp[Pp.RUN_CODE]=jh.extend((Hp={},Hp[Op.USE]=la().default(!0),Hp)),Dp[Pp.WEB_SEARCH]=wh.extend((Gp={},Gp[Op.USE]=la().default(!0),Gp)),Dp[Pp.PEOPLE_PICKER]=Nh.extend((Kp={},Kp[Op.VIEW_USERS]=la().default(!0),Kp[Op.VIEW_GROUPS]=la().default(!0),Kp[Op.VIEW_ROLES]=la().default(!0),Kp)),Dp[Pp.MARKETPLACE]=sa((Wp={},Wp[Op.USE]=la().default(!1),Wp)),Dp[Pp.FILE_SEARCH]=Ch.extend((qp={},qp[Op.USE]=la().default(!0),qp)),Dp[Pp.FILE_CITATIONS]=Sh.extend((Qp={},Qp[Op.USE]=la().default(!0),Qp)),Dp[Pp.MCP_SERVERS]=Th.extend((Yp={},Yp[Op.USE]=la().default(!0),Yp[Op.CREATE]=la().default(!0),Yp[Op.SHARE]=la().default(!0),Yp)),Dp))}),Mp[gh.USER]=Mh.extend({name:ma(gh.USER),permissions:Eh}),Mp)).parse(((Xp={})[gh.ADMIN]={name:gh.ADMIN,permissions:(Jp={},Jp[Pp.PROMPTS]=(Zp={},Zp[Op.SHARED_GLOBAL]=!0,Zp[Op.USE]=!0,Zp[Op.CREATE]=!0,Zp),Jp[Pp.BOOKMARKS]=(eh={},eh[Op.USE]=!0,eh),Jp[Pp.MEMORIES]=(th={},th[Op.USE]=!0,th[Op.CREATE]=!0,th[Op.UPDATE]=!0,th[Op.READ]=!0,th[Op.OPT_OUT]=!0,th),Jp[Pp.AGENTS]=(nh={},nh[Op.SHARED_GLOBAL]=!0,nh[Op.USE]=!0,nh[Op.CREATE]=!0,nh),Jp[Pp.MULTI_CONVO]=(ah={},ah[Op.USE]=!0,ah),Jp[Pp.TEMPORARY_CHAT]=(sh={},sh[Op.USE]=!0,sh),Jp[Pp.RUN_CODE]=(rh={},rh[Op.USE]=!0,rh),Jp[Pp.WEB_SEARCH]=(oh={},oh[Op.USE]=!0,oh),Jp[Pp.PEOPLE_PICKER]=(ih={},ih[Op.VIEW_USERS]=!0,ih[Op.VIEW_GROUPS]=!0,ih[Op.VIEW_ROLES]=!0,ih),Jp[Pp.MARKETPLACE]=(lh={},lh[Op.USE]=!0,lh),Jp[Pp.FILE_SEARCH]=(ch={},ch[Op.USE]=!0,ch),Jp[Pp.FILE_CITATIONS]=(dh={},dh[Op.USE]=!0,dh),Jp[Pp.MCP_SERVERS]=(uh={},uh[Op.USE]=!0,uh[Op.CREATE]=!0,uh[Op.SHARE]=!0,uh),Jp)},Xp[gh.USER]={name:gh.USER,permissions:(mh={},mh[Pp.PROMPTS]={},mh[Pp.BOOKMARKS]={},mh[Pp.MEMORIES]={},mh[Pp.AGENTS]={},mh[Pp.MULTI_CONVO]={},mh[Pp.TEMPORARY_CHAT]={},mh[Pp.RUN_CODE]={},mh[Pp.WEB_SEARCH]={},mh[Pp.PEOPLE_PICKER]=(ph={},ph[Op.VIEW_USERS]=!1,ph[Op.VIEW_GROUPS]=!1,ph[Op.VIEW_ROLES]=!1,ph),mh[Pp.MARKETPLACE]=(hh={},hh[Op.USE]=!1,hh),mh[Pp.FILE_SEARCH]={},mh[Pp.FILE_CITATIONS]={},mh[Pp.MCP_SERVERS]={},mh)},Xp));!function(e){e.PAST_HOUR="h",e.PAST_24_HOURS="d",e.PAST_WEEK="w",e.PAST_MONTH="m",e.PAST_YEAR="y"}(Ih||(Ih={})),function(e){e.USER="user",e.GROUP="group",e.PUBLIC="public",e.ROLE="role"}(Rh||(Rh={})),function(e){e.USER="User",e.GROUP="Group",e.ROLE="Role"}(Ah||(Ah={})),function(e){e.AGENT="agent",e.PROMPTGROUP="promptGroup",e.MCPSERVER="mcpServer"}(Ph||(Ph={})),function(e){e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.DELETE=4]="DELETE",e[e.SHARE=8]="SHARE"}(Oh||(Oh={})),function(e){e.AGENT_VIEWER="agent_viewer",e.AGENT_EDITOR="agent_editor",e.AGENT_OWNER="agent_owner",e.PROMPTGROUP_VIEWER="promptGroup_viewer",e.PROMPTGROUP_EDITOR="promptGroup_editor",e.PROMPTGROUP_OWNER="promptGroup_owner",e.MCPSERVER_VIEWER="mcpServer_viewer",e.MCPSERVER_EDITOR="mcpServer_editor",e.MCPSERVER_OWNER="mcpServer_owner"}(Lh||(Lh={}));var Fh,Uh=sa({type:oa(Rh),id:ra().optional(),name:ra().optional(),email:ra().optional(),source:aa(["local","entra"]).optional(),avatar:ra().optional(),description:ra().optional(),idOnTheSource:ra().optional(),accessRoleId:oa(Lh).optional(),memberCount:pa().optional()}),zh=sa({accessRoleId:oa(Lh),name:ra(),description:ra().optional(),resourceType:oa(Ph).default(Ph.AGENT),permBits:pa()}),Vh=sa({id:ra(),principalType:oa(Rh),principalId:ra().optional(),principalName:ra().optional(),role:zh,grantedBy:ra(),grantedAt:ra(),inheritedFrom:ra().optional(),source:aa(["local","entra"]).optional()});sa({resourceType:oa(Ph),resourceId:ra(),permissions:ca(Vh)}),sa({updated:Uh.array(),removed:Uh.array(),public:la(),publicAccessRoleId:ra().optional()}),sa({message:ra(),results:sa({principals:Uh.array(),public:la(),publicAccessRoleId:ra().optional()})}),sa({resourceType:oa(Ph),resourceId:oa(Lh),principals:ca(Uh),public:la(),publicAccessRoleId:oa(Lh).optional()}),sa({permissionBits:pa()}),function(e){e.messages="messages",e.sharedMessages="sharedMessages",e.sharedLinks="sharedLinks",e.allConversations="allConversations",e.archivedConversations="archivedConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.agents="agents",e.agent="agent",e.files="files",e.fileConfig="fileConfig",e.tools="tools",e.toolAuth="toolAuth",e.toolCalls="toolCalls",e.mcpTools="mcpTools",e.mcpConnectionStatus="mcpConnectionStatus",e.mcpAuthValues="mcpAuthValues",e.agentTools="agentTools",e.actions="actions",e.assistantDocs="assistantDocs",e.agentDocs="agentDocs",e.fileDownload="fileDownload",e.voices="voices",e.customConfigSpeech="customConfigSpeech",e.prompts="prompts",e.prompt="prompt",e.promptGroups="promptGroups",e.allPromptGroups="allPromptGroups",e.promptGroup="promptGroup",e.categories="categories",e.randomPrompts="randomPrompts",e.agentCategories="agentCategories",e.marketplaceAgents="marketplaceAgents",e.roles="roles",e.conversationTags="conversationTags",e.health="health",e.userTerms="userTerms",e.banner="banner",e.memories="memories",e.principalSearch="principalSearch",e.accessRoles="accessRoles",e.resourcePermissions="resourcePermissions",e.effectivePermissions="effectivePermissions",e.graphToken="graphToken",e.mcpServers="mcpServers",e.mcpServer="mcpServer"}(Fh||(Fh={}));var $h,Bh=function(e){return["agentFiles",e]};function Hh(e){na.defaults.headers.common.Authorization="Bearer "+e}function Gh(e,t){return yl(this,0,void 0,(function(){return jl(this,(function(n){switch(n.label){case 0:return[4,na.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))}!function(e){e.fileUpload="fileUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.loginUser="loginUser",e.logoutUser="logoutUser",e.refreshToken="refreshToken",e.avatarUpload="avatarUpload",e.speechToText="speechToText",e.textToSpeech="textToSpeech",e.assistantAvatarUpload="assistantAvatarUpload",e.agentAvatarUpload="agentAvatarUpload",e.updateAction="updateAction",e.updateAgentAction="updateAgentAction",e.deleteAction="deleteAction",e.deleteAgentAction="deleteAgentAction",e.revertAgentVersion="revertAgentVersion",e.deleteUser="deleteUser",e.updateRole="updateRole",e.enableTwoFactor="enableTwoFactor",e.verifyTwoFactor="verifyTwoFactor",e.updateMemoryPreferences="updateMemoryPreferences"}($h||($h={}));var Kh=!1,Wh=[],qh=function(e){return Gh((t=e,"".concat(Nd,"/api/auth/refresh").concat(!0===t?"?retry=true":"")));var t},Qh=function(e){Hh(e),window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e}))},Yh=function(e,t){void 0===t&&(t=null),Wh.forEach((function(n){e?n.reject(e):n.resolve(t)})),Wh=[]};"undefined"!=typeof window&&na.interceptors.response.use((function(e){return e}),(function(e){return yl(void 0,0,void 0,(function(){var t,n,a,s,r,o,i,l,c;return jl(this,(function(d){switch(d.label){case 0:if(t=e.config,!e.response)return[2,Promise.reject(e)];if(!0===(null===(o=t.url)||void 0===o?void 0:o.includes("/api/auth/2fa")))return[2,Promise.reject(e)];if(!0===(null===(i=t.url)||void 0===i?void 0:i.includes("/api/auth/logout")))return[2,Promise.reject(e)];if(401!==e.response.status||t._retry)return[3,13];if(console.warn("401 error, refreshing token"),t._retry=!0,!Kh)return[3,5];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,new Promise((function(e,t){Wh.push({resolve:e,reject:t})}))];case 2:return s=d.sent(),t.headers.Authorization="Bearer "+s,[4,na(t)];case 3:return[2,d.sent()];case 4:return n=d.sent(),[2,Promise.reject(n)];case 5:Kh=!0,d.label=6;case 6:return d.trys.push([6,11,12,13]),[4,qh(!0===(null===(l=t.url)||void 0===l?void 0:l.includes("api/auth/refresh")))];case 7:return a=d.sent(),(s=null!==(c=null==a?void 0:a.token)&&void 0!==c?c:"")?(t.headers.Authorization="Bearer "+s,Qh(s),Yh(null,s),[4,na(t)]):[3,9];case 8:return[2,d.sent()];case 9:window.location.href.includes("share/")?console.log("Refresh token failed from shared link, attempting request to ".concat(t.url)):window.location.href=Vd(),d.label=10;case 10:return[3,13];case 11:return r=d.sent(),Yh(r,null),[2,Promise.reject(r)];case 12:return Kh=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var Xh={get:function(e,t){return yl(this,0,void 0,(function(){return jl(this,(function(n){switch(n.label){case 0:return[4,na.get(e,_l({},t))];case 1:return[2,n.sent().data]}}))}))},getResponse:function(e,t){return yl(this,0,void 0,(function(){return jl(this,(function(n){switch(n.label){case 0:return[4,na.get(e,_l({},t))];case 1:return[2,n.sent()]}}))}))},post:Gh,postMultiPart:function(e,t,n){return yl(this,0,void 0,(function(){return jl(this,(function(a){switch(a.label){case 0:return[4,na.post(e,t,_l(_l({},n),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,a.sent().data]}}))}))},postTTS:function(e,t,n){return yl(this,0,void 0,(function(){return jl(this,(function(a){switch(a.label){case 0:return[4,na.post(e,t,_l(_l({},n),{headers:{"Content-Type":"multipart/form-data"},responseType:"arraybuffer"}))];case 1:return[2,a.sent().data]}}))}))},put:function(e,t){return yl(this,0,void 0,(function(){return jl(this,(function(n){switch(n.label){case 0:return[4,na.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},delete:function(e){return yl(this,0,void 0,(function(){return jl(this,(function(t){switch(t.label){case 0:return[4,na.delete(e)];case 1:return[2,t.sent().data]}}))}))},deleteWithOptions:function(e,t){return yl(this,0,void 0,(function(){return jl(this,(function(n){switch(n.label){case 0:return[4,na.delete(e,_l({},t))];case 1:return[2,n.sent().data]}}))}))},patch:function(e,t){return yl(this,0,void 0,(function(){return jl(this,(function(n){switch(n.label){case 0:return[4,na.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},refreshToken:qh,dispatchTokenUpdatedEvent:Qh},Jh=Object.freeze({__proto__:null,acceptTerms:function(){return Xh.post("".concat(Nd,"/api/user/terms/accept"))},addPromptToGroup:function(e,t){return Xh.post((n=e,"".concat(Nd,"/api/prompts/groups/").concat(n,"/prompts")),t);var n},addTagToConversation:function(e,t){return Xh.put((n=e,"".concat(au(),"/convo/").concat(n)),t);var n},archiveConversation:function(e){return Xh.post(Ud(),{arg:e})},callTool:function(e){var t=e.toolId,n=e.toolParams;return Xh.post(Hd({path:"tools/".concat(t,"/call")}),n)},cancelMCPOAuth:function(e){return Xh.post((t=e,"".concat(Nd,"/api/mcp/oauth/cancel/").concat(t)),{});var t},clearAllConversations:function(){return Xh.delete("".concat(Dd,"/all"))},confirmTwoFactor:function(e){return Xh.post("".concat(Nd,"/api/auth/2fa/confirm"),e)},createAgent:function(e){var t=bl(e,[]);return Xh.post(Hd({}),t)},createAssistant:function(e){var t=e.version,n=bl(e,["version"]);return Xh.post(Bd({version:t}),n)},createConversationTag:function(e){return Xh.post(au(),e)},createMCPServer:function(e){return yl(void 0,0,void 0,(function(){return jl(this,(function(t){return[2,Xh.post(Gd.servers,e)]}))}))},createMemory:function(e){return Xh.post(su(),e)},createPreset:function(e){return Xh.post(zd(),e)},createPrompt:function(e){return Xh.post(Zd(),e)},createSharedLink:function(e,t){return Xh.post((n=e,"".concat(Pd,"/").concat(n)),{targetMessageId:t});var n},deleteAction:function(e){var t=e.assistant_id,n=e.action_id,a=e.model,s=e.version,r=e.endpoint;return yl(void 0,0,void 0,(function(){return jl(this,(function(e){return[2,Xh.delete(Bd({path:"actions/".concat(t,"/").concat(n,"/").concat(a),version:s,endpoint:r}))]}))}))},deleteAgent:function(e){var t=e.agent_id;return Xh.delete(Hd({path:t}))},deleteAgentAction:function(e){var t=e.agent_id,n=e.action_id;return yl(void 0,0,void 0,(function(){return jl(this,(function(e){return[2,Xh.delete(Hd({path:"actions/".concat(t,"/").concat(n)}))]}))}))},deleteAssistant:function(e){var t=e.assistant_id,n=e.model,a=e.endpoint,s=e.version;return Xh.delete(Bd({path:t,options:{model:n,endpoint:a},version:s}))},deleteConversation:function(e){return Xh.deleteWithOptions("".concat(Dd),{data:{arg:e}})},deleteConversationTag:function(e){return Xh.delete(au(e))},deleteFiles:function(e){return yl(void 0,0,void 0,(function(){return jl(this,(function(t){return[2,Xh.deleteWithOptions(Wd(),{data:e})]}))}))},deleteMCPServer:function(e){return yl(void 0,0,void 0,(function(){return jl(this,(function(t){return[2,Xh.delete(Kd(e))]}))}))},deleteMemory:function(e){return Xh.delete(ru(e))},deletePreset:function(e){return Xh.post("".concat(Nd,"/api/presets/delete"),e)},deletePrompt:function(e){return Xh.delete((n=(t=e)._id,a=t.groupId,"".concat($d(),"/").concat(n,"?groupId=").concat(a)));var t,n,a},deletePromptGroup:function(e){return Xh.delete(tu(e))},deleteSharedLink:function(e){return Xh.delete(Od(e))},deleteUser:function(){return Xh.delete("".concat(Nd,"/api/user/delete"))},disableTwoFactor:function(e){return Xh.post("".concat(Nd,"/api/auth/2fa/disable"),e)},duplicateAgent:function(e){var t=e.agent_id;return Xh.post(Hd({path:"".concat(t,"/duplicate")}))},duplicateConversation:function(e){return Xh.post("".concat(Dd,"/duplicate"),e)},editArtifact:function(e){return yl(void 0,0,void 0,(function(){var t=e.messageId,n=bl(e,["messageId"]);return jl(this,(function(e){return[2,Xh.post(Ad(t),n)]}))}))},enableTwoFactor:function(){return Xh.get("".concat(Nd,"/api/auth/2fa/enable"))},forkConversation:function(e){return Xh.post("".concat(Dd,"/fork"),e)},genTitle:function(e){return Xh.post("".concat(Dd,"/gen_title"),e)},getAIEndpoints:function(){return Xh.get("".concat(Nd,"/api/endpoints"))},getAccessRoles:function(e){return Xh.get((t=e,"".concat(Nd,"/api/permissions/").concat(t,"/roles")));var t},getActions:function(){return Xh.get(Hd({path:"actions"}))},getAgentById:function(e){var t=e.agent_id;return Xh.get(Hd({path:t}))},getAgentCategories:function(){return Xh.get(Hd({path:"categories"}))},getAgentFiles:function(e){return Xh.get((t=e,"".concat(Nd,"/api/files/agent/").concat(t)));var t},getAllEffectivePermissions:function(e){return Xh.get((t=e,"".concat(Nd,"/api/permissions/").concat(t,"/effective/all")));var t},getAllPromptGroups:function(){return Xh.get("".concat($d(),"/all"))},getAssistantById:function(e){var t=e.endpoint,n=e.assistant_id,a=e.version;return Xh.get(Bd({path:n,endpoint:t,version:a}))},getAssistantDocs:function(e){var t=e.endpoint,n=e.version;return lc(t)?Xh.get(Bd({path:"documents",version:n,options:{endpoint:t},endpoint:t})):Promise.resolve([])},getAvailableAgentTools:function(){return Xh.get(Hd({path:"tools"}))},getAvailablePlugins:function(){return Xh.get("".concat(Nd,"/api/plugins"))},getAvailableTools:function(e,t){var n="";return n=lc(e)?Bd({path:"tools",endpoint:e,version:null!=t?t:Fu[e]}):Hd({path:"tools"}),Xh.get(n)},getBanner:function(){return Xh.get("".concat(Nd,"/api/banner"))},getCategories:function(){return Xh.get("".concat(Nd,"/api/categories"))},getCodeOutputDownload:function(e){return yl(void 0,0,void 0,(function(){return jl(this,(function(t){return[2,Xh.getResponse(e,{responseType:"blob",headers:{Accept:"application/octet-stream"}})]}))}))},getConversationById:function(e){return Xh.get((t=e,"".concat(Dd,"/").concat(t)));var t},getConversationTags:function(){return Xh.get(au())},getConversations:function(e){return Xh.get(Fd({cursor:e}))},getCustomConfigSpeech:function(){return Xh.get("".concat(Qd(),"/config/get"))},getDomainServerBaseUrl:function(){return"".concat(Td(),"/api")},getEffectivePermissions:function(e,t){return Xh.get((n=e,a=t,"".concat(Nd,"/api/permissions/").concat(n,"/").concat(a,"/effective")));var n,a},getExpandedAgentById:function(e){var t=e.agent_id;return Xh.get(Hd({path:"".concat(t,"/expanded")}))},getFavorites:function(){return Xh.get("/api/user/settings/favorites")},getFileConfig:function(){return Xh.get("".concat(Wd(),"/config"))},getFileDownload:function(e,t){return yl(void 0,0,void 0,(function(){return jl(this,(function(n){return[2,Xh.getResponse("".concat(Wd(),"/download/").concat(e,"/").concat(t),{responseType:"blob",headers:{Accept:"application/octet-stream"}})]}))}))},getFiles:function(){return Xh.get(Wd())},getGraphApiToken:function(e){return Xh.get((t=e.scopes,"".concat(Nd,"/api/auth/graph-token?scopes=").concat(encodeURIComponent(t))));var t},getLoginGoogle:function(){return Xh.get("".concat(Nd,"/api/auth/google"))},getMCPAuthValues:function(e){return Xh.get((t=e,"".concat(Nd,"/api/mcp/").concat(t,"/auth-values")));var t},getMCPConnectionStatus:function(){return Xh.get("".concat(Nd,"/api/mcp/connection/status"))},getMCPServer:function(e){return yl(void 0,0,void 0,(function(){return jl(this,(function(t){return[2,Xh.get(Kd(e))]}))}))},getMCPServerConnectionStatus:function(e){return Xh.get((t=e,"".concat(Nd,"/api/mcp/connection/status/").concat(t)));var t},getMCPServers:function(){return yl(void 0,0,void 0,(function(){return jl(this,(function(e){return[2,Xh.get(Gd.servers)]}))}))},getMCPTools:function(){return Xh.get(Gd.tools)},getMarketplaceAgents:function(e){return Xh.get(Hd({options:e}))},getMemories:function(){return Xh.get(su())},getMessagesByConvoId:function(e){return e===Bm.NEW_CONVO||e===Bm.PENDING_CONVO?Promise.resolve([]):Xh.get(Rd({conversationId:e}))},getModels:function(){return yl(void 0,0,void 0,(function(){return jl(this,(function(e){return[2,Xh.get("".concat(Nd,"/api/models"))]}))}))},getPresets:function(){return Xh.get(zd())},getPrompt:function(e){return Xh.get(Jd(e))},getPromptGroup:function(e){return Xh.get(Xd(e))},getPromptGroups:function(e){return Xh.get(function(e){var t="".concat($d(),"/groups"),n=Object.entries(e).reduce((function(e,t){var n=t[0],a=t[1];return null!=a&&""!==a&&(e[n]=a),e}),{});if(Object.keys(n).length>0){var a=new URLSearchParams(n).toString();t+="?".concat(a)}return t}(e))},getPrompts:function(e){return Xh.get(function(e){var t=$d();if(Object.keys(e).length>0){var n=new URLSearchParams(e).toString();t+="?".concat(n)}return t}(e))},getRandomPrompts:function(e){return Xh.get((t=e.limit,n=e.skip,"".concat($d(),"/random?limit=").concat(t,"&skip=").concat(n)));var t,n},getResourcePermissions:function(e,t){return Xh.get((n=e,a=t,"".concat(Nd,"/api/permissions/").concat(n,"/").concat(a)));var n,a},getRole:function(e){return Xh.get(nu(e))},getSearchEnabled:function(){return Xh.get("".concat(Nd,"/api/search/enable"))},getSharedLink:function(e){return Xh.get((t=e,"".concat(Pd,"/link/").concat(t)));var t},getSharedMessages:function(e){return Xh.get(Od(e))},getStartupConfig:function(){return Xh.get("".concat(Nd,"/api/config"))},getToolCalls:function(e){return Xh.get(Hd({path:"tools/calls",options:e}))},getUser:function(){return Xh.get("".concat(Nd,"/api/user"))},getUserBalance:function(){return Xh.get("".concat(Nd,"/api/balance"))},getUserTerms:function(){return Xh.get("".concat(Nd,"/api/user/terms"))},getVerifyAgentToolAuth:function(e){return Xh.get(Hd({path:"tools/".concat(e.toolId,"/auth")}))},getVoices:function(){return Xh.get("".concat(Yd(),"/voices"))},healthCheck:function(){return Xh.get("".concat(Nd,"/health"))},importConversationsFile:function(e){return Xh.postMultiPart("".concat(Dd,"/import"),e)},listAgents:function(e){return Xh.get(Hd({options:e}))},listAssistants:function(e,t){return Xh.get(Bd({version:t,options:e}))},listConversations:function(e){return Xh.get(Fd(null!=e?e:{}))},listMessages:function(e){return Xh.get(Rd(null!=e?e:{}))},listSharedLinks:function(e){return yl(void 0,0,void 0,(function(){var t,n,a,s,r,o;return jl(this,(function(i){return t=e.pageSize,n=e.isPublic,a=e.sortBy,s=e.sortDirection,r=e.search,o=e.cursor,[2,Xh.get(Ld(t,n,a,s,r,o))]}))}))},login:function(e){return Xh.post("".concat(Nd,"/api/auth/login"),e)},logout:function(){return Xh.post("".concat(Nd,"/api/auth/logout"))},makePromptProduction:function(e){return Xh.patch("".concat(Jd(e),"/tags/production"))},rebuildConversationTags:function(){return Xh.post(au("rebuild"))},regenerateBackupCodes:function(){return Xh.post("".concat(Nd,"/api/auth/2fa/backup/regenerate"))},register:function(e){return Xh.post("".concat(Nd,"/api/auth/register"),e)},reinitializeMCPServer:function(e){return Xh.post((t=e,"".concat(Nd,"/api/mcp/").concat(t,"/reinitialize")));var t},requestPasswordReset:function(e){return Xh.post("".concat(Nd,"/api/auth/requestPasswordReset"),e)},resendVerificationEmail:function(e){return Xh.post("".concat(Nd,"/api/user/verify/resend"),e)},resetPassword:function(e){return Xh.post("".concat(Nd,"/api/auth/resetPassword"),e)},revertAgentVersion:function(e){var t=e.agent_id,n=e.version_index;return Xh.post("".concat(Hd({path:"".concat(t,"/revert")})),{version_index:n})},revokeAllUserKeys:function(){return Xh.delete("".concat(Md,"?all=true"))},revokeUserKey:function(e){return Xh.delete((t=e,"".concat(Md,"/").concat(t)));var t},searchPrincipals:function(e){return Xh.get((n=(t=e).q,a=t.limit,s=t.types,r="".concat(Nd,"/api/permissions/search-principals?q=").concat(encodeURIComponent(n)),void 0!==a&&(r+="&limit=".concat(a)),s&&s.length>0&&(r+="&types=".concat(s.join(","))),r));var t,n,a,s,r},speechToText:function(e){return Xh.postMultiPart("".concat(Qd(),"/stt"),e)},textToSpeech:function(e){return Xh.postTTS("".concat(Yd(),"/manual"),e)},updateAction:function(e){var t=e.assistant_id,n=e.version,a=bl(e,["assistant_id","version"]);return Xh.post(Bd({path:"actions/".concat(t),version:n}),a)},updateAgent:function(e){var t=e.agent_id,n=e.data;return Xh.patch(Hd({path:t}),n)},updateAgentAction:function(e){var t=e.agent_id,n=bl(e,["agent_id"]);return Xh.post(Hd({path:"actions/".concat(t)}),n)},updateAgentPermissions:function(e){return Xh.put((t=e.roleName,"".concat(nu(t),"/agents")),e.updates);var t},updateAssistant:function(e){var t=e.assistant_id,n=e.data,a=e.version;return Xh.patch(Bd({path:t,version:a}),n)},updateConversation:function(e){return Xh.post(Ud(),{arg:e})},updateConversationTag:function(e,t){return Xh.put(au(e),t)},updateFavorites:function(e){return Xh.post("/api/user/settings/favorites",{favorites:e})},updateFeedback:function(e,t,n){return Xh.put((a=e,s=t,"".concat(Nd,"/api/messages/").concat(a,"/").concat(s,"/feedback")),n);var a,s},updateMCPServer:function(e,t){return yl(void 0,0,void 0,(function(){return jl(this,(function(n){return[2,Xh.patch(Kd(e),t)]}))}))},updateMCPServersPermissions:function(e){return Xh.put((t=e.roleName,"".concat(nu(t),"/mcp-servers")),e.updates);var t},updateMarketplacePermissions:function(e){return Xh.put((t=e.roleName,"".concat(nu(t),"/marketplace")),e.updates);var t},updateMemory:function(e,t,n){return Xh.patch(ru(n||e),{key:e,value:t})},updateMemoryPermissions:function(e){return Xh.put((t=e.roleName,"".concat(nu(t),"/memories")),e.updates);var t},updateMemoryPreferences:function(e){return Xh.patch("".concat(su(),"/preferences"),e)},updateMessage:function(e){var t=e.conversationId,n=e.messageId,a=e.text;if(!t)throw new Error("conversationId is required");return Xh.put(Rd({conversationId:t,messageId:n}),{text:a})},updateMessageContent:function(e){var t=e.conversationId,n=e.messageId,a=e.index,s=e.text;if(!t)throw new Error("conversationId is required");return Xh.put(Rd({conversationId:t,messageId:n}),{text:s,index:a})},updatePeoplePickerPermissions:function(e){return Xh.put((t=e.roleName,"".concat(nu(t),"/people-picker")),e.updates);var t},updatePreset:function(e){return Xh.post(zd(),e)},updatePromptGroup:function(e){return Xh.patch(eu(e.id),e.payload)},updatePromptLabels:function(e){return Xh.patch((t=e.id,"".concat(Jd(t),"/labels")),e.payload);var t},updatePromptPermissions:function(e){return Xh.put((t=e.roleName,"".concat(nu(t),"/prompts")),e.updates);var t},updateResourcePermissions:function(e,t,n){return Xh.put((a=e,s=t,"".concat(Nd,"/api/permissions/").concat(a,"/").concat(s)),n);var a,s},updateSharedLink:function(e){return Xh.patch((t=e,"".concat(Pd,"/").concat(t)));var t},updateTokenCount:function(e){return Xh.post("".concat(Nd,"/api/tokenizer"),{arg:e})},updateUserKey:function(e){if(!e.value)throw new Error("value is required");return Xh.put(Md,e)},updateUserPlugins:function(e){return Xh.post("".concat(Nd,"/api/user/plugins"),e)},uploadAgentAvatar:function(e){return Xh.postMultiPart("".concat(qd(),"/agents/").concat(e.agent_id,"/avatar"),e.formData)},uploadAssistantAvatar:function(e){return Xh.postMultiPart(Bd({isAvatar:!0,path:"".concat(e.assistant_id,"/avatar"),options:{model:e.model,endpoint:e.endpoint},version:e.version}),e.formData)},uploadAvatar:function(e){return Xh.postMultiPart("".concat(qd(),"/avatar"),e)},uploadFile:function(e,t){var n=t?{signal:t}:void 0;return Xh.postMultiPart(Wd(),e,n)},uploadImage:function(e,t){var n=t?{signal:t}:void 0;return Xh.postMultiPart(qd(),e,n)},userKeyQuery:function(e){return Xh.get((t=e,"".concat(Md,"?name=").concat(t)));var t},verifyEmail:function(e){return Xh.post("".concat(Nd,"/api/user/verify"),e)},verifyTwoFactor:function(e){return Xh.post("".concat(Nd,"/api/auth/2fa/verify"),e)},verifyTwoFactorTemp:function(e){return Xh.post("".concat(Nd,"/api/auth/2fa/verify-temp"),e)}});var Zh={string:function(e){if(e.enum)return aa(e.enum);var t=ra();return void 0!==e.minLength&&(t=t.min(e.minLength)),void 0!==e.maxLength&&(t=t.max(e.maxLength)),t},number:function(e){var t=pa();return void 0!==e.minimum&&(t=t.min(e.minimum)),void 0!==e.maximum&&(t=t.max(e.maximum)),t},integer:function(e){return Zh.number(e).int()},boolean:function(){return la()},array:function(e){if(e.items){var t=eg(e.items);return ca(t||ua())}return ca(ua())},object:function(e){var t={};return e.properties&&Object.entries(e.properties).forEach((function(n){var a=n[0],s=n[1],r=eg(s);t[a]=r||ua(),e.required&&e.required.includes(a)?t[a]=t[a].describe(s.description||""):t[a]=t[a].optional().describe(s.description||"")})),sa(t)}};function eg(e){if("object"!==e.type||0!==Object.keys(e.properties||{}).length)return(Zh[e.type]||function(){return ua()})(e)}var tg,ng,ag,sg,rg,og,ig=function(){function e(e,t,n,a){this.name=e,this.description=t,this.parameters=n,this.strict=null!=a&&a}return e.prototype.toObjectTool=function(){var e=_l(_l({},this.parameters),{additionalProperties:!this.strict&&void 0});return{type:Nl.function,function:_l({name:this.name,description:this.description,parameters:e},this.strict?{strict:this.strict}:{})}},e}(),lg=function(e,t,n,a,s,r,o){this.domain=e,this.basePath=t,this.method=n,this.operation=a,this.isConsequential=s,this.contentType=r,this.parameterLocations=o},cg=function(){function e(e){this.config=e,this.authHeaders={},this.path=e.basePath}return e.prototype.setParams=function(e){if(this.operationHash=function(e){return a.createHash("sha1").update(e).digest("hex")}(JSON.stringify(e)),this.params=_l({},e),this.config.parameterLocations)for(var t=0,n=Object.entries(e);t<n.length;t++){var s=n[t],r=s[0],o=s[1];if("path"===this.config.parameterLocations[r]){var i="{".concat(r,"}");this.path.includes(i)&&(this.path=this.path.replace(i,encodeURIComponent(String(o))),delete this.params[r])}}else for(var l=0,c=Object.entries(e);l<c.length;l++){var d=c[l];r=d[0],o=d[1],i="{".concat(r,"}"),this.path.includes(i)&&(this.path=this.path.replace(i,encodeURIComponent(String(o))),delete this.params[r])}return this},e.prototype.setAuth=function(e){return yl(this,0,void 0,(function(){var t,n,a,s,r,i,l,c,d,u,m,p,h,g,x,f,v,_;return jl(this,(function(b){if(!e.auth)return[2,this];if(t=e.auth,n=t.type,a=t.authorization_type,s=t.custom_auth_header,r=t.authorization_url,i=t.client_url,l=t.scope,c=t.token_exchange_method,d=e.api_key,u=e.oauth_client_id,m=e.oauth_client_secret,p=e.oauth_token_expires_at,h=e.oauth_access_token,g=void 0===h?"":h,x=null!=d&&d.length>0&&n===iu.ServiceHttp,f=!!(null!=u&&u&&null!=m&&m&&n===iu.OAuth&&null!=r&&r&&null!=i&&i&&null!=l&&l&&c),x&&a===lu.Basic)v=o.from(d).toString("base64"),this.authHeaders.Authorization="Basic ".concat(v);else if(x&&a===lu.Bearer)this.authHeaders.Authorization="Bearer ".concat(d);else if(x&&a===lu.Custom&&null!=s&&s)this.authHeaders[s]=d;else if(f){if(_=new Date,!g)throw new Error("No access token found. Please log in first.");if(p&&_>=new Date(p))throw new Error("Access token is expired. Please re-login.");this.authToken=g,this.authHeaders.Authorization="Bearer ".concat(this.authToken)}return[2,this]}))}))},e.prototype.execute=function(){return yl(this,0,void 0,(function(){var e,t,n,a,s,r,o,l,c,d,u;return jl(this,(function(m){if(e=function(e,t){var n=e.replace(/\/$/,""),a=t.replace(/^\//,""),s="".concat(n,"/").concat(a);return new i(s).toString()}(this.config.domain,this.path),t=_l(_l({},this.authHeaders),this.config.contentType?{"Content-Type":this.config.contentType}:{}),n=this.config.method.toLowerCase(),a=na.create(),s={},r={},this.config.parameterLocations&&this.params)for(o=0,l=Object.keys(this.params);o<l.length;o++)c=l[o],d=this.config.parameterLocations[c]||("get"===n?"query":"body"),u=this.params[c],"query"===d?s[c]=u:"header"===d?t[c]=String(u):"body"===d&&(r[c]=u);else this.params&&(Object.assign(s,this.params),Object.assign(r,this.params));if("get"===n)return[2,a.get(e,{headers:t,params:s})];if("post"===n)return[2,a.post(e,r,{headers:t,params:s})];if("put"===n)return[2,a.put(e,r,{headers:t,params:s})];if("delete"===n)return[2,a.delete(e,{headers:t,data:r,params:s})];if("patch"===n)return[2,a.patch(e,r,{headers:t,params:s})];throw new Error("Unsupported HTTP method: ".concat(n))}))}))},e.prototype.getConfig=function(){return this.config},e}(),dg=function(){function e(e,t,n,a,s,r,o){this.config=new lg(e,t,n,a,s,r,o)}return Object.defineProperty(e.prototype,"domain",{get:function(){return this.config.domain},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.config.basePath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return this.config.method},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"operation",{get:function(){return this.config.operation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConsequential",{get:function(){return this.config.isConsequential},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:function(){return this.config.contentType},enumerable:!1,configurable:!0}),e.prototype.createExecutor=function(){return new cg(this.config)},e.prototype.setParams=function(e){var t=this.createExecutor();return t.setParams(e),t},e.prototype.setAuth=function(e){return yl(this,0,void 0,(function(){return jl(this,(function(t){return[2,this.createExecutor().setAuth(e)]}))}))},e.prototype.execute=function(){return yl(this,0,void 0,(function(){return jl(this,(function(e){return[2,this.createExecutor().execute()]}))}))},e}();function ug(e,t){if("$ref"in e&&t){for(var n=t,a=0,s=e.$ref.replace(/^#\/components\//,"").split("/");a<s.length;a++){var r=s[a];if("object"!=typeof n||null===n||!(r in n))throw new Error("Could not resolve reference: ".concat(e.$ref));n=n[r]}return ug(n,t)}return e}function mg(e){return e.replace(/[^a-zA-Z0-9_-]/g,"")}function pg(e,t){var n,a,s,r,o,i,l,c;void 0===t&&(t=!1);for(var d=[],u={},m={},p=null!==(r=null===(s=null===(a=e.servers)||void 0===a?void 0:a[0])||void 0===s?void 0:s.url)&&void 0!==r?r:"",h=0,g=Object.entries(e.paths);h<g.length;h++)for(var x=g[h],f=x[0],v=x[1],_=0,b=Object.entries(v);_<b.length;_++){var y=b[_],j=y[0],w={},N=y[1],k="".concat(j,"_").concat(f),C=N.operationId||mg(k),S=N.summary||N.description||"",T=null!==(o=N["x-strict"])&&void 0!==o&&o,E={type:"object",properties:{},required:[]};if(N.parameters)for(var I=0,R=null!==(i=N.parameters)&&void 0!==i?i:[];I<R.length;I++){var A=ug(R[I],e.components),P=A.name;if(P&&A.schema){var O=ug(A.schema,e.components);E.properties[P]=O,A.required&&E.required.push(P),w[P]="query"===A.in||"path"===A.in||"header"===A.in||"body"===A.in?A.in:"query"}}var L="";if(N.requestBody){var M=N.requestBody.content;L=Object.keys(null!=M?M:{})[0];var D=ug(z=null===(l=null==M?void 0:M[L])||void 0===l?void 0:l.schema,e.components);if(E.properties=_l(_l({},E.properties),D.properties),D.required&&(n=E.required).push.apply(n,D.required),D.properties)for(var F in D.properties)w[F]="body";L=null!=L?L:"application/json"}var U=new ig(C,S,E,T);d.push(U);var z,V=new dg(p,f,j,C,!(null===(c=N["x-openai-isConsequential"])||void 0===c||!c),L,w);u[C]=V,t&&Object.keys(E.properties).length>0&&(z=eg(E))&&(m[C]=z)}return{functionSignatures:d,requestBuilders:u,zodSchemas:m}}function hg(e){var t;try{var n=void 0;try{n=JSON.parse(e)}catch(k){n=s(e)}if(!n.servers||!Array.isArray(n.servers)||0===n.servers.length)return{status:!1,message:"Could not find a valid URL in `servers`"};if(!n.servers[0].url)return{status:!1,message:"Could not find a valid URL in `servers`"};var a=n.paths;if(!a||"object"!=typeof a||0===Object.keys(a).length)return{status:!1,message:"No paths found in the OpenAPI spec."};for(var r=(null===(t=n.components)||void 0===t?void 0:t.schemas)||{},o=[],i=0,l=Object.entries(a);i<l.length;i++)for(var c=l[i],d=c[0],u=c[1],m=0,p=Object.entries(u);m<p.length;m++){var h=p[m],g=h[0],x=h[1],f=x.responses;if("object"==typeof x&&f)for(var v=0,_=Object.entries(f);v<_.length;v++){var b=_[v],y=b[0],j=b[1].content;if(j&&j["application/json"]&&j["application/json"].schema){var w=j["application/json"].schema;if("$ref"in w&&"string"==typeof w.$ref){var N=w.$ref.split("/").pop();N&&!r[N]&&o.push("In context=('paths', '".concat(d,"', '").concat(g,"', '").concat(y,"', 'response', 'content', 'application/json', 'schema'), reference to unknown component ").concat(N,"; using empty schema"))}}}}return{status:!0,message:o.join("\n")||"OpenAPI spec is valid.",spec:n,serverUrl:n.servers[0].url}}catch(C){return console.error(C),{status:!1,message:"Error parsing OpenAPI spec."}}}var gg={model:{key:"model",label:"com_ui_model",labelCode:!0,type:"string",component:"dropdown",optionType:"model",selectPlaceholder:"com_ui_select_model",searchPlaceholder:"com_ui_select_search_model",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:4},temperature:{key:"temperature",label:"com_endpoint_temperature",labelCode:!0,description:"com_endpoint_openai_temp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},topP:{key:"topP",label:"com_endpoint_top_p",labelCode:!0,description:"com_endpoint_anthropic_topp",descriptionCode:!0,type:"number",component:"slider",optionType:"model",columnSpan:4},stop:{key:"stop",label:"com_endpoint_stop",labelCode:!0,description:"com_endpoint_openai_stop",descriptionCode:!0,placeholder:"com_endpoint_stop_placeholder",placeholderCode:!0,type:"array",default:[],component:"tags",optionType:"conversation",minTags:0,maxTags:4},imageDetail:{key:"imageDetail",label:"com_endpoint_plug_image_detail",labelCode:!0,description:"com_endpoint_openai_detail",descriptionCode:!0,type:"enum",default:ac.auto,component:"slider",options:[ac.low,ac.auto,ac.high],enumMappings:(tg={},tg[ac.low]="com_ui_low",tg[ac.auto]="com_ui_auto",tg[ac.high]="com_ui_high",tg),optionType:"conversation",columnSpan:2}},xg=function(e,t){return _l(_l({},e),t)},fg={modelLabel:{key:"modelLabel",label:"com_endpoint_custom_name",labelCode:!0,type:"string",default:"",component:"input",placeholder:"com_endpoint_openai_custom_name_placeholder",placeholderCode:!0,optionType:"conversation"},maxContextTokens:{key:"maxContextTokens",label:"com_endpoint_context_tokens",labelCode:!0,type:"number",component:"input",placeholder:"com_nav_theme_system",placeholderCode:!0,description:"com_endpoint_context_info",descriptionCode:!0,optionType:"model",columnSpan:2},resendFiles:{key:"resendFiles",label:"com_endpoint_plug_resend_files",labelCode:!0,description:"com_endpoint_openai_resend_files",descriptionCode:!0,type:"boolean",default:!0,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},promptPrefix:{key:"promptPrefix",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"},fileTokenLimit:{key:"fileTokenLimit",label:"com_ui_file_token_limit",labelCode:!0,description:"com_ui_file_token_limit_desc",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,type:"number",component:"input",columnSpan:2}},vg={chatGptLabel:_l(_l({},fg.modelLabel),{key:"chatGptLabel"}),temperature:xg(gg.temperature,{default:_c.temperature.default,range:{min:_c.temperature.min,max:_c.temperature.max,step:_c.temperature.step}}),top_p:xg(gg.topP,{key:"top_p",default:_c.top_p.default,range:{min:_c.top_p.min,max:_c.top_p.max,step:_c.top_p.step}}),frequency_penalty:{key:"frequency_penalty",label:"com_endpoint_frequency_penalty",labelCode:!0,description:"com_endpoint_openai_freq",descriptionCode:!0,type:"number",default:_c.frequency_penalty.default,range:{min:_c.frequency_penalty.min,max:_c.frequency_penalty.max,step:_c.frequency_penalty.step},component:"slider",optionType:"model",columnSpan:4},presence_penalty:{key:"presence_penalty",label:"com_endpoint_presence_penalty",labelCode:!0,description:"com_endpoint_openai_pres",descriptionCode:!0,type:"number",default:_c.presence_penalty.default,range:{min:_c.presence_penalty.min,max:_c.presence_penalty.max,step:_c.presence_penalty.step},component:"slider",optionType:"model",columnSpan:4},max_tokens:{key:"max_tokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_openai_max_tokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,optionType:"model",columnSpan:2},reasoning_effort:{key:"reasoning_effort",label:"com_endpoint_reasoning_effort",labelCode:!0,description:"com_endpoint_openai_reasoning_effort",descriptionCode:!0,type:"enum",default:sc.unset,component:"slider",options:[sc.unset,sc.none,sc.minimal,sc.low,sc.medium,sc.high],enumMappings:(ng={},ng[sc.unset]="com_ui_auto",ng[sc.none]="com_ui_none",ng[sc.minimal]="com_ui_minimal",ng[sc.low]="com_ui_low",ng[sc.medium]="com_ui_medium",ng[sc.high]="com_ui_high",ng),optionType:"model",columnSpan:4},useResponsesApi:{key:"useResponsesApi",label:"com_endpoint_use_responses_api",labelCode:!0,description:"com_endpoint_openai_use_responses_api",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2},web_search:{key:"web_search",label:"com_ui_web_search",labelCode:!0,description:"com_endpoint_openai_use_web_search",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2},reasoning_summary:{key:"reasoning_summary",label:"com_endpoint_reasoning_summary",labelCode:!0,description:"com_endpoint_openai_reasoning_summary",descriptionCode:!0,type:"enum",default:rc.none,component:"slider",options:[rc.none,rc.auto,rc.concise,rc.detailed],enumMappings:(ag={},ag[rc.none]="com_ui_unset",ag[rc.auto]="com_ui_auto",ag[rc.concise]="com_ui_concise",ag[rc.detailed]="com_ui_detailed",ag),optionType:"model",columnSpan:4},verbosity:{key:"verbosity",label:"com_endpoint_verbosity",labelCode:!0,description:"com_endpoint_openai_verbosity",descriptionCode:!0,type:"enum",default:oc.none,component:"slider",options:[oc.none,oc.low,oc.medium,oc.high],enumMappings:(sg={},sg[oc.none]="com_ui_none",sg[oc.low]="com_ui_low",sg[oc.medium]="com_ui_medium",sg[oc.high]="com_ui_high",sg),optionType:"model",columnSpan:4},disableStreaming:{key:"disableStreaming",label:"com_endpoint_disable_streaming_label",labelCode:!0,description:"com_endpoint_disable_streaming",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2}},_g={maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_anthropic_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,range:{min:Nc.maxOutputTokens.min,max:Nc.maxOutputTokens.max,step:Nc.maxOutputTokens.step},optionType:"model",columnSpan:2},temperature:xg(gg.temperature,{default:Nc.temperature.default,range:{min:Nc.temperature.min,max:Nc.temperature.max,step:Nc.temperature.step}}),topP:xg(gg.topP,{default:Nc.topP.default,range:{min:Nc.topP.min,max:Nc.topP.max,step:Nc.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_anthropic_topk",descriptionCode:!0,type:"number",default:Nc.topK.default,range:{min:Nc.topK.min,max:Nc.topK.max,step:Nc.topK.step},component:"slider",optionType:"model",columnSpan:4},promptCache:{key:"promptCache",label:"com_endpoint_prompt_cache",labelCode:!0,description:"com_endpoint_anthropic_prompt_cache",descriptionCode:!0,type:"boolean",default:Nc.promptCache.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_anthropic_thinking",descriptionCode:!0,type:"boolean",default:Nc.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_anthropic_thinking_budget",descriptionCode:!0,type:"number",component:"input",default:Nc.thinkingBudget.default,range:{min:Nc.thinkingBudget.min,max:Nc.thinkingBudget.max,step:Nc.thinkingBudget.step},optionType:"conversation",columnSpan:2},web_search:{key:"web_search",label:"com_ui_web_search",labelCode:!0,description:"com_endpoint_anthropic_use_web_search",descriptionCode:!0,type:"boolean",default:Nc.web_search.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2}},bg={system:{key:"system",label:"com_endpoint_prompt_prefix",labelCode:!0,type:"string",default:"",component:"textarea",placeholder:"com_endpoint_openai_prompt_prefix_placeholder",placeholderCode:!0,optionType:"model"},region:{key:"region",type:"string",label:"com_ui_region",labelCode:!0,component:"combobox",optionType:"conversation",selectPlaceholder:"com_ui_select_region",searchPlaceholder:"com_ui_select_search_region",searchPlaceholderCode:!0,selectPlaceholderCode:!0,columnSpan:2},maxTokens:{key:"maxTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_anthropic_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,optionType:"model",columnSpan:2},temperature:xg(gg.temperature,{default:1,range:{min:0,max:1,step:.01}}),topK:xg(_g.topK,{range:{min:0,max:500,step:1}}),topP:xg(gg.topP,{default:.999,range:{min:0,max:1,step:.01}}),promptCache:{key:"promptCache",label:"com_endpoint_prompt_cache",labelCode:!0,type:"boolean",description:"com_endpoint_anthropic_prompt_cache",descriptionCode:!0,default:!0,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2}},yg={temperature:xg(gg.temperature,{default:.7,range:{min:0,max:1,step:.01}}),topP:xg(gg.topP,{range:{min:0,max:1,step:.01}})},jg={temperature:xg(gg.temperature,{default:.3,range:{min:0,max:1,step:.01}}),topP:xg(gg.topP,{default:.75,range:{min:.01,max:.99,step:.01}})},wg={temperature:xg(gg.temperature,{default:.5,range:{min:0,max:1,step:.01}}),topP:xg(gg.topP,{default:.9,range:{min:0,max:1,step:.01}})},Ng={temperature:xg(gg.temperature,{default:bc.temperature.default,range:{min:bc.temperature.min,max:bc.temperature.max,step:bc.temperature.step}}),topP:xg(gg.topP,{default:bc.topP.default,range:{min:bc.topP.min,max:bc.topP.max,step:bc.topP.step}}),topK:{key:"topK",label:"com_endpoint_top_k",labelCode:!0,description:"com_endpoint_google_topk",descriptionCode:!0,type:"number",default:bc.topK.default,range:{min:bc.topK.min,max:bc.topK.max,step:bc.topK.step},component:"slider",optionType:"model",columnSpan:4},maxOutputTokens:{key:"maxOutputTokens",label:"com_endpoint_max_output_tokens",labelCode:!0,type:"number",component:"input",description:"com_endpoint_google_maxoutputtokens",descriptionCode:!0,placeholder:"com_nav_theme_system",placeholderCode:!0,default:bc.maxOutputTokens.default,range:{min:bc.maxOutputTokens.min,max:bc.maxOutputTokens.max,step:bc.maxOutputTokens.step},optionType:"model",columnSpan:2},thinking:{key:"thinking",label:"com_endpoint_thinking",labelCode:!0,description:"com_endpoint_google_thinking",descriptionCode:!0,type:"boolean",default:bc.thinking.default,component:"switch",optionType:"conversation",showDefault:!1,columnSpan:2},thinkingBudget:{key:"thinkingBudget",label:"com_endpoint_thinking_budget",labelCode:!0,description:"com_endpoint_google_thinking_budget",descriptionCode:!0,placeholder:"com_ui_auto",placeholderCode:!0,type:"number",component:"input",range:{min:bc.thinkingBudget.min,max:bc.thinkingBudget.max,step:bc.thinkingBudget.step},optionType:"conversation",columnSpan:2},web_search:{key:"web_search",label:"com_endpoint_use_search_grounding",labelCode:!0,description:"com_endpoint_google_use_search_grounding",descriptionCode:!0,type:"boolean",default:!1,component:"switch",optionType:"model",showDefault:!1,columnSpan:2}},kg=[fg.modelLabel,fg.promptPrefix,fg.maxContextTokens,Ng.maxOutputTokens,Ng.temperature,Ng.topP,Ng.topK,fg.resendFiles,Ng.thinking,Ng.thinkingBudget,Ng.web_search,fg.fileTokenLimit],Cg=[gg.model,fg.modelLabel,fg.promptPrefix],Sg=[fg.maxContextTokens,Ng.maxOutputTokens,Ng.temperature,Ng.topP,Ng.topK,fg.resendFiles,Ng.thinking,Ng.thinkingBudget,Ng.web_search,fg.fileTokenLimit],Tg=[fg.modelLabel,fg.promptPrefix,fg.maxContextTokens,vg.max_tokens,vg.temperature,vg.top_p,vg.frequency_penalty,vg.presence_penalty,gg.stop,fg.resendFiles,gg.imageDetail,vg.web_search,vg.reasoning_effort,vg.useResponsesApi,vg.reasoning_summary,vg.verbosity,vg.disableStreaming,fg.fileTokenLimit],Eg=[gg.model,fg.modelLabel,fg.promptPrefix],Ig=[fg.maxContextTokens,vg.max_tokens,vg.temperature,vg.top_p,vg.frequency_penalty,vg.presence_penalty,gg.stop,fg.resendFiles,gg.imageDetail,vg.reasoning_effort,vg.reasoning_summary,vg.verbosity,vg.useResponsesApi,vg.web_search,vg.disableStreaming,fg.fileTokenLimit],Rg=[fg.modelLabel,fg.promptPrefix,fg.maxContextTokens,_g.maxOutputTokens,_g.temperature,_g.topP,_g.topK,fg.resendFiles,_g.promptCache,_g.thinking,_g.thinkingBudget,_g.web_search,fg.fileTokenLimit],Ag=[gg.model,fg.modelLabel,fg.promptPrefix],Pg=[fg.maxContextTokens,_g.maxOutputTokens,_g.temperature,_g.topP,_g.topK,fg.resendFiles,_g.promptCache,_g.thinking,_g.thinkingBudget,_g.web_search,fg.fileTokenLimit],Og=[fg.modelLabel,bg.system,fg.maxContextTokens,bg.maxTokens,bg.temperature,bg.topP,bg.topK,gg.stop,fg.resendFiles,bg.region,bg.promptCache,_g.thinking,_g.thinkingBudget,fg.fileTokenLimit],Lg=[fg.modelLabel,fg.promptPrefix,fg.maxContextTokens,bg.maxTokens,yg.temperature,yg.topP,fg.resendFiles,bg.region,fg.fileTokenLimit],Mg=[fg.modelLabel,fg.promptPrefix,fg.maxContextTokens,bg.maxTokens,jg.temperature,jg.topP,fg.resendFiles,bg.region,fg.fileTokenLimit],Dg=[fg.modelLabel,fg.promptPrefix,fg.maxContextTokens,wg.temperature,wg.topP,fg.resendFiles,bg.region,bg.promptCache,fg.fileTokenLimit],Fg=[gg.model,fg.modelLabel,bg.system,gg.stop],Ug=[fg.maxContextTokens,bg.maxTokens,bg.temperature,bg.topP,bg.topK,fg.resendFiles,bg.region,bg.promptCache,_g.thinking,_g.thinkingBudget,fg.fileTokenLimit],zg=[gg.model,fg.modelLabel,fg.promptPrefix],Vg=[fg.maxContextTokens,bg.maxTokens,yg.temperature,yg.topP,fg.resendFiles,bg.region,fg.fileTokenLimit],$g=[gg.model,fg.modelLabel,fg.promptPrefix],Bg=[fg.maxContextTokens,bg.maxTokens,jg.temperature,jg.topP,fg.resendFiles,bg.region,fg.fileTokenLimit],Hg=[gg.model,fg.modelLabel,fg.promptPrefix],Gg=[fg.maxContextTokens,wg.temperature,wg.topP,fg.resendFiles,bg.region,bg.promptCache,fg.fileTokenLimit],Kg=((rg={})[Yl.openAI]=Tg,rg[Yl.azureOpenAI]=Tg,rg[Yl.custom]=Tg,rg[Yl.anthropic]=Rg,rg["".concat(Yl.bedrock,"-").concat(Zl.Anthropic)]=Og,rg["".concat(Yl.bedrock,"-").concat(Zl.MistralAI)]=Lg,rg["".concat(Yl.bedrock,"-").concat(Zl.Cohere)]=Mg,rg["".concat(Yl.bedrock,"-").concat(Zl.Meta)]=Dg,rg["".concat(Yl.bedrock,"-").concat(Zl.AI21)]=Dg,rg["".concat(Yl.bedrock,"-").concat(Zl.Amazon)]=Dg,rg["".concat(Yl.bedrock,"-").concat(Zl.DeepSeek)]=Dg,rg[Yl.google]=kg,rg),Wg={col1:Eg,col2:Ig},qg={col1:Hg,col2:Gg},Qg=((og={})[Yl.openAI]=Wg,og[Yl.azureOpenAI]=Wg,og[Yl.custom]=Wg,og[Yl.anthropic]={col1:Ag,col2:Pg},og["".concat(Yl.bedrock,"-").concat(Zl.Anthropic)]={col1:Fg,col2:Ug},og["".concat(Yl.bedrock,"-").concat(Zl.MistralAI)]={col1:zg,col2:Vg},og["".concat(Yl.bedrock,"-").concat(Zl.Cohere)]={col1:$g,col2:Bg},og["".concat(Yl.bedrock,"-").concat(Zl.Meta)]=qg,og["".concat(Yl.bedrock,"-").concat(Zl.AI21)]=qg,og["".concat(Yl.bedrock,"-").concat(Zl.Amazon)]=qg,og["".concat(Yl.bedrock,"-").concat(Zl.DeepSeek)]=qg,og[Yl.google]={col1:Cg,col2:Sg},og),Yg=Object.entries(Qg).reduce((function(e,t){var n=t[0],a=t[1];return a&&(e[n]=a.col2),e}),{});class Xg{constructor(e){t(this,"mediaSource",new MediaSource),t(this,"audioChunks",[]),t(this,"sourceBuffer"),this.mediaSource.addEventListener("sourceopen",(async()=>{this.sourceBuffer=this.mediaSource.addSourceBuffer(e),this.sourceBuffer.addEventListener("updateend",(()=>{this.tryAppendNextChunk()}))}))}tryAppendNextChunk(){null!=this.sourceBuffer&&!this.sourceBuffer.updating&&this.audioChunks.length>0&&this.sourceBuffer.appendBuffer(this.audioChunks.shift())}addBase64Data(e){this.addData(Uint8Array.from(atob(e),(e=>e.charCodeAt(0))).buffer)}addData(e){this.audioChunks.push(e),this.tryAppendNextChunk()}close(){"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()}get mediaSourceUrl(){return URL.createObjectURL(this.mediaSource)}}const Jg=7e3;function Zg(e){return null==e||""===e||e===Bm.EPHEMERAL_AGENT_ID}var ex=(e=>(e.SIMPLE="simple",e.ADVANCED="advanced",e))(ex||{}),tx=(e=>(e.browser="browser",e.external="external",e))(tx||{});const nx="prompt-textarea",ax="global-audio";var sx=(e=>(e.landing="landing",e.menuItem="menu-item",e.nav="nav",e.message="message",e))(sx||{}),rx=(e=>(e.advanced="advanced",e.builder="builder",e.actions="actions",e.model="model",e.version="version",e))(rx||{});const ox=450;var ix=(e=>(e.Top="top",e.Right="right",e.Bottom="bottom",e.Left="left",e))(ix||{}),lx=(e=>(e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error",e))(lx||{});const cx={log:(...e)=>{},dir:(...e)=>{},warn:(...e)=>{},info:(...e)=>{},error:(...e)=>{},debug:(...e)=>{}};function dx(e){var t;const n={};for(const a of e){if(null==a)continue;const e=a.toolCallId||"";0!==e.length&&(n[e]||(n[e]=[]),null==(t=n[e])||t.push(a))}return n}function ux(e){const t={};for(const n of e)t[n.file_id]=n;return t}function mx(e){const t={};for(const n of e)t[n.id]=n;return t}function px(e){try{JSON.parse(e)}catch(t){return!1}return!0}function hx(e){try{return JSON.stringify(JSON.parse(e),null,2)}catch(t){return e}}const gx=["text/x-"],xx={paths:Rs,fill:"#FF5588",title:"Document"},fx={paths:As,fill:"#10A37F",title:"Spreadsheet"},vx={file:{paths:Ls,fill:"#0000FF",title:"File"},text:xx,txt:xx,audio:{paths:Os,fill:"#FF6B35",title:"Audio"},video:{paths:Ps,fill:"#8B5CF6",title:"Video"},csv:fx,"application/pdf":xx,pdf:xx,"text/x-":{paths:Is,fill:"#FF6E3C",title:"Code"},artifact:{paths:Is,fill:"#2D305C",title:"Code"}},_x=(e="")=>{if(vx[e])return vx[e];if(nd.test(e))return fx;const t=gx.find((t=>e.includes(t)));if(t&&vx[t])return vx[t];const n=e.split("/")[0]||"text";return vx[n]?vx[n]:vx.file};function bx(e,t=!1){if(!e)return"";const n=new Date(e);if(t)return n.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"2-digit"});return`${n.getDate()} ${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]} ${n.getFullYear()}`}function yx(e,t){const n=e.getQueryData([Fh.files]);if(!n)return void console.warn("No current files found in cache, skipped updating file query cache");n.findIndex((e=>e.file_id===t.file_id))>-1?console.warn("File already exists in cache, skipped updating file query cache"):e.setQueryData([Fh.files],[{...t},...n])}function jx(e,t=2){if(0===e)return 0;const n=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(n))}const{checkType:wx}=xd,Nx=/\$\\ce\{/g,kx=/\$\\pu\{/g,Cx=/\$\\\\ce\{[^}]*\}\$/g,Sx=/\$\\\\pu\{[^}]*\}\$/g,Tx=new RegExp("(?<![\\\\$])\\$(?!\\$)(?=\\d+(?:,\\d{3})*(?:\\.\\d+)?(?:[KMBkmb])?(?:\\s|$|[^a-zA-Z\\d]))","g"),Ex=new RegExp("(?<!\\\\)\\$(?!\\$)((?:[^$\\n]|\\\\[$])+?)(?<!\\\\)(?<!`)\\$(?!\\$)","g");function Ix(e,t){let n=0,a=t.length-1;for(;n<=a;){const s=Math.floor((n+a)/2),[r,o]=t[s];if(e>=r&&e<=o)return!0;e<r?a=s-1:n=s+1}return!1}function Rx(e){if(!e.includes("$"))return e;let t=e;(e.includes("\\ce{")||e.includes("\\pu{"))&&(t=function(e){let t=e.replace(Nx,"$\\\\ce{");return t=t.replace(kx,"$\\\\pu{"),t=t.replace(Cx,(e=>`$${e}$`)),t=t.replace(Sx,(e=>`$${e}$`)),t}(e));const n=function(e){const t=[];let n=-1,a=-1;for(let s=0;s<e.length;s++){const r=e[s];"`"===r&&s+2<e.length&&"`"===e[s+1]&&"`"===e[s+2]?-1===a?(a=s,s+=2):(t.push([a,s+2]),a=-1,s+=2):"`"===r&&-1===a&&(-1===n?n=s:(t.push([n,s]),n=-1))}return t}(t),a=[];let s,r=0;for(Tx.lastIndex=0;null!==(s=Tx.exec(t));)Ix(s.index,n)||(a.push(t.substring(r,s.index)),a.push("\\$"),r=s.index+1);a.push(t.substring(r)),t=a.join("");const o=[];for(r=0,Ex.lastIndex=0;null!==(s=Ex.exec(t));)Ix(s.index,n)||(o.push(t.substring(r,s.index)),o.push(`$$${s[1]}$$`),r=s.index+s[0].length);return o.push(t.substring(r)),o.join("")}const Ax=e=>t=>{t?"string"!=typeof t?t.value&&e(t.value+""):e(t):e("")},Px=e=>({label:Sm[e]??e,value:e}),Ox=()=>({...xc,model:localStorage.getItem(Hm.LAST_AGENT_MODEL)??"",provider:Px(localStorage.getItem(Hm.LAST_AGENT_PROVIDER)??""),avatar_file:null,avatar_preview:"",avatar_action:null}),Lx=({agent:e,fileMap:t})=>{var n,a,s,r,o,i,d,u,m,p,h,g;const x=(null==e?void 0:e.isPublic)??!1,f=(null==(a=null==(n=null==e?void 0:e.tool_resources)?void 0:n.context)?void 0:a.file_ids)??[];(null==(r=null==(s=null==e?void 0:e.tool_resources)?void 0:s.ocr)?void 0:r.file_ids)&&f.push(...e.tool_resources.ocr.file_ids);const v={...e??{},label:(null==e?void 0:e.name)??"",value:(null==e?void 0:e.id)??"",icon:x?l.jsx(c,{className:"icon-md text-green-400"}):null,context_files:f.length>0?[]:void 0,knowledge_files:(null==(i=null==(o=null==e?void 0:e.tool_resources)?void 0:o.file_search)?void 0:i.file_ids)?[]:void 0,code_files:(null==(u=null==(d=null==e?void 0:e.tool_resources)?void 0:d.execute_code)?void 0:u.file_ids)?[]:void 0};if(!t)return v;const _=({file_id:e,tool_resource:n,list:a})=>{const s=t[e],r=n===kl.file_search?Sd.vectordb:(null==s?void 0:s.source)??Sd.local;s?null==a||a.push([e,{file_id:s.file_id,type:s.type,filepath:s.filepath,filename:s.filename,width:s.width,height:s.height,size:s.bytes,preview:s.filepath,metadata:s.metadata,progress:1,source:r}]):null==a||a.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:Yl.agents,source:r}])};return v.context_files&&f.length>0&&f.forEach((e=>_({file_id:e,list:v.context_files,tool_resource:kl.context}))),v.knowledge_files&&(null==(p=null==(m=null==e?void 0:e.tool_resources)?void 0:m.file_search)?void 0:p.file_ids)&&e.tool_resources.file_search.file_ids.forEach((e=>_({file_id:e,list:v.knowledge_files,tool_resource:kl.file_search}))),v.code_files&&(null==(g=null==(h=null==e?void 0:e.tool_resources)?void 0:h.execute_code)?void 0:g.file_ids)&&e.tool_resources.execute_code.file_ids.forEach((e=>_({file_id:e,list:v.code_files,tool_resource:kl.execute_code}))),v},Mx=({url:e,alt:t,imgClass:n})=>{const[a,s]=ja(!1);return ya((()=>{s(!1)}),[e]),l.jsxs(l.Fragment,{children:[l.jsx("img",{src:e,alt:t,className:n,loading:"lazy",onLoad:()=>s(!0),onError:()=>s(!1),style:{opacity:a?1:0,transition:"opacity 0.2s ease-in-out"}}),!a&&l.jsx(Ms,{className:"absolute inset-0 rounded-full","aria-hidden":"true"})]})},Dx=(e,t={})=>{const{size:n="md",className:a="",showBorder:s=!0}=t,r=(e=>(null==e?void 0:e.avatar)?"string"==typeof e.avatar?e.avatar:e.avatar&&"object"==typeof e.avatar&&"filepath"in e.avatar?e.avatar.filepath:null:null)(e),o={icon:"h-5 w-5",sm:"h-12 w-12 sm:h-14 sm:w-14",md:"h-16 w-16 sm:h-20 sm:w-20 md:h-24 md:w-24",lg:"h-20 w-20 sm:h-24 sm:w-24 md:h-28 md:w-28",xl:"h-24 w-24"},i=s?"border-1 border-border-medium":"";return r?l.jsx("div",{className:`relative flex items-center justify-center ${o[n]} ${a}`,children:l.jsx(Mx,{url:r,alt:`${(null==e?void 0:e.name)||"Agent"} avatar`,imgClass:`${o[n]} rounded-full object-cover shadow-lg ${i}`})}):l.jsx("div",{className:`relative flex items-center justify-center ${o[n]} ${a}`,children:l.jsx(d,{className:`text-text-primary ${{icon:"h-4 w-4",sm:"h-6 w-6 sm:h-7 sm:w-7",md:"h-6 w-6 sm:h-8 sm:w-8 md:h-10 md:w-10",lg:"h-8 w-8 sm:h-10 sm:w-10 md:h-12 md:w-12",xl:"h-10 w-10"}[n]}`,strokeWidth:1.5})})},Fx=xi((e=>{localStorage.removeItem(`${Hm.TEXT_DRAFT}${e??""}`)}),2500),Ux=({id:e,value:t})=>{t&&t.length>1?localStorage.setItem(`${Hm.TEXT_DRAFT}${e}`,(e=>{try{const t=(new TextEncoder).encode(e);return btoa(String.fromCharCode(...t))}catch{return""}})(t)):localStorage.removeItem(`${Hm.TEXT_DRAFT}${e}`)},zx=e=>(e=>{try{const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return(new TextDecoder).decode(n)}catch{return""}})((localStorage.getItem(`${Hm.TEXT_DRAFT}${e??""}`)??"")||""),Vx={today:"com_ui_date_today",yesterday:"com_ui_date_yesterday",previous7Days:"com_ui_date_previous_7_days",previous30Days:"com_ui_date_previous_30_days",january:"com_ui_date_january",february:"com_ui_date_february",march:"com_ui_date_march",april:"com_ui_date_april",may:"com_ui_date_may",june:"com_ui_date_june",july:"com_ui_date_july",august:"com_ui_date_august",september:"com_ui_date_september",october:"com_ui_date_october",november:"com_ui_date_november",december:"com_ui_date_december"},$x=new Map([["december",11],["november",10],["october",9],["september",8],["august",7],["july",6],["june",5],["may",4],["april",3],["march",2],["february",1],["january",0]]),Bx=Object.fromEntries(Object.entries(Vx).map((([e,t])=>[t,e]))),Hx=new Set([Vx.today,Vx.yesterday,Vx.previous7Days,Vx.previous30Days]),Gx=e=>{if(!Array.isArray(e))return[];const t=new Set,n=new Map,a=new Date(Date.now());e.forEach((e=>{if(!e||t.has(e.conversationId))return;let s;t.add(e.conversationId),s=e.updatedAt?ji(e.updatedAt):a;const r=(e=>{const t=new Date(Date.now());if(wi(e))return Vx.today;if(Ni(e,{start:ki(Ci(t,1)),end:t}))return Vx.yesterday;if(Ni(e,{start:Ci(t,7),end:t}))return Vx.previous7Days;if(Ni(e,{start:Ci(t,30),end:t}))return Vx.previous30Days;if(Ni(e,{start:Si(t),end:t})){const t=Ti(e,"MMMM").toLowerCase();return Vx[t]}return" "+Ei(e).toString()})(s);n.has(r)||n.set(r,[]),n.get(r).push(e)}));const s=new Map;Hx.forEach((e=>{n.has(e)&&s.set(e,n.get(e))}));return Array.from(n.keys()).filter((e=>!Hx.has(e))).sort(((e,t)=>{const[n,a]=[parseInt(e.trim()),parseInt(t.trim())];if(n!==a)return a-n;const[s,r]=[Bx[e],Bx[t]];return($x.get(r)??-1)-($x.get(s)??-1)})).forEach((e=>{s.set(e,n.get(e))})),s.forEach((e=>{e.sort(((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()))})),Array.from(s,(([e,t])=>[e,t]))};function Kx(e,t){if(e)for(const n of e.pages){const e=n.conversations.find((e=>e.conversationId===t));if(e)return e}}function Wx(e,t){const n=e.getQueryCache().findAll([Fh.allConversations],{exact:!1});for(const a of n)e.setQueryData(a.queryKey,(e=>e?e.pages.some((e=>e.conversations.some((e=>e.conversationId===t.conversationId))))?e:{...e,pages:[{...e.pages[0],conversations:[t,...e.pages[0].conversations]},...e.pages.slice(1)]}:e))}function qx(e,t,n){const a=e.getQueryCache().findAll([Fh.allConversations],{exact:!1});for(const s of a)e.setQueryData(s.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId===t?n(e):e))})))}:e))}function Qx(e,t){const n=e.getQueryCache().findAll([Fh.allConversations],{exact:!1});for(const a of n)e.setQueryData(a.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==t))}))).filter((e=>e.conversations.length>0))}:e))}const Yx=(e,t)=>null!=u({path:t,end:!1},e),Xx=e=>Yx(e,"/c/*")||Yx(e,"/share/*"),Jx=(e,t)=>{const{endpoint:n,title:a,model:s,tools:r,promptPrefix:o,chatGptLabel:i,modelLabel:l}=e,c=s??"";let d="",u="";return l&&(u=l),u&&null!=a&&a&&u.toLowerCase().includes(a.toLowerCase())?(d=u+": ",u=""):null!=a&&a&&"New Chat"!==a.trim()&&(d=a+": "),!0===t?`${c}${u?` | ${u}`:""}${null!=o&&o?` | ${o}`:""}${r?` | ${r.map((e=>"string"==typeof e?e:e.pluginKey)).join(", ")}`:""}`:`${d}${c}${u?` (${u})`:""}`.trim()},Zx=(e,t)=>{const n={...e};return n.tools&&n.tools.length>0&&(n.tools=n.tools.filter((e=>{let n;return"string"==typeof e?n=e:({pluginKey:n}=e),!!t[n]})).map((e=>"string"==typeof e?e:e.pluginKey))),n},ef=e=>Array.from(e.matchAll(/{{([^{}]+?)}}/gi)).map((e=>e[1].trim().toLowerCase())).some((e=>!Jm[e])),tf=e=>`{{${e}}}`;function nf(e,t){if(e.focus(),window.getSelection()&&document.queryCommandSupported("insertText"))document.execCommand("insertText",!1,t);else{console.warn("insertTextAtCursor: document.execCommand is not supported");const n=e.selectionStart,a=e.selectionEnd,s=e.value.substring(0,n),r=e.value.substring(a);e.value=s+t+r,e.selectionStart=e.selectionEnd=n+t.length;const o=new Event("input",{bubbles:!0});e.dispatchEvent(o)}}const af=e=>{e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)};function sf(e,t){e.value.endsWith(t)&&(e.value=e.value.slice(0,-1),e.setSelectionRange(e.value.length,e.value.length),e.dispatchEvent(new Event("input",{bubbles:!0}))),e.focus()}const rf=e=>!!e&&e.scrollHeight>e.clientHeight,of="|||",lf=(e,t)=>{var n;if(!e)return"";if(e.text)return e.text;if(e.content&&e.content.length>0)for(let a=e.content.length-1;a>=0;a--){const t=e.content[a];if(t&&t.type!==qm.TEXT)continue;const s=("string"==typeof(null==t?void 0:t.text)?t.text:null==(n=null==t?void 0:t.text)?void 0:n.value)??"";if(s.length>0)return s}return""},cf=e=>e?e.text?e.text:e.content&&e.content.length>0?e.content.filter((e=>null!=e&&e.type===qm.TEXT)).map((e=>{if(!("text"in e))return"";const t=e.text;return"string"==typeof t?t:(null==t?void 0:t.value)||""})).filter((e=>e.length>0)).join("\n"):"":"",df=(e,t)=>{if(!e)return"";const n=(e=>{var t,n,a,s,r,o,i,l;const c=(e,t)=>{if(0===e.length)return"0";const n=e.length,a=e.slice(-16);return`${n}${of}${a}${of}${t}`};if(e.text)return c(e.text,-1);if(!e.content||0===e.content.length)return"";for(let d=e.content.length-1;d>=0;d--){const u=e.content[d];if(!(null==u?void 0:u.type))continue;const m=u.type;let p="";if(p=m===qm.THINK&&"think"in u?"string"==typeof u.think?u.think:(null==(t=u.think)?void 0:t.value)??"":m===qm.TEXT&&"text"in u?"string"==typeof u.text?u.text:(null==(n=u.text)?void 0:n.value)??"":m===qm.ERROR&&"error"in u?String(u.error||"err").slice(0,30):m===qm.TOOL_CALL&&"tool_call"in u?`tc_${(null==(a=u.tool_call)?void 0:a.type)||"x"}_${String((null==(s=u.tool_call)?void 0:s.name)||"unknown").slice(0,20)}_${String((null==(r=u.tool_call)?void 0:r.args)||"none").slice(0,20)}_${String((null==(o=u.tool_call)?void 0:o.output)||"none").slice(0,20)}`:m===qm.IMAGE_FILE&&"image_file"in u?`if_${((null==(i=u.image_file)?void 0:i.file_id)||"x").slice(-8)}`:m===qm.IMAGE_URL?"iu":m===qm.AGENT_UPDATE&&"agent_update"in u?`au_${String((null==(l=u.agent_update)?void 0:l.agentId)||"x").slice(0,30)}`:m,p.length>0)return c(p,d)}return""})(e);return`${e.messageId??""}${of}${n}${of}${e.conversationId??t}`},uf=e=>{const t=document.getElementById("messages-end");t&&(t.scrollIntoView({behavior:"instant"}),e&&e())},mf=(e,t)=>{const n=t??Bm.NEW_CONVO;e.setQueryData([Fh.messages,n],[]),n!==Bm.NEW_CONVO&&e.setQueryData([Fh.messages,Bm.NEW_CONVO],[])},pf=(e,t)=>fi.isNil(e.depth)?t("com_endpoint_message"):t("com_endpoint_message_new",{0:e.depth+1}),hf=["python","javascript","java","go","bash","c","cpp","csharp","css","diff","graphql","json","kotlin","less","lua","makefile","markdown","objectivec","perl","php","php-template","plaintext","python-repl","r","ruby","rust","scss","shell","sql","swift","typescript","vbnet","wasm","xml","yaml"],gf={c:"c",cpp:"cpp","c++":"cpp",cplusplus:"cpp",d:"d",f90:"f90",fortran:"f90",fortran90:"f90",go:"go",golang:"go",java:"java",js:"js",javascript:"js",node:"js",nodejs:"js",php:"php",py:"py",python:"py",python3:"py",rs:"rs",rust:"rs",ts:"ts",typescript:"ts"};function xf(e){cc(e.endpoint)&&e.agent_id&&e.agent_id!==Bm.EPHEMERAL_AGENT_ID&&(e.model=void 0)}const ff=e=>{const t={};if(!e)return t;for(const n of Object.keys(e))t[n]=!!e[n];return t},vf=(e,t)=>{var n,a;const s=new Set(Cm),r=[];for(const o in t)(e[o]||(null==(n=t[o])?void 0:n.type)&&s.has(null==(a=t[o])?void 0:a.type))&&r.push(o);return r};function _f(e){const t=ff(e);return vf(t,e).sort(((t,n)=>{var a,s;return((null==(a=null==e?void 0:e[t])?void 0:a.order)??0)-((null==(s=null==e?void 0:e[n])?void 0:s.order)??0)}))}const bf=Hm.LAST_CONVO_SETUP+"_0";function yf(e){const{conversation:t,newEndpoint:n,endpointsConfig:a,modularChat:s=!1}=e,r=null==t?void 0:t.endpoint,o={...t,endpoint:n,conversationId:"new"};!cc(n)&&o.agent_id&&o.agent_id!==Bm.EPHEMERAL_AGENT_ID&&(o.agent_id=Bm.EPHEMERAL_AGENT_ID),xf(o);const i=lc(n)&&lc(r)&&r===n,l=(null==t?void 0:t.conversationId)??"",c=!(!l||"new"===l),d=Zm(a,r,"type")??r,u=Zm(a,n,"type")??n,m=Am.has(r??""),p=Am.has(d??""),h=m||p||i,g=Am.has(n??""),x=Am.has(u??"");return{template:o,shouldSwitch:r===n||s||i,isExistingConversation:c,isCurrentModular:h,newEndpointType:u,isNewModular:g||x||i}}function jf({specName:e,startupConfig:t}){var n,a;if(t&&e)return null==(a=null==(n=t.modelSpecs)?void 0:n.list)?void 0:a.find((t=>t.name===e))}function wf(e){const{modelSpecs:t,interface:n}=e??{},{list:a,prioritize:s}=t??{};if(!a)return;const r=null==a?void 0:a.find((e=>e.default));if(!0===s||!(null==n?void 0:n.modelSelect)){const e=localStorage.getItem(Hm.LAST_SPEC),t=null==a?void 0:a.find((t=>t.name===e));return{default:r||t||(null==a?void 0:a[0])}}if(r)return{default:r};const o=JSON.parse(localStorage.getItem(Hm.LAST_CONVO_SETUP+"_0")??"{}");return o.spec?{last:null==a?void 0:a.find((e=>e.name===o.spec))}:void 0}function Nf(e){if(e)return{...e.preset,spec:e.name,iconURL:kf(e)}}function kf(e){return e.iconURL??e.preset.iconURL??e.preset.endpoint??""}function Cf({endpointsConfig:e,iconURL:t,endpoint:n}){return((null==e?void 0:e[t??""])?t??n:n)??""}function Sf({endpoint:e,endpointType:t,endpointsConfig:n,endpointIconURL:a}){const s=t??Zm(n,e,"type")??"",r=a??Zm(n,e,"iconURL")??"";return r&&null!=Yl[r]?r:s?"unknown":e??"unknown"}const Tf=({endpoint:e,assistant_id:t,agent_id:n,agentsMap:a,assistantMap:s})=>{var r;const o=cc(e),i=lc(e);if(o){return{entity:null==a?void 0:a[n??""],isAgent:o,isAssistant:i}}if(i){return{entity:null==(r=null==s?void 0:s[e??""])?void 0:r[t??""],isAgent:o,isAssistant:i}}return{entity:null,isAgent:o,isAssistant:i}},Ef={[Ph.AGENT]:{resourceType:Ph.AGENT,defaultViewerRoleId:Lh.AGENT_VIEWER,defaultEditorRoleId:Lh.AGENT_EDITOR,defaultOwnerRoleId:Lh.AGENT_OWNER,getResourceUrl:e=>`${window.location.origin}/c/new?agent_id=${e}`,getResourceName:e=>e&&""!==e?`"${e}"`:"agent",getShareMessage:e=>e&&""!==e?`"${e}"`:"agent",getManageMessage:e=>"Manage permissions for "+(e&&""!==e?`"${e}"`:"agent"),getCopyUrlMessage:()=>"Agent URL copied"},[Ph.PROMPTGROUP]:{resourceType:Ph.PROMPTGROUP,defaultViewerRoleId:Lh.PROMPTGROUP_VIEWER,defaultEditorRoleId:Lh.PROMPTGROUP_EDITOR,defaultOwnerRoleId:Lh.PROMPTGROUP_OWNER,getResourceName:e=>e&&""!==e?`"${e}"`:"prompt",getShareMessage:e=>e&&""!==e?`"${e}"`:"prompt",getManageMessage:e=>"Manage permissions for "+(e&&""!==e?`"${e}"`:"prompt"),getCopyUrlMessage:()=>"Prompt URL copied"},[Ph.MCPSERVER]:{resourceType:Ph.MCPSERVER,defaultViewerRoleId:Lh.MCPSERVER_VIEWER,defaultEditorRoleId:Lh.MCPSERVER_EDITOR,defaultOwnerRoleId:Lh.MCPSERVER_OWNER,getResourceName:e=>e&&""!==e?`"${e}"`:"MCP server",getShareMessage:e=>e&&""!==e?`"${e}"`:"MCP server",getManageMessage:e=>"Manage permissions for "+(e&&""!==e?`"${e}"`:"MCP server"),getCopyUrlMessage:()=>"MCP Server URL copied"}},If={agent_viewer:{name:"com_ui_role_viewer",description:"com_ui_role_viewer_desc"},agent_editor:{name:"com_ui_role_editor",description:"com_ui_role_editor_desc"},agent_manager:{name:"com_ui_role_manager",description:"com_ui_role_manager_desc"},agent_owner:{name:"com_ui_role_owner",description:"com_ui_role_owner_desc"},promptGroup_viewer:{name:"com_ui_role_viewer",description:"com_ui_role_viewer_desc"},promptGroup_editor:{name:"com_ui_role_editor",description:"com_ui_role_editor_desc"},promptGroup_owner:{name:"com_ui_role_owner",description:"com_ui_role_owner_desc"},mcpServer_viewer:{name:"com_ui_mcp_server_role_viewer",description:"com_ui_mcp_server_role_viewer_desc"},mcpServer_editor:{name:"com_ui_mcp_server_role_editor",description:"com_ui_mcp_server_role_editor_desc"},mcpServer_owner:{name:"com_ui_mcp_server_role_owner",description:"com_ui_mcp_server_role_owner_desc"}},Rf=e=>If[e]||{name:"com_ui_unknown",description:"com_ui_unknown"};function Af(){const e={lastSelectedModel:localStorage.getItem(Hm.LAST_MODEL)??"",lastSelectedTools:localStorage.getItem(Hm.LAST_TOOLS)??"",lastConversationSetup:localStorage.getItem(Hm.LAST_CONVO_SETUP+"_0")??""};return{lastSelectedModel:e.lastSelectedModel?JSON.parse(e.lastSelectedModel):{},lastSelectedTools:e.lastSelectedTools?JSON.parse(e.lastSelectedTools):[],lastConversationSetup:e.lastConversationSetup?JSON.parse(e.lastConversationSetup):{}}}function Pf(){Object.keys(localStorage).forEach((e=>{(e.startsWith(Hm.LAST_MCP_)||e.startsWith(Hm.LAST_CODE_TOGGLE_)||e.startsWith(Hm.TEXT_DRAFT)||e.startsWith(Hm.ASST_ID_PREFIX)||e.startsWith(Hm.AGENT_ID_PREFIX)||e.startsWith(Hm.LAST_CONVO_SETUP))&&localStorage.removeItem(e)}))}function Of(e,t){for(let n=0;n<e.pages.length;n++){const a=t(e.pages[n]);if(-1!==a)return{pageIndex:n,index:a}}return{pageIndex:-1,index:-1}}const Lf=(e,t,n,a)=>{const s=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Of(e,a);return-1!==r&&-1!==o&&(s.pages[r][t].splice(o,1),s.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()})),s};const Mf=(e,t)=>((e,t,n,a)=>{const s=JSON.parse(JSON.stringify(e)),{pageIndex:r,index:o}=Of(e,a);return-1!==r&&-1!==o?Lf(e,t,n,a):(s.pages[0][t].unshift({...n,updatedAt:(new Date).toISOString()}),s)})(e,Pm.PROMPT_GROUPS,t,(e=>e.promptGroups.findIndex((e=>e._id===t._id)))),Df=(e,t)=>((e,t,n)=>{const a=JSON.parse(JSON.stringify(e)),{pageIndex:s,index:r}=Of(a,n);return-1!==s&&-1!==r&&a.pages[s][t].splice(r,1),a})(e,Pm.PROMPT_GROUPS,(e=>e.promptGroups.findIndex((e=>e._id===t)))),Ff=(e,t,n)=>((e,t,n,a,s)=>{const r=JSON.parse(JSON.stringify(e)),{pageIndex:o,index:i}=Of(r,(e=>e[n].findIndex((e=>e[a]===t[a]))));if(-1!==o&&-1!==i){const e={...r.pages[o][n].splice(i,1)[0],...t,updatedAt:(new Date).toISOString()};s&&s(e),r.pages[0][n].unshift(e)}return r})(e,t,Pm.PROMPT_GROUPS,"_id",n),Uf=(e,t)=>((e,t,n)=>{const{pageIndex:a,index:s}=Of(e,(e=>e[t].findIndex(n)));if(-1!==a&&-1!==s)return e.pages[a][t][s]})(e,Pm.PROMPT_GROUPS,t),zf=(e,t)=>{!function({queryClient:e,queryKey:t,searchProperty:n,updateData:a,searchValue:s}){e.setQueryData(t,(e=>e?e.map((e=>e[n]===s?{...e,...a}:e)):e))}({queryClient:e,queryKey:[Fh.allPromptGroups],searchProperty:"_id",updateData:t,searchValue:t._id})},Vf=(e,t)=>{!function(e,t,n,a){e.setQueryData(t,(e=>e?e.filter((e=>e[n]!==a)):e))}(e,[Fh.allPromptGroups],"_id",t)},$f=ra().email(),Bf=(e,t)=>{var n;if(!e||""===e.trim())return!0;const a=$f.safeParse(e);return a.success||t||(null==(n=a.error.errors[0])?void 0:n.message)||"Please enter a valid email address"},Hf="_TIMESTAMP",Gf=1728e5,Kf=[Hm.LAST_MCP_,Hm.LAST_CODE_TOGGLE_,Hm.LAST_WEB_SEARCH_TOGGLE_,Hm.LAST_FILE_SEARCH_TOGGLE_,Hm.LAST_ARTIFACTS_TOGGLE_,Hm.PIN_MCP_];function Wf(e){localStorage.setItem(`${e}${Hf}`,Date.now().toString())}function qf(e){const t=`${e}${Hf}`,n=localStorage.getItem(t);if(!n)return localStorage.getItem(e);return Date.now()-parseInt(n,10)>Gf?(localStorage.removeItem(e),localStorage.removeItem(t),null):localStorage.getItem(e)}function Qf(...e){return m(p(e))}function Yf({originalWidth:e,originalHeight:t,containerRef:n}){var a;const s=(null==(a=n.current)?void 0:a.offsetWidth)??0;if(0===s||null==e||null==t)return{width:"auto",height:"auto"};const r=e/t,o=Math.min(s,e);return{width:`${o}px`,height:`${o/r}px`}}const Xf=e=>{const t="com_auth_error_login";if(!e)return t;switch(!0){case e.includes("429"):return"com_auth_error_login_rl";case e.includes("403"):return"com_auth_error_login_ban";case e.includes("500"):return"com_auth_error_login_server";case e.includes("422"):return"com_auth_error_login_unverified";default:return t}},Jf=({preset:e})=>{const{endpoint:t,endpointType:n}=e??{};if(null==t||""===t)return console.error(`Unknown endpoint ${t}`,e),{endpoint:null,presetId:(null==e?void 0:e.presetId)??null,title:(null==e?void 0:e.title)??"New Preset"};const{presetOverride:a={},...s}=e??{},r={...s,...a};r.chatGptLabel&&r.modelLabel?delete r.chatGptLabel:r.chatGptLabel&&!r.modelLabel?(r.modelLabel=r.chatGptLabel,delete r.chatGptLabel):"chatGptLabel"in r&&delete r.chatGptLabel;const o=ip({endpoint:t,endpointType:n,conversation:r});return{presetId:(null==e?void 0:e.presetId)??null,...o,endpoint:t,endpointType:n,title:(null==e?void 0:e.title)??"New Preset"}},Zf=({models:e,conversation:t,endpoint:n=null,lastConversationSetup:a})=>{const{lastSelectedModel:s,lastSelectedTools:r}=Af(),o=(null==a?void 0:a.endpointType)??t.endpointType;if(!n)return{...t,endpointType:o,endpoint:n};const i=e,l=(null==a?void 0:a.model)??(null==s?void 0:s[n])??"";let c;c=i.includes(l)?[l,...i]:[...i];const d=ip({endpoint:n,endpointType:o,conversation:a,possibleValues:{models:c}}),u={...t,...d,endpointType:o,endpoint:n},m=(null==d?void 0:d.assistant_id)??(null==t?void 0:t.assistant_id)??"",p=(null==a?void 0:a.assistant_id)??"";lc(n)&&!p&&m&&(u.assistant_id=m);const h=(null==d?void 0:d.agent_id)??"",g=(null==a?void 0:a.agent_id)??"";return!cc(n)||!h||g&&g!==Bm.EPHEMERAL_AGENT_ID||(u.agent_id=h),xf(u),u.tools=(null==a?void 0:a.tools)??r??u.tools,u},ev=({convoSetup:e,endpointsConfig:t})=>((e,t)=>{let{endpoint:n=""}=e||{};return n=n??"",n&&(null==t?void 0:t[n])?n:(n&&console.warn(`Illegal target endpoint ${n}`,t),null)})(e,t)||(e=>{try{const{lastConversationSetup:t}=Af(),{endpoint:n}=t??{endpoint:null},a=Object.values(e??{}).every((e=>!e));return a&&n||a&&n||n&&null!=(null==e?void 0:e[n])?n:null}catch(t){return console.error(t),null}})(t)||(e=>_f(e).find((t=>Object.hasOwn(e??{},t))))(t),tv=Object.keys(Uc.shape);var nv={};const av="",sv="focus:outline-none focus:ring-0 focus:ring-opacity-0 focus:ring-offset-0",rv="transition-colors rounded-md min-w-[75px] border font-normal bg-white hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-700 dark:bg-gray-800 text-black dark:text-gray-600 focus:outline-none data-[state=open]:bg-gray-50 dark:data-[state=open]:bg-gray-700",ov="rounded-md border border-gray-200 focus:border-gray-400 focus:bg-gray-50 bg-transparent text-sm shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none focus-within:placeholder:text-text-primary focus:placeholder:text-text-primary placeholder:text-text-secondary focus:outline-none focus:ring-gray-400 focus:ring-opacity-20 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-700 dark:border-gray-600 dark:focus:bg-gray-600 dark:focus:border-gray-600 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:outline-none",iv="p-0 shadow-none text-right pr-1 h-8 border-transparent hover:bg-gray-800/10 dark:hover:bg-white/10 dark:focus:bg-white/10 transition-colors",lv=e=>{const t=document.createRange();t.selectNodeContents(e.target);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t))},cv=e=>"string"==typeof e?e:_a.isValidElement(e)?cv(e.props.children):Array.isArray(e)?e.map(cv).join(""):"",dv=e=>{const t=e.reduce(((e,t)=>e+t),0);if(Math.abs(t-100)<.01)return e.map((e=>Number(e.toFixed(2))));const n=100/t,a=e.map((e=>Number((e*n).toFixed(2)))),s=a.reduce(((t,n,a)=>a===e.length-1?t:t+n),0);return a[a.length-1]=Number((100-s).toFixed(2)),a},uv=async(e,t)=>{const{type:n,payload:a}=e;if(!["intent","tool","prompt"].includes(n))return;let s="";if("intent"===n){const{intent:e,params:t}=a;s=`The user clicked a button in an embedded UI Resource, and we got a message of type \`intent\`.\nThe intent is \`${e}\` and the params are:\n\n\`\`\`json\n${JSON.stringify(t,null,2)}\n\`\`\`\n\nExecute the intent that is mentioned in the message using the tools available to you.\n    `}else if("tool"===n){const{toolName:e,params:t}=a;s=`The user clicked a button in an embedded UI Resource, and we got a message of type \`tool\`.\nThe tool name is \`${e}\` and the params are:\n\n\`\`\`json\n${JSON.stringify(t,null,2)}\n\`\`\`\n\nExecute the tool that is mentioned in the message using the tools available to you.\n    `}else if("prompt"===n){const{prompt:e}=a;s=`The user clicked a button in an embedded UI Resource, and we got a message of type \`prompt\`.\nThe prompt is:\n\n\`\`\`\n${e}\n\`\`\`\n\nExecute the intention of the prompt that is mentioned in the message using the tools available to you.\n    `}cx.debug("MCP-UI","About to submit message:",s),t({text:s}),cx.debug("MCP-UI","Message submitted successfully")},mv=h({key:"artifactsState",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{cx.log("artifacts","Recoil Effect: Setting artifactsState",{key:t.key,newValue:e})}))}]}),pv=h({key:"currentArtifactId",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{cx.log("artifacts","Recoil Effect: Setting currentArtifactId",{key:t.key,newValue:e})}))}]}),hv=h({key:"artifactsVisibility",default:!0,effects:[({onSet:e,node:t})=>{e((async e=>{cx.log("artifacts","Recoil Effect: Setting artifactsVisibility",{key:t.key,newValue:e})}))}]}),gv=h({key:"visibleArtifacts",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{cx.log("artifacts","Recoil Effect: Setting `visibleArtifacts`",{key:t.key,newValue:e})}))}]}),xv=Object.freeze(Object.defineProperty({__proto__:null,artifactsState:mv,artifactsVisibility:hv,currentArtifactId:pv,visibleArtifacts:gv},Symbol.toStringTag,{value:"Module"})),fv=wa({}),vv=({children:e})=>{const t=ba(!1);return l.jsx(fv.Provider,{value:t,children:e})},_v=h({key:"latestMessageKeys",default:[]}),bv=h({key:"submissionKeys",default:[]}),yv=g({key:"latestMessageByIndex",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(Bm.COMMON_DIVIDER)[1]);cx.log("Recoil Effect: Setting latestMessage",{key:n,newValue:e})}))}]}),jv=g({key:"submissionByIndex",default:null}),wv=x({key:"latestMessageKeysSelector",get:({get:e})=>e(Sv).filter((t=>null!==e(yv(t)))),set:({set:e},t)=>{cx.log("setting latestMessageKeys",{newKeys:t}),e(_v,t)}}),Nv=x({key:"submissionKeysSelector",get:({get:e})=>e(Sv).filter((t=>null!==e(jv(t)))),set:({set:e},t)=>{cx.log("setting submissionKeysAtom",t),e(bv,t)}}),kv=g({key:"conversationByIndex",default:null,effects:[({onSet:e,node:t})=>{e((async(e,n)=>{const a=Number(t.key.split("__")[1]);if(cx.log("conversation","Setting conversation:",{index:a,newValue:e,oldValue:n}),null!=(null==e?void 0:e.assistant_id)&&e.assistant_id&&localStorage.setItem(`${Hm.ASST_ID_PREFIX}${a}${e.endpoint}`,e.assistant_id),null!=(null==e?void 0:e.agent_id)&&e.agent_id&&localStorage.setItem(`${Hm.AGENT_ID_PREFIX}${a}`,e.agent_id),null!=(null==e?void 0:e.spec)&&e.spec&&localStorage.setItem(Hm.LAST_SPEC,e.spec),(null==e?void 0:e.tools)&&Array.isArray(e.tools)&&localStorage.setItem(Hm.LAST_TOOLS,JSON.stringify(e.tools.filter((e=>!!e)))),!e)return;!function(e){if(!e)return;const{endpoint:t,model:n}=e;if(!t)return;const a=JSON.parse(localStorage.getItem(Hm.LAST_MODEL)??"{}");a[t]=n,localStorage.setItem(Hm.LAST_MODEL,JSON.stringify(a))}(e);const s={...e};xf(s),localStorage.setItem(`${Hm.LAST_CONVO_SETUP}_${a}`,JSON.stringify(s));const r=!0===e.disableParams;if(0===a&&!r&&""===e.createdAt&&JSON.stringify(e)!==JSON.stringify(n)&&(null==n?void 0:n.conversationId)===Bm.NEW_CONVO){const t=function(e){if(null==e)return new URLSearchParams;const t=new URLSearchParams;if(e&&"object"==typeof e&&!("endpoint"in e)&&!("model"in e))return Object.entries(e).forEach((([e,n])=>{null!=n&&tv.includes(e)&&t.set(e,n)})),t;const n=e,a=n.endpoint;if(n.spec)return new URLSearchParams({spec:n.spec});if(cc(a)&&n.agent_id&&!Zg(n.agent_id))return new URLSearchParams({agent_id:String(n.agent_id)});if(lc(a)&&n.assistant_id)return new URLSearchParams({assistant_id:String(n.assistant_id)});if(cc(a)&&!n.agent_id)return t;if(lc(a)&&!n.assistant_id)return t;a&&t.set("endpoint",a),n.model&&t.set("model",n.model);const s={};return tv.forEach((e=>{"agent_id"===e&&Zg(n.agent_id)||"endpoint"!==e&&"model"!==e&&(s[e]=n[e])})),Object.entries(s).reduce(((e,[t,n])=>(null!=n&&(Array.isArray(n)?e.set(t,"stop"===t?n.join(","):JSON.stringify(n)):e.set(t,String(n))),e)),t)}(e),n=Ma(t),a=`${window.location.pathname}?${n.toString()}`;window.history.pushState({},"",a)}}))}]}),Cv=g({key:"filesByIndex",default:new Map}),Sv=h({key:"conversationKeys",default:[]}),Tv=x({key:"allConversationsSelector",get:({get:e})=>e(Sv).map((t=>e(kv(t)))).map((e=>null==e?void 0:e.conversationId))}),Ev=g({key:"presetByIndex",default:null}),Iv=g({key:"textByIndex",default:""}),Rv=g({key:"showStopButtonByIndex",default:!1}),Av=g({key:"abortScrollByIndex",default:!1,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(Bm.COMMON_DIVIDER)[1]);cx.log("message_scrolling","Recoil Effect: Setting abortScrollByIndex",{key:n,newValue:e})}))}]}),Pv=g({key:"isSubmittingByIndex",default:!1,effects:[({onSet:e,node:t})=>{e((async e=>{const n=Number(t.key.split(Bm.COMMON_DIVIDER)[1]);cx.log("message_stream","Recoil Effect: Setting isSubmittingByIndex",{key:n,newValue:e})}))}]}),Ov=x({key:"anySubmittingSelector",get:({get:e})=>e(Sv).some((t=>!0===e(Pv(t))))}),Lv=g({key:"optionSettingsByIndex",default:{}}),Mv=g({key:"showPopoverByIndex",default:!1}),Dv=g({key:"activePromptByIndex",default:void 0}),Fv=g({key:"showMentionPopoverByIndex",default:!1}),Uv=g({key:"showPlusPopoverByIndex",default:!1}),zv=g({key:"showPromptsPopoverByIndex",default:!1}),Vv=g({key:"globalAudioURLByIndex",default:null}),$v=g({key:"globalAudioisFetchingByIndex",default:!1}),Bv=g({key:"globalAudioisPlayingByIndex",default:!1}),Hv=g({key:"activeRunByIndex",default:null}),Gv=g({key:"audioRunByIndex",default:null}),Kv=g({key:"messagesSiblingIdx",default:0});const Wv=f({key:"conversationByKeySelector",get:e=>({get:t})=>t(kv(e))});const qv=f({key:"updateConversationSelector",get:()=>()=>null,set:e=>({set:t,get:n},a)=>{if(a instanceof v)return;n(Sv).forEach((n=>{t(kv(n),(t=>t&&t.conversationId===e?{...t,...a}:t))}))}}),Qv={conversationKeysAtom:Sv,conversationByIndex:kv,filesByIndex:Cv,presetByIndex:Ev,submissionByIndex:jv,textByIndex:Iv,showStopButtonByIndex:Rv,abortScrollFamily:Av,isSubmittingFamily:Pv,optionSettingsFamily:Lv,showPopoverFamily:Mv,latestMessageFamily:yv,messagesSiblingIdxFamily:Kv,anySubmittingSelector:Ov,allConversationsSelector:Tv,conversationByKeySelector:Wv,useClearConvoState:function(){return _((({reset:e,snapshot:t})=>async n=>{const a=await t.getPromise(Sv);for(const s of a){if(!0===n&&0==s)continue;e(kv(s));await t.getPromise(kv(s))&&e(yv(s))}e(Sv)}),[])},useCreateConversationAtom:function(e){const t=Na(fv),[n,a]=b(Sv),s=y(kv(e)),r=j(kv(e));return ya((()=>{n.includes(e)||a([...n,e])}),[e,n,a]),{hasSetConversation:t,conversation:r,setConversation:s}},showMentionPopoverFamily:Fv,globalAudioURLFamily:Vv,activeRunFamily:Hv,audioRunFamily:Gv,globalAudioPlayingFamily:Bv,globalAudioFetchingFamily:$v,showPlusPopoverFamily:Uv,activePromptByIndex:Dv,useClearSubmissionState:function(){return _((({reset:e,set:t,snapshot:n})=>async a=>{const s=await n.getPromise(Nv);cx.log("submissionKeys",s);for(const t of s)!0===a&&0==t||(cx.log("resetting submission",t),e(jv(t)));t(Nv,[])}),[])},useClearLatestMessages:function(e){return _((({reset:t,set:n,snapshot:a})=>async s=>{const r=await a.getPromise(wv);cx.log("[clearAllLatestMessages] latestMessageKeys",r),null!=e&&e&&cx.log(`[clearAllLatestMessages] context: ${e}`);for(const e of r)!0===s&&0==e||(cx.log(`[clearAllLatestMessages] resetting latest message; key: ${e}`),t(yv(e)));n(wv,[])}),[])},showPromptsPopoverFamily:zv,updateConversationSelector:qv},Yv={[Yl.azureOpenAI]:null,[Yl.azureAssistants]:null,[Yl.assistants]:null,[Yl.agents]:null,[Yl.openAI]:null,[Yl.google]:null,[Yl.anthropic]:null,[Yl.custom]:null},Xv=h({key:"endpointsConfig",default:Yv}),Jv=h({key:"endpointsQueryEnabled",default:!0}),Zv=x({key:"endpointsFilter",get:({get:e})=>{const t=e(Xv)||{},n={};for(const a of Object.keys(t))n[a]=!!t[a];return n}}),e_={endpointsConfig:Xv,endpointsFilter:Zv,defaultConfig:Yv,endpointsQueryEnabled:Jv},t_={user:h({key:"user",default:void 0}),availableTools:h({key:"availableTools",default:{}})},n_={text:h({key:"text",default:""})},a_={toastState:h({key:"toastState",default:{open:!1,message:"",severity:lx.SUCCESS,showIcon:!0}})},s_={submission:h({key:"submission",default:null}),isSubmitting:h({key:"isSubmitting",default:!1})},r_={search:h({key:"search",default:{enabled:null,query:"",debouncedQuery:"",isSearching:!1,isTyping:!1}})},o_={defaultPreset:h({key:"defaultPreset",default:null}),presetModalVisible:h({key:"presetModalVisible",default:!1})};function i_(e,t){return h({key:e,default:t,effects_UNSTABLE:[({setSelf:n,onSet:a})=>{const s=localStorage.getItem(e);if(null!==s)try{n(JSON.parse(s))}catch(r){console.error(`Error parsing localStorage key "${e}", \`savedValue\`: defaultValue, error:`,r),localStorage.setItem(e,JSON.stringify(t)),n(t)}a((t=>{localStorage.setItem(e,JSON.stringify(t))}))}]})}const l_={...{promptsName:h({key:"promptsName",default:""}),promptsCategory:h({key:"promptsCategory",default:""}),promptsPageNumber:h({key:"promptsPageNumber",default:1}),promptsPageSize:h({key:"promptsPageSize",default:10})},...{autoSendPrompts:i_("autoSendPrompts",!0),alwaysMakeProd:i_("alwaysMakeProd",!0),promptsEditorMode:i_("promptsEditorMode",ex.SIMPLE)}},c_={lang:i_("lang",(()=>{const e=navigator.language||navigator.languages[0];return w.get("lang")||localStorage.getItem("lang")||e})())},d_={...{abortScroll:h({key:"abortScroll",default:!1}),optionSettings:h({key:"optionSettings",default:{}}),currentSettingsView:h({key:"currentSettingsView",default:_u.default}),showPopover:h({key:"showPopover",default:!1})},...{autoScroll:i_("autoScroll",!1),hideSidePanel:i_("hideSidePanel",!1),enableUserMsgMarkdown:i_(Hm.ENABLE_USER_MSG_MARKDOWN,!0),keepScreenAwake:i_("keepScreenAwake",!0),enterToSend:i_("enterToSend",!0),maximizeChatSpace:i_("maximizeChatSpace",!1),chatDirection:i_("chatDirection","LTR"),showCode:i_(Hm.SHOW_ANALYSIS_CODE,!0),saveDrafts:i_("saveDrafts",!0),showScrollButton:i_("showScrollButton",!0),forkSetting:i_("forkSetting",""),splitAtTarget:i_("splitAtTarget",!1),rememberDefaultFork:i_(Hm.REMEMBER_FORK_OPTION,!1),showThinking:i_("showThinking",!1),saveBadgesState:i_("saveBadgesState",!1),modularChat:i_("modularChat",!0),LaTeXParsing:i_("LaTeXParsing",!0),centerFormOnLanding:i_("centerFormOnLanding",!0),showFooter:i_("showFooter",!0),atCommand:i_("atCommand",!0),plusCommand:i_("plusCommand",!0),slashCommand:i_("slashCommand",!0),conversationMode:i_("conversationMode",!1),advancedMode:i_("advancedMode",!1),speechToText:i_("speechToText",!0),engineSTT:i_("engineSTT","browser"),languageSTT:i_("languageSTT",""),autoTranscribeAudio:i_("autoTranscribeAudio",!1),decibelValue:i_("decibelValue",-45),autoSendText:i_("autoSendText",-1),textToSpeech:i_("textToSpeech",!0),engineTTS:i_("engineTTS","browser"),voice:i_("voice",void 0),cloudBrowserVoices:i_("cloudBrowserVoices",!1),languageTTS:i_("languageTTS",""),automaticPlayback:i_("automaticPlayback",!1),playbackRate:i_("playbackRate",null),cacheTTS:i_("cacheTTS",!0),UsernameDisplay:i_("UsernameDisplay",!0)}},u_=i_("hideBannerHint",[]),m_=h({key:"messageAttachmentsMap",default:{}}),p_=f({key:"conversationAttachments",get:e=>({get:t})=>{if(!e)return{};const n=t(m_),a={};return Object.entries(n).forEach((([t,n])=>{if(!n||0===n.length)return;const s=n.filter((t=>t.conversationId===e));s.length>0&&(a[t]=s)})),a}}),h_=h({key:"queriesEnabled",default:!0}),g_=h({key:"isEditingBadges",default:!1}),x_=i_("chatBadges",[{id:"1"}]),f_={hideBannerHint:u_,messageAttachmentsMap:m_,conversationAttachmentsSelector:p_,queriesEnabled:h_,isEditingBadges:g_,chatBadges:x_},v_={isTemporary:i_("isTemporary",!1),defaultTemporaryChat:i_("defaultTemporaryChat",!1)},__=g({key:"ephemeralAgentByConvoId",default:null,effects:[({onSet:e,node:t})=>{e((async e=>{var n;const a=null==(n=t.key.split("__")[1])?void 0:n.replaceAll('"',"");cx.log("agents","Setting ephemeral agent:",{conversationId:a,newValue:e})}))}]});const b_=k((e=>{const t=e??Bm.NEW_CONVO,n=`${Hm.LAST_MCP_}${t}`;return N(n,[],void 0,{getOnInit:!0})})),y_=N(Hm.PIN_MCP_,!0,void 0,{getOnInit:!0});function j_(e,t){return N(e,t,void 0,{getOnInit:!0})}const w_=j_("favorites",[]),N_={...xv,...Qv,...e_,...t_,...n_,...a_,...s_,...r_,...l_,...o_,...c_,...d_,...f_,...v_};function k_(e=0){const t=y(N_.audioRunFamily(e)),n=y(N_.activeRunFamily(e)),a=y(N_.globalAudioPlayingFamily(e)),s=y(N_.globalAudioFetchingFamily(e)),[r,o]=b(N_.globalAudioURLFamily(e));return{pauseGlobalAudio:ka((()=>{if(null!=r&&""!==r){const e=document.getElementById(ax);e&&(console.log("Pausing global audio",r),e.pause(),a(!1)),URL.revokeObjectURL(r),s(!1),o(null),n(null),t(null)}}),[t,n,r,o,a,s])}}const C_=e=>{const t=j(N_.queriesEnabled);return gs([Fh.user],(()=>Jh.getUser()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},S_=(e={},t)=>{const{scopes:n,enabled:a=!1}=e;return gs({queryKey:[Fh.graphToken,n],queryFn:()=>Jh.getGraphApiToken({scopes:n}),enabled:a,staleTime:3e6,retry:1,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})};function T_(){const e=N_.useClearConvoState(),t=N_.useClearSubmissionState(),n=N_.useClearLatestMessages();return _((({reset:a,snapshot:s})=>async r=>{await t(r),await e(r),await n(r);const o=await s.getPromise(N_.conversationKeysAtom);for(const e of o)!0===r&&0===e||(a(N_.filesByIndex(e)),a(N_.presetByIndex(e)),a(N_.textByIndex(e)),a(N_.showStopButtonByIndex(e)),a(N_.abortScrollFamily(e)),a(N_.isSubmittingFamily(e)),a(N_.optionSettingsFamily(e)),a(N_.showPopoverFamily(e)),a(N_.showMentionPopoverFamily(e)),a(N_.showPlusPopoverFamily(e)),a(N_.showPromptsPopoverFamily(e)),a(N_.activePromptByIndex(e)),a(N_.globalAudioURLFamily(e)),a(N_.globalAudioFetchingFamily(e)),a(N_.globalAudioPlayingFamily(e)),a(N_.activeRunFamily(e)),a(N_.audioRunFamily(e)),a(N_.messagesSiblingIdxFamily(e.toString())));!function(e){Object.keys(localStorage).forEach((t=>{!0===e&&t.endsWith("0")||(t.startsWith(Hm.LAST_MCP_)||t.startsWith(Hm.LAST_CODE_TOGGLE_)||t.startsWith(Hm.ASST_ID_PREFIX)||t.startsWith(Hm.AGENT_ID_PREFIX)||t.startsWith(Hm.LAST_CONVO_SETUP)||t===Hm.LAST_SPEC||t===Hm.LAST_TOOLS||t===Hm.LAST_MODEL||t===Hm.FILES_TO_DELETE)&&localStorage.removeItem(t)}))}(r)}),[])}const E_={limit:10,requiredPermission:Oh.EDIT},I_=()=>{const e=xs().getQueryData([Fh.endpoints]),t=!!(null==e?void 0:e[Yl.agents]);return gs([Fh.tools],(()=>Jh.getAvailableAgentTools()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:t})},R_=(e=E_,t)=>{const n=xs().getQueryData([Fh.endpoints]),a=!!(null==n?void 0:n[Yl.agents]);return gs([Fh.agents,e],(()=>Jh.listAgents(e)),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&a:a})},A_=(e,t)=>{const n=!!e&&!Zg(e);return gs([Fh.agent,e],(()=>Jh.getAgentById({agent_id:e})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,enabled:n&&!0,...t})},P_=(e,t)=>gs([Fh.agent,e,"expanded"],(()=>Jh.getExpandedAgentById({agent_id:e})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),O_=e=>gs([Fh.agentCategories],(()=>Jh.getAgentCategories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5,...e}),L_=[{requiredPermission:Oh.VIEW},{requiredPermission:Oh.EDIT}],M_=e=>{const t=xs();return fs((e=>Jh.createAgent(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;return L_.forEach((r=>{var o;const i=t.getQueryData([Fh.agents,r]);if(!i)return null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,a,s);const l=[n,...JSON.parse(JSON.stringify(i.data))];t.setQueryData([Fh.agents,r],{...i,data:l})})),H_(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},D_=e=>{const t=xs();return fs((({agent_id:e,data:t})=>Jh.updateAgent({data:t,agent_id:e})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;return L_.forEach((r=>{var o;const i=t.getQueryData([Fh.agents,r]);if(!i)return null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,a,s);t.setQueryData([Fh.agents,r],{...i,data:i.data.map((e=>e.id===a.agent_id?n:e))})})),t.setQueryData([Fh.agent,a.agent_id],n),t.setQueryData([Fh.agent,a.agent_id,"expanded"],n),H_(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},F_=e=>{const t=xs();return fs((({agent_id:e})=>Jh.deleteAgent({agent_id:e})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;const o=(r=>{let o=[];return L_.forEach((r=>{var i;const l=t.getQueryData([Fh.agents,r]);if(!l)return null==(i=null==e?void 0:e.onSuccess)?void 0:i.call(e,n,a,s);o=l.data.filter((e=>e.id!==a.agent_id)),t.setQueryData([Fh.agents,r],{...l,data:o})})),o})();return t.removeQueries([Fh.agent,a.agent_id]),t.removeQueries([Fh.agent,a.agent_id,"expanded"]),H_(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,o)}})},U_=e=>{const t=xs();return fs((e=>Jh.duplicateAgent(e)),{onMutate:null==e?void 0:e.onMutate,onError:null==e?void 0:e.onError,onSuccess:({agent:n,actions:a},s,r)=>{var o;L_.forEach((e=>{const a=t.getQueryData([Fh.agents,e]);if(a){const s=[n,...a.data];t.setQueryData([Fh.agents,e],{...a,data:s})}}));const i=t.getQueryData([Fh.actions])||[];return t.setQueryData([Fh.actions],i.concat(a)),H_(t),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,{agent:n,actions:a},s,r)}})},z_=e=>{const t=xs();return fs({mutationKey:[$h.agentAvatarUpload],mutationFn:e=>Jh.uploadAgentAvatar(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;return L_.forEach((e=>{const s=t.getQueryData([Fh.agents,e]);s&&t.setQueryData([Fh.agents,e],{...s,data:s.data.map((e=>e.id===a.agent_id?n:e))})})),t.setQueryData([Fh.agent,a.agent_id],n),t.setQueryData([Fh.agent,a.agent_id,"expanded"],n),H_(t),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},V_=e=>{const t=xs();return fs([$h.updateAgentAction],{mutationFn:e=>Jh.updateAgentAction(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;const o=n[0];return L_.forEach((r=>{var i;const l=t.getQueryData([Fh.agents,r]);if(!l)return null==(i=null==e?void 0:e.onSuccess)?void 0:i.call(e,n,a,s);t.setQueryData([Fh.agents,r],{...l,data:l.data.map((e=>e.id===a.agent_id?o:e))})})),t.setQueryData([Fh.actions],(e=>e?a.action_id?e.map((e=>e.action_id===a.action_id?n[1]:e)):[...e,n[1]]:[n[1]])),t.setQueryData([Fh.agent,a.agent_id],o),t.setQueryData([Fh.agent,a.agent_id,"expanded"],o),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},$_=e=>{const t=xs();return fs([$h.deleteAgentAction],{mutationFn:e=>Jh.deleteAgentAction({...e}),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;let o="";t.setQueryData([Fh.actions],(e=>null==e?void 0:e.filter((e=>(o=e.metadata.domain,e.action_id!==a.action_id))))),L_.forEach((e=>{t.setQueryData([Fh.agents,e],(e=>e?{...e,data:e.data.map((e=>{var t;return e.id===a.agent_id?{...e,tools:null==(t=e.tools)?void 0:t.filter((e=>!e.includes(o??"")))}:e}))}:e))}));const i=e=>{var t;return e?{...e,tools:null==(t=e.tools)?void 0:t.filter((e=>!e.includes(o??"")))}:e};return t.setQueryData([Fh.agent,a.agent_id],i),t.setQueryData([Fh.agent,a.agent_id,"expanded"],i),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},B_=e=>{const t=xs();return fs((({agent_id:e,version_index:t})=>Jh.revertAgentVersion({agent_id:e,version_index:t})),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;return t.setQueryData([Fh.agent,a.agent_id],n),L_.forEach((e=>{const s=t.getQueryData([Fh.agents,e]);s&&t.setQueryData([Fh.agents,e],{...s,data:s.data.map((e=>e.id===a.agent_id?n:e))})})),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},H_=e=>{e.invalidateQueries([Fh.marketplaceAgents])},G_=e=>{const t=j(N_.queriesEnabled);return gs([Fh.endpoints],(()=>Jh.getAIEndpoints()),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},K_=e=>{const t=j(N_.queriesEnabled);return gs([Fh.startupConfig],(()=>Jh.getStartupConfig()),{staleTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},W_=e=>{const t=xs(),{showToast:n}=Ds(),a=qN(),{onSuccess:s,onError:r,...o}=e||{};return fs([$h.fileDelete],{mutationFn:e=>Jh.deleteFiles(e),...o,onError:(e,t,s)=>{var o;if(e&&"object"==typeof e&&"response"in e){403===(null==(o=e.response)?void 0:o.status)&&n({message:a("com_ui_delete_not_allowed"),status:"error"})}null==r||r(e,t,s)},onSuccess:(e,r,o)=>{t.setQueryData([Fh.files],(e=>{const{files:t}=r,n=t.reduce(((e,t)=>(e.set(t.file_id,t),e)),new Map);return(e??[]).filter((e=>!n.has(e.file_id)))})),n({message:a("com_ui_delete_success"),status:"success"}),null==s||s(e,r,o),null!=r.agent_id&&r.agent_id&&t.refetchQueries([Fh.agent,r.agent_id])}})},q_=e=>{const t=j(N_.queriesEnabled);return gs([Fh.files],(()=>Jh.getFiles()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},Q_=(e,t)=>{const n=j(N_.queriesEnabled);return gs(Bh(e??""),(()=>e?Jh.getAgentFiles(e):Promise.resolve([])),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:n&&!Zg(e)})},Y_=e=>gs([Fh.fileConfig],(()=>Jh.getFileConfig()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),X_=(e,t)=>{const n=xs();return gs([Fh.fileDownload,t],(async()=>{if(!e||!t)return void console.warn("No user ID provided for file download");const a=await Jh.getFileDownload(e,t),s=a.data,r=window.URL.createObjectURL(s);try{const e=JSON.parse(a.headers["x-file-metadata"]);if(!e)return console.warn("No metadata found for file download",a.headers),r;yx(n,e)}catch(o){console.error("Error parsing file metadata, skipped updating file query cache",o)}return r}),{enabled:!1,retry:!1})},J_=()=>fs({mutationFn:async({files:e,accessToken:t,onProgress:n})=>{const a=[],s=[];let r=0;const o=[];for(let i=0;i<e.length;i+=3)o.push(e.slice(i,i+3));for(const i of o){const o=i.map((async a=>{try{const o=a.downloadUrl||`https://graph.microsoft.com/v1.0/drives/${a.driveId}/items/${a.itemId}/content`,i=await fetch(o,{headers:{Authorization:`Bearer ${t}`}});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);const l=await i.blob(),c=i.headers.get("content-type")||Z_(a.name),d=new File([l],a.name,{type:c,lastModified:Date.now()});return r++,null==n||n({completed:r,total:e.length,currentFile:a.name,failed:s}),d}catch(o){throw console.error(`Failed to download ${a.name}:`,o),s.push(a.name),r++,null==n||n({completed:r,total:e.length,currentFile:`Error: ${a.name}`,failed:s}),o}}));(await Promise.allSettled(o)).forEach((e=>{"fulfilled"===e.status&&a.push(e.value)}))}return s.length>0&&console.warn(`Failed to download ${s.length} files:`,s),a},retry:1});function Z_(e){var t;return{pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",csv:"text/csv",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",bmp:"image/bmp",svg:"image/svg+xml",webp:"image/webp",zip:"application/zip",rar:"application/x-rar-compressed",mp4:"video/mp4",mp3:"audio/mpeg",wav:"audio/wav"}[(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""]||"application/octet-stream"}const eb=e=>gs([Fh.memories],(()=>Jh.getMemories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),tb=e=>{const t=xs();return fs([$h.updateMemoryPreferences],(e=>Jh.updateMemoryPreferences(e)),{...e,onSuccess:(...n)=>{var a;t.invalidateQueries([Fh.user]),null==(a=null==e?void 0:e.onSuccess)||a.call(e,...n)}})},nb=e=>{const t=xs();return fs((({key:e,value:t})=>Jh.createMemory({key:e,value:t})),{...e,onSuccess:(n,a,s)=>{var r;t.setQueryData([Fh.memories],(e=>{if(!e)return e;const t=[...e.memories,n.memory],a=t.reduce(((e,t)=>e+(t.tokenCount||0)),0),s=e.tokenLimit;let r=e.usagePercentage;return s&&s>0&&(r=Math.min(100,Math.round(a/s*100))),{...e,memories:t,totalTokens:a,usagePercentage:r}})),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,a,s)}})},ab=(e,t)=>{const n=T(),a=xs();return gs([Fh.messages,e],(async()=>{const t=await Jh.getMessagesByConvoId(e);if(!n.pathname.includes("/c/new")&&1===(null==t?void 0:t.length)){const s=a.getQueryData([Fh.messages,e]);if(1===(null==s?void 0:s.length))return t;if(s&&(null==s?void 0:s.length)>1)return cx.warn("messages",`Messages query for convo ${e} returned fewer than cache; path: "${n.pathname}"`,t,s),s}return t}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})},sb=e=>{const t=j(N_.queriesEnabled);return gs([Fh.balance],(()=>Jh.getUserBalance()),{refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:!0,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},rb=e=>{const t=j(N_.queriesEnabled);return gs([Fh.searchEnabled],(()=>Jh.getSearchEnabled()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:!0===((null==e?void 0:e.enabled)??!0)&&t})},ob=(e,t)=>gs([Fh.toolAuth,e.toolId],(()=>Jh.getVerifyAgentToolAuth(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t}),ib=(e,t)=>{const{conversationId:n=""}=e;return gs([Fh.toolCalls,n],(()=>Jh.getToolCalls(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:n.length>0&&n!==Bm.NEW_CONVO&&n!==Bm.PENDING_CONVO&&n!==Bm.SEARCH,...t})},lb=e=>gs([Fh.mcpConnectionStatus],(()=>Jh.getMCPConnectionStatus()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:1e4,...e}),cb=(e,t)=>gs([Fh.mcpAuthValues,e],(()=>Jh.getMCPAuthValues(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:!!e,...t}),db=e=>gs(["favorites"],(()=>Jh.getFavorites()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),ub=()=>{const e=xs();return fs((e=>Jh.updateFavorites(e)),{onMutate:async t=>{await e.cancelQueries(["favorites"]);const n=e.getQueryData(["favorites"]);return e.setQueryData(["favorites"],t),{previousFavorites:n}},onError:(t,n,a)=>{(null==a?void 0:a.previousFavorites)&&e.setQueryData(["favorites"],a.previousFavorites)}})},mb=()=>{const e=xs();return{updateTagsInConversation:(t,n)=>{const a=e.getQueryData([Fh.conversation,t]);if(!a)return;const s={...a,tags:n};e.setQueryData([Fh.conversation,t],s),e.setQueryData([Fh.allConversations],(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId===(a.conversationId??"")?{...e,tags:s.tags}:e))})))}:e))},replaceTagsInAllConversations:(t,n)=>{const a=e.getQueryData([Fh.allConversations]);if(a){const s=JSON.parse(JSON.stringify(a));for(let e=0;e<s.pages.length;e++){const a=s.pages[e];a.conversations=a.conversations.map((e=>{var a;return e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&(null==(a=e.tags)?void 0:a.includes(t))&&(e.tags=e.tags.map((e=>e===t?n:e))),e}))}e.setQueryData([Fh.allConversations],s)}const s=[];for(let r=0;r<s.length;r++){const a=s[r],o=e.getQueryData([Fh.conversation,a]);if(o&&o.tags){const s={...o,tags:o.tags.map((e=>e===t?n:e))};e.setQueryData([Fh.conversation,a],s)}}}}},pb=e=>gs([Fh.presets],(()=>Jh.getPresets()),{staleTime:1e4,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),hb=(e,t)=>{const{isArchived:n,sortBy:a,sortDirection:s,tags:r,search:o}=e;return vs({queryKey:[n?Fh.archivedConversations:Fh.allConversations,{isArchived:n,sortBy:a,sortDirection:s,tags:r,search:o}],queryFn:({pageParam:e})=>Jh.listConversations({isArchived:n,sortBy:a,sortDirection:s,tags:r,search:o,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},gb=(e,t)=>{const{pageSize:n,isPublic:a,search:s,sortBy:r,sortDirection:o}=e;return vs({queryKey:[Fh.sharedLinks,{pageSize:n,isPublic:a,search:s,sortBy:r,sortDirection:o}],queryFn:({pageParam:e})=>Jh.listSharedLinks({cursor:null==e?void 0:e.toString(),pageSize:n,isPublic:a,search:s,sortBy:r,sortDirection:o}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})},xb=e=>gs([Fh.conversationTags],(()=>Jh.getConversationTags()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}),fb=(e,t)=>{var n,a;const s=xs(),r=s.getQueryData([Fh.endpoints]),o=s.getQueryData([Fh.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!cc(e)||!!(null==r?void 0:r[e])&&i,c=(null==(a=null==r?void 0:r[e])?void 0:a.version)??Fu[e];return gs([Fh.tools],(()=>Jh.getAvailableTools(e,c)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,enabled:l,...t})},vb=(e,t=Dl,n)=>{var a,s;const r=xs(),o=r.getQueryData([Fh.endpoints]),i=r.getQueryData([Fh.name,e]),l=!!!(null==(a=null==o?void 0:o[e])?void 0:a.userProvide)||!!(null==i?void 0:i.expiresAt),c=!!(null==o?void 0:o[e])&&l,d=(null==(s=null==o?void 0:o[e])?void 0:s.version)??Fu[e];return gs([Fh.assistants,e,t],(()=>Jh.listAssistants({...t,endpoint:e},d)),{staleTime:5e3,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...n,enabled:void 0!==(null==n?void 0:n.enabled)?n.enabled&&c:c})},_b=(e,t)=>{var n;const a=xs(),s=a.getQueryData([Fh.endpoints]),r=a.getQueryData([Fh.name,e]),o=!!!(null==(n=null==s?void 0:s[e])?void 0:n.userProvide)||!!(null==r?void 0:r.expiresAt),i=!!(null==s?void 0:s[e])&&o||e===Yl.agents;return gs([Fh.actions],(()=>Jh.getActions()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&i:i})},bb=(e,t)=>{var n,a;const s=xs(),r=s.getQueryData([Fh.endpoints]),o=s.getQueryData([Fh.name,e]),i=!!!(null==(n=null==r?void 0:r[e])?void 0:n.userProvide)||!!(null==o?void 0:o.expiresAt),l=!!(null==r?void 0:r[e])&&i,c=(null==(a=null==r?void 0:r[e])?void 0:a.version)??Fu[e];return gs([Fh.assistantDocs,e],(()=>Jh.getAssistantDocs({endpoint:e,version:c})),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t,enabled:void 0!==(null==t?void 0:t.enabled)?t.enabled&&l:l})},yb=()=>{const e=xs();return fs((e=>Jh.genTitle(e)),{onSuccess:(t,n)=>{e.setQueryData([Fh.conversation,n.conversationId],(e=>e?{...e,title:t.title}:e)),qx(e,n.conversationId,(e=>({...e,title:t.title}))),document.title=t.title}})},jb=e=>{const t=xs(),n=[Fh.allConversations],a=[Fh.archivedConversations],{onMutate:s,onError:r,onSuccess:o,...i}=e||{};return fs((e=>Jh.archiveConversation(e)),{onMutate:s,onSuccess:(e,n,a)=>{const s=!0===n.isArchived;Qx(t,n.conversationId);const r=t.getQueryCache().findAll([Fh.archivedConversations],{exact:!1});for(const o of r)t.setQueryData(o.queryKey,(t=>t?s?{...t,pages:[{...t.pages[0],conversations:[e,...t.pages[0].conversations]},...t.pages.slice(1)]}:{...t,pages:t.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==n.conversationId))})))}:t));t.setQueryData([Fh.conversation,n.conversationId],s?null:e),null==o||o(e,n,a)},onError:r,onSettled:()=>{t.invalidateQueries({queryKey:n,refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:a,refetchPage:(e,t)=>0===t})},...i})},wb=e=>{const t=xs(),{onSuccess:n,...a}=e||{};return fs((({conversationId:e,targetMessageId:t})=>{if(!e)throw new Error("Conversation ID is required");return Jh.createSharedLink(e,t)}),{onSuccess:(e,a,s)=>{t.setQueryData([Fh.sharedLinks,e.conversationId],e),null==n||n(e,a,s)},...a})},Nb=e=>{const t=xs(),{onSuccess:n,...a}=e||{};return fs((({shareId:e})=>{if(!e)throw new Error("Share ID is required");return Jh.updateSharedLink(e)}),{onSuccess:(e,a,s)=>{t.setQueryData([Fh.sharedLinks,e.conversationId],e),null==n||n(e,a,s)},...a})},kb=e=>{const t=xs(),{onSuccess:n}=e||{};return fs((e=>Jh.deleteSharedLink(e.shareId)),{onMutate:async e=>{await t.cancelQueries({queryKey:[Fh.sharedLinks],exact:!1});const n=new Map;return t.getQueryCache().findAll([Fh.sharedLinks]).forEach((a=>{const s=t.getQueryData(a.queryKey);n.set(a.queryKey,s),t.setQueryData(a.queryKey,(t=>{if(!(null==t?void 0:t.pages))return t;const n=t.pages.map((t=>({...t,links:t.links.filter((t=>t.shareId!==e.shareId))}))).filter((e=>e.links.length>0));return{...t,pages:n}}))})),{previousQueries:n}},onError:(e,n,a)=>{(null==a?void 0:a.previousQueries)&&a.previousQueries.forEach(((e,n)=>{t.setQueryData(n,e)}))},onSettled:()=>{t.invalidateQueries({queryKey:[Fh.sharedLinks],exact:!1})},onSuccess:(e,a)=>{n&&n(e,a),t.refetchQueries({queryKey:[Fh.sharedLinks],exact:!0})}})},Cb=({context:e,tag:t,options:n})=>{const a=xs(),{onSuccess:s,...r}=n||{},{updateTagsInConversation:o,replaceTagsInAllConversations:i}=mb();return fs((e=>null!=t?Jh.updateConversationTag(t,e):Jh.createConversationTag(e)),{onSuccess:(...n)=>{((n,s)=>{if(a.setQueryData([Fh.conversationTags],(a=>{if(!a)return[{count:1,position:0,tag:Bm.SAVED_TAG,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}];if(void 0===t||!t.length){const t=a.findIndex((e=>e.tag===n.tag));if(-1!==t){cx.log("tag_mutation",`"Created" tag exists, updating from ${e}`,a,n);const s=[...a];return s[t]={...s[t],...n},s.sort(((e,t)=>e.position-t.position))}return cx.log("tag_mutation",`"Created" tag is new, adding from ${e}`,a,n),[...a,n].sort(((e,t)=>e.position-t.position))}return cx.log("tag_mutation",`Updating tag from ${e}`,a,n),((e,t,n,a)=>{if(0===e.length)return[n];const s=e.find((e=>e.tag===a));if(!s)return[e[0],n,...e.slice(1)].map(((e,t)=>({...e,position:t})));const r=s.position,o=n.position,i=e.filter((e=>e.tag!==a));if(void 0===o||r===o)return e.map((e=>e.tag===a?n:e));const l=[...i.slice(0,o),n,...i.slice(o)];if(o>r)for(let c=r;c<o;c++)l[c].position=c;else for(let c=o+1;c<l.length;c++)l[c].position=c;return l})(a,0,n,t)})),!0===s.addToConversation&&null!=s.conversationId&&n.tag){const t=a.getQueryData([Fh.conversation,s.conversationId]);if(!t)return;cx.log("tag_mutation",`\`updateTagsInConversation\` Update from ${e}`,t),o(s.conversationId,[...t.tags||[],n.tag])}null!=t&&i(t,n.tag)})(...n),null==s||s(...n)},...r})},Sb=e=>{const t=xs(),n=(()=>{const e=xs();return t=>{const n=e.getQueryData([Fh.allConversations]);if(!n||!Array.isArray(n.pages)||0===n.pages.length)return;const a=[],s={pageParams:Array.isArray(n.pageParams)?[...n.pageParams]:[],pages:n.pages.map((e=>({...e,conversations:e.conversations.map((e=>e.conversationId&&"tags"in e&&Array.isArray(e.tags)&&e.tags.includes(t)?(a.push(e.conversationId),{...e,tags:e.tags.filter((e=>e!==t))}):e))})))};e.setQueryData([Fh.allConversations],s);for(let r=0;r<a.length;r++){const n=a[r],s=e.getQueryData([Fh.conversation,n]);s&&Array.isArray(s.tags)&&e.setQueryData([Fh.conversation,n],{...s,tags:s.tags.filter((e=>e!==t))})}}})(),{onSuccess:a,...s}=e||{};return fs((e=>Jh.deleteConversationTag(e)),{onSuccess:(e,s,r)=>{t.setQueryData([Fh.conversationTags],(e=>e?e.filter((e=>e.tag!==s)):e)),n(s),null==a||a(e,s,r)},...s})},Tb=e=>{const t=xs();return fs((e=>Jh.deleteConversation(e)),{onMutate:async()=>{await t.cancelQueries([Fh.allConversations]),await t.cancelQueries([Fh.archivedConversations])},onError:()=>{},onSuccess:(n,a,s)=>{var r;a.conversationId&&Qx(t,a.conversationId);const o=t.getQueryCache().findAll([Fh.archivedConversations],{exact:!1});for(const e of o)t.setQueryData(e.queryKey,(e=>e?{...e,pages:e.pages.map((e=>({...e,conversations:e.conversations.filter((e=>e.conversationId!==a.conversationId))}))).filter((e=>e.conversations.length>0))}:e));t.removeQueries({queryKey:[Fh.conversation,a.conversationId],exact:!0}),t.invalidateQueries({queryKey:[Fh.allConversations],refetchPage:(e,t)=>0===t}),t.invalidateQueries({queryKey:[Fh.archivedConversations],refetchPage:(e,t)=>0===t}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,a,s)}})},Eb=e=>{const t=xs(),{onSuccess:n,onError:a,onMutate:s}=e||{};return fs({mutationFn:e=>Jh.importConversationsFile(e),onSuccess:(e,a,s)=>{t.invalidateQueries([Fh.allConversations]),n&&n(e,a,s)},onError:(e,t,n)=>{a&&a(e,t,n)},onMutate:s})},Ib=e=>fs([$h.avatarUpload],{mutationFn:e=>Jh.uploadAvatar(e),...e||{}}),Rb=e=>{const t=xs();return fs((e=>Jh.createAssistant(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r,o;const i=t.getQueryData([Fh.assistants,a.endpoint,Dl]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s);const l=[n,...JSON.parse(JSON.stringify(i.data))];return t.setQueryData([Fh.assistants,a.endpoint,Dl],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,a,s)}})},Ab=e=>{const t=xs();return fs((({assistant_id:e,data:n})=>{const{endpoint:a}=n,s=t.getQueryData([Fh.endpoints]),r=null==s?void 0:s[a],o=(null==r?void 0:r.version)??Fu[a];return Jh.updateAssistant({data:n,version:o,assistant_id:e})}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r,o;const i=t.getQueryData([Fh.assistants,a.data.endpoint,Dl]);return i?(t.setQueryData([Fh.assistantDocs,a.data.endpoint],(e=>e?e.map((e=>e.assistant_id===a.assistant_id?{...e,conversation_starters:n.conversation_starters,append_current_datetime:a.data.append_current_datetime}:e)):e)),t.setQueryData([Fh.assistants,a.data.endpoint,Dl],{...i,data:i.data.map((e=>e.id===a.assistant_id?n:e))}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,a,s)):null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},Pb=e=>{const t=xs();return fs((({assistant_id:e,model:n,endpoint:a})=>{var s;const r=t.getQueryData([Fh.endpoints]),o=(null==(s=null==r?void 0:r[a])?void 0:s.version)??Fu[a];return Jh.deleteAssistant({assistant_id:e,model:n,version:o,endpoint:a})}),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r,o;const i=t.getQueryData([Fh.assistants,a.endpoint,Dl]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s);const l=i.data.filter((e=>e.id!==a.assistant_id));return t.setQueryData([Fh.assistants,a.endpoint,Dl],{...i,data:l}),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,a,l)}})},Ob=e=>fs([$h.assistantAvatarUpload],{mutationFn:({postCreation:e,...t})=>Jh.uploadAssistantAvatar(t),...e||{}}),Lb=e=>{const t=xs();return fs([$h.updateAction],{mutationFn:e=>Jh.updateAction(e),onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r,o;const i=t.getQueryData([Fh.assistants,a.endpoint,Dl]);if(!i)return null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s);const l=n[1];return t.setQueryData([Fh.assistants,a.endpoint,Dl],{...i,data:i.data.map((e=>e.id===a.assistant_id?l:e))}),t.setQueryData([Fh.actions],(e=>null==e?void 0:e.map((e=>e.action_id===a.action_id?n[2]:e)).concat(null!=a.action_id&&a.action_id?[]:[n[2]]))),null==(o=null==e?void 0:e.onSuccess)?void 0:o.call(e,n,a,s)}})},Mb=e=>{const t=xs();return fs([$h.deleteAction],{mutationFn:e=>{var n;const{endpoint:a}=e,s=t.getQueryData([Fh.endpoints]),r=(null==(n=null==s?void 0:s[a])?void 0:n.version)??Fu[a];return Jh.deleteAction({...e,version:r})},onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;let o="";return t.setQueryData([Fh.actions],(e=>null==e?void 0:e.filter((e=>(o=e.metadata.domain,e.action_id!==a.action_id))))),t.setQueryData([Fh.assistants,a.endpoint,Dl],(e=>e?{...e,data:e.data.map((e=>e.id===a.assistant_id?{...e,tools:(e.tools??[]).filter((e=>{var t;return!(null==(t=e.function)?void 0:t.name.includes(o??""))}))}:e))}:e)),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},Db=e=>fs({mutationFn:e=>Jh.resendVerificationEmail(e),...e||{}}),Fb=e=>{const{onMutate:t,onError:n,onSuccess:a}=e||{},s=xs(),r=j(N_.promptsName),o=j(N_.promptsPageSize),i=j(N_.promptsCategory);return fs({mutationFn:e=>Jh.updatePromptGroup(e),onMutate:e=>{const n=s.getQueryData([Fh.promptGroup,e.id]),a=n?structuredClone(n):void 0,l=s.getQueryData([Fh.promptGroups,r,i,o]),c=l?structuredClone(l):void 0;let d=e.payload;if(d.removeProjectIds&&(null==a?void 0:a.projectIds)&&(d=structuredClone(d),d.projectIds=a.projectIds.filter((e=>{var t;return!(null==(t=d.removeProjectIds)?void 0:t.includes(e))})),delete d.removeProjectIds),l){const t=Ff(l,{_id:e.id,...d},(t=>s.setQueryData([Fh.promptGroup,e.id],t)));s.setQueryData([Fh.promptGroups,r,i,o],t)}return t&&t(e),{group:a,previousListData:c}},onError:(e,t,a)=>{(null==a?void 0:a.group)&&s.setQueryData([Fh.promptGroups,t.id],a.group),(null==a?void 0:a.previousListData)&&s.setQueryData([Fh.promptGroups,r,i,o],a.previousListData),n&&n(e,t,a)},onSuccess:(e,t,n)=>{zf(s,{_id:t.id,...e}),a&&a(e,t,n)}})},Ub=e=>{const t=xs(),{onSuccess:n,...a}=e||{},s=j(N_.promptsName),r=j(N_.promptsPageSize),o=j(N_.promptsCategory);return fs({mutationFn:e=>Jh.createPrompt(e),...a,onSuccess:(e,a,i)=>{const{prompt:l,group:c}=e;t.setQueryData([Fh.prompts,a.prompt.groupId],(e=>[l,...e??[]])),c&&(t.setQueryData([Fh.promptGroups,s,o,r],(e=>e?Mf(e,c):e)),((e,t)=>{!function(e,t,n){e.setQueryData(t,(e=>e?[...e,n]:[n]))}(e,[Fh.allPromptGroups],t)})(t,c)),n&&n(e,a,i)}})},zb=e=>{const t=xs(),{onSuccess:n,onError:a,onMutate:s}={},r=j(N_.promptsName),o=j(N_.promptsPageSize),i=j(N_.promptsCategory);return fs({mutationFn:e=>Jh.makePromptProduction(e.id),onMutate:e=>{const n=JSON.parse(JSON.stringify(t.getQueryData([Fh.promptGroup,e.groupId]))),a=t.getQueryData([Fh.promptGroups,r,i,o]),l=JSON.parse(JSON.stringify(a));if(a){const n=Ff(a,{_id:e.groupId,productionId:e.id,productionPrompt:e.productionPrompt},(n=>t.setQueryData([Fh.promptGroup,e.groupId],n)));t.setQueryData([Fh.promptGroups,r,i,o],n)}return s&&s(e),{group:n,previousListData:l}},onError:(e,n,s)=>{(null==s?void 0:s.group)&&t.setQueryData([Fh.promptGroups,n.groupId],s.group),(null==s?void 0:s.previousListData)&&t.setQueryData([Fh.promptGroups,r,i,o],s.previousListData),a&&a(e,n,s)},onSuccess:(e,a,s)=>{zf(t,{_id:a.groupId,productionId:a.id,productionPrompt:a.productionPrompt}),n&&n(e,a,s)}})},Vb=(e,t)=>gs([Fh.roles,e],(()=>Jh.getRole(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t}),$b=e=>gs([Fh.mcpServers],(()=>Jh.getMCPServers()),{staleTime:3e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...e}),Bb=e=>gs([Fh.mcpTools],(()=>Jh.getMCPTools()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5,...e}),Hb=e=>{const t=xs();return fs((e=>Jh.createMCPServer(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;const o=t.getQueryData([Fh.mcpServers]);return o&&t.setQueryData([Fh.mcpServers],{...o,[n.serverName]:n}),t.invalidateQueries([Fh.mcpServers]),t.invalidateQueries([Fh.mcpTools]),t.invalidateQueries([Fh.mcpAuthValues]),t.invalidateQueries([Fh.mcpConnectionStatus]),t.invalidateQueries([Fh.effectivePermissions,"all",Ph.MCPSERVER]),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},Gb=e=>{const t=xs();return fs((({serverName:e,data:t})=>Jh.updateMCPServer(e,t)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;const o=t.getQueryData([Fh.mcpServers]);if(o){const{type:e,...s}=o[a.serverName];o[a.serverName]={...s,...n},t.setQueryData([Fh.mcpServers],{...o})}return t.setQueryData([Fh.mcpServer,a.serverName],n),t.invalidateQueries([Fh.mcpServers]),t.invalidateQueries([Fh.mcpTools]),t.invalidateQueries([Fh.mcpAuthValues]),t.invalidateQueries([Fh.mcpConnectionStatus]),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})},Kb=e=>{const t=xs();return fs((e=>Jh.deleteMCPServer(e)),{onMutate:t=>{var n;return null==(n=null==e?void 0:e.onMutate)?void 0:n.call(e,t)},onError:(t,n,a)=>{var s;return null==(s=null==e?void 0:e.onError)?void 0:s.call(e,t,n,a)},onSuccess:(n,a,s)=>{var r;const o=t.getQueryData([Fh.mcpServers]);if(o){const{[a]:e,...n}=o;t.setQueryData([Fh.mcpServers],n)}return t.removeQueries([Fh.mcpServer,a]),t.invalidateQueries([Fh.mcpServers]),t.invalidateQueries([Fh.mcpTools]),t.invalidateQueries([Fh.mcpAuthValues]),t.invalidateQueries([Fh.mcpConnectionStatus]),null==(r=null==e?void 0:e.onSuccess)?void 0:r.call(e,n,a,s)}})};function Wb({setIsSpeaking:e,audioRef:t,messageId:n,isLast:a,index:s=0}){const r=qN(),{showToast:o}=Ds(),i=j(N_.voice),l=j(N_.cacheTTS),c=j(N_.playbackRate),[d,u]=ja(!1),m=ba(null),p=j(N_.globalAudioFetchingFamily(s)),h=j(N_.globalAudioPlayingFamily(s)),g=e=>{const t=document.createElement("a");t.href=e,t.download="audio.mp3",t.click(),u(!1)},{mutate:x,isLoading:f}=(v={onMutate:e=>{(e.get("input")??"").length>=4096&&o({message:r("com_nav_long_audio_warning"),status:"warning"})},onSuccess:async(e,n)=>{try{const a=n.get("input")??"",s=new Blob([e],{type:"audio/mpeg"});if(l&&a){const e=await caches.open("tts-responses"),t=new Request(a),n=new Response(s);e.put(t,n)}const r=URL.createObjectURL(s);d&&g(r),(e=>{const n=new Audio(e);t.current=n})(r)}catch(a){o({message:`Error processing audio: ${a.message}`,status:"error"})}},onError:e=>{o({message:r("com_nav_audio_process_error",{0:e.message}),status:"error"})}},fs([$h.textToSpeech],{mutationFn:e=>Jh.textToSpeech(e),...v||{}}));var v;const _=(e,t)=>{const n=((e,t)=>{const n=new FormData;return n.append("input",e),n.append("voice",t),n})(e,i??"");u(t),x(n)},b=async(t,n)=>{const a=await caches.match(t);if(!a)return _(t,n);const s=await a.blob(),i=URL.createObjectURL(s);n?g(i):(t=>{const n=new Audio(t),a=()=>{null!=c&&1!==c&&c>0&&(n.playbackRate=c)};a();const s=()=>n.play().then((()=>e(!0)));s().catch((e=>{if(e.message&&e.message.includes("The play() request was interrupted by a call to pause()"))return console.log("Play request was interrupted by a call to pause()"),a(),s().catch(console.error);console.error(e),o({message:r("com_nav_audio_play_error",{0:e.message}),status:"error"})})),n.onended=()=>{console.log("Cached message audio ended"),URL.revokeObjectURL(t),e(!1)},m.current=n})(i)},y=ka((()=>{m.current&&(m.current.pause(),m.current.src&&URL.revokeObjectURL(m.current.src),m.current=null,e(!1))}),[e]);ya((()=>y),[y]);const w=Ca((()=>a&&p&&!h),[p,h,a]),{data:N=[]}=gs([Fh.voices],(()=>Jh.getVoices()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...k});var k;return{generateSpeechExternal:(e,t)=>{l?b(e,t):_(e,t)},cancelSpeech:()=>{const a=e=>{e&&(e.pause(),e.src&&URL.revokeObjectURL(e.src),t.current=null)};a(document.getElementById(`audio-${n}`)),a(m.current),e(!1)},isLoading:w||f,audioRef:t,voices:N}}function qb({setIsPlaying:e}){const t=ba(null);return ya((()=>{const n=()=>{e(!1),console.log("message audio ended"),t.current&&URL.revokeObjectURL(t.current.src)},a=()=>{e(!0),console.log("message audio started")},s=()=>{e(!1),console.log("message audio paused")},r=t.current;return t.current&&(t.current.muted=!0,t.current.addEventListener("ended",n),t.current.addEventListener("play",a),t.current.addEventListener("pause",s)),()=>{r&&(r.removeEventListener("ended",n),r.removeEventListener("play",a),r.removeEventListener("pause",s),URL.revokeObjectURL(r.src))}}),[e]),{audioRef:t}}const Qb=e=>{const{messageId:t,content:n,isLast:a=!1,index:s=0}=e??{},r=ba(!1),o=ba(void 0),[i,l]=ja(!1),{audioRef:c}=qb({setIsPlaying:l}),{pauseGlobalAudio:d}=k_(s),[u,m]=b(N_.voice),p=j(N_.globalAudioPlayingFamily(s)),h=i||a&&p,{cancelSpeech:g,generateSpeechExternal:x,isLoading:f,voices:v}=Wb({setIsSpeaking:l,audioRef:c,messageId:t,isLast:a,index:s});ya((()=>{const e=v[0];if(v.length){const t=v.find((e=>e===u));if(null!=t)return cx.log("useTextToSpeech.ts - Effect:",{voices:v,voice:t}),void m(t.toString());cx.log("useTextToSpeech.ts - Effect:",{voices:v,voice:e}),m(e.toString())}}),[m,u,v]);return{handleMouseDown:()=>{r.current=!0,o.current=window.setTimeout((()=>{if(r.current){const e=n??"",t="string"==typeof e?e:pp(e);x(t,!1)}}),1e3)},handleMouseUp:()=>{r.current=!1,null!=o.current&&window.clearTimeout(o.current)},toggleSpeech:()=>{if(!0===h)g(),d();else{const e=n??"",t="string"==typeof e?e:pp(e);x(t,!1)}},isSpeaking:h,isLoading:f,audioRef:c,voices:v}};const Yb=e=>{const{content:t,isLast:n=!1,index:a=0}=e??{},s=ba(!1),r=ba(void 0),[o,i]=ja(!1),{audioRef:l}=qb({setIsPlaying:i}),{pauseGlobalAudio:c}=k_(a),[d,u]=b(N_.voice),m=j(N_.globalAudioPlayingFamily(a)),p=o||n&&m,{generateSpeechLocal:h,cancelSpeechLocal:g,voices:x}=function({setIsSpeaking:e}){const t=j(N_.voice),[n,a]=ja([]),s=j(N_.cloudBrowserVoices),[r,o]=ja(!0),i=ka((()=>{const e=window.speechSynthesis;if(e)try{const t=e.getVoices();if(!Array.isArray(t))return void console.error("getVoices() did not return an array");const n=t.filter((e=>s||!0===e.localService)).map((e=>({value:e.name,label:e.name})));a(n)}catch(t){console.error("Error updating voices:",t),o(!1)}else o(!1)}),[s]);return ya((()=>{const e=window.speechSynthesis;if(e){try{e.getVoices().length?i():e.onvoiceschanged=i}catch(t){console.error("Error in useEffect:",t),o(!1)}return()=>{e.onvoiceschanged&&(e.onvoiceschanged=null)}}o(!1)}),[i]),{generateSpeechLocal:a=>{if(!r)return void console.warn("Speech synthesis is not supported");const s=window.speechSynthesis,o=n.find((e=>e.value===t));if(o)try{s.cancel();const t=new SpeechSynthesisUtterance(a);t.voice=s.getVoices().find((e=>e.name===o.value))||null,t.onend=()=>{e(!1)},t.onerror=t=>{console.error("Speech synthesis error:",t),e(!1)},e(!0),s.speak(t)}catch(i){console.error("Error generating speech:",i),e(!1)}else console.warn("Selected voice not found")},cancelSpeechLocal:()=>{if(r)try{window.speechSynthesis.cancel()}catch(t){console.error("Error cancelling speech:",t)}finally{e(!1)}},voices:n,isSpeechSynthesisSupported:r}}({setIsSpeaking:i});ya((()=>{const e=x[0];if(x.length&&"object"==typeof e){const t=x.find((e=>"object"==typeof e?e.value===d:e===d));if(null!=t){const e="object"==typeof t?t.value:t;return cx.log("useTextToSpeech.ts - Effect:",{voices:x,voice:e}),void u(e)}cx.log("useTextToSpeech.ts - Effect:",{voices:x,voice:e.value}),u(e.value)}}),[u,d,x]);return{handleMouseDown:()=>{s.current=!0,r.current=window.setTimeout((()=>{if(s.current){const e=t??"",n="string"==typeof e?e:pp(e);h(n)}}),1e3)},handleMouseUp:()=>{s.current=!1,null!=r.current&&window.clearTimeout(r.current)},toggleSpeech:()=>{if(!0===p)g(),c();else{const e=t??"",n="string"==typeof e?e:pp(e);h(n)}},isSpeaking:p,isLoading:!1,audioRef:l,voices:x}};var Xb,Jb,Zb,ey,ty,ny,ay,sy={},ry=function(){return ry=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},ry.apply(this,arguments)};function oy(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(n[a[s]]=e[a[s]])}return n}function iy(e,t,n,a){return new(n||(n=Promise))((function(t,s){function r(e){try{i(a.next(e))}catch(t){s(t)}}function o(e){try{i(a.throw(e))}catch(t){s(t)}}function i(e){var a;e.done?t(e.value):(a=e.value,a instanceof n?a:new n((function(e){e(a)}))).then(r,o)}i((a=a.apply(e,[])).next())}))}function ly(e,t){var n,a,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(r=0)),r;)try{if(n=1,a&&(s=2&i[0]?a.return:i[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,a=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((s=(s=r.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(6===i[0]&&r.label<s[1]){r.label=s[1],s=i;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(i);break}s[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(l){i=[6,l],a=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}function cy(e,t,n){if(n||2===arguments.length)for(var a,s=0,r=t.length;s<r;s++)!a&&s in t||(a||(a=Array.prototype.slice.call(t,0,s)),a[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.execute_code="execute_code",e.code_interpreter="code_interpreter",e.file_search="file_search",e.web_search="web_search",e.retrieval="retrieval",e.function="function",e.memory="memory",e.ui_resources="ui_resources"}(Xb||(Xb={})),function(e){e.code_interpreter="code_interpreter",e.execute_code="execute_code",e.file_search="file_search",e.image_edit="image_edit",e.context="context",e.ocr="ocr"}(Jb||(Jb={})),function(e){e.FILE_CITATION="file_citation",e.FILE_PATH="file_path"}(Zb||(Zb={})),function(e){e.IN_PROGRESS="in_progress",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(ey||(ey={})),function(e){e.TEXT="text",e.IMAGE_FILE="image_file"}(ty||(ty={})),function(e){e.QUEUED="queued",e.IN_PROGRESS="in_progress",e.REQUIRES_ACTION="requires_action",e.CANCELLING="cancelling",e.CANCELLED="cancelled",e.FAILED="failed",e.COMPLETED="completed",e.EXPIRED="expired"}(ny||(ny={})),function(e){e.Vision="vision",e.FineTune="fine-tune",e.FineTuneResults="fine-tune-results",e.Assistants="assistants",e.AssistantsOutput="assistants_output"}(ay||(ay={}));var dy,uy={order:"desc",limit:100};!function(e){e.ThreadCreated="thread.created",e.ThreadRunCreated="thread.run.created",e.ThreadRunQueued="thread.run.queued",e.ThreadRunInProgress="thread.run.in_progress",e.ThreadRunRequiresAction="thread.run.requires_action",e.ThreadRunCompleted="thread.run.completed",e.ThreadRunFailed="thread.run.failed",e.ThreadRunCancelling="thread.run.cancelling",e.ThreadRunCancelled="thread.run.cancelled",e.ThreadRunExpired="thread.run.expired",e.ThreadRunStepCreated="thread.run.step.created",e.ThreadRunStepInProgress="thread.run.step.in_progress",e.ThreadRunStepCompleted="thread.run.step.completed",e.ThreadRunStepFailed="thread.run.step.failed",e.ThreadRunStepCancelled="thread.run.step.cancelled",e.ThreadRunStepExpired="thread.run.step.expired",e.ThreadRunStepDelta="thread.run.step.delta",e.ThreadMessageCreated="thread.message.created",e.ThreadMessageInProgress="thread.message.in_progress",e.ThreadMessageCompleted="thread.message.completed",e.ThreadMessageIncomplete="thread.message.incomplete",e.ThreadMessageDelta="thread.message.delta",e.ErrorEvent="error"}(dy||(dy={}));var my,py,hy,gy,xy=aa(["not_matched","inaccurate","bad_style","missing_image","unjustified_refusal","not_helpful","other","accurate_reliable","creative_solution","clear_well_written","attention_to_detail"]),fy=aa(["thumbsUp","thumbsDown"]),vy=sa({rating:fy,tag:xy,text:ra().max(1024).optional()});ra().uuid(),function(e){e.OVERRIDE_AUTH="override_auth",e.USER_PROVIDED="user_provided",e.SYSTEM_DEFINED="system_defined"}(gy||(gy={}));var _y,by,yy,jy,wy,Ny,ky,Cy=oa(gy);!function(e){e.azureOpenAI="azureOpenAI",e.openAI="openAI",e.google="google",e.anthropic="anthropic",e.assistants="assistants",e.azureAssistants="azureAssistants",e.agents="agents",e.custom="custom",e.bedrock="bedrock"}(_y||(_y={})),function(e){e.OPENAI="openAI",e.ANTHROPIC="anthropic",e.AZURE="azureOpenAI",e.GOOGLE="google",e.VERTEXAI="vertexai",e.BEDROCK="bedrock",e.MISTRALAI="mistralai",e.MISTRAL="mistral",e.DEEPSEEK="deepseek",e.OPENROUTER="openrouter",e.XAI="xai"}(by||(by={})),_y.anthropic,_y.openAI,_y.custom,_y.azureOpenAI,_y.google,by.VERTEXAI,by.MISTRALAI,by.MISTRAL,by.DEEPSEEK,by.OPENROUTER,by.XAI,by.OPENAI,by.AZURE,_y.custom,by.MISTRALAI,by.MISTRAL,by.DEEPSEEK,by.OPENROUTER,by.XAI,_y.agents,_y.openAI,_y.bedrock,_y.azureOpenAI,_y.anthropic,_y.custom,_y.google,function(e){e.AI21="ai21",e.Amazon="amazon",e.Anthropic="anthropic",e.Cohere="cohere",e.Meta="meta",e.MistralAI="mistral",e.StabilityAI="stability",e.DeepSeek="deepseek"}(yy||(yy={})),function(e){e.low="low",e.auto="auto",e.high="high"}(jy||(jy={})),function(e){e.unset="",e.none="none",e.minimal="minimal",e.low="low",e.medium="medium",e.high="high"}(wy||(wy={})),function(e){e.none="",e.auto="auto",e.concise="concise",e.detailed="detailed"}(Ny||(Ny={})),function(e){e.none="",e.low="low",e.medium="medium",e.high="high"}(ky||(ky={})),(my={})[jy.low]=0,my[jy.auto]=1,my[jy.high]=2,jy.low,jy.auto,jy.high;var Sy=oa(jy),Ty=oa(wy),Ey=oa(Ny),Iy=oa(ky);(py={agent:{},id:"",name:"",description:"",instructions:"",model:"",model_parameters:{},tools:[],provider:{},projectIds:[],edges:[],artifacts:"",isCollaborative:!1,recursion_limit:void 0})[Xb.execute_code]=!1,py[Xb.file_search]=!1,py[Xb.web_search]=!1,py.category="general",py.support_contact={name:"",email:""},{type:Xb.function}[Xb.function]={name:"image_vision",description:"Get detailed text descriptions for all current image attachments.",parameters:{type:"object",properties:{},required:[]}};var Ry={model:{default:"gpt-4o-mini"},temperature:{min:0,max:2,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:jy.auto,min:0,max:2,step:1}},Ay=128e3,Py=64e3,Oy=32e3,Ly={model:{default:"claude-3-5-sonnet-latest"},temperature:{min:0,max:1,step:.01,default:1},promptCache:{default:!0},thinking:{default:!0},thinkingBudget:{min:1024,step:100,max:2e5,default:2e3},maxOutputTokens:{min:1,max:Ay,step:1,default:8192,reset:function(e){return/claude-(?:sonnet|haiku)[-.]?[4-9]/.test(e)||/claude-opus[-.]?(?:[5-9]|4[-.]?([5-9]|\d{2,}))/.test(e)?Py:/claude-opus[-.]?[4-9]/.test(e)?Oy:8192},set:function(e,t){return/claude-(?:sonnet|haiku)[-.]?[4-9]/.test(t)&&e>Py?Py:/claude-opus[-.]?(?:[5-9]|4[-.]?([5-9]|\d{2,}))/.test(t)?e>Py?Py:e:/claude-opus[-.]?[4-9]/.test(t)&&e>Oy?Oy:e>Ay?Ay:e}},topP:{min:0,max:1,step:.01,default:.7},topK:{min:1,max:40,step:1,default:5},resendFiles:{default:!0},maxContextTokens:{default:void 0},legacy:{maxOutputTokens:{min:1,max:4096,step:1,default:4096}},web_search:{default:!1}},My={model:{default:"gpt-3.5-turbo-test"},temperature:{min:0,max:1,step:.01,default:1},top_p:{min:0,max:1,step:.01,default:1},presence_penalty:{min:-2,max:2,step:.01,default:0},frequency_penalty:{min:-2,max:2,step:.01,default:0},resendFiles:{default:!0},maxContextTokens:{default:void 0},max_tokens:{default:void 0},imageDetail:{default:jy.auto}},Dy=((hy={})[_y.openAI]=Ry,hy[_y.google]={model:{default:"gemini-1.5-flash-latest"},maxOutputTokens:{min:1,max:64e3,step:1,default:8192},temperature:{min:0,max:2,step:.01,default:1},topP:{min:0,max:1,step:.01,default:.95},topK:{min:1,max:40,step:1,default:40},thinking:{default:!0},thinkingBudget:{min:-1,max:32e3,step:1,default:-1}},hy[_y.anthropic]=Ly,hy[_y.agents]=My,hy[_y.bedrock]=My,hy)[_y.google],Fy=oa(_y),Uy=ia([Fy,ra()]),zy=sa({authField:ra(),label:ra(),description:ra()}),Vy=sa({name:ra(),pluginKey:ra(),description:ra().optional(),icon:ra().optional(),authConfig:ca(zy).optional(),authenticated:la().optional(),chatMenu:la().optional(),isButton:la().optional(),toolkit:la().optional()}),$y=sa({input:sa({content:ra()}),output:sa({content:ra()})});sa({messageId:ra(),endpoint:ra().optional(),clientId:ra().nullable().optional(),conversationId:ra().nullable(),parentMessageId:ra().nullable(),responseMessageId:ra().nullable().optional(),overrideParentMessageId:ra().nullable().optional(),bg:ra().nullable().optional(),model:ra().nullable().optional(),title:ra().nullable().or(ma("New Chat")).default("New Chat"),sender:ra().optional(),text:ra(),generation:ra().nullable().optional(),isCreatedByUser:la(),error:la().optional(),clientTimestamp:ra().optional(),createdAt:ra().optional().default((function(){return(new Date).toISOString()})),updatedAt:ra().optional().default((function(){return(new Date).toISOString()})),current:la().optional(),unfinished:la().optional(),searchResult:la().optional(),finish_reason:ra().optional(),thread_id:ra().optional(),iconURL:ra().nullable().optional(),feedback:vy.optional(),metadata:da(ua()).optional()});var By=ia([pa(),ra()]).transform((function(e){return"string"==typeof e?""===e.trim()?void 0:parseFloat(e):e})),Hy=ha((function(){return ia([ga(),la(),pa(),ra(),ca(ha((function(){return Hy}))),da(ha((function(){return Hy})))])})),Gy=sa({conversationId:ra().nullable(),endpoint:Fy.nullable(),endpointType:Fy.nullable().optional(),isArchived:la().optional(),title:ra().nullable().or(ma("New Chat")).default("New Chat"),user:ra().optional(),messages:ca(ra()).optional(),tools:ia([ca(Vy),ca(ra())]).optional(),modelLabel:ra().nullable().optional(),userLabel:ra().optional(),model:ra().nullable().optional(),promptPrefix:ra().nullable().optional(),temperature:pa().nullable().optional(),topP:pa().optional(),topK:pa().optional(),top_p:pa().optional(),frequency_penalty:pa().optional(),presence_penalty:pa().optional(),parentMessageId:ra().optional(),maxOutputTokens:By.nullable().optional(),maxContextTokens:By.optional(),max_tokens:By.optional(),promptCache:la().optional(),system:ra().optional(),thinking:la().optional(),thinkingBudget:By.optional(),stream:la().optional(),artifacts:ra().optional(),context:ra().nullable().optional(),examples:ca($y).optional(),tags:ca(ra()).optional(),createdAt:ra(),updatedAt:ra(),resendFiles:la().optional(),file_ids:ca(ra()).optional(),imageDetail:Sy.optional(),reasoning_effort:Ty.optional().nullable(),reasoning_summary:Ey.optional().nullable(),verbosity:Iy.optional().nullable(),useResponsesApi:la().optional(),web_search:la().optional(),disableStreaming:la().optional(),assistant_id:ra().optional(),agent_id:ra().optional(),region:ra().optional(),maxTokens:By.optional(),additionalModelRequestFields:Hy.optional(),instructions:ra().optional(),additional_instructions:ra().optional(),append_current_datetime:la().optional(),presetOverride:da(ua()).optional(),stop:ca(ra()).optional(),greeting:ra().optional(),spec:ra().nullable().optional(),iconURL:ra().nullable().optional(),expiredAt:ra().nullable().optional(),fileTokenLimit:By.optional(),resendImages:la().optional(),chatGptLabel:ra().nullable().optional()}),Ky=Gy.omit({conversationId:!0,createdAt:!0,updatedAt:!0,title:!0}).merge(sa({conversationId:ra().nullable().optional(),presetId:ra().nullable().optional(),title:ra().nullable().optional(),defaultPreset:la().optional(),order:pa().optional(),endpoint:Uy.nullable()}));Gy.merge(sa({endpoint:Uy.nullable(),createdAt:ra().optional(),updatedAt:ra().optional()})),Gy.pick({spec:!0,maxContextTokens:!0,resendFiles:!0,imageDetail:!0,promptPrefix:!0,model:!0,temperature:!0,presence_penalty:!0,frequency_penalty:!0,stop:!0,top_p:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,topP:!0,topK:!0,maxOutputTokens:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,region:!0,maxTokens:!0,agent_id:!0,assistant_id:!0,append_current_datetime:!0,instructions:!0,fileTokenLimit:!0}).merge(sa({endpoint:Uy.nullable()})),sa({conversationId:ra(),shareId:ra(),messages:ca(ra()),isPublic:la(),title:ra(),createdAt:ra(),updatedAt:ra()}),sa({_id:ra(),user:ra(),tag:ra(),description:ra().optional(),createdAt:ra(),updatedAt:ra(),count:pa(),position:pa()});var Wy=Gy.pick({model:!0,modelLabel:!0,promptPrefix:!0,examples:!0,temperature:!0,maxOutputTokens:!0,artifacts:!0,topP:!0,topK:!0,thinking:!0,thinkingBudget:!0,web_search:!0,fileTokenLimit:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0});function qy(e,t){var n=ry({},e);return Object.keys(n).forEach((function(e){var a=n[e];null==a&&delete n[e],t&&"string"==typeof a&&""===a&&delete n[e]})),n}Wy.transform((function(e){return qy(e)})).catch((function(){return{}})),sa({maxOutputTokens:By.optional(),temperature:By.optional(),topP:By.optional(),topK:By.optional(),presencePenalty:By.optional(),frequencyPenalty:By.optional(),stopSequences:ca(ra()).optional(),thinkingConfig:sa({includeThoughts:la().optional(),thinkingBudget:By.optional()}).optional(),web_search:la().optional()}).strip().optional(),Gy.pick({model:!0,assistant_id:!0,instructions:!0,artifacts:!0,promptPrefix:!0,iconURL:!0,greeting:!0,spec:!0,append_current_datetime:!0}).transform((function(e){var t,n,a,s,r,o,i,l;return ry(ry({},e),{model:null!==(t=e.model)&&void 0!==t?t:Ry.model.default,assistant_id:null!==(n=e.assistant_id)&&void 0!==n?n:void 0,instructions:null!==(a=e.instructions)&&void 0!==a?a:void 0,promptPrefix:null!==(s=e.promptPrefix)&&void 0!==s?s:null,iconURL:null!==(r=e.iconURL)&&void 0!==r?r:void 0,greeting:null!==(o=e.greeting)&&void 0!==o?o:void 0,spec:null!==(i=e.spec)&&void 0!==i?i:void 0,append_current_datetime:null!==(l=e.append_current_datetime)&&void 0!==l&&l})})).catch((function(){return{model:Ry.model.default,assistant_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,spec:void 0,append_current_datetime:!1}})),Gy.pick({model:!0,assistant_id:!0,instructions:!0,promptPrefix:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0}).transform((function(e){return qy(e)})).catch((function(){return{}})),Gy.pick({model:!0,modelLabel:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,imageDetail:!0,agent_id:!0,instructions:!0,promptPrefix:!0,iconURL:!0,greeting:!0,maxContextTokens:!0}).transform((function(e){var t,n,a,s,r,o,i,l,c,d,u,m,p;return ry(ry({},e),{model:null!==(t=e.model)&&void 0!==t?t:My.model.default,modelLabel:null!==(n=e.modelLabel)&&void 0!==n?n:null,temperature:null!==(a=e.temperature)&&void 0!==a?a:1,top_p:null!==(s=e.top_p)&&void 0!==s?s:1,presence_penalty:null!==(r=e.presence_penalty)&&void 0!==r?r:0,frequency_penalty:null!==(o=e.frequency_penalty)&&void 0!==o?o:0,resendFiles:"boolean"==typeof e.resendFiles?e.resendFiles:My.resendFiles.default,imageDetail:null!==(i=e.imageDetail)&&void 0!==i?i:jy.auto,agent_id:null!==(l=e.agent_id)&&void 0!==l?l:void 0,instructions:null!==(c=e.instructions)&&void 0!==c?c:void 0,promptPrefix:null!==(d=e.promptPrefix)&&void 0!==d?d:null,iconURL:null!==(u=e.iconURL)&&void 0!==u?u:void 0,greeting:null!==(m=e.greeting)&&void 0!==m?m:void 0,maxContextTokens:null!==(p=e.maxContextTokens)&&void 0!==p?p:void 0})})).catch((function(){return{model:My.model.default,modelLabel:null,temperature:1,top_p:1,presence_penalty:0,frequency_penalty:0,resendFiles:My.resendFiles.default,imageDetail:jy.auto,agent_id:void 0,instructions:void 0,promptPrefix:null,iconURL:void 0,greeting:void 0,maxContextTokens:void 0}})),Gy.pick({model:!0,modelLabel:!0,chatGptLabel:!0,promptPrefix:!0,temperature:!0,top_p:!0,presence_penalty:!0,frequency_penalty:!0,resendFiles:!0,artifacts:!0,imageDetail:!0,stop:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,max_tokens:!0,reasoning_effort:!0,reasoning_summary:!0,verbosity:!0,useResponsesApi:!0,web_search:!0,disableStreaming:!0,fileTokenLimit:!0}).transform((function(e){return qy(e,!0)})).catch((function(){return{}})),Wy.transform((function(e){var t=ry({},e);return t.temperature===Dy.temperature.default&&delete t.temperature,t.maxOutputTokens===Dy.maxOutputTokens.default&&delete t.maxOutputTokens,t.topP===Dy.topP.default&&delete t.topP,t.topK===Dy.topK.default&&delete t.topK,qy(t)})).catch((function(){return{}})),Gy.pick({model:!0,modelLabel:!0,promptPrefix:!0,temperature:!0,maxOutputTokens:!0,topP:!0,topK:!0,resendFiles:!0,promptCache:!0,thinking:!0,thinkingBudget:!0,artifacts:!0,iconURL:!0,greeting:!0,spec:!0,maxContextTokens:!0,web_search:!0,fileTokenLimit:!0,stop:!0,stream:!0}).transform((function(e){return qy(e)})).catch((function(){return{}})),sa({bannerId:ra(),message:ra(),displayFrom:ra(),displayTo:ra(),createdAt:ra(),updatedAt:ra(),isPublic:la(),persistable:la().default(!1)}),Gy.pick({spec:!0,iconURL:!0,greeting:!0,agent_id:!0,instructions:!0,additional_instructions:!0}).transform((function(e){return qy(e)})).catch((function(){return{}}));var Qy,Yy,Xy=sa({name:ra(),label:ra(),preset:Ky,order:pa().optional(),default:la().optional(),description:ra().optional(),group:ra().optional(),showIconInMenu:la().optional(),showIconInHeader:la().optional(),iconURL:ia([ra(),Fy]).optional(),authType:Cy.optional(),webSearch:la().optional(),fileSearch:la().optional(),executeCode:la().optional(),mcpServers:ca(ra()).optional()}),Jy=sa({enforce:la().default(!1),prioritize:la().default(!0),list:ca(Xy).min(1),addedEndpoints:ca(ia([ra(),Fy])).optional()}),Zy=/^\${(.+)}$/;function ej(e){if(!e)return e;var t=e.trim(),n=t.match(Zy);if(n){var a=n[1];return sy[a]||t}for(var s,r=/\${([^}]+)}/g,o=t,i=[];null!==(s=r.exec(t));)i.push({fullMatch:s[0],varName:s[1],index:s.index});for(var l=i.length-1;l>=0;l--){var c=i[l],d=c.fullMatch,u=(a=c.varName,c.index),m=sy[a]||d;o=o.substring(0,u)+m+o.substring(u+d.length)}return o}(Qy={})[_y.openAI]=!0,Qy[_y.google]=!0,Qy[_y.assistants]=!0,Qy[_y.azureAssistants]=!0,Qy[_y.agents]=!0,Qy[_y.azureOpenAI]=!0,Qy[_y.anthropic]=!0,Qy[_y.custom]=!0,Qy[_y.bedrock]=!0;var tj=["application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];cy(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/vtt","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/x-sh","application/typescript","application/sql","application/yaml","application/vnd.coffeescript","application/xml","application/zip","image/svg","image/svg+xml","video/mp4","video/avi","video/mov","video/wmv","video/flv","video/webm","video/mkv","video/m4v","video/3gp","video/ogv","audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/aac","audio/flac","audio/wma","audio/opus","audio/mpeg"],tj,!0),cy(["text/x-c","text/x-c++","application/csv","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","image/jpeg","text/javascript","image/gif","image/png","image/heic","image/heif","application/x-tar","application/typescript","application/xml","application/zip"],tj,!0);var nj=[/^(text\/(x-c|x-csharp|tab-separated-values|x-c\+\+|x-h|x-java|html|markdown|x-php|x-python|x-script\.python|x-ruby|x-tex|plain|css|vtt|javascript|csv|xml))$/,/^application\/(vnd\.ms-excel|msexcel|x-msexcel|x-ms-excel|x-excel|x-dos_ms_excel|xls|x-xls|vnd\.openxmlformats-officedocument\.spreadsheetml\.sheet)$/,/^(application\/(epub\+zip|csv|json|pdf|x-tar|x-sh|typescript|sql|yaml|vnd\.coffeescript|vnd\.openxmlformats-officedocument\.(wordprocessingml\.document|presentationml\.presentation|spreadsheetml\.sheet)|xml|zip))$/,/^image\/(jpeg|gif|png|webp|heic|heif)$/,/^video\/(mp4|avi|mov|wmv|flv|webm|mkv|m4v|3gp|ogv)$/,/^audio\/(mp3|mpeg|mpeg3|wav|wave|x-wav|ogg|vorbis|mp4|m4a|x-m4a|flac|x-flac|webm|aac|wma|opus)$/,/^image\/(svg|svg\+xml)$/],aj=536870912,sj={fileLimit:10,fileSizeLimit:aj,totalSizeLimit:aj,supportedMimeTypes:nj,disabled:!1};(Yy={})[_y.assistants]=sj,Yy[_y.azureAssistants]=sj,Yy[_y.agents]=sj,Yy[_y.anthropic]={fileLimit:10,fileSizeLimit:aj,totalSizeLimit:aj,supportedMimeTypes:nj,disabled:!1},Yy.default={fileLimit:10,fileSizeLimit:aj,totalSizeLimit:aj,supportedMimeTypes:nj,disabled:!1};var rj=ca(xa()).optional().refine((function(e){return!e||e.every((function(e){return e instanceof RegExp||"string"==typeof e}))}),{message:"Each mimeType must be a string or a RegExp object."}),oj=sa({disabled:la().optional(),fileLimit:pa().min(0).optional(),fileSizeLimit:pa().min(0).optional(),totalSizeLimit:pa().min(0).optional(),supportedMimeTypes:rj.optional()}),ij=sa({endpoints:da(oj).optional(),serverFileSizeLimit:pa().min(0).optional(),avatarSizeLimit:pa().min(0).optional(),fileTokenLimit:pa().min(0).optional(),imageGeneration:sa({percentage:pa().min(0).max(100).optional(),px:pa().min(0).optional()}).optional(),clientImageResize:sa({enabled:la().optional(),maxWidth:pa().min(0).optional(),maxHeight:pa().min(0).optional(),quality:pa().min(0).max(1).optional()}).optional(),ocr:sa({supportedMimeTypes:rj.optional()}).optional(),text:sa({supportedMimeTypes:rj.optional()}).optional()}),lj="",cj=function(){try{if("undefined"!=typeof globalThis&&globalThis.__VITE_API_BASE_URL__)return globalThis.__VITE_API_BASE_URL__}catch(Il){}return""}();if(cj)lj=cj;else if(void 0===n||!0===n.browser){var dj=document.querySelector("base");lj=(null==dj?void 0:dj.getAttribute("href"))||"/"}lj&&lj.endsWith("/")&&(lj=lj.slice(0,-1));var uj,mj,pj,hj,gj,xj=function(){return lj},fj="".concat(lj,"/api/messages"),vj=function(e){var t,n,a=e.conversationId,s=e.messageId,r=oy(e,["conversationId","messageId"]);return a&&s?"".concat(fj,"/").concat(a,"/").concat(s):a?"".concat(fj,"/").concat(a):"".concat(fj).concat((t=r,(n=Object.entries(t).filter((function(e){var t=e[1];return Array.isArray(t)?t.length>0:null!=t&&""!==t})).map((function(e){var t=e[0],n=e[1];return Array.isArray(n)?n.map((function(e){return"".concat(t,"=").concat(encodeURIComponent(e))})).join("&"):"".concat(t,"=").concat(encodeURIComponent(String(n)))})).join("&"))?"?".concat(n):""))},_j="".concat(lj,"/api/share"),bj="".concat(lj,"/api/keys"),yj="".concat(lj,"/api/convos");!function(e){e.local="local",e.firebase="firebase",e.azure="azure",e.azure_blob="azure_blob",e.openai="openai",e.s3="s3",e.vectordb="vectordb",e.execute_code="execute_code",e.mistral_ocr="mistral_ocr",e.azure_mistral_ocr="azure_mistral_ocr",e.vertexai_mistral_ocr="vertexai_mistral_ocr",e.text="text"}(uj||(uj={})),function(e){e.avatar="avatar",e.unknown="unknown",e.agents="agents",e.assistants="assistants",e.execute_code="execute_code",e.image_generation="image_generation",e.assistants_output="assistants_output",e.message_attachment="message_attachment",e.filename="filename",e.updatedAt="updatedAt",e.source="source",e.filterSource="filterSource",e.context="context",e.bytes="bytes"}(mj||(mj={})),function(e){e.ServiceHttp="service_http",e.OAuth="oauth",e.None="none"}(pj||(pj={})),function(e){e.Bearer="bearer",e.Basic="basic",e.Custom="custom"}(hj||(hj={})),function(e){e.DefaultPost="default_post",e.BasicAuthHeader="basic_auth_header"}(gj||(gj={}));var jj,wj,Nj,kj,Cj,Sj,Tj,Ej,Ij,Rj=sa({title:ra().regex(/^[a-zA-Z0-9 ]+$/,"Title can only contain letters, numbers, and spaces").optional(),description:ra().optional(),startup:la().optional(),iconPath:ra().optional(),timeout:pa().optional(),initTimeout:pa().optional(),chatMenu:la().optional(),serverInstructions:ia([la(),ra()]).optional(),requiresOAuth:la().optional(),oauth:sa({authorization_url:ra().url().optional(),token_url:ra().url().optional(),client_id:ra().optional(),client_secret:ra().optional(),scope:ra().optional(),redirect_uri:ra().url().optional(),token_exchange_method:oa(gj).optional(),grant_types_supported:ca(ra()).optional(),token_endpoint_auth_methods_supported:ca(ra()).optional(),response_types_supported:ca(ra()).optional(),code_challenge_methods_supported:ca(ra()).optional(),skip_code_challenge_check:la().optional(),revocation_endpoint:ra().url().optional(),revocation_endpoint_auth_methods_supported:ca(ra()).optional()}).optional(),oauth_headers:da(ra(),ra()).optional(),apiKey:sa({key:ra().optional(),source:aa(["admin","user"]),authorization_type:aa(["basic","bearer","custom"]),custom_header:ra().optional()}).optional(),customUserVars:da(ra(),sa({title:ra(),description:ra()})).optional()}),Aj=Rj.extend({type:ma("stdio").optional(),command:ra(),args:ca(ra()),env:da(ra(),ra()).optional().transform((function(e){if(!e)return e;for(var t={},n=0,a=Object.entries(e);n<a.length;n++){var s=a[n],r=s[0],o=s[1];t[r]=ej(o)}return t})),stderr:xa().optional()}),Pj=Rj.extend({type:ma("websocket").optional(),url:ra().transform((function(e){return ej(e)})).pipe(ra().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"===t||"wss:"===t}),{message:"WebSocket URL must start with ws:// or wss://"})}),Oj=Rj.extend({type:ma("sse").optional(),headers:da(ra(),ra()).optional(),url:ra().transform((function(e){return ej(e)})).pipe(ra().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"SSE URL must not start with ws:// or wss://"})}),Lj=Rj.extend({type:ia([ma("streamable-http"),ma("http")]),headers:da(ra(),ra()).optional(),url:ra().transform((function(e){return ej(e)})).pipe(ra().url()).refine((function(e){var t=new URL(e).protocol;return"ws:"!==t&&"wss:"!==t}),{message:"Streamable HTTP URL must not start with ws:// or wss://"})}),Mj=ia([Aj,Pj,Oj,Lj]),Dj=da(ra(),Mj),Fj=function(e){return e.omit({startup:!0,timeout:!0,initTimeout:!0,chatMenu:!0,serverInstructions:!0,requiresOAuth:!0,customUserVars:!0,oauth_headers:!0})};ia([Fj(Aj),Fj(Pj),Fj(Oj),Fj(Lj)]),function(e){e.default="default",e.advanced="advanced"}(Ij||(Ij={}));var Uj,zj,Vj=oa(uj),$j=sa({default:Vj.optional(),avatar:Vj.optional(),image:Vj.optional(),document:Vj.optional()}).optional(),Bj=sa({deploymentName:ra().optional(),version:ra().optional(),assistants:la().optional()}).or(la()),Hj=sa({apiKey:ra(),serverless:la().optional(),instanceName:ra().optional(),deploymentName:ra().optional(),assistants:la().optional(),addParams:da(xa()).optional(),dropParams:ca(ra()).optional(),forcePrompt:la().optional(),version:ra().optional(),baseURL:ra().optional(),additionalHeaders:da(xa()).optional()}),Gj=sa({group:ra(),models:da(ra(),Bj)}).required().and(Hj),Kj=ca(Gj).min(1);!function(e){e.code_interpreter="code_interpreter",e.image_vision="image_vision",e.retrieval="retrieval",e.actions="actions",e.tools="tools"}(Uj||(Uj={})),function(e){e.hide_sequential_outputs="hide_sequential_outputs",e.end_after_tools="end_after_tools",e.execute_code="execute_code",e.file_search="file_search",e.web_search="web_search",e.artifacts="artifacts",e.actions="actions",e.context="context",e.tools="tools",e.chain="chain",e.ocr="ocr"}(zj||(zj={})),(jj={})[_y.assistants]=2,jj[_y.azureAssistants]=1;var Wj=sa({streamRate:pa().optional(),baseURL:ra().optional(),titlePrompt:ra().optional(),titleModel:ra().optional(),titleConvo:la().optional(),titleMethod:ia([ma("completion"),ma("functions"),ma("structured")]).optional(),titleEndpoint:ra().optional(),titlePromptTemplate:ra().optional()});Wj.merge(sa({availableRegions:ca(ra()).optional()}));var qj,Qj=ia([ra(),sa({name:ra(),description:ra().optional()})]),Yj=Wj.merge(sa({disableBuilder:la().optional(),pollIntervalMs:pa().optional(),timeoutMs:pa().optional(),version:ia([ra(),pa()]).default(2),supportedIds:ca(ra()).min(1).optional(),excludedIds:ca(ra()).min(1).optional(),privateAssistants:la().optional(),retrievalModels:ca(ra()).min(1).optional().default(["gpt-4o","o1-preview-2024-09-12","o1-preview","o1-mini-2024-09-12","o1-mini","o3-mini","chatgpt-4o-latest","gpt-4o-2024-05-13","gpt-4o-2024-08-06","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-turbo-preview","gpt-3.5-turbo-0125","gpt-4-0125-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-0125","gpt-4-1106"]),capabilities:ca(oa(Uj)).optional().default([Uj.code_interpreter,Uj.image_vision,Uj.retrieval,Uj.actions,Uj.tools]),apiKey:ra().optional(),models:sa({default:ca(Qj).min(1),fetch:la().optional(),userIdQuery:la().optional()}).optional(),headers:da(xa()).optional()})),Xj=[zj.execute_code,zj.file_search,zj.web_search,zj.artifacts,zj.actions,zj.context,zj.tools,zj.chain,zj.ocr],Jj=Wj.merge(sa({recursionLimit:pa().optional(),disableBuilder:la().optional().default(!1),maxRecursionLimit:pa().optional(),maxCitations:pa().min(1).max(50).optional().default(30),maxCitationsPerFile:pa().min(1).max(10).optional().default(7),minRelevanceScore:pa().min(0).max(1).optional().default(.45),allowedProviders:ca(ia([ra(),Fy])).optional(),capabilities:ca(oa(zj)).optional().default(Xj)})).default({disableBuilder:!1,capabilities:Xj,maxCitations:30,maxCitationsPerFile:7,minRelevanceScore:.45}),Zj=Wj.merge(sa({name:ra().refine((function(e){return!Fy.safeParse(e).success}),{message:"Value cannot be one of the default endpoint (EModelEndpoint) values: ".concat(Object.values(_y).join(", "))}),apiKey:ra(),baseURL:ra(),models:sa({default:ca(Qj).min(1),fetch:la().optional(),userIdQuery:la().optional()}),summarize:la().optional(),summaryModel:ra().optional(),iconURL:ra().optional(),forcePrompt:la().optional(),modelDisplayLabel:ra().optional(),headers:da(xa()).optional(),addParams:da(xa()).optional(),dropParams:ca(ra()).optional(),customParams:sa({defaultParamsEndpoint:ra().default("custom"),paramDefinitions:ca(da(xa())).optional()}).strict().optional(),customOrder:pa().optional(),directEndpoint:la().optional(),titleMessageRole:ra().optional()})),ew=sa({groups:Kj,plugins:la().optional(),assistants:la().optional()}).and(Zj.pick({streamRate:!0,titleConvo:!0,titleMethod:!0,titleModel:!0,titlePrompt:!0,titlePromptTemplate:!0,summarize:!0,summaryModel:!0,customOrder:!0}).partial()),tw=sa({url:ra().optional(),apiKey:ra(),model:ra(),voices:ca(ra())}),nw=sa({instanceName:ra(),apiKey:ra(),deploymentName:ra(),apiVersion:ra(),model:ra(),voices:ca(ra())}),aw=sa({url:ra().optional(),websocketUrl:ra().optional(),apiKey:ra(),model:ra(),voices:ca(ra()),voice_settings:sa({similarity_boost:pa().optional(),stability:pa().optional(),style:pa().optional(),use_speaker_boost:la().optional()}).optional(),pronunciation_dictionary_locators:ca(ra()).optional()}),sw=sa({url:ra(),apiKey:ra().optional(),voices:ca(ra()),backend:ra()}),rw=sa({openai:tw.optional(),azureOpenAI:nw.optional(),elevenlabs:aw.optional(),localai:sw.optional()}),ow=sa({url:ra().optional(),apiKey:ra(),model:ra()}),iw=sa({instanceName:ra(),apiKey:ra(),deploymentName:ra(),apiVersion:ra()}),lw=sa({openai:ow.optional(),azureOpenAI:iw.optional()}),cw=sa({conversationMode:la().optional(),advancedMode:la().optional(),speechToText:la().optional().or(sa({engineSTT:ra().optional(),languageSTT:ra().optional(),autoTranscribeAudio:la().optional(),decibelValue:pa().optional(),autoSendText:pa().optional()})).optional(),textToSpeech:la().optional().or(sa({engineTTS:ra().optional(),voice:ra().optional(),languageTTS:ra().optional(),automaticPlayback:la().optional(),playbackRate:pa().optional(),cacheTTS:la().optional()})).optional()}).optional();!function(e){e.FILE_UPLOAD="FILE_UPLOAD",e.IMPORT="IMPORT",e.TTS="TTS",e.STT="STT"}(qj||(qj={}));var dw,uw=sa({fileUploads:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional(),conversationsImport:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional(),tts:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional(),stt:sa({ipMax:pa().optional(),ipWindowInMinutes:pa().optional(),userMax:pa().optional(),userWindowInMinutes:pa().optional()}).optional()});!function(e){e.PNG="png",e.WEBP="webp",e.JPEG="jpeg"}(dw||(dw={}));var mw,pw,hw,gw,xw,fw,vw=sa({externalUrl:ra().optional(),openNewTab:la().optional(),modalAcceptance:la().optional(),modalTitle:ra().optional(),modalContent:ra().or(ca(ra())).optional()}),_w=ia([ra(),da(ra())]),bw=sa({placeholder:ra().optional(),use:la().optional(),create:la().optional(),share:la().optional(),trustCheckbox:sa({label:_w.optional(),subLabel:_w.optional()}).optional()}).optional(),yw=sa({privacyPolicy:sa({externalUrl:ra().optional(),openNewTab:la().optional()}).optional(),termsOfService:vw.optional(),customWelcome:ra().optional(),mcpServers:bw.optional(),endpointsMenu:la().optional(),modelSelect:la().optional(),parameters:la().optional(),sidePanel:la().optional(),multiConvo:la().optional(),bookmarks:la().optional(),memories:la().optional(),presets:la().optional(),prompts:la().optional(),agents:la().optional(),temporaryChat:la().optional(),temporaryChatRetention:pa().min(1).max(8760).optional(),runCode:la().optional(),webSearch:la().optional(),peoplePicker:sa({users:la().optional(),groups:la().optional(),roles:la().optional()}).optional(),marketplace:sa({use:la().optional()}).optional(),fileSearch:la().optional(),fileCitations:la().optional()}).default({endpointsMenu:!0,modelSelect:!0,parameters:!0,sidePanel:!0,presets:!0,multiConvo:!0,bookmarks:!0,memories:!0,prompts:!0,agents:!0,temporaryChat:!0,runCode:!0,webSearch:!0,peoplePicker:{users:!0,groups:!0,roles:!0},marketplace:{use:!1},mcpServers:{use:!0,create:!0,share:!1},fileSearch:!0,fileCitations:!0}),jw=sa({language:ra().default("auto"),size:aa(["normal","compact","flexible","invisible"]).default("normal")}).default({language:"auto",size:"normal"}),ww=sa({siteKey:ra(),options:jw.optional()});!function(e){e.MISTRAL_OCR="mistral_ocr",e.CUSTOM_OCR="custom_ocr",e.AZURE_MISTRAL_OCR="azure_mistral_ocr",e.VERTEXAI_MISTRAL_OCR="vertexai_mistral_ocr"}(mw||(mw={})),function(e){e.PROVIDERS="providers",e.SCRAPERS="scrapers",e.RERANKERS="rerankers"}(pw||(pw={})),function(e){e.SERPER="serper",e.SEARXNG="searxng"}(hw||(hw={})),function(e){e.FIRECRAWL="firecrawl",e.SERPER="serper"}(gw||(gw={})),function(e){e.JINA="jina",e.COHERE="cohere"}(xw||(xw={})),function(e){e[e.OFF=0]="OFF",e[e.MODERATE=1]="MODERATE",e[e.STRICT=2]="STRICT"}(fw||(fw={}));var Nw,kw,Cw=sa({serperApiKey:ra().optional().default("${SERPER_API_KEY}"),searxngInstanceUrl:ra().optional().default("${SEARXNG_INSTANCE_URL}"),searxngApiKey:ra().optional().default("${SEARXNG_API_KEY}"),firecrawlApiKey:ra().optional().default("${FIRECRAWL_API_KEY}"),firecrawlApiUrl:ra().optional().default("${FIRECRAWL_API_URL}"),firecrawlVersion:ra().optional().default("${FIRECRAWL_VERSION}"),jinaApiKey:ra().optional().default("${JINA_API_KEY}"),jinaApiUrl:ra().optional().default("${JINA_API_URL}"),cohereApiKey:ra().optional().default("${COHERE_API_KEY}"),searchProvider:oa(hw).optional(),scraperProvider:oa(gw).optional(),rerankerType:oa(xw).optional(),scraperTimeout:pa().optional(),safeSearch:oa(fw).default(fw.MODERATE),firecrawlOptions:sa({formats:ca(ra()).optional(),includeTags:ca(ra()).optional(),excludeTags:ca(ra()).optional(),headers:da(ra()).optional(),waitFor:pa().optional(),timeout:pa().optional(),maxAge:pa().optional(),mobile:la().optional(),skipTlsVerification:la().optional(),blockAds:la().optional(),removeBase64Images:la().optional(),parsePDF:la().optional(),storeInCache:la().optional(),zeroDataRetention:la().optional(),location:sa({country:ra().optional(),languages:ca(ra()).optional()}).optional(),onlyMainContent:la().optional(),changeTrackingOptions:sa({modes:ca(ra()).optional(),schema:da(ua()).optional(),prompt:ra().optional(),tag:ra().nullable().optional()}).optional()}).optional()}),Sw=sa({mistralModel:ra().optional(),apiKey:ra().optional().default("${OCR_API_KEY}"),baseURL:ra().optional().default("${OCR_BASEURL}"),strategy:oa(mw).default(mw.MISTRAL_OCR)}),Tw=sa({enabled:la().optional().default(!1),startBalance:pa().optional().default(2e4),autoRefillEnabled:la().optional().default(!1),refillIntervalValue:pa().optional().default(30),refillIntervalUnit:aa(["seconds","minutes","hours","days","weeks","months"]).optional().default("days"),refillAmount:pa().optional().default(1e4)}),Ew=sa({enabled:la().optional().default(!0)}),Iw=sa({disabled:la().optional(),validKeys:ca(ra()).optional(),tokenLimit:pa().optional(),charLimit:pa().optional().default(1e4),personalize:la().default(!0),messageWindowSize:pa().optional().default(5),agent:ia([sa({id:ra()}),sa({provider:ra(),model:ra(),instructions:ra().optional(),model_parameters:da(xa()).optional()})]).optional()}),Rw=ca(Zj.partial()).optional();sa({version:ra(),cache:la().default(!0),ocr:Sw.optional(),webSearch:Cw.optional(),memory:Iw.optional(),secureImageLinks:la().optional(),imageOutputType:oa(dw).default(dw.PNG),includedTools:ca(ra()).optional(),filteredTools:ca(ra()).optional(),mcpServers:Dj.optional(),mcpSettings:sa({allowedDomains:ca(ra()).optional()}).optional(),interface:yw,turnstile:ww.optional(),fileStrategy:Vj.default(uj.local),fileStrategies:$j,actions:sa({allowedDomains:ca(ra()).optional()}).optional(),registration:sa({socialLogins:ca(ra()).optional(),allowedDomains:ca(ra()).optional()}).default({socialLogins:["google","facebook","openid","github","discord","saml"]}),balance:Tw.optional(),transactions:Ew.optional(),speech:sa({tts:rw.optional(),stt:lw.optional(),speechTab:cw.optional()}).optional(),rateLimits:uw.optional(),fileConfig:ij.optional(),modelSpecs:Jy.optional(),endpoints:sa((wj={all:Wj.optional()},wj[_y.openAI]=Wj.optional(),wj[_y.google]=Wj.optional(),wj[_y.anthropic]=Wj.optional(),wj[_y.azureOpenAI]=ew.optional(),wj[_y.azureAssistants]=Yj.optional(),wj[_y.assistants]=Yj.optional(),wj[_y.agents]=Jj.optional(),wj[_y.custom]=Rw.optional(),wj[_y.bedrock]=Wj.optional(),wj)).strict().refine((function(e){return Object.keys(e).length>0}),{message:"At least one `endpoints` field must be provided."}).optional()}),function(e){e.anyscale="anyscale",e.apipie="apipie",e.cohere="cohere",e.fireworks="fireworks",e.deepseek="deepseek",e.groq="groq",e.helicone="helicone",e.huggingface="huggingface",e.mistral="mistral",e.mlx="mlx",e.ollama="ollama",e.openrouter="openrouter",e.perplexity="perplexity",e.shuttleai="shuttleai",e["together.ai"]="together.ai",e.unify="unify",e.vercel="vercel",e.xai="xai"}(Nw||(Nw={})),function(e){e.openrouter="openrouter",e.helicone="helicone"}(kw||(kw={})),_y.openAI,_y.assistants,_y.azureAssistants,_y.azureOpenAI,_y.agents,_y.google,_y.anthropic,_y.custom,_y.bedrock,(Nj={})[_y.openAI]="OpenAI",Nj[_y.assistants]="Assistants",Nj[_y.agents]="My Agents",Nj[_y.azureAssistants]="Azure Assistants",Nj[_y.azureOpenAI]="Azure OpenAI",Nj[_y.google]="Google",Nj[_y.anthropic]="Anthropic",Nj[_y.custom]="Custom",Nj[_y.bedrock]="AWS Bedrock",Nj[Nw.ollama]="Ollama",Nj[Nw.deepseek]="DeepSeek",Nj[Nw.xai]="xAI",Nj[Nw.vercel]="Vercel",Nj[Nw.helicone]="Helicone";var Aw,Pw,Ow,Lw,Mw,Dw,Fw,Uw,zw,Vw,$w,Bw,Hw,Gw,Kw,Ww,qw=["gpt-5.1","gpt-5.1-chat-latest","gpt-5.1-codex","gpt-5.1-codex-mini","gpt-5","gpt-5-mini","gpt-5-nano","gpt-5-chat-latest","gpt-4.1","gpt-4.1-mini","gpt-4.1-nano","gpt-4o-mini","gpt-4o","gpt-4.5-preview","gpt-4.5-preview-2025-02-27","gpt-3.5-turbo","gpt-3.5-turbo-0125","gpt-4-turbo","gpt-4-turbo-2024-04-09","gpt-4-0125-preview","gpt-4-turbo-preview","gpt-4-1106-preview","gpt-3.5-turbo-1106","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","gpt-4","gpt-4-0314","gpt-4-32k-0314","gpt-4-0613","gpt-3.5-turbo-0613"],Qw=((kj={})[_y.azureAssistants]=qw,kj[_y.assistants]=cy(cy([],qw,!0),["chatgpt-4o-latest"],!1),kj[_y.agents]=qw,kj[_y.google]=["gemini-2.5-pro","gemini-2.5-flash","gemini-2.5-flash-lite","gemini-2.0-flash-001","gemini-2.0-flash-lite"],kj[_y.anthropic]=["claude-sonnet-4-5","claude-sonnet-4-5-20250929","claude-haiku-4-5","claude-haiku-4-5-20251001","claude-opus-4-1","claude-opus-4-1-20250805","claude-opus-4-5","claude-sonnet-4-20250514","claude-sonnet-4-0","claude-opus-4-20250514","claude-opus-4-0","claude-3-7-sonnet-latest","claude-3-7-sonnet-20250219","claude-3-5-haiku-20241022","claude-3-5-sonnet-20241022","claude-3-5-sonnet-20240620","claude-3-5-sonnet-latest","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307","claude-2.1","claude-2","claude-1.2","claude-1","claude-1-100k","claude-instant-1","claude-instant-1-100k"],kj[_y.openAI]=cy(cy([],qw,!0),["chatgpt-4o-latest","gpt-4-vision-preview","gpt-3.5-turbo-instruct-0914","gpt-3.5-turbo-instruct"],!1),kj[_y.bedrock]=["anthropic.claude-sonnet-4-5-20250929-v1:0","anthropic.claude-haiku-4-5-20251001-v1:0","anthropic.claude-opus-4-1-20250805-v1:0","anthropic.claude-3-5-sonnet-20241022-v2:0","anthropic.claude-3-5-sonnet-20240620-v1:0","anthropic.claude-3-5-haiku-20241022-v1:0","anthropic.claude-3-haiku-20240307-v1:0","anthropic.claude-3-opus-20240229-v1:0","anthropic.claude-3-sonnet-20240229-v1:0","anthropic.claude-v2","anthropic.claude-v2:1","anthropic.claude-instant-v1","cohere.command-r-v1:0","cohere.command-r-plus-v1:0","meta.llama2-13b-chat-v1","meta.llama2-70b-chat-v1","meta.llama3-8b-instruct-v1:0","meta.llama3-70b-instruct-v1:0","meta.llama3-1-8b-instruct-v1:0","meta.llama3-1-70b-instruct-v1:0","meta.llama3-1-405b-instruct-v1:0","mistral.mistral-7b-instruct-v0:2","mistral.mixtral-8x7b-instruct-v0:1","mistral.mistral-large-2402-v1:0","mistral.mistral-large-2407-v1:0","mistral.mistral-small-2402-v1:0","ai21.jamba-instruct-v1:0","amazon.titan-text-lite-v1","amazon.titan-text-express-v1","amazon.titan-text-premier-v1:0"],kj),Yw=Qw[_y.openAI],Xw=((Cj={initial:[]})[_y.openAI]=Yw,Cj[_y.assistants]=Yw.filter((function(e){return/gpt-4|gpt-3\\.5/i.test(e)&&!/vision|instruct/i.test(e)})),Cj[_y.agents]=Yw,Cj[_y.azureOpenAI]=Yw,Cj[_y.google]=Qw[_y.google],Cj[_y.anthropic]=Qw[_y.anthropic],Cj[_y.bedrock]=Qw[_y.bedrock],Cj);function Jw(e,t){return iy(this,0,void 0,(function(){return ly(this,(function(n){switch(n.label){case 0:return[4,na.post(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))}(Sj={})[_y.assistants]="".concat(xj(),"/api/assistants/v2/chat"),Sj[_y.azureAssistants]="".concat(xj(),"/api/assistants/v1/chat"),Sj[_y.agents]="".concat(xj(),"/api/").concat(_y.agents,"/chat"),_y.anthropic,_y.google,_y.openAI,_y.azureOpenAI,_y.custom,_y.agents,_y.bedrock,(Tj={})[_y.custom]=!0,Tj[_y.openAI]=!0,Tj[_y.anthropic]=!0,Tj[_y.assistants]=!0,Tj[_y.agents]=!0,Tj[_y.azureAssistants]=!0,Tj[_y.azureOpenAI]=!0,Tj[_y.bedrock]=!0,Tj[_y.google]=!0,function(e){e.generative="generative",e.agents="agents"}(Aw||(Aw={})),function(e){e.PROMPT_GROUPS="promptGroups",e.SHARED_LINKS="sharedLinks"}(Pw||(Pw={})),function(e){e[e.ONE_DAY=864e5]="ONE_DAY",e[e.TWELVE_HOURS=432e5]="TWELVE_HOURS",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.THIRTY_MINUTES=18e5]="THIRTY_MINUTES",e[e.TEN_MINUTES=6e5]="TEN_MINUTES",e[e.FIVE_MINUTES=3e5]="FIVE_MINUTES",e[e.THREE_MINUTES=18e4]="THREE_MINUTES",e[e.TWO_MINUTES=12e4]="TWO_MINUTES",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.THIRTY_SECONDS=3e4]="THIRTY_SECONDS"}(Ow||(Ow={})),function(e){e.CONFIG_STORE="CONFIG_STORE",e.ROLES="ROLES",e.GEN_TITLE="GEN_TITLE",e.TOOLS="TOOLS",e.MODELS_CONFIG="MODELS_CONFIG",e.MODEL_QUERIES="MODEL_QUERIES",e.STARTUP_CONFIG="STARTUP_CONFIG",e.ENDPOINT_CONFIG="ENDPOINT_CONFIG",e.TOKEN_CONFIG="TOKEN_CONFIG",e.APP_CONFIG="APP_CONFIG",e.ABORT_KEYS="ABORT_KEYS",e.BANS="BANS",e.ENCODED_DOMAINS="ENCODED_DOMAINS",e.AUDIO_RUNS="AUDIO_RUNS",e.MESSAGES="MESSAGES",e.FLOWS="FLOWS",e.PENDING_REQ="PENDING_REQ",e.S3_EXPIRY_INTERVAL="S3_EXPIRY_INTERVAL",e.OPENID_EXCHANGED_TOKENS="OPENID_EXCHANGED_TOKENS",e.OPENID_SESSION="OPENID_SESSION",e.SAML_SESSION="SAML_SESSION"}(Lw||(Lw={})),function(e){e.FILE_UPLOAD_LIMIT="file_upload_limit",e.ILLEGAL_MODEL_REQUEST="illegal_model_request",e.TOKEN_BALANCE="token_balance",e.BAN="ban",e.TTS_LIMIT="tts_limit",e.STT_LIMIT="stt_limit",e.RESET_PASSWORD_LIMIT="reset_password_limit",e.VERIFY_EMAIL_LIMIT="verify_email_limit",e.CONVO_ACCESS="convo_access",e.TOOL_CALL_LIMIT="tool_call_limit",e.GENERAL="general",e.LOGINS="logins",e.CONCURRENT="concurrent",e.NON_BROWSER="non_browser",e.MESSAGE_LIMIT="message_limit",e.REGISTRATIONS="registrations"}(Mw||(Mw={})),function(e){e.NO_USER_KEY="no_user_key",e.EXPIRED_USER_KEY="expired_user_key",e.INVALID_USER_KEY="invalid_user_key",e.NO_BASE_URL="no_base_url",e.MODERATION="moderation",e.INPUT_LENGTH="INPUT_LENGTH",e.INVALID_REQUEST="invalid_request_error",e.INVALID_ACTION="invalid_action_error",e.NO_SYSTEM_MESSAGES="no_system_messages",e.GOOGLE_ERROR="google_error",e.GOOGLE_TOOL_CONFLICT="google_tool_conflict",e.INVALID_AGENT_PROVIDER="invalid_agent_provider",e.MISSING_MODEL="missing_model",e.MODELS_NOT_LOADED="models_not_loaded",e.ENDPOINT_MODELS_NOT_LOADED="endpoint_models_not_loaded",e.AUTH_FAILED="auth_failed",e.REFUSAL="refusal"}(Dw||(Dw={})),function(e){e.GOOGLE_SERVICE_KEY="GOOGLE_SERVICE_KEY",e.GOOGLE_API_KEY="GOOGLE_API_KEY"}(Fw||(Fw={})),function(e){e[e.LOW=85]="LOW",e[e.HIGH=170]="HIGH",e[e.ADDITIONAL=85]="ADDITIONAL"}(Uw||(Uw={})),function(e){e.GENERAL="general",e.CHAT="chat",e.SPEECH="speech",e.BETA="beta",e.DATA="data",e.BALANCE="balance",e.ACCOUNT="account",e.COMMANDS="commands",e.PERSONALIZATION="personalization"}(zw||(zw={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI"}(Vw||(Vw={})),function(e){e.OPENAI="openai",e.AZURE_OPENAI="azureOpenAI",e.ELEVENLABS="elevenlabs",e.LOCALAI="localai"}($w||($w={})),function(e){e.VERSION="v0.8.2-rc1",e.CONFIG_VERSION="1.3.1",e.NO_PARENT="00000000-0000-0000-0000-000000000000",e.USE_PRELIM_RESPONSE_MESSAGE_ID="USE_PRELIM_RESPONSE_MESSAGE_ID",e.NEW_CONVO="new",e.PENDING_CONVO="PENDING",e.SEARCH="search",e[e.ENCODED_DOMAIN_LENGTH=10]="ENCODED_DOMAIN_LENGTH",e.CURRENT_MODEL="current_model",e.COMMON_DIVIDER="__",e[e.COMMANDS_MAX_LENGTH=56]="COMMANDS_MAX_LENGTH",e[e.DEFAULT_STREAM_RATE=1]="DEFAULT_STREAM_RATE",e.SAVED_TAG="Saved",e[e.MAX_CONVO_STARTERS=4]="MAX_CONVO_STARTERS",e.GLOBAL_PROJECT_NAME="instance",e.mcp_delimiter="_mcp_",e.mcp_prefix="mcp_",e.mcp_all="sys__all__sys",e.mcp_clear="sys__clear__sys",e.mcp_server="sys__server__sys",e.LC_TRANSFER_TO_="lc_transfer_to_",e.EPHEMERAL_AGENT_ID="ephemeral"}(Bw||(Bw={})),function(e){e.APP_TITLE="appTitle",e.LAST_CONVO_SETUP="lastConversationSetup",e.LAST_MODEL="lastSelectedModel",e.LAST_TOOLS="lastSelectedTools",e.LAST_SPEC="lastSelectedSpec",e.FILES_TO_DELETE="filesToDelete",e.ASST_ID_PREFIX="assistant_id__",e.AGENT_ID_PREFIX="agent_id__",e.FORK_SETTING="forkSetting",e.REMEMBER_FORK_OPTION="rememberDefaultFork",e.FORK_SPLIT_AT_TARGET="splitAtTarget",e.TEXT_DRAFT="textDraft_",e.FILES_DRAFT="filesDraft_",e.LAST_PROMPT_CATEGORY="lastPromptCategory",e.ENABLE_USER_MSG_MARKDOWN="enableUserMsgMarkdown",e.SHOW_ANALYSIS_CODE="showAnalysisCode",e.LAST_MCP_="LAST_MCP_",e.LAST_CODE_TOGGLE_="LAST_CODE_TOGGLE_",e.LAST_WEB_SEARCH_TOGGLE_="LAST_WEB_SEARCH_TOGGLE_",e.LAST_FILE_SEARCH_TOGGLE_="LAST_FILE_SEARCH_TOGGLE_",e.LAST_ARTIFACTS_TOGGLE_="LAST_ARTIFACTS_TOGGLE_",e.LAST_AGENT_PROVIDER="lastAgentProvider",e.LAST_AGENT_MODEL="lastAgentModel",e.PIN_MCP_="PIN_MCP_",e.PIN_WEB_SEARCH_="PIN_WEB_SEARCH_",e.PIN_CODE_INTERPRETER_="PIN_CODE_INTERPRETER_"}(Hw||(Hw={})),function(e){e.DIRECT_PATH="directPath",e.INCLUDE_BRANCHES="includeBranches",e.TARGET_LEVEL="targetLevel",e.DEFAULT="default"}(Gw||(Gw={})),function(e){e.API_URL="https://api.cohere.ai/v1",e.ROLE_USER="USER",e.ROLE_SYSTEM="SYSTEM",e.ROLE_CHATBOT="CHATBOT",e.TITLE_MESSAGE="TITLE:"}(Kw||(Kw={})),function(e){e.ALL="sys__all__sys",e.MY_PROMPTS="sys__my__prompts__sys",e.NO_CATEGORY="sys__no__category__sys",e.SHARED_PROMPTS="sys__shared__prompts__sys"}(Ww||(Ww={})),(Ej={})[_y.openAI]=_y.openAI,Ej[_y.bedrock]=_y.bedrock,Ej[_y.anthropic]=_y.anthropic,Ej[_y.azureOpenAI]=_y.azureOpenAI;var Zw=!1,eN=[],tN=function(e){return Jw((t=e,"".concat(lj,"/api/auth/refresh").concat(!0===t?"?retry=true":"")));var t},nN=function(e){var t;t=e,na.defaults.headers.common.Authorization="Bearer "+t,window.dispatchEvent(new CustomEvent("tokenUpdated",{detail:e}))},aN=function(e,t){void 0===t&&(t=null),eN.forEach((function(n){e?n.reject(e):n.resolve(t)})),eN=[]};"undefined"!=typeof window&&na.interceptors.response.use((function(e){return e}),(function(e){return iy(void 0,0,void 0,(function(){var t,n,a,s,r,o,i,l,c;return ly(this,(function(d){switch(d.label){case 0:if(t=e.config,!e.response)return[2,Promise.reject(e)];if(!0===(null===(o=t.url)||void 0===o?void 0:o.includes("/api/auth/2fa")))return[2,Promise.reject(e)];if(!0===(null===(i=t.url)||void 0===i?void 0:i.includes("/api/auth/logout")))return[2,Promise.reject(e)];if(401!==e.response.status||t._retry)return[3,13];if(console.warn("401 error, refreshing token"),t._retry=!0,!Zw)return[3,5];d.label=1;case 1:return d.trys.push([1,4,,5]),[4,new Promise((function(e,t){eN.push({resolve:e,reject:t})}))];case 2:return s=d.sent(),t.headers.Authorization="Bearer "+s,[4,na(t)];case 3:return[2,d.sent()];case 4:return n=d.sent(),[2,Promise.reject(n)];case 5:Zw=!0,d.label=6;case 6:return d.trys.push([6,11,12,13]),[4,tN(!0===(null===(l=t.url)||void 0===l?void 0:l.includes("api/auth/refresh")))];case 7:return a=d.sent(),(s=null!==(c=null==a?void 0:a.token)&&void 0!==c?c:"")?(t.headers.Authorization="Bearer "+s,nN(s),aN(null,s),[4,na(t)]):[3,9];case 8:return[2,d.sent()];case 9:window.location.href.includes("share/")?console.log("Refresh token failed from shared link, attempting request to ".concat(t.url)):window.location.href="".concat(lj,"/login"),d.label=10;case 10:return[3,13];case 11:return r=d.sent(),aN(r,null),[2,Promise.reject(r)];case 12:return Zw=!1,[7];case 13:return[2,Promise.reject(e)]}}))}))}));var sN={get:function(e,t){return iy(this,0,void 0,(function(){return ly(this,(function(n){switch(n.label){case 0:return[4,na.get(e,ry({},t))];case 1:return[2,n.sent().data]}}))}))},getResponse:function(e,t){return iy(this,0,void 0,(function(){return ly(this,(function(n){switch(n.label){case 0:return[4,na.get(e,ry({},t))];case 1:return[2,n.sent()]}}))}))},post:Jw,postMultiPart:function(e,t,n){return iy(this,0,void 0,(function(){return ly(this,(function(a){switch(a.label){case 0:return[4,na.post(e,t,ry(ry({},n),{headers:{"Content-Type":"multipart/form-data"}}))];case 1:return[2,a.sent().data]}}))}))},postTTS:function(e,t,n){return iy(this,0,void 0,(function(){return ly(this,(function(a){switch(a.label){case 0:return[4,na.post(e,t,ry(ry({},n),{headers:{"Content-Type":"multipart/form-data"},responseType:"arraybuffer"}))];case 1:return[2,a.sent().data]}}))}))},put:function(e,t){return iy(this,0,void 0,(function(){return ly(this,(function(n){switch(n.label){case 0:return[4,na.put(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},delete:function(e){return iy(this,0,void 0,(function(){return ly(this,(function(t){switch(t.label){case 0:return[4,na.delete(e)];case 1:return[2,t.sent().data]}}))}))},deleteWithOptions:function(e,t){return iy(this,0,void 0,(function(){return ly(this,(function(n){switch(n.label){case 0:return[4,na.delete(e,ry({},t))];case 1:return[2,n.sent().data]}}))}))},patch:function(e,t){return iy(this,0,void 0,(function(){return ly(this,(function(n){switch(n.label){case 0:return[4,na.patch(e,JSON.stringify(t),{headers:{"Content-Type":"application/json"}})];case 1:return[2,n.sent().data]}}))}))},refreshToken:tN,dispatchTokenUpdatedEvent:nN};var rN,oN,iN,lN,cN,dN,uN,mN=function(){return sN.get("".concat("".concat("".concat(lj,"/api/files"),"/speech"),"/config/get"))};!function(e){e.messages="messages",e.sharedMessages="sharedMessages",e.sharedLinks="sharedLinks",e.allConversations="allConversations",e.archivedConversations="archivedConversations",e.searchConversations="searchConversations",e.conversation="conversation",e.searchEnabled="searchEnabled",e.user="user",e.name="name",e.models="models",e.balance="balance",e.endpoints="endpoints",e.presets="presets",e.searchResults="searchResults",e.tokenCount="tokenCount",e.availablePlugins="availablePlugins",e.startupConfig="startupConfig",e.assistants="assistants",e.assistant="assistant",e.agents="agents",e.agent="agent",e.files="files",e.fileConfig="fileConfig",e.tools="tools",e.toolAuth="toolAuth",e.toolCalls="toolCalls",e.mcpTools="mcpTools",e.mcpConnectionStatus="mcpConnectionStatus",e.mcpAuthValues="mcpAuthValues",e.agentTools="agentTools",e.actions="actions",e.assistantDocs="assistantDocs",e.agentDocs="agentDocs",e.fileDownload="fileDownload",e.voices="voices",e.customConfigSpeech="customConfigSpeech",e.prompts="prompts",e.prompt="prompt",e.promptGroups="promptGroups",e.allPromptGroups="allPromptGroups",e.promptGroup="promptGroup",e.categories="categories",e.randomPrompts="randomPrompts",e.agentCategories="agentCategories",e.marketplaceAgents="marketplaceAgents",e.roles="roles",e.conversationTags="conversationTags",e.health="health",e.userTerms="userTerms",e.banner="banner",e.memories="memories",e.principalSearch="principalSearch",e.accessRoles="accessRoles",e.resourcePermissions="resourcePermissions",e.effectivePermissions="effectivePermissions",e.graphToken="graphToken",e.mcpServers="mcpServers",e.mcpServer="mcpServer"}(rN||(rN={})),function(e){e.fileUpload="fileUpload",e.fileDelete="fileDelete",e.updatePreset="updatePreset",e.deletePreset="deletePreset",e.loginUser="loginUser",e.logoutUser="logoutUser",e.refreshToken="refreshToken",e.avatarUpload="avatarUpload",e.speechToText="speechToText",e.textToSpeech="textToSpeech",e.assistantAvatarUpload="assistantAvatarUpload",e.agentAvatarUpload="agentAvatarUpload",e.updateAction="updateAction",e.updateAgentAction="updateAgentAction",e.deleteAction="deleteAction",e.deleteAgentAction="deleteAgentAction",e.revertAgentVersion="revertAgentVersion",e.deleteUser="deleteUser",e.updateRole="updateRole",e.enableTwoFactor="enableTwoFactor",e.verifyTwoFactor="verifyTwoFactor",e.updateMemoryPreferences="updateMemoryPreferences"}(oN||(oN={})),function(e){e.USER="user",e.GROUP="group",e.PUBLIC="public",e.ROLE="role"}(iN||(iN={})),function(e){e.USER="User",e.GROUP="Group",e.ROLE="Role"}(lN||(lN={})),function(e){e.AGENT="agent",e.PROMPTGROUP="promptGroup",e.MCPSERVER="mcpServer"}(cN||(cN={})),function(e){e[e.VIEW=1]="VIEW",e[e.EDIT=2]="EDIT",e[e.DELETE=4]="DELETE",e[e.SHARE=8]="SHARE"}(dN||(dN={})),function(e){e.AGENT_VIEWER="agent_viewer",e.AGENT_EDITOR="agent_editor",e.AGENT_OWNER="agent_owner",e.PROMPTGROUP_VIEWER="promptGroup_viewer",e.PROMPTGROUP_EDITOR="promptGroup_editor",e.PROMPTGROUP_OWNER="promptGroup_owner",e.MCPSERVER_VIEWER="mcpServer_viewer",e.MCPSERVER_EDITOR="mcpServer_editor",e.MCPSERVER_OWNER="mcpServer_owner"}(uN||(uN={}));var pN=sa({type:oa(iN),id:ra().optional(),name:ra().optional(),email:ra().optional(),source:aa(["local","entra"]).optional(),avatar:ra().optional(),description:ra().optional(),idOnTheSource:ra().optional(),accessRoleId:oa(uN).optional(),memberCount:pa().optional()}),hN=sa({accessRoleId:oa(uN),name:ra(),description:ra().optional(),resourceType:oa(cN).default(cN.AGENT),permBits:pa()}),gN=sa({id:ra(),principalType:oa(iN),principalId:ra().optional(),principalName:ra().optional(),role:hN,grantedBy:ra(),grantedAt:ra(),inheritedFrom:ra().optional(),source:aa(["local","entra"]).optional()});sa({resourceType:oa(cN),resourceId:ra(),permissions:ca(gN)}),sa({updated:pN.array(),removed:pN.array(),public:la(),publicAccessRoleId:ra().optional()}),sa({message:ra(),results:sa({principals:pN.array(),public:la(),publicAccessRoleId:ra().optional()})}),sa({resourceType:oa(cN),resourceId:oa(uN),principals:ca(pN),public:la(),publicAccessRoleId:oa(uN).optional()}),sa({permissionBits:pa()});var xN=function(e,t){return gs([rN.sharedMessages,e],(function(){return function(e){return sN.get((t=e,"".concat(_j,"/").concat(t)));var t}(e)}),ry({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},t))},fN=function(e,t){var n=xs();return gs([rN.sharedLinks,e],(function(){return function(e){return sN.get((t=e,"".concat(_j,"/link/").concat(t)));var t}(e)}),ry({enabled:!!e&&e!==Bw.NEW_CONVO&&e!==Bw.PENDING_CONVO,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,onSuccess:function(t){n.setQueryData([rN.sharedLinks,e],{conversationId:t.conversationId,shareId:t.shareId})}},t))},vN=function(){var e=xs();return fs((function(e){return function(e){if(!e.value)throw new Error("value is required");return sN.put(bj,e)}(e)}),{onSuccess:function(t,n){e.invalidateQueries([rN.name,n.name])}})},_N=function(){var e=xs();return fs((function(){return sN.delete("".concat(yj,"/all"))}),{onSuccess:function(){e.invalidateQueries([rN.allConversations])}})},bN=function(e){var t=xs();return fs((function(){return function(e){return sN.delete((t=e,"".concat(bj,"/").concat(t)));var t}(e)}),{onSuccess:function(){var n,a;t.invalidateQueries([rN.name,e]),(a=null!=(n=e)?n:"")&&a.toLowerCase().endsWith(_y.assistants)&&(t.invalidateQueries([rN.assistants,e,uy]),t.invalidateQueries([rN.assistantDocs]),t.invalidateQueries([rN.assistants]),t.invalidateQueries([rN.assistant]),t.invalidateQueries([rN.mcpTools]),t.invalidateQueries([rN.actions]),t.invalidateQueries([rN.tools]))}})},yN=function(){var e=xs();return fs((function(){return sN.delete("".concat(bj,"?all=true"))}),{onSuccess:function(){e.invalidateQueries([rN.name]),e.invalidateQueries([rN.assistants,_y.assistants,uy]),e.invalidateQueries([rN.assistants,_y.azureAssistants,uy]),e.invalidateQueries([rN.assistantDocs]),e.invalidateQueries([rN.assistants]),e.invalidateQueries([rN.assistant]),e.invalidateQueries([rN.mcpTools]),e.invalidateQueries([rN.actions]),e.invalidateQueries([rN.tools])}})},jN=function(e){return gs([rN.models],(function(){return iy(void 0,0,void 0,(function(){return ly(this,(function(e){return[2,sN.get("".concat(lj,"/api/models"))]}))}))}),ry({initialData:Xw,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:1/0},e))},wN=function(){var e=xs();return fs((function(e){return function(e){return sN.post("".concat(lj,"/api/presets"),e)}(e)}),{onSuccess:function(){e.invalidateQueries([rN.presets])}})},NN=function(e){var t=xs();return fs((function(e){return function(e){return sN.post("".concat(lj,"/api/auth/register"),e)}(e)}),ry(ry({},e),{onSuccess:function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];t.invalidateQueries([rN.user]),(null==e?void 0:e.onSuccess)&&e.onSuccess.apply(e,n)}}))},kN=function(e,t){return gs([rN.name,e],(function(){return e?function(e){return sN.get((t=e,"".concat(bj,"?name=").concat(t)));var t}(e):Promise.resolve({expiresAt:""})}),ry({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1},t))},CN=function(){return fs((function(e){return function(e){return sN.post("".concat(lj,"/api/auth/requestPasswordReset"),e)}(e)}))},SN=function(){return fs((function(e){return function(e){return sN.post("".concat(lj,"/api/auth/resetPassword"),e)}(e)}))},TN=function(e){var t=xs(),n=null!=e?e:{},a=n.onSuccess,s=oy(n,["onSuccess"]);return fs((function(e){return function(e){return sN.post("".concat(lj,"/api/user/plugins"),e)}(e)}),ry(ry({},s),{onSuccess:function(){for(var e,n,s,r,o,i=[],l=0;l<arguments.length;l++)i[l]=arguments[l];if(t.invalidateQueries([rN.user]),null==a||a.apply(void 0,i),"uninstall"===(null===(e=i[1])||void 0===e?void 0:e.action)&&(null===(s=null===(n=i[1])||void 0===n?void 0:n.pluginKey)||void 0===s?void 0:s.startsWith(Bw.mcp_prefix))){var c=null===(o=null===(r=i[1])||void 0===r?void 0:r.pluginKey)||void 0===o?void 0:o.substring(Bw.mcp_prefix.length);t.invalidateQueries([rN.mcpAuthValues,c])}}}))},EN=function(){var e=xs();return fs((function(e){return function(e){return sN.post((t=e,"".concat(lj,"/api/mcp/").concat(t,"/reinitialize")));var t}(e)}),{onSuccess:function(){e.invalidateQueries([rN.mcpTools])}})},IN=function(){var e=xs();return fs((function(e){return function(e){return sN.post((t=e,"".concat(lj,"/api/mcp/oauth/cancel/").concat(t)),{});var t}(e)}),{onSuccess:function(){e.invalidateQueries([rN.mcpConnectionStatus])}})},RN=function(e){return gs([rN.customConfigSpeech],(function(){return mN()}),ry({refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1},e))},AN=function(e,t){var n=xs();return fs((function(n){return function(e,t,n){return sN.put((a=e,s=t,"".concat(lj,"/api/messages/").concat(a,"/").concat(s,"/feedback")),n);var a,s}(e,t,n)}),{onSuccess:function(){n.invalidateQueries([rN.messages,t])}})},PN=function(e,t){return gs([rN.principalSearch,e],(function(){return function(e){return sN.get((n=(t=e).q,a=t.limit,s=t.types,r="".concat(lj,"/api/permissions/search-principals?q=").concat(encodeURIComponent(n)),void 0!==a&&(r+="&limit=".concat(a)),s&&s.length>0&&(r+="&types=".concat(s.join(","))),r));var t,n,a,s,r}(e)}),ry({enabled:!!e.q&&e.q.length>=2,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e4},t))},ON=function(e,t){return gs([rN.accessRoles,e],(function(){return function(e){return sN.get((t=e,"".concat(lj,"/api/permissions/").concat(t,"/roles")));var t}(e)}),ry({enabled:!!e,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:3e5},t))},LN=function(e,t,n){return gs([rN.resourcePermissions,e,t],(function(){return function(e,t){return sN.get((n=e,a=t,"".concat(lj,"/api/permissions/").concat(n,"/").concat(a)));var n,a}(e,t)}),ry({enabled:!!e&&!!t,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,staleTime:12e4},n))},MN=function(){var e=xs();return fs({mutationFn:function(e){return function(e,t,n){return sN.put((a=e,s=t,"".concat(lj,"/api/permissions/").concat(a,"/").concat(s)),n);var a,s}(e.resourceType,e.resourceId,e.data)},onSuccess:function(t,n){e.invalidateQueries({queryKey:[rN.accessRoles,n.resourceType]}),e.invalidateQueries({queryKey:[rN.resourcePermissions,n.resourceType,n.resourceId]}),e.invalidateQueries({queryKey:[rN.effectivePermissions,n.resourceType,n.resourceId]})}})},DN=function(e,t,n){return gs(ry({queryKey:[rN.effectivePermissions,e,t],queryFn:function(){return function(e,t){return sN.get((n=e,a=t,"".concat(lj,"/api/permissions/").concat(n,"/").concat(a,"/effective")));var n,a}(e,t)},enabled:!!e&&!!t,refetchOnWindowFocus:!1,staleTime:3e4},n))},FN=function(e,t){return gs(ry({queryKey:[rN.effectivePermissions,"all",e],queryFn:function(){return function(e){return sN.get((t=e,"".concat(lj,"/api/permissions/").concat(t,"/effective/all")));var t}(e)},enabled:!!e,refetchOnWindowFocus:!1,staleTime:3e4},t))};const UN=new Set(["spec","iconURL"]),zN=()=>{const{data:e={}}=G_(),{data:t={}}=jN();return({conversation:n,preset:a,cleanInput:s,cleanOutput:r})=>{const o=ev({convoSetup:a,endpointsConfig:e}),i=t[o??""]||[],l={...n};if(!0===s)for(const e in l)Tu.has(e)&&!UN.has(e)||null!=l[e]&&(l[e]=void 0);const c=Zf({conversation:l,endpoint:o,lastConversationSetup:a,models:i});if(!r)return c;for(const e in c)Tu.has(e)&&!UN.has(e)||null!=c[e]&&(c[e]=void 0);return c}},VN=wa({}),$N=()=>Na(VN),BN=e=>e.data.map((({id:e,name:t,metadata:n,model:a})=>({id:e,name:t??"",metadata:n,model:a})));function HN(e=BN){const{data:t=null}=vb(Yl.assistants,void 0,{select:e}),{data:n=null}=vb(Yl.azureAssistants,void 0,{select:e});return Ca((()=>({[Yl.assistants]:t,[Yl.azureAssistants]:n})),[t,n])}function GN({isAuthenticated:e}){const{data:t=null}=R_({requiredPermission:Oh.VIEW},{select:e=>function(e){const t={};for(const n of e)t[n.id]=n;return t}(e.data),enabled:e});return Ca((()=>null!==t?t:void 0),[t])}const KN=wa({}),WN=()=>Na(KN);function qN(){const e=j(N_.lang),{t:t,i18n:n}=Ri();return ya((()=>{n.language!==e&&n.changeLanguage(e)}),[e,n]),(e,n)=>t(e,n)}const QN="",YN="com_ui_agent_category_general",XN=()=>{const e=qN(),t=O_({staleTime:9e5});return{categories:Ca((()=>t.data?t.data.filter((e=>"promoted"!==e.value&&"all"!==e.value)).map((e=>({label:e.label||e.value,value:e.value,className:"w-full"}))):[]),[t.data]),emptyCategory:Ca((()=>({label:e(YN),value:QN,className:"w-full"})),[e]),isLoading:t.isLoading,error:t.error}};function JN(e){const t=Ca((()=>(null==e?void 0:e.includes(Au.tools))??!1),[e]),n=Ca((()=>(null==e?void 0:e.includes(Au.actions))??!1),[e]),a=Ca((()=>(null==e?void 0:e.includes(Au.artifacts))??!1),[e]),s=Ca((()=>(null==e?void 0:e.includes(Au.ocr))??!1),[e]),r=Ca((()=>(null==e?void 0:e.includes(Au.context))??!1),[e]),o=Ca((()=>(null==e?void 0:e.includes(Au.file_search))??!1),[e]),i=Ca((()=>(null==e?void 0:e.includes(Au.web_search))??!1),[e]);return{ocrEnabled:s,codeEnabled:Ca((()=>(null==e?void 0:e.includes(Au.execute_code))??!1),[e]),toolsEnabled:t,actionsEnabled:n,contextEnabled:r,artifactsEnabled:a,webSearchEnabled:i,fileSearchEnabled:o}}function ZN(e){const{endpointsConfig:t}={},{data:n}=G_({enabled:!t}),a=t||n;return{agentsConfig:Ca((()=>{const e=(null==a?void 0:a[Yl.agents])??null;return e?{...e,capabilities:Array.isArray(e.capabilities)?e.capabilities.map((e=>e)):[]}:null}),[a]),endpointsConfig:a}}const ek=wa(void 0),tk=({authConfig:e,children:t})=>{const[n,a]=b(N_.user),[s,r]=ja(void 0),[o,i]=ja(void 0),[c,d]=ja(!1),u=ba(void 0),{data:m=null}=Vb(gh.USER,{enabled:!(!c||!(null==n?void 0:n.role))}),{data:p=null}=Vb(gh.ADMIN,{enabled:!(!c||(null==n?void 0:n.role)!==gh.ADMIN)}),h=E(),g=Ca((()=>vi.debounce((e=>{const{token:t,isAuthenticated:n,user:s,redirect:o}=e;a(s),r(t),Hh(t),d(n);const i=u.current||o;u.current=void 0,null!=i&&(i.startsWith("http://")||i.startsWith("https://")?window.location.href=i:h(i,{replace:!0}))}),50)),[h,a]),x=function({callback:e,delay:t=400}){const n=ba(null);return ya((()=>()=>{null!==n.current&&clearTimeout(n.current)}),[]),a=>{null!==n.current&&clearTimeout(n.current),null!=a&&a&&(console.log(a),n.current=setTimeout((()=>{e(a)}),t))}}({callback:e=>i(e)}),f=(e=>{const t=xs(),n=T_(),a=S(N_.defaultPreset),s=y(N_.queriesEnabled);return fs([$h.loginUser],{mutationFn:e=>Jh.login(e),...e||{},onMutate:s=>{var r;a(),n(),t.removeQueries(),null==(r=null==e?void 0:e.onMutate)||r.call(e,s)},onSuccess:(...t)=>{var n;s(!0),null==(n=null==e?void 0:e.onSuccess)||n.call(e,...t)}})})({onSuccess:e=>{const{user:t,token:n,twoFAPending:a,tempToken:s}=e;a?h(`/login/2fa?tempToken=${s}`,{replace:!0}):(i(void 0),g({token:n,isAuthenticated:!0,user:t,redirect:"/c/new"}))},onError:e=>{x(e.message),h("/login",{replace:!0})}}),v=(e=>{const t=xs(),n=T_(),a=S(N_.defaultPreset),s=y(N_.queriesEnabled);return fs([$h.logoutUser],{mutationFn:()=>Jh.logout(),...e||{},onSuccess:(...r)=>{var o;s(!1),a(),n(),t.removeQueries(),null==(o=null==e?void 0:e.onSuccess)||o.call(e,...r)}})})({onSuccess:e=>{g({token:void 0,isAuthenticated:!1,user:void 0,redirect:e.redirect??"/login"})},onError:e=>{x(e.message),g({token:void 0,isAuthenticated:!1,user:void 0,redirect:"/login"})}}),_=(e=>{const t=xs();return fs([$h.refreshToken],{mutationFn:()=>Xh.refreshToken(),onMutate:e=>{t.removeQueries()}})})(),j=ka((e=>{e&&(u.current=e),v.mutate(void 0)}),[v]),w=C_({enabled:!!s}),N=e=>{f.mutate(e)},k=ka((()=>{!0!==(null==e?void 0:e.test)?_.mutate(void 0,{onSuccess:t=>{const{user:n,token:a=""}=t??{};if(a)g({token:a,isAuthenticated:!0,user:n});else{if(console.log("Token is not present. User is not authenticated."),!0===(null==e?void 0:e.test))return;h("/login")}},onError:t=>{console.log("refreshToken mutation error:",t),!0!==(null==e?void 0:e.test)&&h("/login")}}):console.log("Test mode. Skipping silent refresh.")}),[]);ya((()=>{w.data?a(w.data):w.isError&&(x(w.error.message),h("/login",{replace:!0})),null!=o&&o&&c&&x(void 0),null!=s&&s&&c||k()}),[s,c,w.data,w.isError,w.error,o,a,h,k,g]),ya((()=>{const e=e=>{console.log("tokenUpdated event received event");const t=e.detail;g({token:t,isAuthenticated:!0,user:n})};return window.addEventListener("tokenUpdated",e),()=>{window.removeEventListener("tokenUpdated",e)}}),[g,n]);const C=Ca((()=>({user:n,token:s,error:o,login:N,logout:j,setError:i,roles:{[gh.USER]:m,[gh.ADMIN]:p},isAuthenticated:c})),[n,o,c,s,m,p]);return l.jsx(ek.Provider,{value:C,children:t})},nk=()=>{const e=Na(ek);if(void 0===e)throw new Error("useAuthContext should be used inside AuthProvider");return e},ak=({permissionType:e,permission:t})=>{const n=Na(ek),a=null==n?void 0:n.user,s=null==n?void 0:n.roles,r=(null==n?void 0:n.isAuthenticated)||!1,o=ka((({user:e,permissionType:t,permission:a})=>{var o,i,l;return!!n&&(!!(r&&null!=(null==e?void 0:e.role)&&s&&s[e.role])&&!0===(null==(l=null==(i=null==(o=s[e.role])?void 0:o.permissions)?void 0:i[t])?void 0:l[a]))}),[n,r,s]);return Ca((()=>o({user:a,permissionType:e,permission:t})),[a,e,t,o])},sk=()=>ak({permissionType:Pp.MARKETPLACE,permission:Op.USE})?Oh.EDIT:Oh.VIEW;wa({}),wa({});const rk=wa(void 0);function ok({children:e,defaultActive:t}){const[n,a]=ja(t);return l.jsx(rk.Provider,{value:{active:n,setActive:e=>{localStorage.setItem("side:active-panel",e),a(e)}},children:e})}const ik=wa(void 0);function lk(){const e=Na(ik);if(void 0===e)throw new Error("useAgentPanelContext must be used within an AgentPanelProvider");return e}function ck({children:e}){const t=qN(),[n,a]=ja(void 0),[s,r]=ja(void 0),[o,i]=ja(void 0),[c,d]=ja(rx.builder),[u,m]=ja(void 0),{availableMCPServers:p,isLoading:h,availableMCPServersMap:g}=aS(),{data:x}=K_(),{data:f}=_b(Yl.agents,{enabled:!Zg(u)}),{data:v}=fb(Yl.agents),{data:_}=Bb({enabled:!Zg(u)&&!h&&null!=p&&p.length>0}),{agentsConfig:b,endpointsConfig:y}=ZN(),j=Ca((()=>p.map((e=>e.serverName))),[p]),{connectionStatus:w}=nS({enabled:!Zg(u)&&j.length>0}),N={mcp:n,mcps:s,action:o,setMcp:a,actions:f,setMcps:r,agent_id:u,setAction:i,activePanel:c,regularTools:v,agentsConfig:b,startupConfig:x,mcpServersMap:Ca((()=>{var e,n;const a=new Set(j),s=new Map;if(null==_?void 0:_.servers)for(const[r,o]of Object.entries(_.servers)){const n=null==g?void 0:g[r],i={name:(null==n?void 0:n.title)||r,pluginKey:r,description:(null==n?void 0:n.description)||`${t("com_ui_tool_collection_prefix")} ${r}`,icon:o.icon||"",authConfig:o.authConfig,authenticated:o.authenticated},l=o.tools.map((e=>({tool_id:e.pluginKey,metadata:{...e,icon:o.icon,authConfig:o.authConfig,authenticated:o.authenticated}})));s.set(r,{serverName:r,tools:l,isConfigured:a.has(r),isConnected:"connected"===(null==(e=null==w?void 0:w[r])?void 0:e.connectionState),metadata:i,consumeOnly:null==n?void 0:n.consumeOnly})}for(const r of j){if(s.has(r))continue;const e=null==g?void 0:g[r],a=(null==e?void 0:e.title)||r,o=(null==e?void 0:e.description)||`${t("com_ui_tool_collection_prefix")} ${r}`,i={icon:(null==e?void 0:e.iconPath)||"",name:a,pluginKey:r,description:o};s.set(r,{tools:[],metadata:i,isConfigured:!0,serverName:r,isConnected:"connected"===(null==(n=null==w?void 0:w[r])?void 0:n.connectionState),consumeOnly:null==e?void 0:e.consumeOnly})}return s}),[_,t,j,w,g]),setActivePanel:d,endpointsConfig:y,setCurrentAgentId:m,availableMCPServers:p,availableMCPServersMap:g};return l.jsx(ik.Provider,{value:N,children:e})}const dk=wa({}),uk=()=>Na(dk),mk=wa({}),pk=()=>Na(mk),hk=wa({}),gk=()=>Na(hk),xk=wa(void 0),fk=wa(void 0);function vk({children:e}){const[t,n]=ja(!1),[a,s]=ja(),r=Ca((()=>({isMutating:t,setIsMutating:n})),[t]),o=Ca((()=>({currentCode:a,setCurrentCode:s})),[a]);return l.jsx(xk.Provider,{value:r,children:l.jsx(fk.Provider,{value:o,children:e})})}function _k(){const e=Na(xk);if(void 0===e)throw new Error("useMutationState must be used within an EditorProvider");return e}function bk(){const e=Na(fk);if(void 0===e)throw new Error("useCodeState must be used within an EditorProvider");return e}const{CustomFormProvider:yk,useCustomFormContext:jk}=function(){const e=wa(void 0);return{CustomFormProvider:({register:t,control:n,setValue:a,getValues:s,handleSubmit:r,reset:o,children:i})=>{const c=Ca((()=>({register:t,control:n,getValues:s,setValue:a,handleSubmit:r,reset:o})),[t,n,a,s,r,o]);return l.jsx(e.Provider,{value:c,children:i})},useCustomFormContext:()=>{const t=Na(e);if(!t)throw new Error("useCustomFormContext must be used within a CustomFormProvider");return t}}}(),wk=wa({bookmarks:[]}),Nk=()=>Na(wk),kk=wa({}),Ck=()=>Na(kk),Sk=wa({}),Tk=()=>Na(Sk),Ek=wa({}),Ik=()=>Na(Ek),Rk={announceAssertive:()=>console.warn("Announcement failed, LiveAnnouncer context is missing"),announcePolite:()=>console.warn("Announcement failed, LiveAnnouncer context is missing")},Ak=_a.createContext(Rk),Pk=()=>_a.useContext(Ak),Ok=wa({});function Lk({children:e}){const t=ba(0),n=ka((e=>{if(e)return t.current;const n=t.current;return t.current+=1,n}),[]),a=ka((()=>{t.current=0}),[]);return l.jsx(Ok.Provider,{value:{getNextIndex:n,resetCounter:a},children:e})}const Mk=wa({});function Dk({children:e}){const t=ba(0),n=ka((e=>{if(e)return t.current;const n=t.current;return t.current+=1,n}),[]),a=ka((()=>{t.current=0}),[]);return l.jsx(Mk.Provider,{value:{getNextIndex:n,resetCounter:a},children:e})}const Fk=wa({});function Uk({children:e,conversationId:t}){const n=function({conversationId:e}){const{data:t=null}=ib({conversationId:e},{select:e=>function(e=[]){return e.reduce(((e,t)=>{const n=`${t.messageId}_${t.partIndex??0}_${t.blockIndex??0}_${t.toolId}`,a=e[n]??[];return a.push(t),e[n]=a,e}),{})}(e)}),n=Ca((()=>null!==t?t:void 0),[t]);return cx.log("tools","tool calls map:",n),n}({conversationId:t});return l.jsx(Fk.Provider,{value:n,children:e})}const zk=wa({}),Vk=()=>Na(zk),$k=wa(void 0);function Bk(){const e=Na($k);if(void 0===e)throw new Error("useBadgeRowContext must be used within a BadgeRowProvider");return e}function Hk({children:e,isSubmitting:t,conversationId:n}){const a=ba(""),s=ba(!1),{agentsConfig:r}=ZN(),o=n??Bm.NEW_CONVO,i=y(__(o));ya((()=>{if(!(t||s.current&&a.current===o)){s.current=!0,a.current=o;const t=`${Hm.LAST_CODE_TOGGLE_}${o}`,n=`${Hm.LAST_WEB_SEARCH_TOGGLE_}${o}`,r=`${Hm.LAST_FILE_SEARCH_TOGGLE_}${o}`,l=`${Hm.LAST_ARTIFACTS_TOGGLE_}${o}`,c=qf(t),d=qf(n),u=qf(r),m=qf(l),p={};if(null!==c)try{p[Nl.execute_code]=JSON.parse(c)}catch(e){console.error("Failed to parse code toggle value:",e)}if(null!==d)try{p[Nl.web_search]=JSON.parse(d)}catch(e){console.error("Failed to parse web search toggle value:",e)}if(null!==u)try{p[Nl.file_search]=JSON.parse(u)}catch(e){console.error("Failed to parse file search toggle value:",e)}if(null!==m)try{p[Au.artifacts]=JSON.parse(m)}catch(e){console.error("Failed to parse artifacts toggle value:",e)}const h={[Nl.execute_code]:p[Nl.execute_code]??!1,[Nl.web_search]:p[Nl.web_search]??!1,[Nl.file_search]:p[Nl.file_search]??!1,[Au.artifacts]:p[Au.artifacts]??!1};i((e=>({...e||{},...h}))),Object.entries(h).forEach((([e,a])=>{if(!1!==a){let s=l;e===Nl.execute_code?s=t:e===Nl.web_search?s=n:e===Nl.file_search&&(s=r),localStorage.setItem(s,JSON.stringify(a)),Wf(s)}}))}}),[o,t,i]);const c=wS({}),{setIsDialogOpen:d}=c,u=yS({conversationId:n,setIsDialogOpen:d,toolKey:Nl.execute_code,localStorageKey:Hm.LAST_CODE_TOGGLE_,authConfig:{toolId:Nl.execute_code,queryOptions:{retry:1}}}),m=kS({}),{setIsDialogOpen:p}=m,h=yS({conversationId:n,toolKey:Nl.web_search,localStorageKey:Hm.LAST_WEB_SEARCH_TOGGLE_,setIsDialogOpen:p,authConfig:{toolId:Nl.web_search,queryOptions:{retry:1}}}),g=yS({conversationId:n,toolKey:Nl.file_search,localStorageKey:Hm.LAST_FILE_SEARCH_TOGGLE_,isAuthenticated:!0}),x={webSearch:h,artifacts:yS({conversationId:n,toolKey:Au.artifacts,localStorageKey:Hm.LAST_ARTIFACTS_TOGGLE_,isAuthenticated:!0}),fileSearch:g,agentsConfig:r,conversationId:n,codeApiKeyForm:c,codeInterpreter:u,searchApiKeyForm:m,mcpServerManager:aS({conversationId:n})};return l.jsx($k.Provider,{value:x,children:e})}const Gk=wa(void 0);function Kk({children:e}){const{conversation:t}=$N(),n=Ca((()=>({endpoint:null==t?void 0:t.endpoint})),[null==t?void 0:t.endpoint]);return l.jsx(Gk.Provider,{value:n,children:e})}const Wk=wa(void 0);function qk({children:e}){const{conversation:t}=$N(),{data:n}=G_(),a=Ca((()=>Zm(n,null==t?void 0:t.endpoint,"type")||(null==t?void 0:t.endpoint)),[null==t?void 0:t.endpoint,n]),s=Ca((()=>({conversationId:null==t?void 0:t.conversationId,agentId:null==t?void 0:t.agent_id,endpoint:null==t?void 0:t.endpoint,endpointType:a})),[null==t?void 0:t.conversationId,null==t?void 0:t.agent_id,null==t?void 0:t.endpoint,a]);return l.jsx(Wk.Provider,{value:s,children:e})}const Qk=wa(void 0);function Yk({children:e,value:t}){const{isSubmitting:n,latestMessage:a,conversation:s}=$N(),r=Ca((()=>lf({messageId:(null==a?void 0:a.messageId)??null,text:(null==a?void 0:a.text)??null,content:(null==a?void 0:a.content)??null})),[null==a?void 0:a.messageId,null==a?void 0:a.text,null==a?void 0:a.content]),o=Ca((()=>({isSubmitting:n,latestMessageText:r,latestMessageId:(null==a?void 0:a.messageId)??null,conversationId:(null==s?void 0:s.conversationId)??null})),[n,r,null==a?void 0:a.messageId,null==s?void 0:s.conversationId]),i=Ca((()=>t?{...o,...t}:o),[o,t]);return l.jsx(Qk.Provider,{value:i,children:e})}function Xk(){const e=Na(Qk);if(!e)throw new Error("useArtifactsContext must be used within ArtifactsProvider");return e}const Jk={misc:L,roleplay:V,write:z,idea:U,shop:F,finance:R,code:A,travel:D,teach_or_explain:M,general:L,hr:O,rd:P,it:A,sales:R,aftersales:I},Zk={code:"text-red-500",misc:"text-blue-300",shop:"text-purple-400",idea:"text-yellow-500/90 dark:text-yellow-300 ",write:"text-purple-400",travel:"text-yellow-500/90 dark:text-yellow-300 ",finance:"text-orange-400",roleplay:"text-orange-400",teach_or_explain:"text-blue-300",general:"text-blue-500",hr:"text-green-500",rd:"text-purple-500",it:"text-red-500",sales:"text-orange-500",aftersales:"text-yellow-500"};function eC({category:e,className:t=""}){const n=Jk[e],a=Zk[e]+" "+t;return n?l.jsx(n,{className:Qf(a,t),"aria-hidden":"true"}):null}const tC=wa(null),nC=({children:e})=>{const t=ak({permissionType:Pp.PROMPTS,permission:Op.USE}),n=function(e=!0){var t,n,a;const[s]=b(N_.promptsPageSize),[r]=b(N_.promptsCategory),[o,i]=b(N_.promptsName),[l,c]=ja(0),d=ba([null]),u=ba({name:o,category:r}),m=((e,t)=>{const{name:n,pageSize:a,category:s}=e||{};return vs([Fh.promptGroups,n,s,a],(({pageParam:e})=>{const t={name:n,category:s||"",limit:(a||10).toString()};return e&&"string"==typeof e&&(t.cursor=e),Jh.getPromptGroups(t)}),{getNextPageParam:e=>e.has_more&&e.after?e.after:void 0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})({name:o,pageSize:s,category:r},{enabled:e}),p=Ca((()=>{var t;if(!e||!(null==(t=m.data)?void 0:t.pages)||0===m.data.pages.length)return null;const n=Math.min(l,m.data.pages.length-1);return m.data.pages[n]}),[e,null==(t=m.data)?void 0:t.pages,l]),h=Ca((()=>(null==p?void 0:p.promptGroups)||[]),[p]),g=Ca((()=>{var e,t;return!!p&&(l<((null==(t=null==(e=m.data)?void 0:e.pages)?void 0:t.length)||0)-1||(p.has_more||!1))}),[p,l,null==(a=null==(n=m.data)?void 0:n.pages)?void 0:a.length]),x=l>0,f=l+1,v=g?f+1:f,_=ka((async()=>{var t,n,a;if(!e||!g)return;const s=l+1;if(s>=((null==(n=null==(t=m.data)?void 0:t.pages)?void 0:n.length)||0)){const e=await m.fetchNextPage();if(e.isSuccess&&(null==(a=e.data)?void 0:a.pages)){const t=e.data.pages[e.data.pages.length-2];(null==t?void 0:t.after)&&!d.current.includes(t.after)&&d.current.push(t.after)}}c(s)}),[e,l,g,m]),y=ka((()=>{e&&x&&c(l-1)}),[e,l,x]);return ya((()=>{if(!e)return;(u.current.name!==o||u.current.category!==r)&&(c(0),d.current=[null],u.current={name:o,category:r})}),[e,o,r]),{promptGroups:e?h:[],groupsQuery:m,currentPage:f,totalPages:v,hasNextPage:e&&g,hasPreviousPage:e&&x,nextPage:_,prevPage:y,isFetching:!!e&&m.isFetching,name:o,setName:i}}(t),{data:a,isLoading:s}=(r={enabled:t,select:e=>{const t=e.map((e=>{var t,n;return{id:e._id??"",type:"prompt",value:e.command??e.name,label:`${null!=e.command&&e.command?`/${e.command} - `:""}${e.name}: ${((null==(t=e.oneliner)?void 0:t.length)??0)>0?e.oneliner:(null==(n=e.productionPrompt)?void 0:n.prompt)??""}`,icon:l.jsx(eC,{category:e.category??"",className:"h-5 w-5"})}}));return{promptsMap:e.reduce(((e,t)=>t._id?(e[t._id]=t,e):e),{}),promptGroups:t}}},gs([Fh.allPromptGroups],(()=>Jh.getAllPromptGroups()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...r}));var r;const o=Ca((()=>({...n,allPromptGroups:{data:t?a:void 0,isLoading:!!t&&s},hasAccess:t})),[n,a,s,t]);return l.jsx(tC.Provider,{value:o,children:e})},aC=()=>{const e=Na(tC);if(!e)throw new Error("usePromptGroupsContext must be used within a PromptGroupsProvider");return e},sC=wa(void 0);function rC({children:e}){const t=$N(),n=gk(),{ask:a,index:s,regenerate:r,isSubmitting:o,conversation:i,latestMessage:c,setAbortScroll:d,handleContinue:u,setLatestMessage:m,abortScroll:p,getMessages:h,setMessages:g}=t,{isSubmitting:x}=n,f=Ca((()=>({conversation:i,conversationId:null==i?void 0:i.conversationId})),[i]),v=Ca((()=>({isSubmitting:o,isSubmittingFamily:o||x,abortScroll:p,setAbortScroll:d})),[o,x,p,d]),_=Ca((()=>({ask:a,regenerate:r,getMessages:h,setMessages:g,handleContinue:u})),[a,r,u,h,g]),b=Ca((()=>({index:s,latestMessage:c,setLatestMessage:m})),[s,c,m]),y=Ca((()=>({...f,...v,..._,...b})),[f,v,_,b]);return l.jsx(sC.Provider,{value:y,children:e})}function oC(){const e=Na(sC);if(!e)throw new Error("useMessagesViewContext must be used within MessagesViewProvider");return e}function iC(){const{conversation:e,conversationId:t}=oC();return Ca((()=>({conversation:e,conversationId:t})),[e,t])}function lC(){const{ask:e,regenerate:t,handleContinue:n,getMessages:a,setMessages:s}=oC();return Ca((()=>({ask:e,regenerate:t,handleContinue:n,getMessages:a,setMessages:s})),[e,t,n,a,s])}function cC(e,t){const n=WN(),a=Ca((()=>null!=e&&""!==e?null==n?void 0:n[e]:void 0),[e,n]),{data:s}=A_(e),r=Ca((()=>(null==s?void 0:s.tools)||(null==a?void 0:a.tools)),[null==s?void 0:s.tools,null==a?void 0:a.tools]),o=Ca((()=>(null==s?void 0:s.provider)||(null==a?void 0:a.provider)),[null==s?void 0:s.provider,null==a?void 0:a.provider]);return{fileSearchAllowedByAgent:Ca((()=>Zg(e)?(null==t?void 0:t[kl.file_search])??!1:!!a&&((null==r?void 0:r.includes(Nl.file_search))??!1)),[e,a,r,t]),codeAllowedByAgent:Ca((()=>Zg(e)?(null==t?void 0:t[kl.execute_code])??!1:!!a&&((null==r?void 0:r.includes(Nl.execute_code))??!1)),[e,a,r,t]),provider:o,tools:r}}function dC(){const e=_((({set:e})=>(t,n)=>{e(__(t),n)}),[]),t=ka((({convoId:t,specName:n,startupConfig:a})=>{if(null==n||!n)return;!function({convoId:e,modelSpec:t,updateEphemeralAgent:n}){t&&n&&n((e??Bm.NEW_CONVO)||Bm.NEW_CONVO,{mcp:t.mcpServers??[Bm.mcp_clear],web_search:t.webSearch??!1,file_search:t.fileSearch??!1,execute_code:t.executeCode??!1})}({convoId:t,modelSpec:jf({specName:n,startupConfig:a}),updateEphemeralAgent:e})}),[e]);return t}function uC(){const e=_((({snapshot:e,set:t})=>async(n,a=Bm.NEW_CONVO,s)=>{const r=a||Bm.NEW_CONVO;if(cx.log("agents",`Attempting to apply template from "${r}" to "${n}"`),n!==r)try{const a=s??await e.getPromise(__(r));a?(cx.log("agents",`Applying agent template to "${n}":`,a),t(__(n),a)):(cx.warn("agents",`Agent template from "${r}" is null or unset. Setting agent for "${n}" to null.`),t(__(n),null))}catch(o){cx.error("agents",`Error applying agent template from "${r}" to "${n}":`,o),t(__(n),null)}else cx.warn("agents",`Attempted to apply template to itself ("${r}"). Skipping.`)}),[]);return ka((({targetId:t,sourceId:n,ephemeralAgent:a,specName:s,startupConfig:r})=>{if(!s)return void e(t,n,a);const o=jf({specName:s,startupConfig:r});if(!o)return void e(t,n,a);const i={...a,mcp:[...(null==a?void 0:a.mcp)??[],...o.mcpServers??[]],web_search:(null==a?void 0:a.web_search)??o.webSearch??!1,file_search:(null==a?void 0:a.file_search)??o.fileSearch??!1,execute_code:(null==a?void 0:a.execute_code)??o.executeCode??!1};i.mcp=[...new Set(i.mcp)],e(t,n,i)}),[e])}function mC(){return e=>localStorage.setItem(Hm.FILES_TO_DELETE,JSON.stringify(e))}function pC(){const{data:e={}}=G_();return ka((t=>{const{modelDisplayLabel:n}=(null==e?void 0:e[t.endpoint??""])??{};return dp({...t,modelDisplayLabel:n})}),[e])}const hC=e=>{const{data:t}=G_(),n=null==t?void 0:t[e??""],{azure:a}=n??{};let s=e;a&&(s=Yl.azureOpenAI);const r=vN(),o=kN(s),i=ka((()=>{if(o.data)return o.data.expiresAt||"never"}),[o.data]),l=ka((()=>{const e=i();if(!e)return!0;return!(new Date(e)<new Date)}),[i]),c=ka(((e,t)=>{const n=t?new Date(t).toISOString():"";r.mutate({name:s,value:e,expiresAt:n})}),[r,s]);return Ca((()=>({getExpiry:i,checkExpiry:l,saveUserKey:c})),[i,l,c])},gC=e=>{cx.log("=====================================\nAsk function called with:"),cx.dir(e),cx.log("=====================================")};function xC({index:e=0,files:t,setFiles:n,getMessages:a,setMessages:s,isSubmitting:r,latestMessage:o,setSubmission:i,setLatestMessage:l,conversation:c}){const d=E(),u=pC(),{user:m}=nk(),p=xs(),h=mC(),g=_((({snapshot:e})=>t=>(cx.log("agents",`[useGetEphemeralAgent] Getting loadable for ID: ${t}`),e.getLoadable(__(t)).contents)),[]),x=j(N_.isTemporary),{getExpiry:f}=hC((null==c?void 0:c.endpoint)??""),v=y(N_.showStopButtonByIndex(e)),b=S(N_.latestMessageFamily(e+1)),w=({text:_,overrideConvoId:y,overrideUserMessageId:j,parentMessageId:w=null,conversationId:N=null,messageId:k=null},{editedContent:C=null,editedMessageId:S=null,isRegenerate:T=!1,isContinued:E=!1,isEdited:I=!1,overrideMessages:R,overrideFiles:A}={})=>{var P;if(v(!1),b(),r||""===_)return;const O=vi.cloneDeep(c),L=null==O?void 0:O.endpoint;if(null===L)return void console.error("No endpoint available");if("search"==(N=N??(null==O?void 0:O.conversationId)??null))return void console.error("cannot send any message under search view!");if(E&&!o)return void console.error("cannot continue AI message without latestMessage!");const M=g(N??Bm.NEW_CONVO),D=I||E;let F=R??a()??[];(null==O?void 0:O.promptPrefix)&&(O.promptPrefix=hp({text:O.promptPrefix,user:m})),_=_.trim();const U=j??$();w=w??(null==o?void 0:o.messageId)??Bm.NO_PARENT,gC({index:e,conversation:O,latestMessage:o,conversationId:N,intermediateId:U,parentMessageId:w,currentMessages:F}),N==Bm.NEW_CONVO&&(w=Bm.NO_PARENT,F=[],N=null,d("/c/new",{state:{focusChat:!0}}));const z=T?k:null==o?void 0:o.parentMessageId,V=F.find((e=>e.messageId===z));let B=(null==V?void 0:V.thread_id)??(null==o?void 0:o.thread_id);null==B&&(B=null==(P=F.find((e=>e.thread_id)))?void 0:P.thread_id);const H=p.getQueryData([Fh.endpoints]),G=Zm(H,L,"type"),K=null==O?void 0:O.iconURL,W=mp({endpoint:L,endpointType:G,conversation:O??{}}),{modelDisplayLabel:q}=(null==H?void 0:H[L??""])??{},Q=Object.assign({endpoint:L,endpointType:G,overrideConvoId:y,overrideUserMessageId:j},W);L!==Yl.agents?(Q.key=f(),Q.thread_id=B,Q.modelDisplayLabel=q):Q.key=new Date(Date.now()+36e5).toISOString();const Y=u({model:null==O?void 0:O.model,...Q}),X={text:_,sender:"User",clientTimestamp:(new Date).toLocaleString("sv").replace(" ","T"),isCreatedByUser:!0,parentMessageId:w,conversationId:N,messageId:E&&null!=k&&k?k:U,thread_id:B,error:!1},J=A??(null==V?void 0:V.files),Z=(T||null!=A&&A.length)&&J&&J.length>0;n&&!0===Z?(X.files=[...J],n(new Map),h({})):n&&t&&t.size>0&&(X.files=Array.from(t.values()).map((e=>({file_id:e.file_id,filepath:e.filepath,type:e.type??"",height:e.height,width:e.width}))),n(new Map),h({}));const ee=S??((null==o?void 0:o.messageId)&&T?o.messageId.replace(/_+$/,"")+"_":null)??null,te={sender:Y,text:"",endpoint:L??"",parentMessageId:T?k:U,messageId:ee??`${T?k:U}`.replace(/_+$/,"")+"_",thread_id:B,conversationId:N,unfinished:!1,isCreatedByUser:!1,model:null==W?void 0:W.model,error:!1,iconURL:K};if(lc(L))te.model=(null==O?void 0:O.assistant_id)??"",te.text="",te.content=[{type:qm.TEXT,[qm.TEXT]:{value:""}}];else if(null!=L){if(te.model=cc(L)?(null==O?void 0:O.agent_id)??"":(null==O?void 0:O.model)??"",te.text="",C&&(null==o?void 0:o.content)){te.content=vi.cloneDeep(o.content);const{index:e,type:t,...n}=C;if(te.content&&e>=0&&e<te.content.length){const a=te.content[e];t===qm.THINK&&a.type===qm.THINK?a[qm.THINK]=n[qm.THINK]:t===qm.TEXT&&a.type===qm.TEXT&&(a[qm.TEXT]=n[qm.TEXT])}}else te.content=[{type:qm.TEXT,[qm.TEXT]:{value:""}}];v(!0)}E&&(F=F.filter((e=>e.messageId!==ee))),cx.log("message_state",te);const ne={conversation:{...O,conversationId:N},endpointOption:Q,userMessage:{...X,responseMessageId:ee,overrideParentMessageId:T?k:null},messages:F,isEdited:D,isContinued:E,isRegenerate:T,initialResponse:te,isTemporary:x,ephemeralAgent:M,editedContent:C};s(T?[...ne.messages,te]:[...ne.messages,X,te]),0===e&&l&&l(te),i(ne),cx.dir("message_stream",ne,{depth:null})};return{ask:w,regenerate:({parentMessageId:e})=>{const t=a(),n=null==t?void 0:t.find((t=>t.messageId==e));n&&n.isCreatedByUser?w({...n},{isRegenerate:!0}):console.error("Failed to regenerate the message: parentMessage not found or not created by user.")}}}const fC=[];function vC(){const e=qN(),t=j(N_.chatBadges),n=Ca((()=>new Set(t.map((e=>e.id)))),[t]);return Ca((()=>fC.map((t=>({id:t.id,label:e(t.label),icon:t.icon,atom:t.atom,isAvailable:n.has(t.id)})))||[]),[n,e])}const _C=(e=0)=>{const t=E(),[n]=Da(),{data:a}=K_(),s=dC(),r=N_.useClearConvoState(),o=j(N_.defaultPreset),{setConversation:i}=N_.useCreateConversationAtom(e),[l,c]=b(N_.filesByIndex(e)),d=j(N_.saveBadgesState),u=N_.useClearLatestMessages(`useNewConvo ${e}`),m=y(N_.submissionByIndex(e)),{data:p={}}=G_(),h=ak({permissionType:Pp.AGENTS,permission:Op.USE}),g=jN(),x=HN(),{pauseGlobalAudio:f}=k_(e),v=j(N_.saveDrafts),w=_((({reset:e})=>()=>{fC.forEach((({atom:t})=>e(t))),e(N_.chatBadges)}),[]),{mutateAsync:N}=W_({onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),k=_((()=>async(a,s=null,l,c,d,f,v,_)=>{var b,y,j;const w=l??g.data,{endpoint:N=null}=a,k=(null===N||c)??!1,C=!o||s||o.endpoint!==N&&N||!k?s:o,S=_??(null!=(null==C?void 0:C.presetId)&&C.presetId&&C.presetId===(null==o?void 0:o.presetId));if(k){let t=ev({convoSetup:C??a,endpointsConfig:p});const{lastConversationSetup:n}=Af(),s=cc(null==n?void 0:n.endpoint)&&(null==n?void 0:n.agent_id),r=cc(t)&&(a.agent_id&&a.agent_id!==Bm.EPHEMERAL_AGENT_ID||s&&s!==Bm.EPHEMERAL_AGENT_ID);t&&cc(t)&&!h&&!r&&(t=Object.keys(p??{}).find((e=>!cc(e)&&(null==p?void 0:p[e])))),t||(t=Object.keys(p??{}).find((e=>!(cc(e)&&!h&&!r)&&!!(null==p?void 0:p[e]))));const o=Zm(p,t,"type");!a.endpointType&&o?a.endpointType=o:a.endpointType&&!o&&(a.endpointType=void 0);const i=lc(t),l=x[t]??[],c=a.assistant_id??"",d=null==(b=x[t])?void 0:b[c];if(c&&!d&&(a.assistant_id=void 0),!c&&i&&(a.assistant_id=localStorage.getItem(`${Hm.ASST_ID_PREFIX}${e}${t}`)??(null==(y=l[0])?void 0:y.id)),c&&i&&a.conversationId===Bm.NEW_CONVO){const e=l.find((e=>e.id===c));a.model=null==e?void 0:e.model,function({endpoint:e,model:t=""}){if(!t)return;const n=JSON.parse((localStorage.getItem(bf)??"{}")||"{}");n.endpoint===e&&(n.model=t,localStorage.setItem(bf,JSON.stringify(n)));const a=JSON.parse((localStorage.getItem(Hm.LAST_MODEL)??"{}")||"{}");a[e]=t,localStorage.setItem(Hm.LAST_MODEL,JSON.stringify(a))}({endpoint:t,model:a.model})}c&&!i&&(a.assistant_id=void 0);const u=(null==w?void 0:w[t])??[];a=Zf({conversation:a,lastConversationSetup:C,endpoint:t,models:u})}!0===S&&(a.disableParams=!0),f||r(!0);const T=null==(j=a.conversationId)?void 0:j.startsWith("_");if(T?(cx.log("conversation","Cancelled conversation, setting to `new` in `useNewConvo`",a),i({...a,conversationId:Bm.NEW_CONVO})):(cx.log("conversation","Setting conversation from `useNewConvo`",a),i(a)),m({}),d||(cx.log("latest_message","Clearing all latest messages"),u()),T)return;const E=null==n?void 0:n.toString(),I=()=>E?`?${E}`:"";if(a.conversationId===Bm.NEW_CONVO&&!l){const e=localStorage.getItem(Hm.APP_TITLE)??"";e&&(document.title=e);const n=`/c/${Bm.NEW_CONVO}${I()}`;return void t(n,{state:{focusChat:!0}})}const R=`/c/${a.conversationId}${I()}`;t(R,{replace:!0,state:v?{}:{focusChat:!0}})}),[p,o,x,g.data]),C=ka((function({template:e={},preset:t,modelsData:n,disableFocus:r,buildDefault:o=!0,keepLatestMessage:i=!1,keepAddedConvos:u=!1,disableParams:m}={}){var p,h;f(),d||w();const g=e.conversationId??"",x=!0===(!0===dc(e.endpoint??"",e.endpointType??"")||dc((null==t?void 0:t.endpoint)??"",(null==t?void 0:t.endpointType)??""))&&g&&g===Bm.NEW_CONVO?{endpoint:e.endpoint}:e,_={conversationId:Bm.NEW_CONVO,title:"New Chat",endpoint:null,...x,createdAt:"",updatedAt:""};let b=t;const y=wf(a),j=(null==y?void 0:y.default)??(null==y?void 0:y.last);if(!b&&a&&(!0===(null==(p=a.modelSpecs)?void 0:p.prioritize)||!0!==((null==(h=a.interface)?void 0:h.modelSelect)??!0)||null!=(null==y?void 0:y.last)&&0===Object.keys(e).length)&&j&&(b=Nf(j)),s({startupConfig:a,specName:null==b?void 0:b.spec,convoId:_.conversationId}),_.conversationId===Bm.NEW_CONVO&&!n){const e=Array.from(l.values()).filter((e=>null!=e.filepath&&""!==e.filepath&&e.source&&!e.embedded&&e.temp_file_id)).map((e=>({file_id:e.file_id,embedded:!!e.embedded,filepath:e.filepath,source:e.source})));c(new Map),localStorage.setItem(Hm.FILES_TO_DELETE,JSON.stringify({})),!v&&e.length>0&&N({files:e})}k(_,b,n,o,i,u,r,m)}),[l,c,v,N,w,a,d,f,k,s]);return{switchToConversation:k,newConversation:C}};function bC(e=0,t){const n=N_.useClearSubmissionState(),[a,s]=b(N_.filesByIndex(e)),[r,o]=ja(!1),i=xs(),{isAuthenticated:l}=nk(),{newConversation:c}=_C(e),{useCreateConversationAtom:d}=N_,{conversation:u,setConversation:m}=d(e),{conversationId:p}=u??{},h="new"===t?t:p??t??"",{data:g}=ab(p??"",{enabled:l}),x=S(N_.latestMessageFamily(e)),[f,v]=b(N_.isSubmittingFamily(e)),[_,j]=b(N_.latestMessageFamily(e)),w=y(N_.messagesSiblingIdxFamily((null==_?void 0:_.parentMessageId)??null)),N=ka((e=>{i.setQueryData([Fh.messages,h],e),"new"===h&&p&&"new"!==p&&i.setQueryData([Fh.messages,p],e)}),[h,i,p]),k=ka((()=>i.getQueryData([Fh.messages,h])),[h,i]),C=y(N_.submissionByIndex(e)),{ask:T,regenerate:E}=xC({index:e,files:a,setFiles:s,getMessages:k,setMessages:N,isSubmitting:f,conversation:u,latestMessage:_,setSubmission:C,setLatestMessage:j}),I=()=>n(),[R,A]=b(N_.presetByIndex(e)),[P,O]=b(N_.showPopoverFamily(e)),[L,M]=b(N_.abortScrollFamily(e)),[D,F]=b(N_.optionSettingsFamily(e));return{newConversation:c,conversation:u,setConversation:m,isSubmitting:f,setIsSubmitting:v,getMessages:k,setMessages:N,setSiblingIdx:w,latestMessage:_,setLatestMessage:j,resetLatestMessage:x,ask:T,index:e,regenerate:E,stopGenerating:I,handleStopGenerating:e=>{e.preventDefault(),I()},handleRegenerate:e=>{e.preventDefault();const t=(null==_?void 0:_.parentMessageId)??"";t?E({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleContinue:e=>{e.preventDefault(),(()=>{if(!_)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=k(),t=null==e?void 0:e.find((e=>e.messageId==_.parentMessageId));t&&t.isCreatedByUser?T({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),w(0)},showPopover:P,setShowPopover:O,abortScroll:L,setAbortScroll:M,preset:R,setPreset:A,optionSettings:D,setOptionSettings:F,files:a,setFiles:s,filesLoading:r,setFilesLoading:o}}function yC({rootIndex:e=0,currentIndex:t,paramId:n}){const a=xs(),s=N_.useClearSubmissionState(),[r,o]=b(N_.filesByIndex(e)),i=j(N_.latestMessageFamily(e)),l=y(N_.latestMessageFamily(t)),{useCreateConversationAtom:c}=N_,{conversation:d,setConversation:u}=c(t),[m,p]=b(N_.isSubmittingFamily(t)),h=y(N_.messagesSiblingIdxFamily((null==i?void 0:i.parentMessageId)??null)),g="new"===n?n:(null==d?void 0:d.conversationId)??n??"",x=ka((e=>{a.setQueryData([Fh.messages,g,t],e);const n=e[e.length-1];n&&l({...n,depth:-1})}),[g,a,t,l]),f=ka((()=>a.getQueryData([Fh.messages,g,t])),[g,a,t]),v=y(N_.submissionByIndex(t)),{ask:_,regenerate:w}=xC({index:t,files:r,setFiles:o,getMessages:f,setMessages:x,isSubmitting:m,conversation:d,setSubmission:v,latestMessage:i}),N=()=>s();return{ask:_,regenerate:w,getMessages:f,setMessages:x,conversation:d,isSubmitting:m,setSiblingIdx:h,latestMessage:i,stopGenerating:N,handleContinue:e=>{e.preventDefault(),(()=>{if(!i)return void console.error("Failed to regenerate the message: latestMessage not found.");const e=f(),t=null==e?void 0:e.find((e=>e.messageId==i.parentMessageId));t&&t.isCreatedByUser?_({...t},{isContinued:!0,isRegenerate:!0,isEdited:!0}):console.error("Failed to regenerate the message: parentMessage not found, or not created by user.")})(),h(0)},setConversation:u,setIsSubmitting:p,handleRegenerate:e=>{e.preventDefault();const t=null==i?void 0:i.parentMessageId;t?w({parentMessageId:t}):console.error("Failed to regenerate the message: parentMessageId not found.")},handleStopGenerating:e=>{e.preventDefault(),N()}}}const jC=({index:e=0,rootIndex:t,setConversation:n})=>{const a=jN(),s=HN(),{data:r={}}=G_(),o=ba(),i=j(N_.conversationByKeySelector(t));ya((()=>{null!=(null==i?void 0:i.conversationId)&&n&&n((e=>{if(!e)return e;const t={...e,conversationId:i.conversationId};return cx.log("conversation","Setting conversation from `useNewConvo`",t),t}))}),[null==i?void 0:i.conversationId,n]);return{generateConversation:ka((({template:t={},preset:l,modelsData:c}={})=>{var d,u;let m={conversationId:"new",title:"New Chat",endpoint:null,...t,createdAt:"",updatedAt:""};(null==i?void 0:i.conversationId)&&(m.conversationId=i.conversationId);const p=c??a.data,h=ev({convoSetup:l??m,endpointsConfig:r}),g=Zm(r,h,"type");!m.endpointType&&g?m.endpointType=g:m.endpointType&&!g&&(m.endpointType=void 0);const x=lc(h),f=s[h??""]??[];if(m.assistant_id&&!(null==(d=s[h??""])?void 0:d[m.assistant_id])&&(m.assistant_id=void 0),!m.assistant_id&&x&&(m.assistant_id=localStorage.getItem(`${Hm.ASST_ID_PREFIX}${e}${h}`)??(null==(u=f[0])?void 0:u.id)),null!=m.assistant_id&&x&&"new"===m.conversationId){const e=f.find((e=>e.id===m.assistant_id));m.model=null==e?void 0:e.model}null==m.assistant_id||x||(m.assistant_id=void 0);const v=(null==p?void 0:p[h??""])??[];return m=Zf({conversation:m,lastConversationSetup:l,endpoint:h??"",models:v}),null!=(null==l?void 0:l.title)&&""!==l.title&&(m.title=l.title),n&&n(m),clearTimeout(o.current),o.current=setTimeout((()=>{const e=document.getElementById(nx);e&&e.focus()}),150),m}),[s,r,e,a.data,i,n])}};function wC({startupConfig:e,user:t}){var n;const[a,s]=b(N_.defaultPreset);!function(e){const{data:t}=RN({enabled:e}),n=ba({conversationMode:y(N_.conversationMode),advancedMode:y(N_.advancedMode),speechToText:y(N_.speechToText),textToSpeech:y(N_.textToSpeech),cacheTTS:y(N_.cacheTTS),engineSTT:y(N_.engineSTT),languageSTT:y(N_.languageSTT),autoTranscribeAudio:y(N_.autoTranscribeAudio),decibelValue:y(N_.decibelValue),autoSendText:y(N_.autoSendText),engineTTS:y(N_.engineTTS),voice:y(N_.voice),cloudBrowserVoices:y(N_.cloudBrowserVoices),languageTTS:y(N_.languageTTS),automaticPlayback:y(N_.automaticPlayback),playbackRate:y(N_.playbackRate)}).current;ya((()=>{e&&t&&"not_found"!==t.message&&(cx.log("Initializing speech settings from config:",t),Object.entries(t).forEach((([e,t])=>{if("sttExternal"===e||"ttsExternal"===e)return;if(null!==localStorage.getItem(e))return;const a=n[e];a&&(cx.log(`Setting default speech setting: ${e} = ${t}`),a(t))})))}),[e,t,n])}(!!t);const{data:r,isLoading:o}=$b();Bb({enabled:!o&&!!r&&Object.keys(r).length>0&&!!t}),ya((()=>{!function(){try{const e=[],t=Date.now();for(let n=0;n<localStorage.length;n++){const a=localStorage.key(n);if(a&&(a!==Hm.PIN_MCP_&&Kf.some((e=>a.startsWith(e)&&!a.includes("pinned")))&&!a.endsWith(Hf))){const n=`${a}${Hf}`,s=localStorage.getItem(n);if(!s){e.push(a);continue}t-parseInt(s,10)>Gf&&(e.push(a),e.push(n))}}e.forEach((e=>localStorage.removeItem(e))),e.length>0&&console.log(`Cleaned up ${e.length} old localStorage entries`)}catch(e){console.error("Error during cleanup of timestamped storage:",e)}}()}),[]),ya((()=>{const t=(null==e?void 0:e.appTitle)??"";t&&(document.title=t,localStorage.setItem(Hm.APP_TITLE,t))}),[e]),ya((()=>{var t;if(a&&null!=a.spec)return;const n=null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list;if(!n||!n.length)return;const r=n.find((e=>e.default));r&&s({...r.preset,iconURL:r.iconURL,spec:r.name})}),[a,s,null==(n=null==e?void 0:e.modelSpecs)?void 0:n.list]),ya((()=>{if(null!=(null==e?void 0:e.analyticsGtmId)&&void 0===window.google_tag_manager){const t={gtmId:e.analyticsGtmId};B.initialize(t)}}),[null==e?void 0:e.analyticsGtmId])}function NC(){const e=qN(),t=ba(!1),n=xs(),{showToast:a}=Ds(),{user:s,isAuthenticated:r}=nk(),[o,i]=ja(!1),[l,c]=ja(null),d=j(N_.modularChat),u=j(N_.availableTools),m=y(N_.presetModalVisible),[p,h]=b(N_.defaultPreset),g=pb({enabled:!!s&&r}),{preset:x,conversation:f,index:v,setPreset:_}=$N(),{data:w}=jN(),{newConversation:N}=_C(v);ya((()=>{if(null==w?void 0:w.initial)return;const{data:e}=g;if(p||!e||t.current)return;if(e&&e.length>0&&s&&e[0].user!==s.id)return void g.refetch();const n=e.find((e=>e.defaultPreset));n?(h(n),(null==f?void 0:f.conversationId)&&"new"!==f.conversationId||N({preset:n,modelsData:w,disableParams:!0}),t.current=!0):t.current=!0}),[g.data,s,w]);const k=ka((e=>{n.setQueryData([Fh.presets],e)}),[n]),C=(S={onMutate:e=>{if(!e)return void k([]);const t=g.data??[];t&&k(t.filter((t=>t.presetId!==e.presetId)))},onSuccess:()=>{n.invalidateQueries([Fh.presets]),a({message:e("com_endpoint_preset_delete_success"),severity:lx.SUCCESS,showIcon:!0})},onError:t=>{n.invalidateQueries([Fh.presets]),console.error("Error deleting the preset:",t),a({message:e("com_endpoint_preset_delete_error"),severity:lx.ERROR,showIcon:!0})}},fs([$h.deletePreset],{mutationFn:e=>Jh.deletePreset(e),...S||{}}));var S;const T=wN(),E=(e=>fs([$h.updatePreset],{mutationFn:e=>Jh.updatePreset(e),...e||{}}))({onSuccess:(t,s)=>{const r=t.title?`"${t.title}"`:e("com_endpoint_preset_title");let o=`${r} ${e("com_ui_saved")}`;t.defaultPreset&&t.presetId!==(null==p?void 0:p.presetId)?(o=`${r} ${e("com_endpoint_preset_default")}`,h(t),N({preset:t,disableParams:!0})):!1===s.defaultPreset&&(h(null),o=`${r} ${e("com_endpoint_preset_default_removed")}`),a({message:o}),n.invalidateQueries([Fh.presets])},onError:t=>{console.error("Error updating the preset:",t),a({message:e("com_endpoint_preset_save_error"),severity:lx.ERROR})}}),I=zN();return{presetsQuery:g,onSetDefaultPreset:(e,t=!1)=>{E.mutate({...e,defaultPreset:!t})},onFileSelected:t=>{(t=>{T.mutate({...t},{onSuccess:()=>{a({message:e("com_endpoint_preset_import")}),n.invalidateQueries([Fh.presets])},onError:t=>{console.error("Error uploading the preset:",t),a({message:e("com_endpoint_preset_import_error"),severity:lx.ERROR})}})})({...Jf({preset:t}),presetId:null})},onSelectPreset:t=>{if(!t)return;const s=Zx(t,u),r=s.title?`"${s.title}"`:e("com_endpoint_preset_title");a({message:`${r} ${e("com_endpoint_preset_selected_title")}`,showIcon:!1,duration:750});const o=n.getQueryData([Fh.endpoints]),{shouldSwitch:i,isNewModular:l,newEndpointType:c,isCurrentModular:m,isExistingConversation:p}=yf({newEndpoint:s.endpoint??"",modularChat:d,conversation:f,endpointsConfig:o});s.spec=null,s.iconURL=s.iconURL??null,s.modelLabel=s.modelLabel??null;const h=m&&l&&i,g=!0===s.defaultPreset;if(p&&h){const e=I({conversation:{...f??{},spec:null,iconURL:null,modelLabel:null,endpointType:c},preset:{...s,endpointType:c},cleanInput:!0});N({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:g})}else N({preset:s,keepAddedConvos:h,disableParams:g})},onChangePreset:e=>{_(e),m(!0)},clearAllPresets:()=>C.mutate(void 0),onDeletePreset:e=>{c(e),i(!0)},submitPreset:()=>{x&&E.mutate(Jf({preset:x}))},exportPreset:()=>{if(!x)return;const e=H(x.title||"preset");G({data:Jf({preset:x}),fileName:e,exportType:G.types.json})},showDeleteDialog:o,setShowDeleteDialog:i,presetToDelete:l,confirmDeletePreset:()=>{l&&(C.mutate(l),i(!1),c(null))}}}function kC({setOption:e,setter:t,optionKey:n,initialValue:a,delay:s=ox}){const[r,o]=ja(a),i=Ca((()=>xi(e&&n?e(n):t||(()=>{}),s)),[e,n,t,s]);return[ka(((e,t)=>{let n="object"!=typeof e?e:e.target.value;!0===t&&void 0!==n&&""!==n&&(n=Number(n)),o(n),i(n)}),[i]),r,o]}const CC=(e=0)=>{const t=E(),n=xs(),a=N_.useClearConvoState(),s=dC(),r=y(N_.submissionByIndex(e)),o=N_.useClearLatestMessages(`useNavigateToConvo ${e}`),{hasSetConversation:i,setConversation:l}=N_.useCreateConversationAtom(e),c=ka((e=>{if(l(e),!e.spec)return;const t=n.getQueryData([Fh.startupConfig]);s({startupConfig:t,specName:null==e?void 0:e.spec,convoId:e.conversationId})}),[l,n,s]);return{navigateToConvo:(e,s)=>{if(!e)return void cx.warn("conversation","Conversation not provided to `navigateToConvo`");const{resetLatestMessage:l=!0,currentConvoId:d}=s||{};cx.log("conversation","Navigating to conversation",e),i.current=!0,r(null),l&&(cx.log("latest_message","Clearing all latest messages"),o());let u={...e};const m=n.getQueryData([Fh.endpoints]);if(!u.endpoint||!(null==m?void 0:m[u.endpoint])){const t=n.getQueryData([Fh.models]),a=ev({convoSetup:e,endpointsConfig:m}),s=Zm(m,a,"type");!e.endpointType&&s&&(e.endpointType=s);const r=(null==t?void 0:t[a??""])??[];u=Zf({models:r,conversation:e,endpoint:a,lastConversationSetup:e})}a(!0),mf(n,d),u.conversationId!==Bm.NEW_CONVO&&u.conversationId?(n.invalidateQueries([Fh.conversation,u.conversationId]),(async e=>{const a=null==e?void 0:e.conversationId;if(a)try{const e=await n.fetchQuery([Fh.conversation,a],(()=>Jh.getConversationById(a)));cx.log("conversation","Fetched fresh conversation data",e);const s={...e};xf(s),c(s),t(`/c/${a??Bm.NEW_CONVO}`,{state:{focusChat:!0}})}catch(s){console.error("Error fetching conversation data on navigation",s),e&&(c(e),t(`/c/${a}`,{state:{focusChat:!0}}))}})(u)):(c(u),t(`/c/${u.conversationId??Bm.NEW_CONVO}`,{state:{focusChat:!0}}))}}},SC=(e=!1)=>{const{conversation:t,setConversation:n}=$N(),a=(e=>{const{preset:t,setPreset:n}=$N();return!!e&&{setOption:e=>t=>{const a={};a[e]=t,n((e=>Jf({preset:{...e,...a}})))},setExample:(e,a,s=null)=>{var r;const o={},i=(null==(r=null==t?void 0:t.examples)?void 0:r.slice())||[],l={...i[e]};l[a]={content:s},i[e]=l,o.examples=i,n((e=>Jf({preset:{...e,...o}})))},addExample:()=>{var e;const a={},s=(null==(e=null==t?void 0:t.examples)?void 0:e.slice())||[];s.push({input:{content:""},output:{content:""}}),a.examples=s,n((e=>Jf({preset:{...e,...a}})))},setOptions:e=>{const t={...e};n((e=>Jf({preset:{...e,...t}})))},removeExample:()=>{var e;const a={},s=(null==(e=null==t?void 0:t.examples)?void 0:e.slice())||[];if(s.length<=1)return a.examples=[{input:{content:""},output:{content:""}}],void n((e=>Jf({preset:{...e,...a}})));s.pop(),a.examples=s,n((e=>Jf({preset:{...e,...a}})))},getConversation:()=>t}})(e);if(a&&"boolean"!=typeof a)return a;return{setOption:e=>a=>{const s={};if(s[e]=a,"presetOverride"===e){const e=(null==t?void 0:t.presetOverride)||{};s.presetOverride={...e,...a}}if("web_search"===e&&!0===a){const e=null==t?void 0:t.endpoint;if(e===Yl.openAI||e===Yl.azureOpenAI||e===Yl.custom){((null==t?void 0:t.useResponsesApi)??!1)||(s.useResponsesApi=!0)}}n((e=>Fc.parse({...e,...s})))},setExample:(e,a,s=null)=>{var r;const o={},i=(null==(r=null==t?void 0:t.examples)?void 0:r.slice())||[],l={...i[e]};l[a]={content:s},i[e]=l,o.examples=i,n((e=>Fc.parse({...e,...o})))},addExample:()=>{var e;const a={},s=(null==(e=null==t?void 0:t.examples)?void 0:e.slice())||[];s.push({input:{content:""},output:{content:""}}),a.examples=s,n((e=>Fc.parse({...e,...a})))},removeExample:()=>{var e;const a={},s=(null==(e=null==t?void 0:t.examples)?void 0:e.slice())||[];if(s.length<=1)return a.examples=[{input:{content:""},output:{content:""}}],void n((e=>Fc.parse({...e,...a})));s.pop(),a.examples=s,n((e=>Fc.parse({...e,...a})))}}};function TC({preset:e,settingKey:t,defaultValue:n,conversation:a,inputValue:s,setInputValue:r,preventDelayedUpdate:o=!1}){const i=ba(null),l=ba(null);ya((()=>{if(o)return;const e=setTimeout((()=>{(null==a?void 0:a[t])!==s&&r(null==a?void 0:a[t])}),1.25*ox);return()=>clearTimeout(e)}),[r,o,a,s,t]),ya((()=>{const e=(null==a?void 0:a.conversationId)??"";e&&i.current!==e&&(i.current=e,r(n))}),[r,null==a?void 0:a.conversationId,n]),ya((()=>{const t=(null==e?void 0:e.presetId)??"";t&&l.current!==t&&(l.current=t,r(n))}),[r,null==e?void 0:e.presetId,n])}const EC=wa({}),IC=()=>{const{ref:e}=Na(EC),{theme:t}=Na(Fs);return{screenshotTargetRef:e,captureScreenshot:async()=>{if(e instanceof Function)throw new Error("Ref callback is not supported.");if(null==e?void 0:e.current)return(async e=>{if(!e)throw new Error("You should provide correct html node.");const n=Us(t)?"#171717":"white",a=await K(e,{backgroundColor:n,imagePlaceholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII="}),s=document.createElement("canvas"),r=s.getContext("2d"),o=a.width,i=a.height;return s.width=o,s.height=i,r.fillStyle=n,r.fillRect(0,0,o,i),r.drawImage(a,0,0),s.toDataURL("image/png",1)})(e.current);throw new Error("Ref is not attached to any element.")}}},RC=({children:e})=>{const t=ba(null);return l.jsx(EC.Provider,{value:{ref:t},children:e})};function AC({conversation:e,filename:t,type:n,includeOptions:a,exportBranches:s,recursive:r}){const o=xs(),{captureScreenshot:i}=IC(),l=function(){const e=_((({snapshot:e})=>async t=>await e.getPromise(N_.messagesSiblingIdxFamily(t))),[]),t=async({messageId:n,message:a,messages:s,branches:r=!1,recursive:o=!1})=>{let i=[];if(null!=(null==s?void 0:s.length)&&s.length>0)if(r)for(const e of s)i.push(await t({messageId:null==e?void 0:e.messageId,message:e,messages:(null==e?void 0:e.children)||[],branches:r,recursive:o}));else{let a=s[0];if(s.length>1){const t=await e(n);a=s[s.length-t-1]}i=[await t({messageId:null==a?void 0:a.messageId,message:a,messages:(null==a?void 0:a.children)||[],branches:r,recursive:o})]}if(o&&a)return{...a,children:i};{let e=[];if(a){const t={...a};delete t.children,e=[t]}for(const t of i)e=e.concat(t);return e}};return t}(),{conversationId:c}=W(),d=ka((()=>{const t="new"===c?c:(null==e?void 0:e.conversationId)??c??"",n=gp({messages:o.getQueryData([Fh.messages,t])??[]});return 0===(null==n?void 0:n.length)?null:n??null}),[c,null==e?void 0:e.conversationId,o]),u=(e,t="text")=>{if(!e)return"";const n=(e,n)=>"text"===t?`>> ${e}:\n${n}`:`**${e}**\n${n}`;return e.content?e.content.filter((e=>null!=e)).map((t=>m(e.sender||"",t))).filter((e=>e.length>0)).map((e=>n(e[0],e[1]))).join("\n\n\n"):n(e.sender||"",e.text||"")},m=(e,t)=>{if(!t)return[];if(t.type===qm.ERROR)return[e,"object"==typeof t[qm.TEXT]?t[qm.TEXT].value??"":t[qm.TEXT]??""];if(t.type===qm.TEXT){const n=t[qm.TEXT];return[e,"string"==typeof n?n:(null==n?void 0:n.value)??""]}if(t.type===qm.TOOL_CALL){const e=t[qm.TOOL_CALL].type;if(e===Ym.CODE_INTERPRETER){const e=t[qm.TOOL_CALL][Ym.CODE_INTERPRETER];return["Code Interpreter",JSON.stringify(e)]}if(e===Ym.RETRIEVAL){const e=t[qm.TOOL_CALL];return["Retrieval",JSON.stringify(e)]}if(e===Ym.FUNCTION&&Xm.has(t[qm.TOOL_CALL].function.name)){const e=t[qm.TOOL_CALL];return["Tool",JSON.stringify(e)]}if(e===Ym.FUNCTION){const e=t[qm.TOOL_CALL];return vc(e),["Tool",JSON.stringify(e)]}}if(t.type===qm.IMAGE_FILE){const e=t[qm.IMAGE_FILE];return["Image",JSON.stringify(e)]}return[e,JSON.stringify(t)]};return{exportConversation:()=>{"json"===n?(async()=>{const n={conversationId:null==e?void 0:e.conversationId,endpoint:null==e?void 0:e.endpoint,title:null==e?void 0:e.title,exportAt:(new Date).toTimeString(),branches:s,recursive:r};!0===a&&(n.options=Jf({preset:e}));const o=await l({messageId:null==e?void 0:e.conversationId,message:null,messages:d(),branches:Boolean(s),recursive:Boolean(r)});!0!==r||Array.isArray(o)?n.messages=o:n.messagesTree=o.children;const i=JSON.stringify(n),c=new Blob([i],{type:"application/json;charset=utf-8"});q(c,`${t}.json`,"application/json")})():"text"==n?(async()=>{let n=`Conversation\n########################\nconversationId: ${null==e?void 0:e.conversationId}\nendpoint: ${null==e?void 0:e.endpoint}\ntitle: ${null==e?void 0:e.title}\nexportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\nOptions\n########################\n";const t=Jf({preset:e});for(const e of Object.keys(t))n+=`${e}: ${t[e]}\n`}const s=await l({messageId:null==e?void 0:e.conversationId,message:null,messages:d(),branches:!1,recursive:!1});if(n+="\nHistory\n########################\n",Array.isArray(s))for(const e of s)n+=`${u(e)}\n`,(null==e?void 0:e.error)&&(n+="(This is an error message)\n"),!0===(null==e?void 0:e.unfinished)&&(n+="(This is an unfinished message)\n"),n+="\n\n";else n+=`${u(s)}\n`,s.error&&(n+="(This is an error message)\n"),!0===s.unfinished&&(n+="(This is an unfinished message)\n");G({data:n,fileName:t,extension:"txt",exportType:G.types.txt})})():"markdown"==n?(async()=>{let n=`# Conversation\n- conversationId: ${null==e?void 0:e.conversationId}\n- endpoint: ${null==e?void 0:e.endpoint}\n- title: ${null==e?void 0:e.title}\n- exportAt: ${(new Date).toTimeString()}\n`;if(!0===a){n+="\n## Options\n";const t=Jf({preset:e});for(const e of Object.keys(t))n+=`- ${e}: ${t[e]}\n`}const s=await l({messageId:null==e?void 0:e.conversationId,message:null,messages:d(),branches:!1,recursive:!1});if(n+="\n## History\n",Array.isArray(s))for(const e of s)n+=`${u(e,"md")}\n`,(null==e?void 0:e.error)&&(n+="*(This is an error message)*\n"),!0===(null==e?void 0:e.unfinished)&&(n+="*(This is an unfinished message)*\n"),n+="\n\n";else n+=`${u(s,"md")}\n`,s.error&&(n+="*(This is an error message)*\n"),!0===s.unfinished&&(n+="*(This is an unfinished message)*\n");G({data:n,fileName:t,extension:"md",exportType:G.types.txt})})():"csv"==n?(async()=>{const n=[],a=await l({messageId:null==e?void 0:e.conversationId,message:null,messages:d(),branches:Boolean(s),recursive:!1});if(Array.isArray(a))for(const e of a)e&&n.push(e);else n.push(a);G({data:n,fileName:t,extension:"csv",exportType:G.types.csv,beforeTableEncode:e=>{var t,n,a,s,r,o,i,l;return[{fieldName:"sender",fieldValues:(null==(t=null==e?void 0:e.find((e=>"sender"==e.fieldName)))?void 0:t.fieldValues)??[]},{fieldName:"text",fieldValues:(null==(n=null==e?void 0:e.find((e=>"text"==e.fieldName)))?void 0:n.fieldValues)??[]},{fieldName:"isCreatedByUser",fieldValues:(null==(a=null==e?void 0:e.find((e=>"isCreatedByUser"==e.fieldName)))?void 0:a.fieldValues)??[]},{fieldName:"error",fieldValues:(null==(s=null==e?void 0:e.find((e=>"error"==e.fieldName)))?void 0:s.fieldValues)??[]},{fieldName:"unfinished",fieldValues:(null==(r=null==e?void 0:e.find((e=>"unfinished"==e.fieldName)))?void 0:r.fieldValues)??[]},{fieldName:"messageId",fieldValues:(null==(o=null==e?void 0:e.find((e=>"messageId"==e.fieldName)))?void 0:o.fieldValues)??[]},{fieldName:"parentMessageId",fieldValues:(null==(i=null==e?void 0:e.find((e=>"parentMessageId"==e.fieldName)))?void 0:i.fieldValues)??[]},{fieldName:"createdAt",fieldValues:(null==(l=null==e?void 0:e.find((e=>"createdAt"==e.fieldName)))?void 0:l.fieldValues)??[]}]}})})():"screenshot"==n&&(async()=>{let e;try{e=await i()}catch(n){return console.error("Failed to capture screenshot"),console.error(n)}q(e,`${t}.png`,"image/png")})()}}}function PC({nextCursor:e,isFetchingNext:t,setShowLoading:n,fetchNextPage:a}){const s=ba(null),r=ba(null),o=ka(_i((()=>a?a():Promise.resolve()),750,{leading:!0}),[a]),i=ka((()=>{if(r.current){const{scrollTop:a,clientHeight:s,scrollHeight:i}=r.current;a+s>=.97*i&&null!=e&&!t?(n(!0),o()):n(!1)}}),[e,t,o,n]);ya((()=>{const e=r.current;return e&&e.addEventListener("scroll",i),()=>{e&&e.removeEventListener("scroll",i)}}),[i]);const l=ka((()=>{const e=r.current;e&&(s.current=e.scrollTop)}),[]);return{containerRef:r,moveToTop:l}}function OC(){const e=Na(ek),t=ak({permissionType:Pp.AGENTS,permission:Op.USE}),n=ak({permissionType:Pp.MARKETPLACE,permission:Op.USE});return Ca((()=>void 0!==(null==e?void 0:e.isAuthenticated)&&(!1===(null==e?void 0:e.isAuthenticated)||void 0!==(null==e?void 0:e.user))),[null==e?void 0:e.isAuthenticated,null==e?void 0:e.user])&&t&&n}function LC(e,t){const n=E(),a=T();return ka((s=>{t&&t(s),0!==s.button||s.ctrlKey||s.metaKey||(s.preventDefault(),n(e,{state:{prevLocation:a}}))}),[n,e,t,a])}const MC=({mutateAsync:e,agent_id:t,assistant_id:n,tool_resource:a})=>{const[s,r]=ja([]),o=mC(),i=ka((({filesToDelete:t,agent_id:n,assistant_id:a,tool_resource:s})=>{const o=$c({agent_id:n,assistant_id:a,tool_resource:s});console.log("Deleting files:",t,o),e({files:t,...o}),r([])}),[e]),l=ka(xi(i,1e3),[]);ya((()=>()=>l.cancel()),[l]);return{deleteFile:ka((({file:e,setFiles:s})=>{const{file_id:i,temp_file_id:c="",filepath:d="",source:u=Sd.local,embedded:m,attached:p=!1}=e;if((e.progress??1)<1)return;const h={file_id:i,embedded:m,filepath:d,source:u};s&&s((e=>{const t=new Map(e);t.delete(i),t.delete(c);const n=Object.fromEntries(t);return o(n),t})),p||r((e=>{const s=[...e,h];return l({filesToDelete:s,agent_id:t,assistant_id:n,tool_resource:a}),s}))}),[l,o,t,n,a]),deleteFiles:ka((({files:e,setFiles:a})=>{const s=[];for(const t of e){const{file_id:e,embedded:n,temp_file_id:a,filepath:r="",source:o=Sd.local}=t;s.push({source:o,file_id:e,filepath:r,temp_file_id:a,embedded:n??!1})}a&&a((e=>{const t=new Map(e);s.forEach((e=>{t.delete(e.file_id),e.temp_file_id&&t.delete(e.temp_file_id)}));const n=Object.fromEntries(t);return o(n),t})),r((e=>{const a=[...e,...s];return l({filesToDelete:a,agent_id:t,assistant_id:n}),a}))}),[l,o,t,n])}};const DC=()=>{const e=qN(),{showToast:t}=Ds(),[n,a]=ja({});return{startUploadTimer:(s,r,o)=>{const i=(e=>5e3+2e3*Math.floor(e/1e6))(o);n[s]&&clearTimeout(n[s]);const l=setTimeout((()=>{const n=e("com_ui_upload_delay",{0:r});t({message:n,status:"warning",duration:1e4})}),i);a((e=>({...e,[s]:l})))},clearUploadTimer:e=>{n[e]&&(clearTimeout(n[e]),a((t=>{const{[e]:n,...a}=t;return a})))}}},FC=async(e,t=.9,n)=>{const a=await(async e=>{try{return await Ki(e)}catch(t){return console.warn("Error checking if file is HEIC:",t),"image/heic"===e.type||"image/heif"===e.type}})(e);return a?(console.log("HEIC file detected, converting to JPEG..."),(async(e,t=.9,n)=>{try{null==n||n(.3);const a=await Wi({blob:e,type:"image/jpeg",quality:t});null==n||n(.8);const s=new File([a],e.name.replace(/\.(heic|heif)$/i,".jpg"),{type:"image/jpeg",lastModified:e.lastModified});return null==n||n(1),s}catch(a){throw console.error("Error converting HEIC to JPEG:",a),new Error("Failed to convert HEIC image to JPEG")}})(e,t,n)):e},UC={maxWidth:1900,maxHeight:1900,quality:.92,format:"jpeg"};function zC(){try{if("undefined"==typeof HTMLCanvasElement)return!1;if("undefined"==typeof FileReader)return!1;if("undefined"==typeof Image)return!1;const e=document.createElement("canvas"),t=e.getContext("2d");return!!(t&&t.drawImage&&e.toBlob)}catch{return!1}}function VC(e,t={}){return new Promise(((n,a)=>{if(!zC())return void a(new Error("Browser does not support client-side image resizing"));if(!e.type.startsWith("image/"))return void a(new Error("File is not an image"));const s={...UC,...t},r=new FileReader;r.onload=t=>{var r;const o=new Image;o.onload=()=>{try{const t={width:o.width,height:o.height},r=function(e,t,n,a){const{width:s,height:r}={width:e,height:t};if(s<=n&&r<=a)return{width:s,height:r};const o=n/s,i=a/r,l=Math.min(o,i);return{width:Math.round(s*l),height:Math.round(r*l)}}(o.width,o.height,s.maxWidth,s.maxHeight);if(r.width===t.width&&r.height===t.height)return void n({file:e,originalSize:e.size,newSize:e.size,originalDimensions:t,newDimensions:r,compressionRatio:1});const i=document.createElement("canvas"),l=i.getContext("2d");i.width=r.width,i.height=r.height,l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(o,0,0,r.width,r.height),i.toBlob((o=>{if(!o)return void a(new Error("Failed to create blob from canvas"));const i="jpeg"===s.format?".jpg":`.${s.format}`,l=e.name.replace(/\.[^/.]+$/,""),c=new File([o],`${l}${i}`,{type:`image/${s.format}`,lastModified:Date.now()});n({file:c,originalSize:e.size,newSize:c.size,originalDimensions:t,newDimensions:r,compressionRatio:c.size/e.size})}),`image/${s.format}`,s.quality)}catch(t){a(t)}},o.onerror=()=>a(new Error("Failed to load image")),o.src=null==(r=t.target)?void 0:r.result},r.onerror=()=>a(new Error("Failed to read file")),r.readAsDataURL(e)}))}function $C(e){const t=mC();return{addFile:t=>{e((e=>{const n=new Map(e);return n.set(t.file_id,t),n}))},replaceFile:t=>{e((e=>{const n=new Map(e);return n.set(t.file_id,t),n}))},updateFileById:(n,a,s=!1)=>{e((e=>{if(!e.has(n))return console.warn(`File with id ${n} not found.`),e;const r=new Map(e),o=r.get(n);if(!o)return console.warn(`File with id ${n} not found.`),e;r.set(n,{...o,...a});if((a.filepath??"")&&1!==a.progress&&!s){const e=Object.fromEntries(r);t(e)}return r}))},deleteFileById:n=>{e((e=>{const a=new Map(e);a.has(n)?a.delete(n):console.warn(`File with id ${n} not found.`);const s=Object.fromEntries(a);return t(s),a}))}}}const BC=e=>{var t,n,a;const s=qN(),r=xs(),{showToast:o}=Ds(),[i,l]=ja([]),c=ba(null),{startUploadTimer:d,clearUploadTimer:u}=DC(),{files:m,setFiles:p,setFilesLoading:h,conversation:g}=$N(),x=y(__((null==g?void 0:g.conversationId)??Bm.NEW_CONVO)),f=e=>l((t=>[...t,e])),{addFile:v,replaceFile:_,updateFileById:b,deleteFileById:j}=$C((null==e?void 0:e.fileSetter)??p),{resizeImageIfNeeded:w}=(()=>{const{data:e=null}=Y_({select:e=>wd(e)}),t=(null==e?void 0:e.clientImageResize)??{enabled:!1,maxWidth:1900,maxHeight:1900,quality:.92},n=(null==t?void 0:t.enabled)??!1,a=ka((async(e,a)=>{if(!n)return{file:e,resized:!1};if(!zC())return console.warn("Client-side image resizing not supported in this browser"),{file:e,resized:!1};if(!function(e,t=536870912){return!(e.size<.1*t||!e.type.startsWith("image/")||"image/gif"===e.type)}(e))return{file:e,resized:!1};try{const n={maxWidth:null==t?void 0:t.maxWidth,maxHeight:null==t?void 0:t.maxHeight,quality:null==t?void 0:t.quality,...a},s=await VC(e,n);return{file:s.file,resized:!0,result:s}}catch(s){return console.warn("Client-side image resizing failed:",s),{file:e,resized:!1}}}),[n,t]);return{isEnabled:n,isSupported:zC(),config:t,resizeImageIfNeeded:a}})(),N=(null==(t=null==e?void 0:e.additionalMetadata)?void 0:t.agent_id)??"",k=(null==(n=null==e?void 0:e.additionalMetadata)?void 0:n.assistant_id)??"",C=Ca((()=>null==g?void 0:g.endpointType),[null==g?void 0:g.endpointType]),S=Ca((()=>(null==g?void 0:g.endpoint)??"default"),[null==g?void 0:g.endpoint]),{data:T=null}=Y_({select:e=>wd(e)}),E=ka((()=>{if(i.length>1){const e=Array.from(new Set(i)).map(((e,t)=>`${t>0?" ":""}${s(e)||e}\n`)).join("");o({message:e,status:"error",duration:5e3})}else if(1===i.length){const e=s(i[0])||i[0];o({message:e,status:"error",duration:5e3})}l([])}),[i,o,s]),I=xi(E,250);ya((()=>(i.length>0&&I(),()=>I.cancel())),[i,I]);const R=((e,t)=>{const n=xs(),{onSuccess:a,...s}=e||{};return fs([$h.fileUpload],{mutationFn:e=>{const n=e.get("width")??"",a=e.get("height")??"",s=e.get("version")??"",r=e.get("endpoint")??"";return lc(r)&&"2"===s?Jh.uploadFile(e,t):""!==n&&""!==a?Jh.uploadImage(e,t):Jh.uploadFile(e,t)},...s,onSuccess:(e,t,s)=>{n.setQueryData([Fh.files],(t=>[e,...t??[]]));const r=t.get("endpoint"),o=t.get("message_file"),i=t.get("agent_id")??"",l=t.get("assistant_id")??"",c=t.get("tool_resource")??"";"true"!==o?(i&&c&&n.setQueryData([Fh.agent,i],(t=>{var n,a;if(!t)return t;const s={},r=t.tool_resources??{},o=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};return o.file_ids||(o.file_ids=[]),o.file_ids.push(e.file_id),s.tool_resources={...r,[c]:o},(null==(a=t.tools)?void 0:a.includes(c))||(s.tools=[...t.tools??[],c]),{...t,...s}})),l?(n.setQueryData([Fh.assistants,r,Dl],(t=>t?{...t,data:t.data.map((t=>{var n;if(t.id!==l)return t;const a={};if(c||(a.file_ids=[...t.file_ids??[],e.file_id]),c===kl.code_interpreter){const s=t.tool_resources??{},r=(null==(n=t.tool_resources)?void 0:n[c])??{file_ids:[]};r.file_ids||(r.file_ids=[]),r.file_ids.push(e.file_id),a.tool_resources={...s,[c]:r}}return{...t,...a}}))}:t)),null==a||a(e,t,s)):null==a||a(e,t,s)):null==a||a(e,t,s)}})})({onSuccess:e=>{u(e.temp_file_id),console.log("upload success",e),N?r.refetchQueries([Fh.agent,N]):(b(e.temp_file_id,{progress:.9,filepath:e.filepath},!!k),setTimeout((()=>{b(e.temp_file_id,{progress:1,file_id:e.file_id,temp_file_id:e.temp_file_id,filepath:e.filepath,type:e.type,height:e.height,width:e.width,filename:e.filename,source:e.source,embedded:e.embedded},!!k)}),300))},onError:(e,t)=>{var n,a;const s=e;console.log("upload error",s);const r=t.get("file_id");t.get("tool_resource")===kl.execute_code&&x((e=>({...e,[kl.execute_code]:!1}))),u(r),j(r);let o="com_error_files_upload";"ERR_CANCELED"===(null==s?void 0:s.code)?o="com_error_files_upload_canceled":(null==(a=null==(n=null==s?void 0:s.response)?void 0:n.data)?void 0:a.message)&&(o=s.response.data.message),f(o)}},null==(a=c.current)?void 0:a.signal),A=async t=>{var n,a;const s=(null==(n=t.file)?void 0:n.name)??"File";d(t.file_id,s,t.size);const o=new FormData;o.append("endpoint",S),o.append("endpointType",C??""),o.append("file",t.file,encodeURIComponent(s)),o.append("file_id",t.file_id);const i=t.width??0,l=t.height??0;i&&o.append("width",i.toString()),l&&o.append("height",l.toString());const c=(null==e?void 0:e.additionalMetadata)??{};if(null==e?void 0:e.additionalMetadata)for(const[e,r=""]of Object.entries(c))r&&o.append(e,r);if(!lc(C??S)){N||o.append("message_file","true");const e=t.tool_resource;return null!=e&&o.append("tool_resource",e),null!=(null==g?void 0:g.agent_id)&&null==o.get("agent_id")&&o.append("agent_id",g.agent_id),void R.mutate(o)}const u=(null==g?void 0:g.model)??"",m=(null==g?void 0:g.assistant_id)??"";k||o.append("message_file","true");const p=r.getQueryData([Fh.endpoints]),h=(null==(a=null==p?void 0:p[S])?void 0:a.version)??Fu[S];!k&&m&&(o.append("version",h),o.append("model",u),o.append("assistant_id",m));(o.get("version")??"")||o.append("version",h);(o.get("model")??"")||o.append("model",u),R.mutate(o)},P=(e,t)=>{const n=new Image;n.onload=async()=>{e.width=n.width,e.height=n.height,e={...e,progress:.6},_(e),await A(e),URL.revokeObjectURL(t)},n.src=t},O=async(e,t)=>{c.current=new AbortController;const n=Array.from(e);let a;try{const e=jd({endpoint:S,fileConfig:T,endpointType:C});a=(({files:e,fileList:t,setError:n,endpointFileConfig:a,toolResource:s,fileConfig:r})=>{var o,i,l;const{fileLimit:c,fileSizeLimit:d,totalSizeLimit:u,supportedMimeTypes:m,disabled:p}=a;if(!0===p)return n("com_ui_attach_error_disabled"),!1;const h=Array.from(e.values()),g=t.reduce(((e,t)=>e+t.size),0);if(0===g)return n("com_error_files_empty"),!1;const x=h.reduce(((e,t)=>e+t.size),0);if(c&&t.length+e.size>c)return n(`You can only upload up to ${c} files at a time.`),!1;for(let v=0;v<t.length;v++){let e=t[v];const a=dd(e.name,e.type);if(!a)return n("Unable to determine file type for: "+e.name),!1;if(e.type!==a){const n=new File([e],e.name,{type:a});e=n,t[v]=n}let c=m;if(s===kl.context&&(c=[...(null==(o=null==r?void 0:r.text)?void 0:o.supportedMimeTypes)||[],...(null==(i=null==r?void 0:r.ocr)?void 0:i.supportedMimeTypes)||[],...(null==(l=null==r?void 0:r.stt)?void 0:l.supportedMimeTypes)||[]]),!wx(e.type,c))return console.log(e),n("Currently, unsupported file type: "+e.type),!1;if(d&&e.size>=d)return n(`File size exceeds ${d/md} MB.`),!1}if(u&&x+g>u)return n(`The total size of the files cannot exceed ${u/md} MB.`),!1;const f=[...h.map((e=>{var t,n;return`${(null==(t=e.file)?void 0:t.name)??e.filename}-${e.size}-${(null==(n=e.type)?void 0:n.split("/")[0])??"file"}`})),...t.map((e=>`${null==e?void 0:e.name}-${null==e?void 0:e.size}-${(null==e?void 0:e.type.split("/")[0])??"file"}`))];return new Set(f).size===f.length||(n("com_error_files_dupe"),!1)})({files:m,fileList:n,setError:f,fileConfig:T,endpointFileConfig:e,toolResource:t})}catch(r){return console.error("file validation error",r),void f("com_error_files_validation")}if(a)for(const l of n){const e=$();try{const n=URL.createObjectURL(l),a={file_id:e,file:l,type:l.type,preview:n,progress:.1,size:l.size};null!=t&&""!==t&&(a.tool_resource=t),v(a);("image/heic"===l.type||"image/heif"===l.type||l.name.toLowerCase().match(/\.(heic|heif)$/))&&o({message:s("com_info_heic_converting"),status:"info",duration:3e3});const r=await FC(l,.9,(e=>{const t=.1+.4*e;_({...a,progress:t})}));let c=r;if(r.type.startsWith("image/"))try{const e=await w(r);if(c=e.file,e.resized&&e.result){const{originalSize:t,newSize:n,compressionRatio:a}=e.result,s=(t/1048576).toFixed(1),r=(n/1048576).toFixed(1),i=Math.round(100*(1-a));o({message:`Image resized: ${s}MB  ${r}MB (${i}% smaller)`,status:"success",duration:3e3})}}catch(i){console.warn("Image resize failed, using original:",i)}if(c!==l){URL.revokeObjectURL(n);const e=URL.createObjectURL(c),t={...a,file:c,type:c.type,preview:e,progress:.5,size:c.size};_(t);if("image"===c.type.split("/")[0]){P(t,e);continue}await A(t)}else{const e="image"===l.type.split("/")[0],t={...a,progress:.2};if(_(t),e){P(t,n);continue}await A(t)}}catch(r){j(e),console.log("file handling error",r),r instanceof Error&&r.message.includes("HEIC")?f("com_error_heic_conversion"):f("com_error_files_process")}}else h(!1)};return{handleFileChange:(e,t)=>{e.stopPropagation(),e.target.files&&(h(!0),O(e.target.files,t),e.target.value="")},handleFiles:O,abortUpload:()=>{c.current&&(cx.log("files","Aborting upload"),c.current.abort("User aborted upload"),c.current=null)},setFiles:p,files:m}};function HC({enabled:e=!0,purpose:t}){const{user:n}=nk(),{data:a}=K_(),s=null==a?void 0:a.sharePointBaseUrl,r=null==a?void 0:a.sharePointPickerGraphScope,o=null==a?void 0:a.sharePointPickerSharePointScope,i="openid"===(null==n?void 0:n.provider),l="Pick"===t?o:r,{data:c,isLoading:d,error:u,refetch:m}=S_({scopes:l,enabled:e&&i&&!!s});return{token:c,isLoading:d,error:u,refetch:m}}function GC(e){const{handleFiles:t}=BC(e),{downloadSharePointFiles:n,isDownloading:a,downloadProgress:s,error:r}=function({onFilesDownloaded:e,onError:t}={}){const{showToast:n}=Ds(),[a,s]=ja(null),[r,o]=ja(null),{token:i,refetch:l}=HC({enabled:!1,purpose:"Download"}),c=J_();return{downloadSharePointFiles:ka((async a=>{var r;if(!a||0===a.length)throw new Error("No files provided for download");o(null),s({completed:0,total:a.length,failed:[]});try{let t=null==i?void 0:i.access_token;if(!t&&(n({message:"Getting SharePoint access token...",status:"info",duration:2e3}),t=null==(r=(await l()).data)?void 0:r.access_token,!t))throw new Error("Failed to obtain SharePoint access token");n({message:`Downloading ${a.length} file(s) from SharePoint...`,status:"info",duration:3e3});const o=await c.mutateAsync({files:a,accessToken:t,onProgress:e=>{s(e),a.length>5&&e.completed%3==0&&n({message:`Downloaded ${e.completed}/${e.total} files...`,status:"info",duration:1e3})}});if(o.length>0){const t=a.length-o.length,s=t>0?`Downloaded ${o.length}/${a.length} files from SharePoint (${t} failed)`:`Successfully downloaded ${o.length} file(s) from SharePoint`;n({message:s,status:t>0?"warning":"success",duration:4e3}),e&&await e(o)}return s(null),o}catch(d){const e=d instanceof Error?d.message:"Unknown download error";throw o(e),n({message:`SharePoint download failed: ${e}`,status:"error",duration:5e3}),t&&t(d instanceof Error?d:new Error(e)),s(null),d}}),[i,n,c,e,t,l]),isDownloading:c.isLoading,downloadProgress:a,error:r}}({onFilesDownloaded:async n=>{const a=Array.from(n);await t(a,null==e?void 0:e.toolResource)},onError:e=>{console.error("SharePoint download failed:",e)}});return{handleSharePointFiles:ka((async e=>{try{await n(e)}catch(t){throw console.error("SharePoint file handling error:",t),t}}),[n]),isProcessing:a,downloadProgress:s,error:r}}function KC(e,t=[],n=300){const a=ba(),s=ba();s.current=ka(e,t);const r=ka(xi((()=>{var e;return a.current=null==(e=s.current)?void 0:e.call(s)}),n),[]);ya(r,t),ya((()=>()=>a.current instanceof Function?a.current():void 0),[])}function WC(e,t){const[n,a]=ja(e);return ya((()=>{const n=setTimeout((()=>{a(e)}),t);return()=>{clearTimeout(n)}}),[e,t]),n}function qC({textAreaRef:e,submitButtonRef:t,setIsScrollable:n,disabled:a=!1}){const s=qN(),r=pC(),o=ba(!1),i=WN(),{handleFiles:l}=BC(),c=Ik(),d=(()=>{const e=xs(),t=ba(Date.now());return ka((()=>{const n=Date.now();n-t.current>Om.FIVE_MINUTES&&(cx.log("Checking health on interaction. Time elapsed:",n-t.current),e.invalidateQueries([Fh.health]),t.current=n)}),[e])})(),u=j(N_.enterToSend),{index:m,conversation:p,isSubmitting:h,filesLoading:g,latestMessage:x,setFilesLoading:f}=$N(),[v,_]=b(N_.activePromptByIndex(m)),{endpoint:y=""}=p||{},{entity:w,isAgent:N,isAssistant:k}=Tf({endpoint:y,agentsMap:i,assistantMap:c,agent_id:null==p?void 0:p.agent_id,assistant_id:null==p?void 0:p.assistant_id}),C=(null==w?void 0:w.name)??"",S=(((null==x?void 0:x.unfinished)??!1)&&!h||((null==x?void 0:x.error)??!1))&&!k;ya((()=>{const t=v??"";t&&e.current&&(nf(e.current,t),af(e.current),_(void 0))}),[v,_,e]),ya((()=>{var t,n;if((null==(t=e.current)?void 0:t.value)??"")return;const o=()=>{var e;if(a)return s("com_endpoint_config_placeholder");const t=(null==p?void 0:p.endpoint)??"",n=(null==p?void 0:p.agent_id)??"",o=(null==p?void 0:p.assistant_id)??"";if(!(!N||n&&(null==i?void 0:i[n])))return s("com_endpoint_agent_placeholder");if(k&&(!o||!(null==(e=null==c?void 0:c[t])?void 0:e[o])))return s("com_endpoint_assistant_placeholder");if(S)return s("com_endpoint_message_not_appendable");const l=k||N?(({name:e="",localize:t,isAgent:n})=>e&&e.length>0?e:t(!0===n?"com_ui_agent":"com_ui_assistant"))({name:C,isAgent:N,localize:s}):r(p);return`${s("com_endpoint_message_new",{0:l||s("com_endpoint_ai")})}`},l=o();if((null==(n=e.current)?void 0:n.getAttribute("placeholder"))===l)return;const d=xi((()=>{var t,n;const a=o();(null==(t=e.current)?void 0:t.getAttribute("placeholder"))!==a&&(null==(n=e.current)||n.setAttribute("placeholder",a),af(e.current))}),80);return d(),()=>d.cancel()}),[N,s,a,r,i,C,e,k,c,p,x,S]);const T=ka((a=>{var s;if(e.current&&rf(e.current)){const t=rf(e.current);t&&n(t)}if("Enter"===a.key&&h)return;d();const r="Enter"===a.key&&!a.shiftKey,i="Enter"===a.key&&(a.ctrlKey||a.metaKey),l=o.current||"Process"===a.key||229===a.keyCode;if(r&&g&&a.preventDefault(),r&&a.preventDefault(),"Enter"===a.key&&!u&&!i&&e.current&&!l)return a.preventDefault(),nf(e.current,"\n"),void af(e.current);if((r||i)&&!l){const e=document.getElementById(ax);e&&(console.log("Unmuting global audio"),e.muted=!1),null==(s=t.current)||s.click()}}),[h,d,g,u,n,e,t]),E=ka((t=>{if(!e.current)return;const n=t.clipboardData;if(n&&n.files.length>0){f(!0);const e=[];for(const t of n.files){const n=new File([t],`clipboard_${+new Date}_${t.name}`,{type:t.type});e.push(n)}l(e)}}),[l,f,e]);return{textAreaRef:e,handlePaste:E,handleKeyDown:T,isNotAppendable:S,handleCompositionEnd:()=>{o.current=!1},handleCompositionStart:()=>{o.current=!0}}}const QC=e=>{const t={};return Object.entries(e).forEach((([e,n])=>{try{const a=Uc.shape[e];if(a){const s=(e=>"true"===e||"false"!==e&&(isNaN(Number(e))?e:Number(e)))(n),r=a.parse(s);t[e]=r}}catch(a){console.warn(`Invalid value for setting ${e}:`,a)}})),null!=t.assistant_id&&t.assistant_id&&!lc(t.endpoint)&&(t.endpoint=Yl.assistants),null!=t.agent_id&&t.agent_id&&!cc(t.endpoint)&&(t.endpoint=Yl.agents),t};function YC({textAreaRef:e}){const t=ba(0),n=ba(!1),a=ba(!1),s=ba(!1),r=ba(!1),o=ba(null),i=ba(null),l=ba(null),c=jk(),[d,u]=Da(),m=zN(),p=j(N_.modularChat),h=j(N_.availableTools),{submitMessage:g}=lS(),x=xs(),{conversation:f,newConversation:v}=$N(),_=d.get("agent_id")||"",{data:b}=A_(_),y=ka((e=>{var t;if(!e)return;let n=Zx(e,h);if(null!=n.spec&&""!==n.spec){const e=x.getQueryData([Fh.startupConfig]),a=((null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list)??[]).find((e=>e.name===n.spec));if(!a)return;const{preset:s}=a;s.iconURL=kf(a),s.spec=a.name,n=s}let a=n.endpoint??"";const s=x.getQueryData([Fh.endpoints]);if(a&&s&&!s[a]){const e=a.toLowerCase();for(const[t,r]of Object.entries(s))if(r&&r.type===Yl.custom&&t.toLowerCase()===e){a=t,n.endpoint=t,n.endpointType=Yl.custom;break}}const{template:r,shouldSwitch:o,isNewModular:i,newEndpointType:l,isCurrentModular:c,isExistingConversation:d}=yf({newEndpoint:a,modularChat:p,conversation:f,endpointsConfig:s});let u={};null==n.spec&&(r.spec=null,r.iconURL=null,r.modelLabel=null,u={spec:null,iconURL:null,modelLabel:null},n={...n,...u}),n.agent_id&&(r.agent_id=n.agent_id),xf(r);if(d&&(c&&i&&o)){r.endpointType=l;const e=m({conversation:{...f??{},endpointType:r.endpointType,...u},preset:r,cleanOutput:null!=n.spec&&""!==n.spec});return cx.log("conversation","Switching conversation from query params",e),void v({template:e,preset:n,keepLatestMessage:!0,keepAddedConvos:!0})}v({preset:n,keepAddedConvos:!0})}),[x,p,f,h,v,m]),w=ka((()=>{if(!i.current||!f)return!1;for(const[e,t]of Object.entries(i.current))if(!["presetOverride","iconURL","spec","modelLabel"].includes(e)&&f[e]!==t)return!1;return!0}),[f]),N=ka((()=>{!r.current&&a.current&&o.current&&(r.current=!0,a.current=!1,c.setValue("text",o.current,{shouldValidate:!0}),c.handleSubmit((e=>{var t;if(null==(t=e.text)?void 0:t.trim()){g(e);const t=window.location.pathname;window.history.replaceState({},"",t),console.log("Message submitted with conversation state:",f)}}))())}),[c,g,f]);ya((()=>{const s=setInterval((()=>{if(n.current||t.current>=50)return clearInterval(s),void(t.current>=50&&console.warn("Max attempts reached, failed to process parameters"));if(t.current+=1,!e.current)return;if(!x.getQueryData([Fh.startupConfig]))return;const{decodedPrompt:m,validSettings:p,shouldAutoSubmit:h}=(()=>{var e;const t={};d.forEach(((e,n)=>{t[n]=e}));const n=t.prompt||t.q||"",a="true"===(null==(e=t.submit)?void 0:e.toLowerCase());return delete t.prompt,delete t.q,delete t.submit,{decodedPrompt:n,validSettings:QC(t),shouldAutoSubmit:a}})();h||(r.current=!0);Object.keys(p).length>0&&(i.current=p),m&&(o.current=m),h&&m?Object.keys(p).length>0?(a.current=!0,l.current=setTimeout((()=>{!r.current&&a.current&&(console.warn("Settings application timeout reached, proceeding with submission anyway"),N())}),3e3)):(c.setValue("text",m,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(m.length,m.length),c.handleSubmit((e=>{var t;(null==(t=e.text)?void 0:t.trim())&&g(e)}))()):m?(c.setValue("text",m,{shouldValidate:!0}),e.current.focus(),e.current.setSelectionRange(m.length,m.length)):r.current=!0,Object.keys(p).length>0&&y(p),(()=>{const e=d.toString(),t=new URLSearchParams(e);if(t.delete("prompt"),t.delete("q"),t.delete("submit"),u(t,{replace:!0}),n.current=!0,console.log("Parameters processed successfully",e),clearInterval(s),!a.current){const e=window.location.pathname;window.history.replaceState({},"",e)}})()}),100);return()=>{clearInterval(s),l.current&&clearTimeout(l.current)}}),[d,c,e,y,v,g,u,x,N]),ya((()=>{if(!n.current||r.current||s.current||!i.current||!f)return;w()&&(s.current=!0,a.current&&(l.current&&(clearTimeout(l.current),l.current=null),console.log("Settings fully applied, processing submission"),N()))}),[f,N,w]);const{isAuthenticated:k}=nk(),C=GN({isAuthenticated:k});ya((()=>{b&&((e,t)=>{const n=[Fh.agents,{requiredPermission:Oh.EDIT}],a=e.getQueryData(n);if((null==a?void 0:a.data)&&!a.data.some((e=>e.id===t.id))){const s={...a,data:[t,...a.data]};e.setQueryData(n,s),cx.log("agent","Injected URL agent into cache:",t)}})(x,b)}),[b,x,C])}const XC={Escape:!0,Backspace:!0,Enter:!0},JC=(e,t)=>{var n,a;const s=null==(n=e.current)?void 0:n.value;if("string"!=typeof s||0===s.length||s[0]!==t)return!1;const r=null==(a=e.current)?void 0:a.selectionStart;return"number"==typeof r&&1===r};const ZC=()=>{const e=j(N_.engineSTT),t=j(N_.engineTTS),n=e,a=t;return Ca((()=>({speechToTextEndpoint:n,textToSpeechEndpoint:a})),[n,a])},eS=(e,t)=>{const{showToast:n}=Ds(),{speechToTextEndpoint:a}=ZC(),s="external"===a,r=ba(null),o=ba(null),i=ba(null),l=ba(null),[c,d]=ja(!1),[u,m]=ja(!1),[p,h]=ja([]),[g,x]=ja(!1),[f,v]=ja((()=>T())),[_]=b(N_.decibelValue),[y]=b(N_.autoSendText),[j]=b(N_.languageSTT),[w]=b(N_.speechToText),[N]=b(N_.autoTranscribeAudio),{mutate:k,isLoading:C}=(S={onSuccess:n=>{const a=n.text;e(a),x(!1),y>-1&&w&&a.length>0&&setTimeout((()=>{t(a)}),1e3*y)},onError:()=>{n({message:"An error occurred while processing the audio, maybe the audio was too short",status:"error"}),x(!1)}},fs([$h.speechToText],{mutationFn:e=>Jh.speechToText(e),...S||{}}));var S;function T(){const e=["audio/webm","audio/webm;codecs=opus","audio/mp4","audio/ogg;codecs=opus","audio/ogg","audio/wav"];for(const t of e)if("undefined"!=typeof MediaRecorder&&MediaRecorder.isTypeSupported(t))return t;if("undefined"!=typeof navigator){const e=navigator.userAgent.toLowerCase();if(-1!==e.indexOf("safari")&&-1===e.indexOf("chrome"))return"audio/mp4";if(-1!==e.indexOf("firefox"))return"audio/ogg"}return"audio/webm"}const E=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});d(!0),r.current=e??null}catch{d(!1)}},I=()=>{if(p.length>0){const t=new Blob(p,{type:f}),n=(e=f).includes("mp4")?"m4a":e.includes("ogg")?"ogg":e.includes("wav")?"wav":"webm";h([]);const a=new FormData;a.append("audio",t,`audio.${n}`),j&&a.append("language",j),x(!0),l.current&&(l.current.removeEventListener("dataavailable",(e=>{p.push(e.data)})),l.current.removeEventListener("stop",I),l.current=null),k(a)}else n({message:"The audio was too short",status:"warning"});var e},R=async()=>{if(g)n({message:"A request is already being made. Please wait.",status:"warning"});else if(r.current||await E(),r.current)try{h([]);const e=T();v(e),l.current=new MediaRecorder(r.current,{mimeType:f}),l.current.addEventListener("dataavailable",(e=>{p.push(e.data)})),l.current.addEventListener("stop",I),l.current.start(100),!i.current&&N&&w&&((e,t)=>{const n=new AudioContext,a=n.createMediaStreamSource(e),s=n.createAnalyser();s.minDecibels=_,a.connect(s);const r=s.frequencyBinCount,i=new Uint8Array(r);let l=Date.now();const c=()=>{s.getByteFrequencyData(i),i.some((e=>e>0))&&(l=Date.now()),Date.now()-l>3e3?t():o.current=window.requestAnimationFrame(c)};o.current=window.requestAnimationFrame(c)})(r.current,A),m(!0)}catch(e){n({message:`Error starting recording: ${e}`,status:"error"})}else n({message:"Microphone permission not granted",status:"error"})},A=()=>{var e;l.current&&("recording"===l.current.state?(l.current.stop(),null==(e=r.current)||e.getTracks().forEach((e=>e.stop())),r.current=null,null!==o.current&&(window.cancelAnimationFrame(o.current),o.current=null),m(!1)):n({message:"MediaRecorder is not recording",status:"error"}))},P=async e=>{if(e.shiftKey&&e.altKey&&"KeyL"===e.code&&s){if(!window.MediaRecorder)return void n({message:"MediaRecorder is not supported in this browser",status:"error"});!1===c&&await E(),u?A():R(),e.preventDefault()}};return ya((()=>(window.addEventListener("keydown",P),()=>{window.removeEventListener("keydown",P)})),[u]),{isListening:u,externalStopRecording:()=>{u?A():n({message:"Not currently recording. Please start recording first.",status:"warning"})},externalStartRecording:()=>{u?n({message:"Already listening. Please stop recording first.",status:"warning"}):R()},isLoading:C}},tS=(e,t)=>{const{speechToTextEndpoint:n}=ZC(),a="external"===n,{isListening:s,isLoading:r,startRecording:o,stopRecording:i}=((e,t)=>{const n=qN(),{showToast:a}=Ds(),{speechToTextEndpoint:s}=ZC(),r="browser"===s,{data:o}=RN({enabled:!0}),i=Boolean(null==o?void 0:o.sttExternal),l=ba(null),c=ba(null),d=ba(),[u]=b(N_.autoSendText),[m]=b(N_.languageSTT),[p]=b(N_.autoTranscribeAudio),{listening:h,finalTranscript:g,resetTranscript:x,interimTranscript:f,isMicrophoneAvailable:v,browserSupportsSpeechRecognition:_}=Q.useSpeechRecognition(),y=Ca((()=>h),[h]);ya((()=>{null!=f&&""!==f&&c.current!==f&&(e(f),c.current=f)}),[e,f]),ya((()=>{if(null!=g&&""!==g&&l.current!==g)return e(g),l.current=g,u>-1&&g.length>0&&(d.current=setTimeout((()=>{t(g),x()}),1e3*u)),()=>{d.current&&clearTimeout(d.current)}}),[e,t,x,g,u]);const j=()=>{_?v?!0===y?Y.stopListening():Y.startListening({language:m,continuous:p}):a({message:n("com_ui_microphone_unavailable"),status:"error"}):a({message:n(i?"com_ui_speech_not_supported_use_external":"com_ui_speech_not_supported"),status:"error"})};return ya((()=>{const e=e=>{e.shiftKey&&e.altKey&&"KeyL"===e.code&&!r&&j()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[]),{isListening:y,isLoading:!1,startRecording:j,stopRecording:j}})(e,t),{isListening:l,isLoading:c,externalStartRecording:d,externalStopRecording:u}=eS(e,t);return{isLoading:a?c:r,isListening:a?l:s,stopRecording:a?u:i,startRecording:a?d:o}};function nS({enabled:e}={}){const{data:t}=lb({enabled:e});return{connectionStatus:null==t?void 0:t.connectionStatus}}function aS({conversationId:e}={}){var t,n;const a=qN(),s=xs(),{showToast:r}=Ds(),{data:o}=K_(),{data:i,isLoading:l}=$b(),{data:c}=FN(Ph.MCPSERVER),[d,u]=ja(!1),[m,p]=ja(null),h=ba(null),g=Ca((()=>{const e=[];if(i)for(const[t,n]of Object.entries(i)){const{dbId:a,consumeOnly:s,...r}=n,o=a&&(null==c?void 0:c[a])?c[a]:1;e.push({serverName:t,dbId:a,effectivePermissions:o,consumeOnly:s,config:r})}return e}),[i,c]),x=Ca((()=>g.filter((e=>!1!==e.config.chatMenu&&!e.consumeOnly))),[g]),{mcpValues:f,setMCPValues:v,isPinned:_,setIsPinned:y}=function({conversationId:e,servers:t}){const n=e??Bm.NEW_CONVO,a=Ca((()=>new Set(null==t?void 0:t.map((e=>e.serverName)))),[t]),[s,r]=X(y_),[o,i]=X(b_(n)),[l,c]=b(__(n));ya((()=>{const e=(null==l?void 0:l.mcp)??[];if(1===e.length&&e[0]===Bm.mcp_clear)i([]);else if(e.length>0){const t=e.filter((e=>a.has(e)));i(t)}}),[null==l?void 0:l.mcp,i,a]),ya((()=>{c((e=>bi(null==e?void 0:e.mcp,o)?e:{...e??{},mcp:o}))}),[o,c]),ya((()=>{const e=`${Hm.LAST_MCP_}${n}`;o.length>0&&Wf(e)}),[o,n]);const d=ka((e=>{Array.isArray(e)&&i(e)}),[i]);return{isPinned:s,mcpValues:o,setIsPinned:r,setMCPValues:d}}({conversationId:e,servers:x}),j=ba(f);ya((()=>{j.current=f}),[f]);const w=ka(((e,t)=>0!=(e&t)),[]),N=EN(),k=IN(),C=TN({onSuccess:async()=>{r({message:a("com_nav_mcp_vars_updated"),status:"success"}),await Promise.all([s.invalidateQueries([Fh.mcpServers]),s.invalidateQueries([Fh.mcpTools]),s.invalidateQueries([Fh.mcpAuthValues]),s.invalidateQueries([Fh.mcpConnectionStatus])])},onError:e=>{console.error("Error updating MCP auth:",e),r({message:a("com_nav_mcp_vars_update_error"),status:"error"})}}),[S,T]=ja((()=>{const e={};return g.forEach((t=>{e[t.serverName]={isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null}})),e})),{connectionStatus:E}=nS({enabled:!l&&g.length>0}),I=ka(((e,t)=>{T((n=>{const a={...n},s=a[e]||{isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null};return a[e]={...s,...t},a}))}),[]),R=ka((e=>{const t=S[e];(null==t?void 0:t.pollInterval)&&clearTimeout(t.pollInterval),I(e,{isInitializing:!1,oauthUrl:null,oauthStartTime:null,isCancellable:!1,pollInterval:null})}),[S,I]),A=ka((e=>{const t=S[e];if(null==t?void 0:t.pollInterval)return void console.debug(`[MCP Manager] Polling already active for ${e}, skipping duplicate`);let n=0,o=null;const i=e=>e<12?5e3:e<22?6e3:7500,l=18e4,c=async()=>{try{n++;const t=S[e],d=(null==t?void 0:t.oauthStartTime)?Date.now()-t.oauthStartTime:5e3*n;if(n>30||d>l)return console.warn(`[MCP Manager] OAuth timeout for ${e} after ${(d/1e3).toFixed(0)}s (attempt ${n})`),r({message:a("com_ui_mcp_oauth_timeout",{0:e}),status:"error"}),o&&clearTimeout(o),void R(e);await s.refetchQueries([Fh.mcpConnectionStatus]);const u=s.getQueryData([Fh.mcpConnectionStatus]),m=((null==u?void 0:u.connectionStatus)||{})[e];if("connected"===(null==m?void 0:m.connectionState)){o&&clearTimeout(o),r({message:a("com_ui_mcp_authenticated_success",{0:e}),status:"success"});const t=j.current??[];return t.includes(e)||v([...t,e]),await s.invalidateQueries([Fh.mcpTools]),void setTimeout((()=>{R(e)}),1e3)}if((null==t?void 0:t.oauthStartTime)&&Date.now()-t.oauthStartTime>l)return r({message:a("com_ui_mcp_oauth_timeout",{0:e}),status:"error"}),o&&clearTimeout(o),void R(e);if("error"===(null==m?void 0:m.connectionState))return r({message:a("com_ui_mcp_init_failed"),status:"error"}),o&&clearTimeout(o),void R(e);const p=i(n);(n%5==0||n<=2)&&console.debug(`[MCP Manager] Polling ${e} attempt ${n}/30, next in ${p/1e3}s`),o=setTimeout(c,p),I(e,{pollInterval:o})}catch(t){return console.error(`[MCP Manager] Error polling server ${e}:`,t),o&&clearTimeout(o),void R(e)}};o=setTimeout(c,i(0)),I(e,{pollInterval:o})}),[s,S,r,a,v,R,I]),P=ka((async(e,t=!0)=>{I(e,{isInitializing:!0});try{const n=await N.mutateAsync(e);if(!n.success)return r({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"}),R(e),n;if(n.oauthRequired&&n.oauthUrl)I(e,{oauthUrl:n.oauthUrl,oauthStartTime:Date.now(),isCancellable:!0,isInitializing:!0}),t&&window.open(n.oauthUrl,"_blank","noopener,noreferrer"),A(e);else{await Promise.all([s.invalidateQueries([Fh.mcpServers]),s.invalidateQueries([Fh.mcpTools]),s.invalidateQueries([Fh.mcpAuthValues]),s.invalidateQueries([Fh.mcpConnectionStatus])]),r({message:a("com_ui_mcp_initialized_success",{0:e}),status:"success"});const t=f??[];t.includes(e)||v([...t,e]),R(e)}return n}catch(n){console.error(`[MCP Manager] Failed to initialize ${e}:`,n),r({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"}),R(e)}}),[I,N,A,s,r,a,f,R,v]),O=ka((e=>{k.mutate(e,{onSuccess:()=>{R(e),Promise.all([s.invalidateQueries([Fh.mcpServers]),s.invalidateQueries([Fh.mcpTools]),s.invalidateQueries([Fh.mcpAuthValues]),s.invalidateQueries([Fh.mcpConnectionStatus])]),r({message:a("com_ui_mcp_oauth_cancelled",{0:e}),status:"warning"})},onError:t=>{console.error(`[MCP Manager] Failed to cancel OAuth for ${e}:`,t),r({message:a("com_ui_mcp_init_failed",{0:e}),status:"error"})}})}),[s,R,r,a,k]),L=ka((e=>{var t;return(null==(t=S[e])?void 0:t.isInitializing)||!1}),[S]),M=ka((e=>{var t;return(null==(t=S[e])?void 0:t.isCancellable)||!1}),[S]),D=ka((e=>{var t;return(null==(t=S[e])?void 0:t.oauthUrl)||null}),[S]),F=Ca((()=>{var e,t;return(null==(t=null==(e=null==o?void 0:o.interface)?void 0:e.mcpServers)?void 0:t.placeholder)||a("com_ui_mcp_servers")}),[null==(n=null==(t=null==o?void 0:o.interface)?void 0:t.mcpServers)?void 0:n.placeholder,a]),U=ka((e=>{const t=[],n=[];e.forEach((e=>{if(L(e))return;const a=null==E?void 0:E[e];"connected"===(null==a?void 0:a.connectionState)?t.push(e):n.push(e)})),v(t),n.forEach((e=>{P(e)}))}),[E,v,P,L]),z=ka((e=>{if(L(e))return;const t=f??[];if(t.includes(e)){const n=t.filter((t=>t!==e));v(n)}else{const n=null==E?void 0:E[e];"connected"===(null==n?void 0:n.connectionState)?v([...t,e]):P(e)}}),[f,v,E,P,L]),V=ka(((e,t)=>{if(m&&m.name===e){const n={pluginKey:`${Bm.mcp_prefix}${e}`,action:"install",auth:t};C.mutate(n)}}),[m,C]),$=ka((e=>{if(m&&m.name===e){const t={pluginKey:`${Bm.mcp_prefix}${e}`,action:"uninstall",auth:{}};C.mutate(t);const n=(f??[]).filter((t=>t!==e));v(n)}}),[m,C,f,v]),B=ka((e=>{const t={pluginKey:`${Bm.mcp_prefix}${e}`,action:"uninstall",auth:{}};C.mutate(t)}),[C]),H=ka((e=>{m&&V(m.name,e)}),[m,V]),G=ka((()=>{m&&$(m.name)}),[m,$]),K=ka((e=>{u(e),!e&&h.current&&setTimeout((()=>{h.current&&"function"==typeof h.current.focus&&h.current.focus(),h.current=null}),0)}),[]),W=ka((e=>{var t;const n=s.getQueryData([Fh.mcpTools]),a=null==(t=null==n?void 0:n.servers)?void 0:t[e],r=null==E?void 0:E[e],o=null==i?void 0:i[e],l=(null==o?void 0:o.customUserVars)&&Object.keys(o.customUserVars).length>0;return{serverName:e,serverStatus:r,tool:a?{name:e,pluginKey:`${Bm.mcp_prefix}${e}`,icon:a.icon,authenticated:a.authenticated}:void 0,onConfigClick:t=>{t.stopPropagation(),t.preventDefault(),h.current=document.activeElement;const n={name:e,pluginKey:`${Bm.mcp_prefix}${e}`,authConfig:(null==a?void 0:a.authConfig)||((null==o?void 0:o.customUserVars)?Object.entries(o.customUserVars).map((([e,t])=>({authField:e,label:t.title,description:t.description}))):[]),authenticated:(null==a?void 0:a.authenticated)??!1};p(n),u(!0)},isInitializing:L(e),canCancel:M(e),onCancel:t=>{t.stopPropagation(),t.preventDefault(),O(e)},hasCustomUserVars:l}}),[s,M,L,O,E,i]),q=ka((()=>{if(!m)return null;const e={};(null==m?void 0:m.authConfig)&&m.authConfig.forEach((t=>{e[t.authField]={title:t.label||t.authField,description:t.description}}));const t={};return(null==m?void 0:m.authConfig)&&m.authConfig.forEach((e=>{t[e.authField]=""})),{serverName:m.name,serverStatus:null==E?void 0:E[m.name],isOpen:d,onOpenChange:K,fieldsSchema:e,initialValues:t,onSave:H,onRevoke:G,isSubmitting:C.isLoading}}),[m,E,d,K,H,G,C.isLoading]);return{availableMCPServers:g,selectableServers:x,availableMCPServersMap:i,isLoading:l,connectionStatus:E,initializeServer:P,cancelOAuthFlow:O,isInitializing:L,isCancellable:M,getOAuthUrl:D,mcpValues:f,setMCPValues:v,isPinned:_,setIsPinned:y,placeholderText:F,batchToggleServers:U,toggleServerSelection:z,localize:a,isConfigModalOpen:d,handleDialogOpenChange:K,selectedToolForConfig:m,setSelectedToolForConfig:p,handleSave:H,handleRevoke:G,revokeOAuthForServer:B,getServerStatusIconProps:W,getConfigDialogProps:q,checkEffectivePermission:w}}function sS(e){const t=qN(),{showToast:n}=Ds(),{getValues:a,setValue:s}=Pi(),r=!1!==(null==e?void 0:e.showToast);return{removeTool:ka((e=>{if(!e)return;const o=a("tools"),i=(null==o?void 0:o.filter((t=>t!==e&&!t.endsWith(`${Bm.mcp_delimiter}${e}`))))||[];s("tools",i,{shouldDirty:!0}),r&&n({message:t("com_ui_delete_tool_save_reminder"),status:"warning"})}),[a,s,n,t,r])}}function rS(e=.01,t=.007,n){const a=ka((e=>{const n=e?e/1048576:0;return e?n<=1?.1:Math.max(.05/Math.sqrt(n),.002):t}),[t]),s=Ca((()=>a(n)),[n,a]),[r,o]=ja(e),i=ka((e=>s),[s,n]);return ya((()=>{let t,n;if(!(e>=1&&r>=1))return e>=1&&r<1?(o(.99),t=setTimeout((()=>{o(1)}),200)):n=setInterval((()=>{o((e=>{if(e>=1)return clearInterval(n),1;const t=i(e);return Math.min(e+t,.95)}))}),200),()=>{clearInterval(n),clearTimeout(t)}}),[r,e,s,n,i]),r}function oS({messageId:e,attachments:t}){const n=j(N_.messageAttachmentsMap),a=Ca((()=>t??n[e??""]??[]),[t,n,e]),s=function(e){const t=qN();return Ca((()=>{const n={};let a=0;return null==e||e.forEach((e=>{if(e.type===Nl.web_search&&e[Nl.web_search]){const t=e[Nl.web_search];t&&"number"==typeof t.turn&&(n[t.turn.toString()]=t)}if(e.type===Nl.file_search&&e[Nl.file_search]){const s=e[Nl.file_search].sources,r=new Map;s.forEach((e=>{const t=e.fileId;if(r.has(t)){const n=r.get(t);if(n){const t=[...n.pages||[],...e.pages||[]],a=[...new Set(t)].sort(((e,t)=>e-t)),s={...n.pageRelevance||{},...e.pageRelevance||{}};n.pages=a,n.relevance=Math.max(n.relevance||0,e.relevance||0),n.pageRelevance=s}}else r.set(t,{fileId:e.fileId,fileName:e.fileName,pages:e.pages||[],relevance:e.relevance||.5,pageRelevance:e.pageRelevance||{},metadata:e.metadata})}));const o={turn:a,organic:[],topStories:[],images:[],references:Array.from(r.values()).map((e=>({title:e.fileName||t("com_file_unknown"),link:`#file-${e.fileId}`,attribution:e.fileName||t("com_file_unknown"),snippet:e.pages&&e.pages.length>0?t("com_file_pages",{pages:e.pages.join(", ")}):"",type:"file",fileId:e.fileId,fileName:e.fileName,pages:e.pages,pageRelevance:e.pageRelevance,metadata:e.metadata})))};n[a.toString()]=o,a++}})),n}),[e,t])}(a);return{attachments:a,searchResults:s}}const iS=(e,t)=>t?`${t}${Bm.COMMON_DIVIDER}${e}`:t;function lS(){const{user:e}=nk(),t=jk(),{ask:n,index:a,getMessages:s,setMessages:r,latestMessage:o}=$N(),{addedIndex:i,ask:l,conversation:c}=gk(),d=j(N_.autoSendPrompts),u=j(N_.allConversationsSelector),m=y(N_.activePromptByIndex(a)),p=ka((e=>{if(!e)return console.warn("No data provided to submitMessage");const a=s();!(null==a?void 0:a.some((e=>e.messageId===(null==o?void 0:o.messageId))))&&o&&r([...a||[],o]);const d=i&&u[i]&&c,m=d&&u.every((e=>e===Bm.NEW_CONVO))&&!(null==a?void 0:a.length)?$():void 0,p=d?$():void 0,h=i-1,g=(new Date).toISOString();n({text:e.text,overrideConvoId:iS(h,m),overrideUserMessageId:iS(h,p),clientTimestamp:g}),d&&l({text:e.text,overrideConvoId:iS(i,m),overrideUserMessageId:iS(i,p),clientTimestamp:g},{overrideMessages:a}),t.reset()}),[n,t,i,c,r,s,u,l,o]),h=ka((n=>{const a=hp({text:n,user:e});if(d)return void p({text:a});const s=t.getValues("text").trim().length>1?`\n${a}`:a;m(s)}),[d,p,m,t,e]);return{submitMessage:p,submitPrompt:h}}const cS=/((?:\\ue203|\ue203).*?(?:\\ue204|\ue204))/g,dS=/((?:\\ue200|\ue200).*?(?:\\ue201|\ue201))/g,uS=/(?:\\ue202|\ue202)turn(\d+)(search|image|news|video|ref|file)(\d+)/g,mS=/\\ue200|\\ue201|\\ue202|\\ue203|\\ue204|\\ue206|\ue200|\ue201|\ue202|\ue203|\ue204|\ue206/g,pS=/\s*(?:\\ue202|\ue202)turn\d+(search|news|image|video|ref|file)\d+/g,hS={search:"organic",ref:"references",news:"topStories",image:"images",video:"videos"};function gS({text:e,content:t,searchResults:n}){const a=ba(null);ya((()=>()=>{a.current&&clearTimeout(a.current)}),[]);return ka((s=>{a.current&&clearTimeout(a.current),s(!0);let r=e??"";if(t&&(r=t.reduce(((e,n,a)=>{if(n.type===qm.TEXT){return e+("string"==typeof n.text?n.text:n.text.value)+(a===t.length-1?"":"\n")}return e}),"")),!n||0===Object.keys(n).length){const e=r.replace(pS,"").replace(mS,"");return J(e,{format:"text/plain"}),void(a.current=setTimeout((()=>{s(!1)}),3e3))}const o=function(e,t){var n,a;const s=new Map,r=new Map;let o=1,i=e;i=i.replace(cS,(e=>`**${e.replace(/\\ue203|\\ue204|\ue203|\ue204/g,"")}**`));const l=[];let c;const d=new RegExp(uS.source,"g");for(;null!==(c=d.exec(i));)l.push({turn:c[1],type:c[2],index:c[3],position:c.index,fullMatch:c[0],isComposite:!1});let u;const m=new RegExp(dS.source,"g");for(;null!==(u=m.exec(i));){const e=u[0],t=u.index;let n;const a=new RegExp(uS.source,"g");for(;null!==(n=a.exec(e));)l.push({turn:n[1],type:n[2],index:n[3],position:t+n.index,fullMatch:e,isComposite:!0})}l.sort(((e,t)=>e.position-t.position));const p=new Set,h=[],g=new Map;for(const x of l){const{turn:e,type:i,index:l,fullMatch:c,isComposite:d}=x,u=t[e];if(!u)continue;const m=hS[i.toLowerCase()]||i.toLowerCase(),f=parseInt(l,10);if(!u[m]||!u[m][f])continue;const v=u[m][f],_=v.link||"";if(!_)continue;let b=r.get(_);b||(b=`${e}-${m}-${f}`,r.set(_,b));const y={link:_,title:v.title||v.name||"",attribution:v.attribution||v.source||"",type:m,typeIndex:f,citationKey:b};if(d&&p.has(c))continue;let j="",w=s.get(b);if(w||(w={referenceNumber:o++,link:y.link,title:y.title,source:y},s.set(b,w)),w){if(d){if(!p.has(c)){const e=[];let i;const l=new RegExp(uS.source,"g");for(;null!==(i=l.exec(c));){const l=i[1],c=i[2],d=i[3],u=hS[c.toLowerCase()]||c.toLowerCase(),m=null==(a=null==(n=t[l])?void 0:n[u])?void 0:a[parseInt(d,10)];if(m&&m.link){const t=m.link;let n=r.get(t);n||(n=`${l}-${u}-${d}`,r.set(t,n));let a=s.get(n);a||(a={referenceNumber:o++,link:m.link,title:m.title||m.name||"",source:{link:m.link,title:m.title||m.name||"",attribution:m.attribution||m.source||"",type:u,typeIndex:parseInt(d,10),citationKey:n}},s.set(n,a)),a&&e.push(a.referenceNumber)}}const d=[...new Set(e)].sort(((e,t)=>e-t));j=d.length>0?d.map((e=>`[${e}]`)).join(""):"",p.add(c),g.set(c,d),h.push([c,j])}continue}j=`[${w.referenceNumber}]`,h.push([c,j])}}h.sort(((e,t)=>t[0].length-e[0].length));for(const[x,f]of h)i=i.replace(x,f);return i=i.replace(/\n\s*\[\d+\](\[\d+\])*\s*$/g,""),i=i.replace(pS,""),i=i.replace(mS,""),{formattedText:i,citations:s}}(r,n);let i=o.formattedText;if(o.citations.size>0){i+="\n\nCitations:\n";const e=Array.from(o.citations.entries()).sort(((e,t)=>e[1].referenceNumber-t[1].referenceNumber));for(const[t,n]of e)i+=`[${n.referenceNumber}] ${n.link}\n`}J(i,{format:"text/plain"}),a.current=setTimeout((()=>{s(!1)}),3e3)}),[e,t,n])}function xS(e){const t=qN(),{user:n}=nk(),a=j(N_.UsernameDisplay),{message:s,currentEditId:r,setCurrentEditId:o,isMultiMessage:i,searchResults:l}=e,{ask:c,index:d,regenerate:u,latestMessage:m,handleContinue:p,setLatestMessage:h,conversation:g,isSubmitting:x}=$N(),{conversation:f,isSubmitting:v}=gk(),_=Ca((()=>!0===i?f:g),[i,f,g]),b=WN(),y=Ik(),{text:w,content:N,messageId:k=null,isCreatedByUser:C}=s??{},S=Ca((()=>k===r),[k,r]),[T,E]=ja((()=>{var e,t;if(null==s?void 0:s.feedback){const n=Ql(null==(t=null==(e=s.feedback)?void 0:e.tag)?void 0:t.key);return{rating:s.feedback.rating,tag:n,text:s.feedback.text}}})),I=ka((e=>o&&o(!0===e?-1:k)),[k,o]),R=Ca((()=>{if(!lc(null==_?void 0:_.endpoint))return;const e=(null==_?void 0:_.endpoint)??"",t=(null==s?void 0:s.model)??"";return(null==y?void 0:y[e])?y[e][t]:void 0}),[null==_?void 0:_.endpoint,null==s?void 0:s.model,y]),A=Ca((()=>{if(!cc(null==_?void 0:_.endpoint))return;if(!b)return;const e=(null==s?void 0:s.model)??"";if(e)return b[e];const t=(null==_?void 0:_.agent_id)??"";return t?b[t]:void 0}),[b,null==_?void 0:_.agent_id,null==_?void 0:_.endpoint,null==s?void 0:s.model]),P=Ca((()=>!0===i?v:x),[i,v,x]),O=ka((()=>{P&&!0===C||!s||u(s)}),[P,C,s,u]),L=gS({text:w,content:N,searchResults:l}),M=Ca((()=>!0===(null==s?void 0:s.isCreatedByUser)?a?((null==n?void 0:n.name)??"")||(null==n?void 0:n.username):t("com_user_message"):A?A.name??"Assistant":R?R.name??"Assistant":null==s?void 0:s.sender),[s,A,R,a,n,t]),D=AN((null==_?void 0:_.conversationId)||"",(null==s?void 0:s.messageId)||""),F=ka((({feedback:e})=>{const t={feedback:e?ql(e):void 0};D.mutate(t,{onSuccess:e=>{var t;if(e.feedback){const n=Ql((null==(t=e.feedback)?void 0:t.tag)??void 0);E({rating:e.feedback.rating,tag:n,text:e.feedback.text})}else E(void 0)},onError:e=>{console.error("Failed to update feedback:",e)}})}),[D]);return{ask:c,edit:S,index:d,agent:A,assistant:R,enterEdit:I,conversation:_,messageLabel:M,isSubmitting:P,latestMessage:m,handleContinue:p,copyToClipboard:L,setLatestMessage:h,regenerateMessage:O,handleFeedback:F,feedback:T}}function fS({message:e}){const t=ba(""),[n,a]=ja(null),s=Ca((()=>{var t;return 0===((null==(t=null==e?void 0:e.children)?void 0:t.length)??0)}),[e]),{index:r,conversation:o,latestMessage:i,setAbortScroll:l,setLatestMessage:c,isSubmittingFamily:d}=oC(),u=j(N_.latestMessageFamily(r+1));ya((()=>{const n=null==o?void 0:o.conversationId;if(n===Bm.NEW_CONVO)return;if(!e)return;if(!s)return;const a=df(e,n),r={textKey:a,"latestText.current":t.current,messageId:e.messageId,convoId:n};let i=null;if(t.current&&"string"==typeof t.current&&t.current.length>0){const e=t.current.split(of);i=e[e.length-1]||null}a!==t.current||null!=n&&null!=i&&n!==i?(cx.log("latest_message","[useMessageProcess] Setting latest message; logInfo:",r),t.current=a,c({...e})):cx.log("latest_message","No change in latest message; logInfo",r)}),[s,e,c,null==o?void 0:o.conversationId]);const m=ka((e=>{_i((()=>{cx.log("message_scrolling",`useMessageProcess: setting abort scroll to ${d}, handleScroll event`,e),l(!!d)}),500)()}),[d,l]),p=Ca((()=>{var e;return s&&u&&0===((null==(e=u.children)?void 0:e.length)??0)||!!n}),[s,u,n]);return ya((()=>{if(s&&u&&u.conversationId===(null==e?void 0:e.conversationId)){const t=Object.assign({},u,{parentMessageId:e.parentMessageId,depth:e.depth});a(t)}}),[s,u,e,a,i]),{showSibling:p,handleScroll:m,conversation:o,siblingMessage:n,setSiblingMessage:a,isSubmittingFamily:d,latestMultiMessage:u}}const vS=.85,_S=150;function bS(e){const t=j(N_.autoScroll),n=ba(null),a=ba(null),[s,r]=ja(!1),{conversation:o,conversationId:i}=iC(),{setAbortScroll:l,isSubmitting:c,abortScroll:d}=function(){const{isSubmitting:e,isSubmittingFamily:t,abortScroll:n,setAbortScroll:a}=oC();return Ca((()=>({isSubmitting:e,isSubmittingFamily:t,abortScroll:n,setAbortScroll:a})),[e,t,n,a])}(),u=ba(),m=ka((e=>{clearTimeout(u.current),u.current=setTimeout((()=>{r(e)}),_S)}),[]);ya((()=>{if(!a.current||!n.current)return;const e=new IntersectionObserver((([e])=>{m(!e.isIntersecting)}),{root:n.current,threshold:vS});return e.observe(a.current),()=>{e.disconnect(),clearTimeout(u.current)}}),[a,n,m]);const p=ka((()=>{if(a.current&&n.current){const e=new IntersectionObserver((([e])=>{m(!e.isIntersecting)}),{root:n.current,threshold:vS});return e.observe(a.current),()=>e.disconnect()}}),[m]),h=()=>m(!1),{scrollToRef:g,handleSmoothToRef:x}=function({targetRef:e,callback:t,smoothCallback:n}){const a=(t,n)=>{var a;null==(a=e.current)||a.scrollIntoView({behavior:t}),n()},s=ka(_i((()=>a("instant",t)),145,{leading:!0}),[e]),r=ka(_i((()=>a("smooth",n)),750,{leading:!0}),[e]);return{scrollToRef:s,handleSmoothToRef:e=>{e.preventDefault(),r()}}}({targetRef:a,callback:h,smoothCallback:()=>{h(),l(!1)}});return ya((()=>{if(e&&0!==e.length&&a.current&&n.current)return c&&g&&!0!==d&&g(),()=>{!0===d&&g&&g.cancel()}}),[c,e,g,d]),ya((()=>{a.current&&n.current&&g&&t&&i!==Bm.NEW_CONVO&&g()}),[t,i,g]),{conversation:o,scrollableRef:n,messagesEndRef:a,scrollToBottom:g,showScrollButton:s,handleSmoothToRef:x,debouncedHandleScroll:p}}function yS({conversationId:e,toolKey:t,localStorageKey:n,isAuthenticated:a,setIsDialogOpen:s,authConfig:r}){var o;const i=e??Bm.NEW_CONVO,[l,c]=b(__(i)),d=ob({toolId:(null==r?void 0:r.toolId)||""},{enabled:!!(null==r?void 0:r.toolId),...null==r?void 0:r.queryOptions}),u=Ca((()=>{var e;return a??(!!r&&((null==(e=null==d?void 0:d.data)?void 0:e.authenticated)??!1))}),[a,r,null==(o=d.data)?void 0:o.authenticated]),m=Ca((()=>t),[t]),p=Ca((()=>`${n}${i}`),[n,i]),h=Ca((()=>(null==l?void 0:l[m])??!1),[l,m]),g=Ca((()=>"string"==typeof h?h.length>0:!0===h),[h]);ya((()=>{const e=null==l?void 0:l[m];void 0!==e&&(localStorage.setItem(p,JSON.stringify(e)),Wf(p))}),[l,m,p]);const[x,f]=function(e,t,n,a){const[s,r]=ja(t);return ya((()=>{const n=localStorage.getItem(e);n||localStorage.setItem(e,JSON.stringify(t));const a=n&&"undefined"!==n?JSON.parse(n):t;function s(t){if(t.key!==e)return;const n=localStorage.getItem(e);r(JSON.parse(n??""))}return r(a),window.addEventListener("storage",s),()=>{window.removeEventListener("storage",s)}}),[e,n]),[s,ka((t=>{try{r(t),a||(localStorage.setItem(e,JSON.stringify(t)),null==window||window.dispatchEvent(new StorageEvent("storage",{key:e}))),null==n||n(t)}catch(s){console.error(s)}}),[e,n,a])]}(`${n}pinned`,!1),v=ka((({e:e,value:t})=>{var n;if(void 0!==u&&!u&&s)return s(!0),null==(n=null==e?void 0:e.preventDefault)||n.call(e),void c((e=>({...e||{},[m]:!1})));c((e=>({...e||{},[m]:t})))}),[s,u,c,m]),_=Ca((()=>xi(v,50,{leading:!0})),[v]);return{toggleState:h,handleChange:v,isToolEnabled:g,toolValue:h,setToggleState:e=>v({value:e}),ephemeralAgent:l,debouncedChange:_,setEphemeralAgent:c,authData:null==d?void 0:d.data,isPinned:x,setIsPinned:f}}const jS=e=>{const t=xs(),n=null==e?void 0:e.isEntityTool,a=TN({onMutate:e=>{t.setQueryData([Fh.toolAuth,Nl.execute_code],(()=>({authenticated:"install"===e.action,message:Hl.USER_PROVIDED})))},onSuccess:()=>{t.invalidateQueries([Fh.toolAuth,Nl.execute_code])},onError:()=>{t.invalidateQueries([Fh.toolAuth,Nl.execute_code])}}),s=ka((e=>{a.mutate({pluginKey:Nl.execute_code,action:"install",auth:{LIBRECHAT_CODE_API_KEY:e},isEntityTool:n})}),[a,n]);return{removeTool:ka((()=>{a.mutate({pluginKey:Nl.execute_code,action:"uninstall",auth:{LIBRECHAT_CODE_API_KEY:null},isEntityTool:n})}),[a,n]),installTool:s}};function wS({onSubmit:e,onRevoke:t}){const n=Oi(),a=ba(null),s=ba(null),[r,o]=ja(!1),{installTool:i,removeTool:l}=jS({isEntityTool:!0}),{reset:c}=n,d=ka((t=>{c(),i(t.apiKey),o(!1),null==e||e()}),[e,c,i]),u=ka((()=>{c(),l(),o(!1),null==t||t()}),[c,t,l]);return{methods:n,isDialogOpen:r,setIsDialogOpen:o,handleRevokeApiKey:u,onSubmit:d,badgeTriggerRef:s,menuTriggerRef:a}}const NS=e=>{const t=xs(),n=null==e?void 0:e.isEntityTool,a=TN({onMutate:e=>{t.setQueryData([Fh.toolAuth,Nl.web_search],(()=>({authenticated:"install"===e.action,authTypes:"install"===e.action?[["providers",Hl.USER_PROVIDED],["scrapers",Hl.USER_PROVIDED],["rerankers",Hl.USER_PROVIDED]]:[]})))},onSuccess:()=>{t.invalidateQueries([Fh.toolAuth,Nl.web_search])},onError:()=>{t.invalidateQueries([Fh.toolAuth,Nl.web_search])}}),s=ka((e=>{const t=Object.entries({serperApiKey:e.serperApiKey,searxngInstanceUrl:e.searxngInstanceUrl,searxngApiKey:e.searxngApiKey,firecrawlApiKey:e.firecrawlApiKey,firecrawlApiUrl:e.firecrawlApiUrl,jinaApiKey:e.jinaApiKey,jinaApiUrl:e.jinaApiUrl,cohereApiKey:e.cohereApiKey}).reduce(((e,[t,n])=>(n&&(e[t]=n),e)),{});a.mutate({pluginKey:Nl.web_search,action:"install",auth:t,isEntityTool:n})}),[a,n]);return{removeTool:ka((()=>{a.mutate({pluginKey:Nl.web_search,action:"uninstall",auth:{},isEntityTool:n})}),[a,n]),installTool:s}};function kS({onSubmit:e,onRevoke:t}){const n=Oi(),a=ba(null),s=ba(null),[r,o]=ja(!1),{installTool:i,removeTool:l}=NS({isEntityTool:!0}),{reset:c}=n,d=ka((t=>{i(t),o(!1),null==e||e()}),[e,i]),u=ka((()=>{c(),l(),o(!1),null==t||t()}),[c,t,l]);return{methods:n,isDialogOpen:r,setIsDialogOpen:o,handleRevokeApiKey:u,onSubmit:d,badgeTriggerRef:s,menuTriggerRef:a}}function CS(){const[e,t]=ja(1),[n,a]=ja(1),[s,r]=ja(1),[o,i]=ja(!1),[l,c]=ja(""),[d,u]=ja(!1),[m,p]=ja(""),[h,g]=ja(!1),[x,f]=ja(void 0),v=e=>{const t=e.offsetWidth;let n;t<501?r(8):(n=t<640?2:t<1024?3:4,r(2*n))},_=ka((e=>{if(null!==e){1===s&&v(e);new ResizeObserver((()=>v(e))).observe(e)}}),[s]);return{maxPage:e,setMaxPage:t,currentPage:n,setCurrentPage:a,itemsPerPage:s,setItemsPerPage:r,searchChanged:o,setSearchChanged:i,searchValue:l,setSearchValue:c,gridRef:_,handleSearch:e=>{c(e.target.value),i(!0)},handleChangePage:e=>{a(e)},error:d,setError:u,errorMessage:m,setErrorMessage:p,showPluginAuthForm:h,setShowPluginAuthForm:g,selectedPlugin:x,setSelectedPlugin:f}}const SS=[{label:"com_ui_loading",value:""}],TS={label:"com_ui_empty_category",value:""},ES=({className:e="",hasAccess:t=!0})=>{const n=qN(),{data:a=SS}=(s={enabled:t,select:t=>t.map((t=>({label:n(t.label),value:t.value,icon:t.value?l.jsx(eC,{category:t.value,className:e}):null})))},gs([Fh.categories],(()=>Jh.getCategories()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...s,enabled:void 0===(null==s?void 0:s.enabled)||s.enabled}));var s;return{categories:a,emptyCategory:TS}};const IS=()=>{const e=ak({permissionType:Pp.PEOPLE_PICKER,permission:Op.VIEW_USERS}),t=ak({permissionType:Pp.PEOPLE_PICKER,permission:Op.VIEW_GROUPS}),n=ak({permissionType:Pp.PEOPLE_PICKER,permission:Op.VIEW_ROLES}),a=e||t||n,s=Ca((()=>{const a=[];return e&&a.push(Rh.USER),t&&a.push(Rh.GROUP),n&&a.push(Rh.ROLE),0===a.length||3===a.length?null:a}),[e,t,n]);return{canViewUsers:e,canViewRoles:n,canViewGroups:t,hasPeoplePickerAccess:a,peoplePickerTypeFilter:s}},RS=(e,t,n=!1)=>{var a;const s=(e=>Ef[e])(e),r=!!t&&""!==t.trim(),{data:o,isLoading:i,error:l}=LN(e,t||"",{enabled:r}),c=MN(),d=(null==(a=null==o?void 0:o.principals)?void 0:a.map((e=>({type:e.type,id:e.id,name:e.name,email:e.email,source:e.source,avatar:e.avatar,description:e.description,accessRoleId:e.accessRoleId,idOnTheSource:e.idOnTheSource}))))||[],u=(null==o?void 0:o.public)??!1,m=(null==o?void 0:o.publicAccessRoleId)||(null==s?void 0:s.defaultViewerRoleId),[p,h]=ja(!1),[g,x]=ja(null==s?void 0:s.defaultViewerRoleId);return ya((()=>{o&&n&&(h(u??!1),x(m))}),[o,n,u,m]),{config:s,permissionsData:o,isLoadingPermissions:i,permissionsError:l,updatePermissionsMutation:c,currentShares:d,currentIsPublic:u,currentPublicRole:m,isPublic:p,setIsPublic:h,publicRole:g,setPublicRole:x}};function AS(e){const t=y(N_.messageAttachmentsMap);return({data:n})=>{const{messageId:a}=n;if(e&&(null==n?void 0:n.filepath)&&!n.filepath.includes("/api/files")&&e.setQueryData([Fh.files],(e=>[n,...e||[]])),e&&n.type===Nl.memory&&n[Nl.memory]){const t=n[Nl.memory];e.setQueryData([Fh.memories],(e=>e&&function({memoryArtifact:e,currentData:t}){const{type:n,key:a,value:s,tokenCount:r=0}=e;if("update"===n&&!s)return;const o=t.memories,i=o.findIndex((e=>e.key===a));if("delete"===n){if(-1===i)return;const e=o[i],n=[...o];n.splice(i,1);const a=t.totalTokens-(e.tokenCount||0),s=t.tokenLimit?Math.min(100,Math.round(a/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:a,usagePercentage:s}}if("update"===n){const e=(new Date).toISOString();let n,l=t.totalTokens;i>=0?(l=l-(o[i].tokenCount||0)+r,n=[...o],n[i]={key:a,value:s,tokenCount:r,updated_at:e}):(l+=r,n=[...o,{key:a,value:s,tokenCount:r,updated_at:e}]);const c=t.tokenLimit?Math.min(100,Math.round(l/t.tokenLimit*100)):null;return{...t,memories:n,totalTokens:l,usagePercentage:c}}}({memoryArtifact:t,currentData:e})||e))}t((e=>{const t=e[a]||[];return{...e,[a]:[...t,n]}}))}}const PS=({errorMetadata:e,getMessages:t,submission:n,error:a})=>{const s=t(),r=null==s?void 0:s[s.length-1];let o;const i=n.initialResponse.text.length>45?n.initialResponse.text:"",l=((null==e?void 0:e.text)||i||(null==a?void 0:a.message))??"Error cancelling request",c=(null==r?void 0:r.content)??[];let d=!1;if(c.length>0){const e=c[c.length-1];if(null!=e){const t=e[e.type??""];d=e.type!==qm.TEXT||e.type===qm.TEXT&&"string"==typeof t||""!==(null==t?void 0:t.value)}}if((null==r?void 0:r.conversationId)&&(null==r?void 0:r.messageId)&&c&&d){const t=[...c];return t.push({type:qm.ERROR,error:l}),o={...r,...e,error:void 0,text:"",content:t},n.userMessage.messageId&&n.userMessage.messageId!==o.parentMessageId&&(o.parentMessageId=n.userMessage.messageId),o}return e||(o={...n,...n.initialResponse,text:l,unfinished:!!i.length,error:!0},Pc.parse(o))},OS=({parentId:e,queryClient:t,currentTitle:n,conversationId:a})=>{if(e!==Bm.NO_PARENT&&(null==n?void 0:n.toLowerCase().includes("new chat"))){const e=t.getQueryData([Fh.conversation,a]);if(null==e?void 0:e.title)return e.title;const n=Kx(t.getQueryData([Fh.allConversations]),a??"");return(null==n?void 0:n.title)??(null==e?void 0:e.title)??null}return n};function LS({genTitle:e,setMessages:t,getMessages:n,setCompleted:a,isAddedRequest:s=!1,setConversation:r,setIsSubmitting:o,newConversation:i,setShowStopButton:l,resetLatestMessage:c}){const d=xs(),{announcePolite:u}=Pk(),m=uC(),p=y(N_.abortScroll),h=E(),g=T(),x=ba(Date.now()),{conversationId:f}=W(),{token:v}=nk(),_=function({setMessages:e,getMessages:t}){const n=xs(),a=Ca((()=>new Map),[]);return ka((({data:s,submission:r})=>{var o,i;const{type:l,messageId:c,thread_id:d,conversationId:u,index:m}=s,p=t(),h=(null==p?void 0:p.filter((e=>e.messageId!==c)).map((e=>({...e,thread_id:d}))))??[],g=h[h.length-1],{initialResponse:x}=r;let f=a.get(c);f||(f={...x,parentMessageId:(null==g?void 0:g.messageId)??"",conversationId:u,messageId:c,thread_id:d},a.set(c,f));const v=s[qm.TEXT],_=null!=v&&"string"==typeof v?{value:v}:s[l];l===qm.IMAGE_FILE&&yx(n,_),f.content=[...f.content??[]],f.content[m]={type:l,[l]:_};const b=f.content[f.content.length-1],y=null==(o=x.content)?void 0:o[0];l!==qm.TEXT&&null!=y&&null!=b&&(b.type===qm.TOOL_CALL&&1===(null==(i=b[qm.TOOL_CALL])?void 0:i.progress)||b.type===qm.IMAGE_FILE)&&f.content.push(y),e([...h,f])}),[n,t,a,e])}({setMessages:t,getMessages:n}),{stepHandler:b,clearStepMaps:j}=function({setMessages:e,getMessages:t,setIsSubmitting:n,announcePolite:a,lastAnnouncementTimeRef:s}){const r=ba(new Map),o=ba(new Map),i=ba(new Map),l=(e,t,n,a)=>{var s;if(t.length>0&&(n===qm.TEXT||n===qm.THINK)){const r=e+t.length-1;if((null==(s=null==a?void 0:a[r])?void 0:s.type)===n)return r}return e+t.length},c=(e,t,n,a=!1)=>{var s;const r=n.type??"";if(!r)return console.warn("No content type found in content part"),e;const o=[...e.content||[]];o[t]||(o[t]={type:n.type});const i=(null==(s=o[t])?void 0:s.type)??"";if(i&&!r.startsWith(i))return console.warn("Content type mismatch"),e;if(r.startsWith(qm.TEXT)&&qm.TEXT in n&&"string"==typeof n.text){const e=o[t],a={type:qm.TEXT,text:(e.text||"")+n.text};null!=n.tool_call_ids&&(a.tool_call_ids=n.tool_call_ids),o[t]=a}else if(r.startsWith(qm.AGENT_UPDATE)&&qm.AGENT_UPDATE in n&&n.agent_update){const e={type:qm.AGENT_UPDATE,agent_update:n.agent_update};o[t]=e}else if(r.startsWith(qm.THINK)&&qm.THINK in n&&"string"==typeof n.think){const e=o[t],a={type:qm.THINK,think:(e.think||"")+n.think};o[t]=a}else if(r===qm.IMAGE_URL&&"image_url"in n){const e=o[t];o[t]={...e}}else if(r===qm.TOOL_CALL&&"tool_call"in n){const e=o[t],s=null==e?void 0:e.tool_call,r=n.tool_call.args;let i=a||"object"==typeof(null==s?void 0:s.args)||"object"==typeof r?n.tool_call.args:((null==s?void 0:s.args)??"")+(r??"");a&&null==i&&null!=(null==s?void 0:s.args)&&(i=s.args);const l={id:rp([n.tool_call.id,null==s?void 0:s.id])??"",name:rp([n.tool_call.name,null==s?void 0:s.name])??"",args:i,type:Ym.TOOL_CALL,auth:n.tool_call.auth,expires_at:n.tool_call.expires_at};a&&(l.progress=1,l.output=n.tool_call.output),o[t]={type:qm.TOOL_CALL,tool_call:l}}return{...e,content:o}};return{stepHandler:ka((({event:d,data:u},m)=>{var p,h,g,x,f,v,_,b,y,j,w,N,k;const C=t()||[],{userMessage:S}=m;n(!0);let T=S.messageId;const E=Date.now();E-s.current>Jg&&(a({message:"composing",isStatus:!0}),s.current=E);let I=[];if(null!=(null==m?void 0:m.editedContent)&&(I=(null==(p=null==m?void 0:m.initialResponse)?void 0:p.content)??I),"on_run_step"===d){const t=u;let n=t.runId??"";if(n===Bm.USE_PRELIM_RESPONSE_MESSAGE_ID&&(n=(null==(h=null==m?void 0:m.initialResponse)?void 0:h.messageId)??"",T=(null==(g=null==m?void 0:m.initialResponse)?void 0:g.parentMessageId)??""),!n)return void console.warn("No message id found in run step event");i.current.set(t.id,t);let a=o.current.get(n);if(a||(a={...C[C.length-1],parentMessageId:T,conversationId:S.conversationId,messageId:n,content:I},o.current.set(n,a),e([...C.slice(0,-1),a])),t.stepDetails.type===Qm.TOOL_CALLS){let s={...a};t.stepDetails.tool_calls.forEach((e=>{const n=e.id??"";"id"in e&&n&&r.current.set(t.id,n);const a={type:qm.TOOL_CALL,tool_call:{name:e.name??"",args:e.args,id:n}},o=t.index+I.length;s=c(s,o,a)})),o.current.set(n,s);const i=C.map((e=>e.messageId===n?s:e));e(i)}}else if("on_agent_update"===d){const{agent_update:n}=u;let a=n.runId||"";if(a===Bm.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(x=null==m?void 0:m.initialResponse)?void 0:x.messageId)??"",T=(null==(f=null==m?void 0:m.initialResponse)?void 0:f.parentMessageId)??""),!a)return void console.warn("No message id found in agent update event");const s=o.current.get(a);if(s){const r=n.index+I.length,i=c(s,r,u);o.current.set(a,i);const l=t()||[];e([...l.slice(0,-1),i])}}else if("on_message_delta"===d){const n=u,a=i.current.get(n.id);let s=(null==a?void 0:a.runId)??"";if(s===Bm.USE_PRELIM_RESPONSE_MESSAGE_ID&&(s=(null==(v=null==m?void 0:m.initialResponse)?void 0:v.messageId)??"",T=(null==(_=null==m?void 0:m.initialResponse)?void 0:_.parentMessageId)??""),!a||!s)return void console.warn("No run step or runId found for message delta event");const r=o.current.get(s);if(r&&n.delta.content){const i=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content;if(null==i)return;const d=l(a.index,I,i.type||"",r.content),u=c(r,d,i);o.current.set(s,u);const m=t()||[];e([...m.slice(0,-1),u])}}else if("on_reasoning_delta"===d){const n=u,a=i.current.get(n.id);let s=(null==a?void 0:a.runId)??"";if(s===Bm.USE_PRELIM_RESPONSE_MESSAGE_ID&&(s=(null==(b=null==m?void 0:m.initialResponse)?void 0:b.messageId)??"",T=(null==(y=null==m?void 0:m.initialResponse)?void 0:y.parentMessageId)??""),!a||!s)return void console.warn("No run step or runId found for reasoning delta event");const r=o.current.get(s);if(r&&null!=n.delta.content){const i=Array.isArray(n.delta.content)?n.delta.content[0]:n.delta.content;if(null==i)return;const d=l(a.index,I,i.type||"",r.content),u=c(r,d,i);o.current.set(s,u);const m=t()||[];e([...m.slice(0,-1),u])}}else if("on_run_step_delta"===d){const t=u,n=i.current.get(t.id);let a=(null==n?void 0:n.runId)??"";if(a===Bm.USE_PRELIM_RESPONSE_MESSAGE_ID&&(a=(null==(j=null==m?void 0:m.initialResponse)?void 0:j.messageId)??"",T=(null==(w=null==m?void 0:m.initialResponse)?void 0:w.parentMessageId)??""),!n||!a)return void console.warn("No run step or runId found for run step delta event");const s=o.current.get(a);if(s&&t.delta.type===Qm.TOOL_CALLS&&t.delta.tool_calls){let i={...s};t.delta.tool_calls.forEach((e=>{const a=r.current.get(t.id)??"",s={type:qm.TOOL_CALL,tool_call:{name:e.name??"",args:e.args??"",id:a}};null!=t.delta.auth&&(s.tool_call.auth=t.delta.auth,s.tool_call.expires_at=t.delta.expires_at);const o=n.index+I.length;i=c(i,o,s)})),o.current.set(a,i);const l=C.map((e=>e.messageId===a?i:e));e(l)}}else if("on_run_step_completed"===d){const{result:t}=u,{id:n}=t,a=i.current.get(n);let s=(null==a?void 0:a.runId)??"";if(s===Bm.USE_PRELIM_RESPONSE_MESSAGE_ID&&(s=(null==(N=null==m?void 0:m.initialResponse)?void 0:N.messageId)??"",T=(null==(k=null==m?void 0:m.initialResponse)?void 0:k.parentMessageId)??""),!a||!s)return void console.warn("No run step or runId found for completed tool call event");const r=o.current.get(s);if(r){let n={...r};const i={type:qm.TOOL_CALL,tool_call:t.tool_call},l=a.index+I.length;n=c(n,l,i,!0),o.current.set(s,n);const d=C.map((e=>e.messageId===s?n:e));e(d)}}return()=>{r.current.clear(),o.current.clear(),i.current.clear()}}),[t,n,s,a,e]),clearStepMaps:ka((()=>{r.current.clear(),o.current.clear(),i.current.clear()}),[])}}({setMessages:t,getMessages:n,announcePolite:u,setIsSubmitting:o,lastAnnouncementTimeRef:x}),w=AS(d),N=ka(((e,n)=>{const{messages:a,userMessage:s,initialResponse:r,isRegenerate:i=!1}=n,l=e??"";o(!0);const c=Date.now();c-x.current>Jg&&(u({message:"composing",isStatus:!0}),x.current=c),t(i?[...a,{...r,text:l}]:[...a,s,{...r,text:l}])}),[t,u,o]),k=ka(((n,a)=>{const{requestMessage:i,responseMessage:l,conversation:c}=n,{messages:u,isRegenerate:m=!1}=a,p=c??a.conversation;if(m){const e=[...u,l].filter((e=>e));t(e)}else{const e=[...u,i,l].filter((e=>e));t(e)}const h=c.conversationId!==a.conversation.conversationId;h&&Qx(d,a.conversation.conversationId),e&&h&&i.parentMessageId===Bm.NO_PARENT&&setTimeout((()=>{e.mutate({conversationId:p.conversationId})}),2500),r&&!s&&r((e=>({...e,...p}))),o(!1)}),[t,r,e,s,d,o]),C=ka(((e,n)=>{const{conversationId:a,thread_id:o,responseMessage:i,requestMessage:m}=e,{initialResponse:p,messages:h,userMessage:g}=n,x=h.filter((e=>e.messageId!==g.messageId));t([...x,m,{...p,...i}]),u({message:"start",isStatus:!0});let f={};r&&!s?(r((e=>{const t=m.parentMessageId,n=OS({parentId:t,queryClient:d,conversationId:a,currentTitle:null==e?void 0:e.title});return f=Fc.parse({...e,conversationId:a,thread_id:o,title:n,messages:[m.messageId,i.messageId]}),f})),m.parentMessageId===Bm.NO_PARENT?Wx(d,f):qx(d,f.conversationId,(e=>f))):r&&r((e=>(f=Fc.parse({...e,conversationId:a,thread_id:o,messages:[m.messageId,i.messageId]}),f))),l(!0),c&&(cx.log("latest_message","syncHandler: resetting latest message"),c())}),[d,t,s,u,r,l,c]),S=ka(((e,n)=>{var a,o;d.invalidateQueries([Fh.mcpConnectionStatus]);const{messages:i,userMessage:l,isRegenerate:h=!1,isTemporary:g=!1}=n,f={...n.initialResponse,parentMessageId:l.messageId,messageId:l.messageId+"_"};t(h?[...i,f]:[...i,l,f]);const{conversationId:v,parentMessageId:_}=l;x.current=Date.now(),u({message:"start",isStatus:!0});let b={};r&&!s?(r((e=>{const t=h?l.overrideParentMessageId:_,n=OS({parentId:t,queryClient:d,conversationId:v,currentTitle:null==e?void 0:e.title});return b=Fc.parse({...e,conversationId:v,title:n}),b})),g||(_===Bm.NO_PARENT?Wx(d,b):qx(d,b.conversationId,(e=>b)))):r&&r((e=>(b=Fc.parse({...e,conversationId:v}),b))),v&&m({targetId:v,sourceId:null==(a=n.conversation)?void 0:a.conversationId,ephemeralAgent:n.ephemeralAgent,specName:null==(o=n.conversation)?void 0:o.spec,startupConfig:d.getQueryData([Fh.startupConfig])}),c&&(cx.log("latest_message","createdHandler: resetting latest message"),c()),uf((()=>p(!1)))}),[t,d,p,s,u,r,c,m]),I=ka(((i,c)=>{var p,x,f,v,_,b,y,j,N,k,C;const{requestMessage:S,responseMessage:T,conversation:E,runMessages:I}=i,{messages:R,conversation:A,isRegenerate:P=!1,isTemporary:O=!1}=c;try{(null==T?void 0:T.attachments)&&T.attachments.length>0&&T.attachments.forEach((e=>{const t={...e,messageId:T.messageId};w({data:t,submission:c})})),a((e=>new Set(e.add(c.initialResponse.messageId))));const o=n();if(!o||0===o.length)return;u({message:"end",isStatus:!0}),u({message:cf(T)});const i=E.conversationId!==A.conversationId,l=(e,n)=>{t(n),d.setQueryData([Fh.messages,e],n)},L=(null==(f=null==(x=null==(p=null==T?void 0:T.content)?void 0:p[0])?void 0:x.text)?void 0:f.value)===(null==(y=null==(b=null==(_=null==(v=c.initialResponse)?void 0:v.content)?void 0:_[0])?void 0:b.text)?void 0:y.value)||!!(null==(k=null==(N=null==(j=null==T?void 0:T.content)?void 0:j[0])?void 0:N.tool_call)?void 0:k.auth);if(!E.conversationId&&L){const e=(A.conversationId??E.conversationId)||Bm.NEW_CONVO;i&&A.conversationId&&Qx(d,A.conversationId);const t=g.pathname===`/c/${Bm.NEW_CONVO}`&&e===Bm.NEW_CONVO;return l(e,t?[]:[...R]),Ux({id:e,value:null==S?void 0:S.text}),void(t&&h(`/c/${Bm.NEW_CONVO}`,{replace:!0,state:{focusChat:!0}}))}let M=[];I?M=[...I]:P&&T?M=[...R,T]:null!=S&&null!=T&&(M=[...R,S,T]),M.length>0?l(E.conversationId,M):!lc(A.endpoint)||A.conversationId&&A.conversationId!==Bm.NEW_CONVO||d.setQueryData([Fh.messages,E.conversationId],[...o]),i&&A.conversationId&&Qx(d,A.conversationId),e&&i&&!O&&S&&S.parentMessageId===Bm.NO_PARENT&&setTimeout((()=>{e.mutate({conversationId:E.conversationId})}),2500),r&&!0!==s&&(r((e=>{const t={...e,...E};null!=(null==e?void 0:e.model)&&e.model!==A.model&&(t.model=e.model);return d.getQueryData([Fh.conversation,E.conversationId])||d.setQueryData([Fh.conversation,E.conversationId],t),t})),E.conversationId&&c.ephemeralAgent&&m({targetId:E.conversationId,sourceId:A.conversationId,ephemeralAgent:c.ephemeralAgent,specName:null==(C=c.conversation)?void 0:C.spec,startupConfig:d.getQueryData([Fh.startupConfig])}),g.pathname===`/c/${Bm.NEW_CONVO}`&&h(`/c/${E.conversationId}`,{replace:!0}))}finally{l(!1),o(!1)}}),[h,e,n,t,d,a,s,u,r,o,l,g.pathname,m,w]),R=ka((({data:e,submission:s})=>{var r;const{messages:l,userMessage:c,initialResponse:u}=s;a((e=>new Set(e.add(u.messageId))));const m=c.conversationId??(null==(r=s.conversation)?void 0:r.conversationId)??"",p=(e,n)=>{const a=[...l,c,n];t(a),d.setQueryData([Fh.messages,e],a)},h=e=>{const t=e.responseMessage??e,n={...u,...t,error:!0,parentMessageId:c.messageId};return void 0!==n.messageId&&""!==n.messageId||(n.messageId=$()),Pc.parse(n)};if(!e){const e=m||`_${$()}`,t=h({text:"Error connecting to server, try refreshing the page.",...s,conversationId:e});return p(e,PS({errorMetadata:t,getMessages:n,submission:s})),i&&i({template:{conversationId:e},preset:Dc.parse(s.conversation)}),void o(!1)}const g=e.conversationId??"";if(!m&&!g){const t=`_${$()}`;return p(t,h(e)),i&&i({template:{conversationId:t},preset:Dc.parse(s.conversation)}),void o(!1)}if(!g){return p(m,h(e)),void o(!1)}p(g,Pc.parse({...e,error:!0,parentMessageId:c.messageId})),g&&f===Bm.NEW_CONVO&&i&&i({template:{conversationId:g},preset:Dc.parse(s.conversation)}),o(!1)}),[a,t,f,i,o,n,d]),A=ka((async(e="",a,s)=>{var r,c;const d=`${e}:${(null==(r=null==s?void 0:s[s.length-1])?void 0:r.messageId)??""}`,{endpoint:u,endpointType:m}=a.conversation??{},p=m??u;if(lc(p)||null==(null==s?void 0:s[s.length-1])||null==s[s.length-2]){if(!lc(p)){const t=e||`_${$()}`;return cx.log("conversation","Aborted conversation with minimal messages, ID: "+t),i&&i({template:{conversationId:t},preset:Dc.parse(a.conversation)}),void o(!1)}try{const e=await fetch(`${Rm[p??""]}/abort`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify({abortKey:d,endpoint:p})}),t=e.headers.get("content-type");if(null!=t&&t.includes("application/json")){const t=await e.json();if(404===e.status)return void o(!1);!0===t.final?I(t,a):k(t,a)}else{if(204!==e.status&&200!==e.status)throw new Error("Unexpected response from server; Status: "+e.status+" "+e.statusText);o(!1)}}catch(h){const s=PS({getMessages:n,submission:a,error:h});t([...a.messages,a.userMessage,s]),i&&i({template:{conversationId:e||s.conversationId||$()},preset:Dc.parse(a.conversation)}),o(!1)}}else{let t=s[s.length-2];const n=s[s.length-1];if(t.messageId!==n.parentMessageId)for(let e=s.length-3;e>=0;e--)if(s[e].messageId===n.parentMessageId){t=s[e];break}const r={...n,content:null==(c=n.content)?void 0:c.filter((e=>null!=e))};try{I({conversation:{conversationId:e},requestMessage:t,responseMessage:r},a)}catch(h){console.error("Error in finalHandler during abort:",h),l(!1),o(!1)}}}),[v,n,t,I,k,i,o,l]);return{clearStepMaps:j,stepHandler:b,syncHandler:C,finalHandler:I,errorHandler:R,messageHandler:N,contentHandler:_,createdHandler:S,attachmentHandler:w,abortConversation:A}}const MS=e=>{e?(localStorage.removeItem(`${Hm.TEXT_DRAFT}${e}`),localStorage.removeItem(`${Hm.FILES_DRAFT}${e}`)):(localStorage.removeItem(`${Hm.TEXT_DRAFT}${Bm.NEW_CONVO}`),localStorage.removeItem(`${Hm.FILES_DRAFT}${Bm.NEW_CONVO}`))};function DS(e,t,n=!1,a=0){var s;const r=yb(),o=y(N_.activeRunFamily(a)),{token:i,isAuthenticated:l}=nk(),[c,d]=ja(new Set),u=y(N_.abortScrollFamily(a)),m=y(N_.showStopButtonByIndex(a)),{setMessages:p,getMessages:h,setConversation:g,setIsSubmitting:x,newConversation:f,resetLatestMessage:v}=t,{clearStepMaps:_,stepHandler:b,syncHandler:j,finalHandler:w,errorHandler:N,messageHandler:k,contentHandler:C,createdHandler:S,attachmentHandler:T,abortConversation:E}=LS({genTitle:r,setMessages:p,getMessages:h,setCompleted:d,isAddedRequest:n,setConversation:g,setIsSubmitting:x,newConversation:f,setShowStopButton:m,resetLatestMessage:v}),{data:I}=K_(),R=sb({enabled:!!l&&(null==(s=null==I?void 0:I.balance)?void 0:s.enabled)});ya((()=>{if(null==e||0===Object.keys(e).length)return;let{userMessage:t}=e;const n=function(e){var t=e.isEdited,n=e.userMessage,a=e.isContinued,s=e.isTemporary,r=e.isRegenerate,o=e.conversation,i=e.editedContent,l=e.ephemeralAgent,c=e.endpointOption,d=Fc.parse(o).conversationId,u=c,m=u.endpoint,p=u.endpointType,h=m,g="".concat(Rm[Yl.agents],"/").concat(h);return lc(h)&&(g=Rm[null!=p?p:h]+(t?"/modify":"")),{server:g,payload:_l(_l(_l({},n),c),{endpoint:h,isTemporary:s,isRegenerate:r,editedContent:i,conversationId:d,isContinued:!(!t||!a),ephemeralAgent:lc(h)?void 0:l})}}(e);let{payload:a}=n;a=$c(a),_();const s=new Z(n.server,{payload:JSON.stringify(a),headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}});return s.addEventListener("attachment",(t=>{try{const n=JSON.parse(t.data);T({data:n,submission:e})}catch(n){console.error(n)}})),s.addEventListener("message",(n=>{var a,s;const r=JSON.parse(n.data);if(null!=r.final){MS(null==(a=e.conversation)?void 0:a.conversationId);try{w(r,e)}catch(i){console.error("Error in finalHandler:",i),x(!1),m(!1)}return(null==(s=null==I?void 0:I.balance)?void 0:s.enabled)&&R.refetch(),void console.log("final",r)}if(null!=r.created){const n=$();o(n),t={...t,...r.message,overrideParentMessageId:t.overrideParentMessageId},S(r,{...e,userMessage:t})}else if(null!=r.event)b(r,{...e,userMessage:t});else if(null!=r.sync){const n=$();o(n),j(r,{...e,userMessage:t})}else if(null!=r.type){const{text:t,index:n}=r;C({data:r,submission:e})}else{const n=r.text??r.response,a={...e.initialResponse,parentMessageId:r.parentMessageId,messageId:r.messageId};null!=r.message&&k(n,{...e,userMessage:t,initialResponse:a})}})),s.addEventListener("open",(()=>{u(!1),console.log("connection is opened")})),s.addEventListener("cancel",(async()=>{var n,a,s;const r=null==(n=null==e?void 0:e.initialResponse)?void 0:n.messageId;if(c.has(r))return x(!1),void d((e=>(e.delete(r),new Set(e))));d((e=>new Set(e.add(r))));const o=h(),i=null==(a=null==o?void 0:o[o.length-1])?void 0:a.conversationId;try{await E(i??t.conversationId??(null==(s=e.conversation)?void 0:s.conversationId)??"",e,o)}catch(l){console.error("Error during abort:",l),x(!1),m(!1)}})),s.addEventListener("error",(async n=>{var a;if(401===n.responseCode)try{const e=await Xh.refreshToken(),t=(null==e?void 0:e.token)??"";if(!t)throw new Error("Token refresh failed.");return s.headers={"Content-Type":"application/json",Authorization:`Bearer ${t}`},Xh.dispatchTokenUpdatedEvent(t),void s.stream()}catch(o){console.log(o)}let r;console.log("error in server stream."),(null==(a=null==I?void 0:I.balance)?void 0:a.enabled)&&R.refetch();try{r=JSON.parse(n.data)}catch(o){console.error(o),console.log(n),x(!1)}N({data:r,submission:{...e,userMessage:t}})})),x(!0),s.stream(),()=>{const e=s.readyState<=1;if(s.close(),e){const e=new Event("cancel");s.dispatchEvent(e)}}}),[e])}const FS=_a.createContext(void 0),US=({value:e,children:t})=>{const[n,a]=ja(!1);return l.jsx(FS.Provider,{value:e??{error:n,setError:a},children:t})},zS=()=>{const e=_a.useContext(FS);if(void 0===e)throw new Error("useApiErrorBoundary must be used inside ApiErrorBoundaryProvider");return e},VS=()=>{const[e,t]=ja(!1),[n,a]=ja(null),s=ka(((e,n)=>{n.preventDefault(),n.stopPropagation(),a(e),t(!0)}),[]);return{keyDialogOpen:e,keyDialogEndpoint:n,onOpenChange:e=>{if(!e&&n){const e=document.getElementById(`endpoint-${n}-settings`);e&&setTimeout((()=>{e.focus()}),5)}t(e)},handleOpenKeyDialog:s}},$S={[gm.anyscale]:"assets/anyscale.png",[gm.apipie]:"assets/apipie.png",[gm.cohere]:"assets/cohere.png",[gm.deepseek]:"assets/deepseek.svg",[gm.fireworks]:"assets/fireworks.png",[gm.google]:"assets/google.svg",[gm.groq]:"assets/groq.png",[gm.helicone]:"assets/helicone.png",[gm.huggingface]:"assets/huggingface.svg",[gm.mistral]:"assets/mistral.png",[gm.mlx]:"assets/mlx.png",[gm.ollama]:"assets/ollama.png",[gm.openai]:"assets/openai.svg",[gm.openrouter]:"assets/openrouter.png",[gm.perplexity]:"assets/perplexity.png",[gm.qwen]:"assets/qwen.svg",[gm.shuttleai]:"assets/shuttleai.png",[gm["together.ai"]]:"assets/together.png",[gm.unify]:"assets/unify.webp"},BS={[gm.cohere]:{[sx.landing]:"p-2"},[gm.xai]:{[sx.landing]:"p-2"}},HS=({currentEndpoint:e,context:t="",className:n})=>{var a;if(e===gm.openrouter)return n;return Qf((null==(a=BS[e])?void 0:a[t])??"",t===sx.landing?"":n)};const GS=Sa((function({className:e="",endpoint:t,iconURL:n="",context:a}){const s=t??"";if(!s)return l.jsx(zs,{className:e});const r=s.toLowerCase();if(r===gm.xai)return l.jsx(Vs,{className:HS({currentEndpoint:r,context:a,className:e})});if(n)return l.jsx("img",{className:e,src:n,alt:`${s} Icon`});const o=$S[r]??"";return o?l.jsx("img",{className:HS({currentEndpoint:r,context:a,className:e}),src:o,alt:`${r} Icon`}):l.jsx(zs,{className:e})})),KS=({className:e="",assistantName:t="",avatar:n="",context:a,size:s})=>t&&n?l.jsx("img",{src:n,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:t,width:"80",height:"80"}):t?l.jsx(Ws,{className:Qf("text-token-secondary",e),size:s}):l.jsx(qs,{className:Qf("landing"===a?"icon-2xl":"",e)}),WS={[Yl.azureOpenAI]:Gs,[Yl.openAI]:Hs,[Yl.anthropic]:Bs,[Yl.google]:$s,[Yl.custom]:zs,[Yl.assistants]:KS,[Yl.azureAssistants]:KS,[Yl.agents]:({className:e="",avatar:t="",agentName:n,size:a})=>null!=n&&n&&t?l.jsx("img",{src:t,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:n,width:"80",height:"80"}):l.jsx(d,{className:Qf(""===n?"icon-2xl":"",e),size:a}),[Yl.bedrock]:({className:e=""})=>l.jsx(Ks,{className:Qf(e,"h-full w-full")}),unknown:GS},qS=({agents:e,assistantsMap:t,endpointsConfig:n,startupConfig:a})=>{var s;const r=jN(),{data:o=[]}=G_({select:_f}),i=(null==a?void 0:a.interface)??{},l=Ca((()=>{var e;return new Set((null==(e=null==a?void 0:a.modelSpecs)?void 0:e.addedEndpoints)??[])}),[null==(s=null==a?void 0:a.modelSpecs)?void 0:s.addedEndpoints]),c=ak({permissionType:Pp.AGENTS,permission:Op.USE}),d=Ca((()=>Object.values((null==t?void 0:t[Yl.assistants])??{})),[t]),u=Ca((()=>Object.values((null==t?void 0:t[Yl.azureAssistants])??{})),[t]),m=Ca((()=>{if(!i.modelSelect)return[];const e=[];for(let t=0;t<o.length;t++)(o[t]!==Yl.agents||c)&&(l.size>0&&!l.has(o[t])||e.push(o[t]));return e}),[o,c,l,i.modelSelect]),p=ka((e=>!!Zm(n,e,"userProvide")),[n]);return{mappedEndpoints:Ca((()=>m.map((t=>{var a,s,o,i,l,c;const m=Zm(n,t,"type"),p=Sf({endpoint:t,endpointsConfig:n,endpointType:m}),h=WS[p],g=Zm(n,t,"iconURL"),x=t===Yl.agents&&((null==e?void 0:e.length)??0)>0||t===Yl.assistants&&(null==d?void 0:d.length)>0||t!==Yl.assistants&&t!==Yl.agents&&((null==(s=null==(a=r.data)?void 0:a[t])?void 0:s.length)??0)>0,f={value:t,label:Sm[t]||t,hasModels:x,icon:h?_a.createElement(h,{size:20,className:"text-text-primary shrink-0 icon-md",iconURL:g,endpoint:t}):null};return t===Yl.agents&&((null==e?void 0:e.length)??0)>0?(f.models=null==e?void 0:e.map((e=>({name:e.id,isGlobal:e.isPublic??!1}))),f.agentNames=null==e?void 0:e.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),f.modelIcons=null==e?void 0:e.reduce(((e,t)=>{var n;return e[t.id]=null==(n=null==t?void 0:t.avatar)?void 0:n.filepath,e}),{})):t===Yl.assistants&&d.length>0?(f.models=d.map((e=>({name:e.id,isGlobal:!1}))),f.assistantNames=d.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),f.modelIcons=d.reduce(((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e}),{})):t===Yl.azureAssistants&&u.length>0?(f.models=u.map((e=>({name:e.id,isGlobal:!1}))),f.assistantNames=u.reduce(((e,t)=>(e[t.id]=t.name||"",e)),{}),f.modelIcons=u.reduce(((e,t)=>{var n;return e[t.id]=null==(n=t.metadata)?void 0:n.avatar,e}),{})):t!==Yl.agents&&t!==Yl.assistants&&((null==(i=null==(o=r.data)?void 0:o[t])?void 0:i.length)??0)>0&&(f.models=null==(c=null==(l=r.data)?void 0:l[t])?void 0:c.map((e=>({name:e,isGlobal:!1})))),f}))),[m,n,r.data,e,d,u]),endpointRequiresUserKey:p}};const QS=50,YS=e=>Array.isArray(e)?e.map((e=>e.agentId?{agentId:e.agentId}:e.model&&e.endpoint?{model:e.model,endpoint:e.endpoint}:e)):[];function XS(){const e=qN(),{showToast:t}=Ds(),[n,a]=X(w_),s=db(),r=ub(),o=ba(!1);ya((()=>{o.current||r.isLoading||s.data&&(Array.isArray(s.data)?a(s.data):a([]))}),[s.data,a,r.isLoading]);const i=ka((t=>{var n;if(t&&"object"==typeof t&&"response"in t){const a=t,{code:s,limit:r}=(null==(n=a.response)?void 0:n.data)??{};if("MAX_FAVORITES_EXCEEDED"===s)return e("com_ui_max_favorites_reached",{0:String(r??QS)})}return e("com_ui_error")}),[e]),l=ka((async e=>{const n=YS(e);a(n),o.current=!0;try{await r.mutateAsync(n)}catch(l){cx.error("Error updating favorites:",l),t({message:i(l),status:"error"}),s.refetch()}finally{setTimeout((()=>{o.current=!1}),100)}}),[a,r,t,i,s]),c=e=>{if(n.some((t=>t.agentId===e)))return;const t=[...n,{agentId:e}];l(t)},d=e=>{const t=n.filter((t=>t.agentId!==e));l(t)},u=e=>{if(n.some((t=>t.model===e.model&&t.endpoint===e.endpoint)))return;const t=[...n,{model:e.model,endpoint:e.endpoint}];l(t)},m=(e,t)=>{const a=n.filter((n=>!(n.model===e&&n.endpoint===t)));l(a)},p=e=>!!e&&n.some((t=>t.agentId===e)),h=(e,t)=>n.some((n=>n.model===e&&n.endpoint===t)),g=ka((async(e,n=!1)=>{const l=YS(e);if(a(l),n){o.current=!0;try{await r.mutateAsync(l)}catch(c){cx.error("Error reordering favorites:",c),t({message:i(c),status:"error"}),s.refetch()}finally{setTimeout((()=>{o.current=!1}),100)}}}),[a,r,t,i,s]);return{favorites:n,addFavoriteAgent:c,removeFavoriteAgent:d,addFavoriteModel:u,removeFavoriteModel:m,isFavoriteAgent:p,isFavoriteModel:h,toggleFavoriteAgent:e=>{p(e)?d(e):c(e)},toggleFavoriteModel:e=>{h(e.model,e.endpoint)?m(e.model,e.endpoint):u(e)},reorderFavorites:g,isLoading:s.isLoading,isError:s.isError,isUpdating:r.isLoading,fetchError:s.error,updateError:r.error}}function JS(e,t){const[n,a]=ja(t);ya((()=>{const n=localStorage.getItem(e);function s(t){if(t.key!==e)return;const n=localStorage.getItem(e);a(JSON.parse(n??""))}return n||localStorage.setItem(e,JSON.stringify(t)),a(n?JSON.parse(n):t),window.addEventListener("storage",s),()=>{window.removeEventListener("storage",s)}}),[]);return[n,t=>{try{a(t),localStorage.setItem(e,JSON.stringify(t)),"undefined"!=typeof window&&window.dispatchEvent(new StorageEvent("storage",{key:e}))}catch(n){console.error(n)}}]}function ZS(e){ya((()=>{document.title=e}),[e])}const eT=(e,t)=>{const{data:n,isLoading:a}=DN(e,t);return{hasPermission:e=>!!n&&function(e,t){return(e&t)===t}(n.permissionBits,e),isLoading:a,permissionBits:(null==n?void 0:n.permissionBits)||0}},tT="undefined"!=typeof window&&"undefined"!=typeof navigator&&"undefined"!=typeof document,nT=tT&&"wakeLock"in navigator,aT=e=>{const t=ba(null);ya((()=>{if(!nT)return;let n=!1;const{wakeLock:a}=navigator;if(!a)return;const s=async()=>{if(t.current)try{await t.current.release()}catch(e){console.warn("[WakeLock] release failed",e)}finally{t.current=null}},r=async()=>{if(e&&!n&&"visible"===document.visibilityState&&!t.current)try{const s=await a.request("screen");t.current=s;const o=()=>{t.current=null,s.removeEventListener("release",o),!n&&e&&"visible"===document.visibilityState&&r()};s.addEventListener("release",o)}catch(s){console.warn("[WakeLock] request failed",s)}},o=()=>{n||"visible"===document.visibilityState&&e&&r()};return e?(r(),document.addEventListener("visibilitychange",o)):s(),()=>{n=!0,document.removeEventListener("visibilitychange",o),s()}}),[e])},sT=()=>{const e=j(N_.anySubmittingSelector),t=j(N_.keepScreenAwake);return aT(e&&t),null},rT="text-base",oT=function(e,t,n){const a=j_(e,t);return C((e=>e(a)),((e,t,s)=>{t(a,s),"undefined"!=typeof window&&n(s)}))}("fontSize",rT,Qs),iT=()=>{!function(e,t,n){if("undefined"==typeof window||"undefined"==typeof localStorage)return t;try{const a=localStorage.getItem(e),s=a?JSON.parse(a):t;return n&&n(s),s}catch(a){console.error(`Error initializing ${e} from localStorage, using default. Error:`,a);try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`Error resetting corrupted ${e} in localStorage:`,s)}return n&&n(t),t}}("fontSize",rT,Qs)},lT=({statusMessage:e,logMessage:t})=>l.jsxs("div",{className:"sr-only",children:[l.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:e}),l.jsx("div",{"aria-live":"polite","aria-atomic":"true",children:t})]}),cT=({children:e})=>{const[t,n]=ja(""),[a,s]=ja(""),r=ba(null),o=qN(),i=Ca((()=>({start:o("com_a11y_start"),end:o("com_a11y_end"),composing:o("com_a11y_ai_composing")})),[o]),c=ka((e=>{r.current&&clearTimeout(r.current),n(e),r.current=setTimeout((()=>{n("")}),1e3)}),[]),d=ka((e=>{s(e)}),[]),u=ka((({message:e,isStatus:t=!1})=>{const n=(i[e]??e).replace(/[*`_]/g,"");t?c(n):d(n)}),[i,c,d]),m={announcePolite:u,announceAssertive:u};return ya((()=>()=>{r.current&&clearTimeout(r.current)}),[]),l.jsxs(Ak.Provider,{value:m,children:[e,l.jsx(lT,{statusMessage:t,logMessage:a})]})},dT=({children:e})=>l.jsx("div",{role:"alert","aria-live":"assertive",className:"relative mt-6 rounded-xl border border-red-500/20 bg-red-50/50 px-6 py-4 text-red-700 shadow-sm transition-all dark:bg-red-950/30 dark:text-red-100",children:e}),uT=({id:e,enabled:t,serverDomain:n,oauthPath:a,Icon:s,label:r})=>t?l.jsx("div",{className:"mt-2 flex gap-x-2",children:l.jsxs("a",{"aria-label":`${r}`,className:"flex w-full items-center space-x-3 rounded-2xl border border-border-light bg-surface-primary px-5 py-3 text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",href:`${n}/oauth/${a}`,"data-testid":e,children:[l.jsx(s,{}),l.jsx("p",{children:r})]})}):null,mT=({onSubmit:e,startupConfig:t,error:n,setError:a})=>{var s,r;const o=qN(),{theme:i}=Na(Fs),{register:c,getValues:d,handleSubmit:u,formState:{errors:m,isSubmitting:p}}=Oi(),[h,g]=ja(!1),[x,f]=ja(null),{data:v}=K_(),_=null==(s=null==v?void 0:v.ldap)?void 0:s.username,b=Us(i)?"dark":"light",y=Boolean(null==(r=t.turnstile)?void 0:r.siteKey);ya((()=>{n&&n.includes("422")&&!h&&g(!0)}),[n,h]);const j=Db({onMutate:()=>{a(void 0),g(!1)}});if(!t)return null;const w=e=>{var t;const n=null==(t=m[e])?void 0:t.message;return n?l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-600 dark:text-red-500",children:String(n)}):null};return l.jsxs(l.Fragment,{children:[h&&l.jsxs("div",{className:"mt-2 rounded-md border border-green-500 bg-green-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",children:[o("com_auth_email_verification_resend_prompt"),l.jsx("button",{type:"button",className:"ml-2 text-blue-600 hover:underline",onClick:()=>{const e=d("email");if(!e)return g(!1);j.mutate({email:e})},disabled:j.isLoading,children:o("com_auth_email_resend_link")})]}),l.jsxs("form",{className:"mt-6","aria-label":"Login form",method:"POST",onSubmit:u((t=>e(t))),children:[l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"text",id:"email",autoComplete:_?"username":"email","aria-label":o("com_auth_email"),...c("email",{required:o("com_auth_email_required"),maxLength:{value:120,message:o("com_auth_email_max_length")},pattern:{value:_?/\S+/:/\S+@\S+\.\S+/,message:o("com_auth_email_pattern")}}),"aria-invalid":!!m.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),l.jsx("label",{htmlFor:"email",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-600 dark:peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:_?o("com_auth_username").replace(/ \(.*$/,""):o("com_auth_email_address")})]}),w("email")]}),l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":o("com_auth_password"),...c("password",{required:o("com_auth_password_required"),minLength:{value:(null==t?void 0:t.minPasswordLength)||8,message:o("com_auth_password_min_length")},maxLength:{value:128,message:o("com_auth_password_max_length")}}),"aria-invalid":!!m.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),l.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-600 dark:peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:o("com_auth_password")})]}),w("password")]}),t.passwordResetEnabled&&l.jsx("a",{href:"/forgot-password",className:"inline-flex p-1 text-sm font-medium text-green-600 underline decoration-transparent transition-all duration-200 hover:text-green-700 hover:decoration-green-700 focus:text-green-700 focus:decoration-green-700 dark:text-green-500 dark:hover:text-green-400 dark:hover:decoration-green-400 dark:focus:text-green-400 dark:focus:decoration-green-400",children:o("com_auth_password_forgot")}),y&&l.jsx("div",{className:"my-4 flex justify-center",children:l.jsx(zi,{siteKey:t.turnstile.siteKey,options:{...t.turnstile.options,theme:b},onSuccess:f,onError:()=>f(null),onExpire:()=>f(null)})}),l.jsx("div",{className:"mt-6",children:l.jsx(Ys,{"aria-label":o("com_auth_continue"),"data-testid":"login-button",type:"submit",disabled:y&&!x||p,variant:"submit",className:"h-12 w-full rounded-2xl",children:p?l.jsx(Xs,{}):o("com_auth_continue")})})]})]})};function pT(){const e=qN(),{showToast:t}=Ds(),{error:n,setError:a,login:s}=nk(),{startupConfig:r}=ee(),[o,i]=Da(),c="false"===o.get("redirect"),[d,u]=ja(c);ya((()=>{const n=null==o?void 0:o.get("error");if(n&&n===Dm.AUTH_FAILED){t({message:e("com_auth_error_oauth_failed"),status:"error"});const n=new URLSearchParams(o);n.delete("error"),i(n,{replace:!0})}}),[o,i,t,e]),ya((()=>{if(c){u(!0);const e=new URLSearchParams(o);e.delete("redirect"),i(e,{replace:!0})}}),[c,o,i]);const m=(null==r?void 0:r.openidLoginEnabled)&&(null==r?void 0:r.openidAutoRedirect)&&(null==r?void 0:r.serverDomain)&&!d;return ya((()=>{m&&(console.log("Auto-redirecting to OpenID provider..."),window.location.href=`${r.serverDomain}/oauth/openid`)}),[m,r]),m?l.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:[l.jsx("p",{className:"text-lg font-semibold",children:e("com_ui_redirecting_to_provider",{0:r.openidLabel})}),l.jsx("div",{className:"mt-4",children:l.jsx(uT,{enabled:r.openidLoginEnabled,serverDomain:r.serverDomain,oauthPath:"openid",Icon:()=>r.openidImageUrl?l.jsx("img",{src:r.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):l.jsx(Js,{}),label:r.openidLabel,id:"openid"},"openid")})]}):l.jsxs(l.Fragment,{children:[null!=n&&l.jsx(dT,{children:e(Xf(n))}),!0===(null==r?void 0:r.emailLoginEnabled)&&l.jsx(mT,{onSubmit:s,startupConfig:r,error:n,setError:a}),!0===(null==r?void 0:r.registrationEnabled)&&l.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[" ",e("com_auth_no_account")," ",l.jsx("a",{href:"".concat(Nd,"/register"),className:"inline-flex p-1 text-sm font-medium text-green-600 underline decoration-transparent transition-all duration-200 hover:text-green-700 hover:decoration-green-700 focus:text-green-700 focus:decoration-green-700 dark:text-green-500 dark:hover:text-green-400 dark:hover:decoration-green-400 dark:focus:text-green-400 dark:focus:decoration-green-400",children:e("com_auth_sign_up")})]})]})}const hT=()=>{var e,t;const n=E(),a=qN(),{theme:s}=Na(Fs),{startupConfig:r,startupConfigError:o,isFetching:i}=ee(),{watch:c,register:d,handleSubmit:u,formState:{errors:m}}=Oi({mode:"onChange"}),p=c("password"),[h,g]=ja(""),[x,f]=ja(!1),[v,_]=ja(3),[b,y]=ja(null),j=T(),w=new URLSearchParams(j.search).get("token"),N=Us(s)?"dark":"light",k=Boolean(null==(e=null==r?void 0:r.turnstile)?void 0:e.siteKey),C=NN({onMutate:()=>{f(!0)},onSuccess:()=>{f(!1),_(3);const e=setInterval((()=>{_((t=>t<=1?(clearInterval(e),n("/c/new",{replace:!0}),0):t-1))}),1e3)},onError:e=>{var t,n,a,s;f(!1),(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)&&g((null==(s=null==(a=e.response)?void 0:a.data)?void 0:s.message)??"")}}),S=(e,t,n,s)=>{var r;return l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{id:e,type:n,autoComplete:e,"aria-label":a(t),...d(e,s),"aria-invalid":!!m[e],className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" ","data-testid":e}),l.jsx("label",{htmlFor:e,className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:a(t)})]}),m[e]&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500",children:String(null==(r=m[e])?void 0:r.message)??""})]})};return l.jsxs(l.Fragment,{children:[h&&l.jsxs(dT,{children:[a("com_auth_error_create")," ",h]}),C.isSuccess&&v>0&&l.jsx("div",{className:"rounded-md border border-green-500 bg-green-500/10 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",role:"alert",children:a((null==r?void 0:r.emailEnabled)?"com_auth_registration_success_generic":"com_auth_registration_success_insecure")+" "+a("com_auth_email_verification_redirecting",{0:v.toString()})}),!o&&!i&&l.jsxs(l.Fragment,{children:[l.jsxs("form",{className:"mt-6","aria-label":"Registration form",method:"POST",onSubmit:u((e=>C.mutate({...e,token:w??void 0}))),children:[S("name","com_auth_full_name","text",{required:a("com_auth_name_required"),minLength:{value:3,message:a("com_auth_name_min_length")},maxLength:{value:80,message:a("com_auth_name_max_length")}}),S("username","com_auth_username","text",{minLength:{value:2,message:a("com_auth_username_min_length")},maxLength:{value:80,message:a("com_auth_username_max_length")}}),S("email","com_auth_email","email",{required:a("com_auth_email_required"),minLength:{value:1,message:a("com_auth_email_min_length")},maxLength:{value:120,message:a("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:a("com_auth_email_pattern")}}),S("password","com_auth_password","password",{required:a("com_auth_password_required"),minLength:{value:(null==r?void 0:r.minPasswordLength)||8,message:a("com_auth_password_min_length")},maxLength:{value:128,message:a("com_auth_password_max_length")}}),S("confirm_password","com_auth_password_confirm","password",{validate:e=>e===p||a("com_auth_password_not_match")}),(null==(t=null==r?void 0:r.turnstile)?void 0:t.siteKey)&&l.jsx("div",{className:"my-4 flex justify-center",children:l.jsx(zi,{siteKey:r.turnstile.siteKey,options:{...r.turnstile.options,theme:N},onSuccess:e=>y(e),onError:()=>y(null),onExpire:()=>y(null)})}),l.jsx("div",{className:"mt-6",children:l.jsx(Ys,{disabled:Object.keys(m).length>0||x||k&&!b,type:"submit","aria-label":"Submit registration",variant:"submit",className:"h-12 w-full rounded-2xl",children:x?l.jsx(Xs,{}):a("com_auth_continue")})})]}),l.jsxs("p",{className:"my-4 text-center text-sm font-light text-gray-700 dark:text-white",children:[a("com_auth_already_have_account")," ",l.jsx("a",{href:Vd(),"aria-label":"Login",className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:a("com_auth_login")})]})]})]})};function gT(){const e=qN(),{register:t,handleSubmit:n,watch:a,formState:{errors:s,isSubmitting:r}}=Oi(),o=E(),[i]=Da(),c=a("password"),d=SN(),{setError:u,setHeaderText:m,startupConfig:p}=ee();return d.isSuccess?l.jsx(l.Fragment,{children:l.jsx("div",{className:"relative mt-6 rounded-xl border border-green-500/20 bg-green-50/50 px-6 py-4 text-green-700 shadow-sm transition-all dark:bg-green-950/30 dark:text-green-100",role:"alert",children:l.jsxs("div",{className:"flex flex-col space-y-4",children:[l.jsx("p",{children:e("com_auth_login_with_new_password")}),l.jsx(Ys,{onClick:()=>o("/login"),"aria-label":e("com_auth_sign_in"),variant:"submit",children:e("com_auth_continue")})]})})}):l.jsxs("form",{className:"mt-6","aria-label":"Password reset form",method:"POST",onSubmit:n((e=>{d.mutate(e,{onError:()=>{u("com_auth_error_invalid_reset_token")},onSuccess:()=>{m("com_auth_reset_password_success")}})})),children:[l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"hidden",id:"token",value:i.get("token")??"",...t("token",{required:"Unable to process: No valid reset token"})}),l.jsx("input",{type:"hidden",id:"userId",value:i.get("userId")??"",...t("userId",{required:"Unable to process: No valid user id"})}),l.jsx("input",{type:"password",id:"password",autoComplete:"current-password","aria-label":e("com_auth_password"),...t("password",{required:e("com_auth_password_required"),minLength:{value:(null==p?void 0:p.minPasswordLength)||8,message:e("com_auth_password_min_length")},maxLength:{value:128,message:e("com_auth_password_max_length")}}),"aria-invalid":!!s.password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),l.jsx("label",{htmlFor:"password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password")})]}),s.password&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:s.password.message})]}),l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"password",id:"confirm_password","aria-label":e("com_auth_password_confirm"),...t("confirm_password",{validate:t=>t===c||e("com_auth_password_not_match")}),"aria-invalid":!!s.confirm_password,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),l.jsx("label",{htmlFor:"confirm_password",className:"absolute start-3 top-1.5 z-10 origin-[0] -translate-y-4 scale-75 transform bg-surface-primary px-2 text-sm text-text-secondary-alt duration-200 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-1.5 peer-focus:-translate-y-4 peer-focus:scale-75 peer-focus:px-2 peer-focus:text-green-500 rtl:peer-focus:left-auto rtl:peer-focus:translate-x-1/4",children:e("com_auth_password_confirm")})]}),s.confirm_password&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:s.confirm_password.message}),s.token&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:s.token.message}),s.userId&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-500 dark:text-red-900",children:s.userId.message})]}),l.jsx("div",{className:"mt-6",children:l.jsx(Ys,{type:"submit","aria-label":e("com_auth_submit_registration"),disabled:!!s.password||!!s.confirm_password||r,variant:"submit",className:"h-12 w-full rounded-2xl",children:r?l.jsx(Xs,{}):e("com_auth_continue")})})]})}function xT(){const e=E(),t=qN(),[n]=Da(),[a,s]=ja(3),[r,o]=ja(""),[i,c]=ja(!1),[d,u]=ja(!1),m=Ca((()=>n.get("token")||""),[n]),p=Ca((()=>n.get("email")||""),[n]),h=ka((()=>{s(3);const t=setInterval((()=>{s((n=>n<=1?(clearInterval(t),e("/c/new",{replace:!0}),0):n-1))}),1e3)}),[e]),g=fs({mutationFn:e=>Jh.verifyEmail(e),...{onSuccess:()=>{o(t("com_auth_email_verification_success")+" "),u(!0),h()},onError:e=>{o(t("com_auth_email_verification_failed")+" "),c(!0),u(!0)}}||{}});const x=Db({onSuccess:()=>{o(t("com_auth_email_resent_success")+" "),h()},onError:()=>{o(t("com_auth_email_resent_failed")+" ")},onMutate:()=>c(!1)}),f=()=>{x.mutate({email:p})};ya((()=>{d||g.isLoading||(m&&p?g.mutate({email:p,token:m}):(o(p?t("com_auth_email_verification_failed_token_missing")+" ":t("com_auth_email_verification_invalid")+" "),c(!0),u(!0)))}),[m,p,d,g]);const v=()=>l.jsxs("div",{className:"flex flex-col items-center justify-center",children:[l.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:r}),a>0&&l.jsx("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:t("com_auth_email_verification_redirecting",{0:a.toString()})}),i&&0===a&&l.jsxs("p",{className:"text-center text-lg text-gray-600 dark:text-gray-400",children:[t("com_auth_email_verification_resend_prompt"),l.jsx("button",{className:"ml-2 text-blue-600 hover:underline",onClick:f,disabled:x.isLoading,children:t("com_auth_email_resend_link")})]})]}),_=()=>l.jsxs("div",{className:"flex flex-col items-center justify-center",children:[l.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",children:t("com_auth_email_verification_in_progress")}),l.jsx("div",{className:"mt-4 flex justify-center",children:l.jsx(Xs,{className:"h-8 w-8 text-green-500"})})]});return l.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white pt-6 dark:bg-gray-900 sm:pt-0",children:[l.jsx("div",{className:"absolute bottom-0 left-0 m-4",children:l.jsx(Zs,{})}),d?l.jsx(v,{}):l.jsx(_,{})]})}const fT=()=>{const{error:e}=zS(),t=E();return _a.useEffect((()=>{var t;null==(t=null==e?void 0:e.response)||t.status}),[e,t]),null},vT=({children:e})=>l.jsx("div",{className:"relative mt-6 rounded-xl border border-green-500/20 bg-green-50/50 px-6 py-4 text-green-700 shadow-sm transition-all dark:bg-green-950/30 dark:text-green-100",role:"alert",children:e}),_T=()=>{const e=qN();return l.jsxs("div",{className:"flex flex-col space-y-4",children:[l.jsx("p",{children:e("com_auth_reset_password_if_email_exists")}),l.jsx("a",{className:"inline-flex text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",href:Vd(),children:e("com_auth_back_to_login")})]})};function bT(){const e=qN(),{register:t,handleSubmit:n,formState:{errors:a}}=Oi(),[s,r]=ja(void 0),{startupConfig:o,setHeaderText:i}=ee(),c=CN(),{isLoading:d}=c;return s?l.jsx(vT,{children:s}):l.jsxs("form",{className:"mt-8 space-y-6","aria-label":"Password reset form",method:"POST",onSubmit:n((t=>{c.mutate(t,{onSuccess:t=>{t.link&&!(null==o?void 0:o.emailEnabled)?(i("com_auth_reset_password"),r(l.jsxs("span",{children:[e("com_auth_click")," ",l.jsx("a",{className:"text-green-500 hover:underline",href:t.link,children:e("com_auth_here")})," ",e("com_auth_to_reset_your_password")]}))):(i("com_auth_reset_password_link_sent"),r(l.jsx(_T,{})))},onError:()=>{i("com_auth_reset_password_link_sent"),r(l.jsx(_T,{}))}})})),children:[l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{type:"email",id:"email",autoComplete:"off","aria-label":e("com_auth_email"),...t("email",{required:e("com_auth_email_required"),minLength:{value:3,message:e("com_auth_email_min_length")},maxLength:{value:120,message:e("com_auth_email_max_length")},pattern:{value:/\S+@\S+\.\S+/,message:e("com_auth_email_pattern")}}),"aria-invalid":!!a.email,className:"webkit-dark-styles transition-color peer w-full rounded-2xl border border-border-light bg-surface-primary px-3.5 pb-2.5 pt-3 text-text-primary duration-200 focus:border-green-500 focus:outline-none",placeholder:" "}),l.jsx("label",{htmlFor:"email",className:"absolute -top-2 left-2 z-10 bg-white px-2 text-sm text-gray-600 transition-all peer-placeholder-shown:top-3 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 peer-focus:-top-2 peer-focus:text-sm peer-focus:text-green-600 dark:bg-gray-900 dark:text-gray-400 dark:peer-focus:text-green-500",children:e("com_auth_email_address")})]}),a.email&&l.jsx("p",{role:"alert",className:"text-sm font-medium text-red-600 dark:text-red-400",children:a.email.message})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx(Ys,{"aria-label":"Continue with password reset",type:"submit",disabled:!!a.email||d,variant:"submit",className:"h-12 w-full rounded-2xl",children:d?l.jsx(Xs,{}):e("com_auth_continue")}),l.jsx("a",{href:Vd(),className:"block text-center text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:e("com_auth_back_to_login")})]})]})}const yT=_a.memo((()=>{const[e]=Da(),t=e.get("tempToken"),n=null!==t&&""!==t?t:"",{control:a,handleSubmit:s,formState:{errors:r}}=Oi(),o=qN(),{showToast:i}=Ds(),[c,d]=ja(!1),[u,m]=ja(!1),{mutate:p}=(e=>{const t=xs();return fs((e=>Jh.verifyTwoFactorTemp(e)),{...e||{},onSuccess:(n,...a)=>{var s;t.setQueryData([Fh.user,"2fa"],n),null==(s=null==e?void 0:e.onSuccess)||s.call(e,n,...a)}})})({onSuccess:e=>{null!=e.token&&""!==e.token&&(window.location.href="/")},onMutate:()=>{m(!0)},onError:e=>{var t,n;m(!1);const a=e,s="string"==typeof(null==(n=null==(t=a.response)?void 0:t.data)?void 0:n.message)?a.response.data.message:"Error verifying 2FA";i({message:s,status:"error"})}}),h=ka((e=>{const t={tempToken:n};c&&null!=e.backupCode&&""!==e.backupCode?t.backupCode=e.backupCode:null!=e.token&&""!==e.token&&(t.token=e.token),p(t)}),[n,c,p]),g=ka((()=>{d(!0)}),[]),x=ka((()=>{d(!1)}),[]);return l.jsx("div",{className:"mt-4",children:l.jsxs("form",{onSubmit:s(h),children:[l.jsx(er,{className:"flex justify-center break-keep text-center text-sm text-text-primary",children:o("com_auth_two_factor")}),!c&&l.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[l.jsx(Li,{name:"token",control:a,render:({field:{onChange:e,value:t}})=>l.jsxs(tr,{maxLength:6,value:null!=t?t:"",onChange:e,pattern:te,children:[l.jsxs(nr,{children:[l.jsx(ar,{index:0}),l.jsx(ar,{index:1}),l.jsx(ar,{index:2})]}),l.jsx(sr,{}),l.jsxs(nr,{children:[l.jsx(ar,{index:3}),l.jsx(ar,{index:4}),l.jsx(ar,{index:5})]})]})}),r.token&&l.jsx("span",{className:"text-sm text-red-500",children:r.token.message})]}),c&&l.jsxs("div",{className:"my-4 flex justify-center text-text-primary",children:[l.jsx(Li,{name:"backupCode",control:a,render:({field:{onChange:e,value:t}})=>l.jsx(tr,{maxLength:8,value:null!=t?t:"",onChange:e,pattern:ne,children:l.jsxs(nr,{children:[l.jsx(ar,{index:0}),l.jsx(ar,{index:1}),l.jsx(ar,{index:2}),l.jsx(ar,{index:3}),l.jsx(ar,{index:4}),l.jsx(ar,{index:5}),l.jsx(ar,{index:6}),l.jsx(ar,{index:7})]})})}),r.backupCode&&l.jsx("span",{className:"text-sm text-red-500",children:r.backupCode.message})]}),l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("button",{type:"submit","aria-label":o("com_auth_continue"),"data-testid":"login-button",disabled:u,className:"w-full rounded-2xl bg-green-600 px-4 py-3 text-sm font-medium text-white transition-colors hover:bg-green-700 disabled:opacity-80 dark:bg-green-600 dark:hover:bg-green-700",children:o(u?"com_auth_email_verifying_ellipsis":"com_ui_verify")})}),l.jsx("div",{className:"mt-4 flex justify-center",children:c?l.jsx("button",{type:"button",onClick:x,className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:o("com_ui_use_2fa_code")}):l.jsx("button",{type:"button",onClick:g,className:"inline-flex p-1 text-sm font-medium text-green-600 transition-colors hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",children:o("com_ui_use_backup_code")})})]})})})),jT=({children:e})=>{const t=bC(0,"new");return l.jsx(VN.Provider,{value:t,children:e})},wT=({control:e,marketplacePerm:t,label:n,getValues:a,setValue:s})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[l.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>s(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),l.jsx(Li,{name:t,control:e,render:({field:e})=>l.jsx(dr,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString(),"aria-label":n})})]}),NT=()=>{const e=qN(),{showToast:t}=Ds(),{user:n,roles:a}=nk(),{mutate:s,isLoading:r}=(e=>{const t=xs(),{onMutate:n,onSuccess:a,onError:s}=e??{};return fs((e=>(kh.partial().parse(e.updates),Jh.updateMarketplacePermissions(e))),{onSuccess:(e,n,s)=>{t.invalidateQueries([Fh.roles,n.roleName]),a&&a(e,n,s)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update marketplace permissions:",t),s&&s(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[o,i]=ja(!1),[c,d]=ja(gh.USER),u=Ca((()=>{var e;const t=null==(e=null==a?void 0:a[c])?void 0:e.permissions;return t?t[Pp.MARKETPLACE]:Dh[c].permissions[Pp.MARKETPLACE]}),[a,c]),{reset:m,control:p,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:f}}=Oi({mode:"onChange",defaultValues:u});if(ya((()=>{var e,t;const n=null==(t=null==(e=null==a?void 0:a[c])?void 0:e.permissions)?void 0:t[Pp.MARKETPLACE];m(n||Dh[c].permissions[Pp.MARKETPLACE])}),[a,c,m]),(null==n?void 0:n.role)!==gh.ADMIN)return null;const v=[{marketplacePerm:Op.USE,label:e("com_ui_marketplace_allow_use")}],_=e=>{s({roleName:c,updates:e})},b=[{label:gh.USER,onClick:()=>{d(gh.USER)}},{label:gh.ADMIN,onClick:()=>{d(gh.ADMIN)}}];return l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{variant:"outline",className:"relative h-12 rounded-xl border-border-medium font-medium",children:l.jsx(ae,{className:"cursor-pointer","aria-hidden":"true"})})}),l.jsxs(ir,{className:"w-11/12 max-w-md border-border-light bg-surface-primary text-text-primary",children:[l.jsx(lr,{children:e("com_ui_admin_settings_section",{section:e("com_ui_marketplace")})}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(cr,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:o,setIsOpen:i,trigger:l.jsx(se,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:c}),items:b,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:x(_),children:[l.jsx("div",{className:"py-5",children:v.map((({marketplacePerm:e,label:t})=>l.jsx("div",{children:l.jsx(wT,{control:p,marketplacePerm:e,label:t,getValues:g,setValue:h})},e)))}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{type:"button",onClick:x(_),disabled:f||r,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})},kT=Sa((function({artifacts:e,currentLayout:t,minSizeMain:n,shouldRender:a,onRenderChange:s}){const r=ba(null);return ya((()=>{null!=e?(s(!0),requestAnimationFrame((()=>{requestAnimationFrame((()=>{var e;null==(e=r.current)||e.expand()}))}))):a&&s(!1)}),[e,a,s]),a?l.jsxs(l.Fragment,{children:[null!=e&&l.jsx(ur,{withHandle:!0,className:"bg-border-medium text-text-primary"}),l.jsx(mr,{ref:r,defaultSize:null!=e?t[1]:0,minSize:n,maxSize:70,collapsible:!0,collapsedSize:0,order:2,id:"artifacts-panel",children:l.jsx("div",{className:"h-full min-w-[400px] overflow-hidden",children:e})})]}):null}));let CT;function ST({serverName:e,serverStatus:t,tool:n,onConfigClick:a,isInitializing:s,canCancel:r,onCancel:o,hasCustomUserVars:i=!1}){if(CT=qN(),s)return l.jsx(TT,{serverName:e,onConfigClick:a,onCancel:o,canCancel:r});if(!t)return null;const{connectionState:c,requiresOAuth:d}=t;if("connecting"===c)return l.jsx(ET,{serverName:e,onConfigClick:a});if("disconnected"===c)return d?l.jsx(IT,{serverName:e,onConfigClick:a}):l.jsx(RT,{serverName:e,onConfigClick:a});if("error"===c)return l.jsx(AT,{serverName:e,onConfigClick:a});if("connected"===c){if(i){const t=(null==n?void 0:n.authenticated)||d;return l.jsx(PT,{serverName:e,onConfigClick:a,isAuthenticated:t})}return l.jsx(OT,{serverName:e,requiresOAuth:d,onConfigClick:a})}return null}function TT({serverName:e,onCancel:t,canCancel:n}){return n?l.jsx("button",{type:"button",onClick:t,className:"group flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-red-100 dark:hover:bg-red-900/20","aria-label":CT("com_ui_cancel"),title:CT("com_ui_cancel"),children:l.jsxs("div",{className:"relative h-4 w-4",children:[l.jsx(Xs,{className:"h-4 w-4 group-hover:opacity-0"}),l.jsx(re,{className:"absolute inset-0 h-4 w-4 text-red-500 opacity-0 group-hover:opacity-100"})]})}):l.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:l.jsx(Xs,{className:"h-4 w-4","aria-label":CT("com_nav_mcp_status_connecting",{0:e})})})}function ET({serverName:e}){return l.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:l.jsx(Xs,{className:"h-4 w-4","aria-label":CT("com_nav_mcp_status_connecting",{0:e})})})}function IT({serverName:e,onConfigClick:t}){return l.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":CT("com_nav_mcp_configure_server",{0:e}),children:l.jsx(oe,{className:"h-4 w-4 text-amber-500","aria-hidden":"true"})})}function RT({serverName:e,onConfigClick:t}){return l.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":CT("com_nav_mcp_configure_server",{0:e}),children:l.jsx(ie,{className:"h-4 w-4 text-orange-500","aria-hidden":"true"})})}function AT({serverName:e,onConfigClick:t}){return l.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":CT("com_nav_mcp_configure_server",{0:e}),children:l.jsx(le,{className:"h-4 w-4 text-red-500","aria-hidden":"true"})})}function PT({serverName:e,onConfigClick:t,isAuthenticated:n}){return l.jsx("button",{type:"button",onClick:t,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":CT("com_nav_mcp_configure_server",{0:e}),children:l.jsx(I,{className:"h-4 w-4 "+(n?"text-green-500":"text-gray-400"),"aria-hidden":"true"})})}function OT({serverName:e,requiresOAuth:t,onConfigClick:n}){return t?l.jsx(pr,{role:"button",onClick:n,className:"flex h-6 w-6 items-center justify-center rounded p-1 hover:bg-surface-secondary","aria-label":CT("com_nav_mcp_configure_server",{0:e}),description:CT("com_nav_mcp_status_connected"),side:"top",children:l.jsx(ce,{className:"h-4 w-4 text-green-500"})}):l.jsx(pr,{className:"flex h-6 w-6 items-center justify-center rounded p-1",description:CT("com_nav_mcp_status_connected"),side:"top",children:l.jsx(ce,{className:"h-4 w-4 text-green-500"})})}kT.displayName="ArtifactsPanel";var LT=(e=>(e.None="none",e.ServiceHttp="service_http",e.OAuth="oauth",e))(LT||{}),MT=(e=>(e.Basic="basic",e.Bearer="bearer",e.Custom="custom",e))(MT||{});function DT(e){switch(e){case"service_http":return"com_ui_api_key";case"oauth":return"com_ui_manual_oauth";default:return"com_ui_auto_detect"}}function FT({value:e,onChange:t}){const n=qN(),[a,s]=ja(!1),r=Oi({defaultValues:e}),{handleSubmit:o,watch:i,reset:c}=r,d=i("auth_type")||"none",u=Qf("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),m=o((e=>{t(e),s(!1)}));return l.jsxs(rr,{open:a,onOpenChange:t=>{t&&c(e),s(t)},children:[l.jsx(or,{asChild:!0,children:l.jsxs("div",{className:"relative mb-4",children:[l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:n("com_ui_authentication")})}),l.jsxs("div",{className:"border-token-border-medium flex rounded-lg border text-sm hover:cursor-pointer",children:[l.jsx("div",{className:"h-9 grow px-3 py-2",children:n(DT(d))}),l.jsx("div",{className:"bg-token-border-medium w-px"}),l.jsx("button",{type:"button",color:"neutral",className:"flex items-center gap-2 px-3",children:l.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[l.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),l.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]})})]})]})}),l.jsx(Mi,{...r,children:l.jsx(hr,{title:n("com_ui_authentication"),showCloseButton:!1,className:"w-full max-w-md",main:l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:n("com_ui_authentication_type")}),l.jsxs(Va,{defaultValue:"none",onValueChange:e=>r.setValue("auth_type",e),value:d,role:"radiogroup","aria-required":"false",dir:"ltr",className:"flex gap-4",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"auth-auto-detect",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"none",id:"auth-auto-detect",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),n("com_ui_auto_detect")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"auth-apikey",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"service_http",id:"auth-apikey",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),n("com_ui_api_key")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"auth-manual-oauth",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"oauth",id:"auth-manual-oauth",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),n("com_ui_manual_oauth")]})})]})]}),"none"===d&&l.jsx("div",{className:"rounded-lg border border-border-medium bg-surface-secondary p-3",children:l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_ui_auto_detect_description")})}),"service_http"===d&&l.jsx(UT,{inputClasses:u}),"oauth"===d&&l.jsx(zT,{inputClasses:u})]}),buttons:l.jsx(Ys,{type:"button",variant:"submit",onClick:m,className:"text-white",children:n("com_ui_save")})})})]})}const UT=({inputClasses:e})=>{const t=qN(),{register:n,watch:a,setValue:s}=Pi(),r=a("api_key_source")||"admin",o=a("api_key_authorization_type")||"bearer";return l.jsxs(l.Fragment,{children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_api_key_source")}),l.jsxs(Va,{defaultValue:"admin",onValueChange:e=>s("api_key_source",e),value:r,role:"radiogroup","aria-required":"true",dir:"ltr",className:"mb-3 flex flex-col gap-2",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"source-admin",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"admin",id:"source-admin",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_admin_provides_key")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"source-user",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"user",id:"source-user",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_user_provides_key")]})})]}),"admin"===r&&l.jsxs(l.Fragment,{children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_api_key")}),l.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:e,...n("api_key")})]}),"user"===r&&l.jsx("div",{className:"mb-3 rounded-lg border border-border-medium bg-surface-secondary p-3",children:l.jsx("p",{className:"text-sm text-text-secondary",children:t("com_ui_user_provides_key_note")})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_header_format")}),l.jsxs(Va,{defaultValue:"bearer",onValueChange:e=>s("api_key_authorization_type",e),value:o,role:"radiogroup","aria-required":"true",dir:"ltr",className:"mb-2 flex gap-6 overflow-hidden rounded-lg",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"auth-bearer",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"bearer",id:"auth-bearer",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_bearer")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"auth-basic",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"basic",id:"auth-basic",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_basic")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"auth-custom",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:"custom",id:"auth-custom",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_custom")]})})]}),"custom"===o&&l.jsxs("div",{className:"mt-2",children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_custom_header_name")}),l.jsx("input",{className:e,placeholder:"X-Api-Key",...n("api_key_custom_header")})]})]})},zT=({inputClasses:e})=>{const t=qN(),{showToast:n}=Ds(),{register:a,watch:s,formState:r}=Pi(),[o,i]=ja(!1),{errors:c}=r,d=s("server_id"),u=!!d,m=u?`${window.location.origin}/api/mcp/${d}/oauth/callback`:"",p=gS({text:m});return l.jsxs(l.Fragment,{children:[l.jsxs("label",{className:"mb-1 block text-sm font-medium",children:[t("com_ui_client_id")," ",!u&&l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{placeholder:u?t("com_ui_leave_blank_to_keep"):"",autoComplete:"off",className:e,...a("oauth_client_id",{required:!u})}),c.oauth_client_id&&l.jsx("span",{className:"text-xs text-red-500",children:t("com_ui_field_required")}),l.jsxs("label",{className:"mb-1 block text-sm font-medium",children:[t("com_ui_client_secret")," ",!u&&l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{placeholder:u?t("com_ui_leave_blank_to_keep"):"",type:"password",autoComplete:"new-password",className:e,...a("oauth_client_secret",{required:!u})}),c.oauth_client_secret&&l.jsx("span",{className:"text-xs text-red-500",children:t("com_ui_field_required")}),l.jsxs("label",{className:"mb-1 block text-sm font-medium",children:[t("com_ui_auth_url")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:e,...a("oauth_authorization_url",{required:!0})}),c.oauth_authorization_url&&l.jsx("span",{className:"text-xs text-red-500",children:t("com_ui_field_required")}),l.jsxs("label",{className:"mb-1 block text-sm font-medium",children:[t("com_ui_token_url")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{className:e,...a("oauth_token_url",{required:!0})}),c.oauth_token_url&&l.jsx("span",{className:"text-xs text-red-500",children:t("com_ui_field_required")}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_redirect_uri")}),u?l.jsx("div",{className:"relative mb-2 flex items-center",children:l.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-10 w-full rounded-lg border",children:[l.jsx("div",{className:"flex-1 overflow-hidden",children:l.jsx("div",{className:"relative w-full",children:l.jsx("input",{type:"text",readOnly:!0,value:m,className:"w-full border-0 bg-transparent px-3 py-2 pr-12 text-sm text-text-secondary-alt focus:outline-none",style:{direction:"rtl"}})})}),l.jsx("div",{className:"absolute right-0 flex h-full items-center pr-1",children:l.jsx(Ys,{size:"sm",variant:"ghost",type:"button",onClick:()=>{o||(n({message:t("com_ui_copied_to_clipboard")}),p(i))},className:Qf("h-8 rounded-md px-2",o?"cursor-default":""),"aria-label":t("com_ui_copy_link"),children:o?l.jsx(de,{className:"size-4"}):l.jsx(ue,{className:"size-4"})})})]})}):l.jsx("div",{className:"mb-2 rounded-lg border border-border-medium bg-surface-secondary p-2",children:l.jsx("p",{className:"text-xs text-text-secondary",children:t("com_ui_redirect_uri_info")})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_scope")}),l.jsx("input",{className:e,...a("oauth_scope")})]})};function VT({icon:e,onIconChange:t}){const[n,a]=ja(""),s=ba(null),r=qN();ya((()=>{a(e||"")}),[e]);return l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{onClick:()=>{s.current&&(s.current.value="",s.current.click())},className:"bg-token-surface-secondary dark:bg-token-surface-tertiary border-token-border-medium flex h-16 w-16 shrink-0 cursor-pointer items-center justify-center rounded-[1.5rem] border-2 border-dashed",children:n?l.jsx("img",{src:n,className:"h-full w-full rounded-[1.5rem] object-cover",alt:"MCP Icon",width:"64",height:"64"}):l.jsx(gr,{})}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsxs("span",{className:"token-text-secondary text-sm",children:[r("com_ui_icon")," ",r("com_ui_optional")]}),l.jsx("span",{className:"token-text-tertiary text-xs",children:r("com_agents_mcp_icon_size")})]}),l.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:t,ref:s})]})}function $T({principal:e,size:t="md",className:n}){const{avatar:a,type:s,name:r}=e,o=r||"Unknown",i={sm:"h-6 w-6",md:"h-8 w-8",lg:"h-10 w-10"}[t],c={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"}[t],{Icon:d,containerClass:u,iconClass:m}=(()=>{switch(s){case Rh.USER:return{Icon:me,containerClass:"bg-blue-100 dark:bg-blue-900",iconClass:"text-blue-600 dark:text-blue-400"};case Rh.GROUP:return{Icon:O,containerClass:"bg-green-100 dark:bg-green-900",iconClass:"text-green-600 dark:text-green-400"};case Rh.ROLE:return{Icon:pe,containerClass:"bg-purple-100 dark:bg-purple-900",iconClass:"text-purple-600 dark:text-purple-400"};default:return{Icon:me,containerClass:"bg-surface-tertiary",iconClass:"text-text-secondary"}}})();return a?l.jsxs("div",{className:Qf("flex-shrink-0",n),children:[l.jsx("img",{src:a,alt:`${o} avatar`,className:Qf(i,"rounded-full object-cover"),onError:e=>{var t;const n=e.target;n.style.display="none",null==(t=n.nextElementSibling)||t.classList.remove("hidden")}}),l.jsx("div",{className:Qf("hidden",i),children:l.jsx("div",{className:Qf(i,"flex items-center justify-center rounded-full",u),children:l.jsx(d,{className:Qf(c,m)})})})]}):l.jsx("div",{className:Qf("flex-shrink-0",n),children:l.jsx("div",{className:Qf(i,"flex items-center justify-center rounded-full",u),children:l.jsx(d,{className:Qf(c,m)})})})}function BT({id:e,resourceType:t=Ph.AGENT,selectedRoleId:n=Lh.AGENT_VIEWER,onRoleChange:a,className:s=""}){const r=qN(),[o,i]=_a.useState(!1),{data:c,isLoading:d}=ON(t),u=e=>{const t=Rf(e);return{name:r(t.name),description:r(t.description)}},m=null==c?void 0:c.find((e=>e.accessRoleId===n)),p=m?u(m.accessRoleId):null;if(d||!c)return l.jsx(Ms,{className:"h-10 w-24 rounded-lg"});const h=c.map((e=>{const t=u(e.accessRoleId);return{id:e.accessRoleId,label:t.name,onClick:()=>{a(e.accessRoleId),i(!1)},render:e=>l.jsx("button",{...e,children:l.jsxs("div",{className:"flex flex-col items-start gap-0.5 text-left",children:[l.jsx("span",{className:"font-medium text-text-primary",children:t.name}),l.jsx("span",{className:"text-xs text-text-secondary",children:t.description})]})})}}));return l.jsx("div",{className:s,id:e,children:l.jsx(cr,{menuId:"access-roles-menu",isOpen:o,setIsOpen:i,trigger:l.jsxs(se,{"aria-label":(null==p?void 0:p.description)||"Select role",className:Qf("flex items-center justify-between gap-2 rounded-xl border border-border-light bg-transparent px-3 py-2 text-sm transition-colors hover:bg-surface-tertiary"),children:[l.jsx("span",{className:"font-medium",children:(null==p?void 0:p.name)||r("com_ui_select")}),l.jsx(he,{className:"h-4 w-4 text-text-secondary","aria-hidden":"true"})]}),items:h,className:"w-[280px]"})})}const HT={[Ph.AGENT]:"com_ui_agent",[Ph.PROMPTGROUP]:"com_ui_prompt",[Ph.MCPSERVER]:"com_ui_mcp_server"};function GT({isPublic:e,publicRole:t,onPublicToggle:n,onPublicRoleChange:a,resourceType:s=Ph.AGENT,className:r}){const o=qN(),i=_a.useCallback((e=>{n(e)}),[n]);return l.jsxs("div",{className:Qf("space-y-4",r),children:[l.jsx("div",{className:"group relative rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:Qf("transition-colors duration-200",e?"text-blue-600 dark:text-blue-500":"text-text-secondary"),children:l.jsx(ge,{className:"size-5"})}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(er,{htmlFor:"share-everyone-toggle",className:"cursor-pointer text-sm font-medium text-text-primary",children:o("com_ui_share_everyone")}),l.jsx(xr,{side:fr.Top,text:o("com_ui_share_everyone_description_var",{resource:o(HT[s])||o("com_ui_resource")})})]})]}),l.jsx(dr,{id:"share-everyone-toggle",checked:e,onCheckedChange:i,"aria-label":o("com_ui_share_everyone")})]})}),l.jsx("div",{className:Qf("transition-all duration-300 ease-in-out",e?"max-h-32 opacity-100":"max-h-0 opacity-0"),style:{overflow:e?"visible":"hidden"},children:l.jsx("div",{className:Qf("rounded-lg transition-all duration-300",e?"bg-surface-secondary/50 translate-y-0":"-translate-y-2"),children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:Qf("transition-all duration-300",e?"scale-100 text-blue-600 dark:text-blue-500":"scale-95 text-text-secondary"),children:l.jsx(pe,{className:"size-5"})}),l.jsx("div",{className:"flex flex-col gap-0.5",children:l.jsx(er,{htmlFor:"permission-level",className:"text-sm font-medium text-text-primary",children:o("com_ui_everyone_permission_level")})})]}),l.jsx("div",{className:Qf("relative z-50 transition-all duration-300",e?"scale-100 opacity-100":"scale-95 opacity-0"),children:l.jsx(BT,{id:"permission-level",resourceType:s,selectedRoleId:t,onRoleChange:a})})]})})})]})}const KT=Ta((function({principal:e,className:t,style:n,onClick:a,...s},r){const o=qN(),{name:i,email:c,type:d}=e,u=i||o("com_ui_unknown"),m=c||`${d} (${e.source||"local"})`,p=(()=>{switch(d){case Rh.USER:return{className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",label:o("com_ui_user")};case Rh.GROUP:return{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",label:o("com_ui_group")};case Rh.ROLE:return{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",label:o("com_ui_role")};default:return{className:"bg-surface-tertiary text-text-secondary",label:d}}})();return l.jsxs("div",{...s,ref:r,className:Qf("flex items-center gap-3 p-2",t),style:n,onClick:e=>{null==a||a(e)},children:[l.jsx($T,{principal:e,size:"md"}),l.jsxs("div",{className:"min-w-0 flex-1",children:[l.jsx("div",{className:"truncate text-sm font-medium text-text-primary",children:u}),l.jsx("div",{className:"truncate text-xs text-text-secondary",children:m})]}),l.jsx("div",{className:"flex-shrink-0",children:l.jsx("span",{className:Qf("inline-flex items-center rounded-full px-2 py-1 text-xs font-medium",p.className),children:p.label})})]})}));function WT({options:e,renderOptions:t,onPick:n,onQueryChange:a,query:s,label:r,isSmallScreen:o=!1,placeholder:i,resetValueOnHide:c=!1,isLoading:d=!1,minQueryLengthForNoResults:u=2}){const m=qN(),[p,h]=va.useState(!1),g=va.useRef(null),[x,f]=va.useState(s),v=xe({resetValueOnHide:c});va.useEffect((()=>{f(s)}),[s]);const _=va.useMemo((()=>xi((e=>{a(e)}),500)),[a]);va.useEffect((()=>()=>{_.cancel()}),[_]);return l.jsxs(fe,{store:v,children:[l.jsx(ve,{className:"mb-2 block font-medium text-text-primary",children:r}),l.jsx(l.Fragment,{children:l.jsxs("div",{className:Qf("group relative flex h-10 cursor-pointer items-center gap-2 rounded-lg border-border-medium text-text-primary transition-colors duration-200 focus-within:bg-surface-hover hover:bg-surface-hover",!0===o?"mb-2 h-14 rounded-2xl":""),children:[d?l.jsx(Xs,{className:"absolute left-3 h-4 w-4"}):l.jsx(_e,{className:"absolute left-3 h-4 w-4 text-text-secondary group-focus-within:text-text-primary group-hover:text-text-primary","aria-hidden":"true"}),l.jsx(be,{ref:g,onKeyDown:e=>{"Escape"===e.key&&v.getState().open&&(e.preventDefault(),e.stopPropagation(),f(""),a(""),_.cancel(),h(!1))},store:v,setValueOnClick:!1,setValueOnChange:!1,onChange:e=>{const t=e.target.value;f(t),_(t)},value:x,placeholder:i||m("com_ui_select_options"),className:"h-10 w-full rounded-lg bg-transparent pl-10 text-sm leading-tight text-text-primary placeholder-text-secondary placeholder-opacity-100 focus:outline-none focus-visible:outline-none group-focus-within:placeholder-text-primary group-hover:placeholder-text-primary"})]})}),l.jsx(ye,{portal:!1,gutter:8,sameWidth:!0,open:d||e.length>0||x.trim().length>=u&&!d,store:v,unmountOnHide:!0,autoFocusOnShow:!1,modal:!1,className:Qf("animate-popover z-[9999] min-w-64 overflow-hidden rounded-2xl border border-border-light bg-surface-secondary shadow-lg","[pointer-events:auto]"),children:d?l.jsx("div",{className:"space-y-2 p-2",children:Array.from({length:3}).map(((e,t)=>l.jsxs("div",{className:"flex items-center gap-3 px-3 py-2",children:[l.jsx(Ms,{className:"h-8 w-8 rounded-full"}),l.jsxs("div",{className:"flex-1 space-y-1",children:[l.jsx(Ms,{className:"h-4 w-3/4"}),l.jsx(Ms,{className:"h-3 w-1/2"})]})]},t)))}):e.length>0?e.map((e=>l.jsx(je,{focusOnHover:!0,value:e.value,selectValueOnClick:!1,onClick:()=>{return t=e,f(""),a(""),n(t),h(!1),void(g.current&&g.current.focus());var t},className:Qf("flex w-full cursor-pointer items-center px-3 text-sm","text-text-primary hover:bg-surface-tertiary","data-[active-item]:bg-surface-tertiary"),render:t(e)},e.key))):x.trim().length>=u?l.jsx("div",{className:Qf("flex items-center justify-center px-4 py-8 text-center","text-sm text-text-secondary"),children:l.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l.jsx(_e,{className:"h-8 w-8 text-text-tertiary opacity-50"}),l.jsx("div",{className:"font-medium",children:m("com_ui_no_results_found")}),l.jsx("div",{className:"text-xs text-text-tertiary",children:m("com_ui_try_adjusting_search")})]})}):null})]})}function qT({onAddPeople:e,placeholder:t,className:n="",typeFilter:a=null,excludeIds:s=[]}){const r=qN(),[o,i]=ja(""),c=Ca((()=>({q:o,limit:30,...a&&a.length>0&&{types:a}})),[o,a]),{data:d,isLoading:u,error:m}=PN(c,{enabled:o.length>=2}),p=o.length>=2&&u,h=Ca((()=>((null==d?void 0:d.results)||[]).filter((e=>e.idOnTheSource&&!s.includes(e.idOnTheSource)))),[null==d?void 0:d.results,s]);m&&console.error("Principal search error:",m);return l.jsx("div",{className:`${n}`,children:l.jsx(WT,{options:h.map((e=>({...e,id:e.id??void 0,key:e.idOnTheSource||"unknownpicker_key",value:e.idOnTheSource||"Unknown"}))),renderOptions:e=>l.jsx(KT,{principal:e}),placeholder:t||r("com_ui_search_default_placeholder"),query:o,onQueryChange:e=>{i(e)},onPick:t=>{e([t])},isLoading:p,label:""})})}const QT=({control:e,peoplePickerPerm:t,label:n,getValues:a,setValue:s})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[l.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>s(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),l.jsx(Li,{name:t,control:e,render:({field:e})=>l.jsx(dr,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString(),"aria-label":n})})]}),YT=()=>{const e=qN(),{showToast:t}=Ds(),{user:n,roles:a}=nk(),{mutate:s,isLoading:r}=(e=>{const t=xs(),{onMutate:n,onSuccess:a,onError:s}=e??{};return fs((e=>(Nh.partial().parse(e.updates),Jh.updatePeoplePickerPermissions(e))),{onSuccess:(e,n,s)=>{t.invalidateQueries([Fh.roles,n.roleName]),a&&a(e,n,s)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update people picker permissions:",t),s&&s(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[o,i]=ja(!1),[c,d]=ja(gh.USER),u=Ca((()=>{var e;const t=null==(e=null==a?void 0:a[c])?void 0:e.permissions;return t?t[Pp.PEOPLE_PICKER]:Dh[c].permissions[Pp.PEOPLE_PICKER]}),[a,c]),{reset:m,control:p,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:f}}=Oi({mode:"onChange",defaultValues:u});if(ya((()=>{var e,t;const n=null==(t=null==(e=null==a?void 0:a[c])?void 0:e.permissions)?void 0:t[Pp.PEOPLE_PICKER];m(n||Dh[c].permissions[Pp.PEOPLE_PICKER])}),[a,c,m]),(null==n?void 0:n.role)!==gh.ADMIN)return null;const v=[{peoplePickerPerm:Op.VIEW_USERS,label:e("com_ui_people_picker_allow_view_users")},{peoplePickerPerm:Op.VIEW_GROUPS,label:e("com_ui_people_picker_allow_view_groups")},{peoplePickerPerm:Op.VIEW_ROLES,label:e("com_ui_people_picker_allow_view_roles")}],_=e=>{s({roleName:c,updates:e})},b=[{label:gh.USER,onClick:()=>{d(gh.USER)}},{label:gh.ADMIN,onClick:()=>{d(gh.ADMIN)}}];return l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{variant:"outline",className:"btn btn-neutral border-token-border-light relative gap-1 rounded-lg font-medium","aria-label":e("com_ui_admin_settings"),children:[l.jsx(ae,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),l.jsxs(ir,{className:"w-full border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[l.jsx(lr,{children:e("com_ui_admin_settings_section",{section:e("com_ui_people_picker")})}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(cr,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:o,setIsOpen:i,trigger:l.jsx(se,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:c}),items:b,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:x(_),children:[l.jsx("div",{className:"py-5",children:v.map((({peoplePickerPerm:e,label:t})=>l.jsx("div",{children:l.jsx(QT,{control:p,peoplePickerPerm:e,label:t,getValues:g,setValue:h})},e)))}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{type:"button",onClick:x(_),disabled:f||r,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600",children:e("com_ui_save")})})]})]})]})]})};function XT({principles:e,onRemoveHandler:t,className:n="",onRoleChange:a,resourceType:s=Ph.AGENT}){const r=qN(),o=vr("(max-width: 768px)");return 0===e.length?l.jsx("div",{className:`space-y-3 ${n}`,children:l.jsxs("div",{className:"rounded-lg border border-dashed border-border-medium py-8 text-center text-muted-foreground",children:[l.jsx(O,{className:"mx-auto mb-2 h-8 w-8 opacity-50","aria-hidden":"true"}),l.jsx("p",{className:"mt-1 text-xs",children:r("com_ui_search_above_to_add_all")})]})}):l.jsx("div",{className:`space-y-3 ${n}`,children:l.jsx("div",{className:"space-y-2",children:e.map((e=>{const{displayName:n,subtitle:i}={displayName:(c=e).name||r("com_ui_unknown"),subtitle:o?`${c.type} (${c.source||"local"})`:c.email||`${c.type} (${c.source||"local"})`};var c;return l.jsxs("div",{className:"bg-surface flex items-center justify-between rounded-2xl border border-border p-3",children:[l.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[l.jsx($T,{principal:e,size:"md"}),l.jsxs("div",{className:"min-w-0 flex-1",children:[l.jsx("div",{className:"truncate text-sm font-medium",children:n}),l.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[l.jsx("span",{children:i}),"entra"===e.source&&l.jsxs(l.Fragment,{children:[l.jsx(we,{className:"h-3 w-3","aria-hidden":"true"}),l.jsx("span",{children:r("com_ui_azure_ad")})]})]})]})]}),l.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2",children:[!!e.accessRoleId&&!!a&&l.jsx(BT,{resourceType:s,selectedRoleId:e.accessRoleId,onRoleChange:t=>{null==a||a(e.idOnTheSource,t)},className:"min-w-0"}),l.jsx(Ys,{variant:"outline",onClick:()=>t(e.idOnTheSource),className:"h-9 w-9 p-0 hover:border-destructive/10 hover:bg-destructive/10 hover:text-destructive","aria-label":r("com_ui_remove_user",{0:n}),children:l.jsx(re,{className:"h-4 w-4","aria-hidden":"true"})})]})]},e.idOnTheSource+"-principalList")}))})})}function JT({resourceName:e,resourceDbId:t,resourceId:n,resourceType:a,onGrantAccess:s,disabled:r=!1,children:o}){const i=qN(),{showToast:c}=Ds(),[d,u]=ja(!1),[m,p]=ja(!1),{hasPeoplePickerAccess:h,peoplePickerTypeFilter:g}=IS(),{config:x,permissionsData:f,isLoadingPermissions:v,permissionsError:_,updatePermissionsMutation:b,currentShares:y,currentIsPublic:j,currentPublicRole:w,isPublic:N,setIsPublic:k,publicRole:C,setPublicRole:S}=RS(a,t,d),[T,E]=ja([]),[I,R]=ja(!1),[A,P]=ja(null==x?void 0:x.defaultViewerRoleId);ya((()=>{if(f&&d){const e=f.principals||[];E(e.map((e=>({...e,isExisting:!0})))),R(!1)}}),[f,d]);const L=(null==x?void 0:x.getResourceUrl)?null==x?void 0:x.getResourceUrl(n||""):"",M=gS({text:L});if(!t)return null;if(!x)return console.error(`Unsupported resource type: ${a}`),null;const D=e=>{E(T.filter((t=>t.idOnTheSource!==e))),R(!0)},F=y.length+(j?1:0),U=T.some((e=>e.accessRoleId===(null==x?void 0:x.defaultOwnerRoleId)))||N&&C===(null==x?void 0:x.defaultOwnerRoleId),z=I||(N!==j||C!==w);if(_)return l.jsx("div",{className:"text-sm text-red-600",children:i("com_ui_permissions_failed_load")});const V=o||l.jsx(Ys,{size:"sm",variant:"outline","aria-label":i("com_ui_share_var",{0:null==x?void 0:x.getShareMessage(e)}),type:"button",disabled:r,children:l.jsxs("div",{className:"flex min-w-[32px] items-center justify-center gap-2 text-blue-500",children:[l.jsx("span",{className:"flex h-6 w-6 items-center justify-center",children:l.jsx(Ne,{className:"icon-md h-4 w-4","aria-hidden":"true"})}),F>0&&l.jsx(er,{className:"text-sm font-medium text-text-secondary",children:F})]})});return l.jsxs(rr,{open:d,onOpenChange:u,modal:!0,children:[l.jsx(or,{asChild:!0,children:V}),l.jsxs(ir,{className:"max-h-[90vh] w-11/12 overflow-y-auto md:max-w-3xl",children:[l.jsx(lr,{children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(O,{className:"h-5 w-5","aria-hidden":"true"}),i("com_ui_share_var",{0:null==x?void 0:x.getShareMessage(e)})]})}),l.jsxs("div",{className:"space-y-6 p-2",children:[l.jsx("div",{className:"space-y-4",children:h&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("h4",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-text-primary",children:[l.jsx(ke,{className:"h-4 w-4","aria-hidden":"true"}),i("com_ui_user_group_permissions")," ( ",T.length," )"]}),l.jsx(qT,{onAddPeople:e=>{const t=e.filter((e=>!T.some((t=>t.idOnTheSource===e.idOnTheSource)))).map((e=>({...e,accessRoleId:A||(null==x?void 0:x.defaultViewerRoleId),isExisting:!1})));E((e=>[...e,...t])),R(!0)},placeholder:i("com_ui_search_people_placeholder"),typeFilter:g,excludeIds:T.map((e=>e.idOnTheSource))}),v?l.jsxs("div",{className:"flex flex-col items-center gap-2",children:[l.jsx(Ms,{className:"h-[62px] w-full rounded-lg"}),l.jsx(Ms,{className:"h-[62px] w-full rounded-lg"})]}):0!==T.length||I?l.jsxs("div",{className:"space-y-2",children:[!U&&I&&l.jsx("div",{className:"rounded-lg border border-destructive/30 bg-destructive/10 p-3 text-center",children:l.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-red-600 dark:text-red-400",children:[l.jsx(Ce,{className:"h-4 w-4","aria-hidden":"true"}),i("com_ui_at_least_one_owner_required")]})}),l.jsx(XT,{principles:T,onRemoveHandler:D,resourceType:a,onRoleChange:(e,t)=>((e,t)=>{E(T.map((n=>n.idOnTheSource===e?{...n,accessRoleId:t}:n))),R(!0)})(e,t)})]}):l.jsxs("div",{className:"rounded-lg border-2 border-dashed border-border-light p-8 text-center",children:[l.jsx(O,{className:"mx-auto h-8 w-8 text-text-primary","aria-hidden":"true"}),l.jsx("p",{className:"mt-2 text-sm text-text-primary",children:i("com_ui_no_individual_access")}),l.jsx("p",{className:"mt-1 text-xs text-text-primary",children:i("com_ui_search_above_to_add_people")})]})]})}),l.jsx("div",{className:"flex border-t border-border-light"}),l.jsx(GT,{isPublic:N,publicRole:C,onPublicToggle:e=>{k(e),R(!0),e||S(null==x?void 0:x.defaultViewerRoleId)},onPublicRoleChange:e=>{S(e),R(!0)},resourceType:a}),l.jsxs("div",{className:"flex justify-between pt-4",children:[l.jsx("div",{className:"flex gap-2",children:n&&L&&l.jsx(Ys,{variant:"outline",onClick:()=>{m||(M(p),c({message:i("com_ui_agent_url_copied"),status:"success"}))},disabled:m,className:Qf("shrink-0",m?"cursor-default":""),"aria-label":i("com_ui_copy_url_to_clipboard"),title:m?null==x?void 0:x.getCopyUrlMessage():i("com_ui_copy_url_to_clipboard"),children:m?l.jsx(de,{className:"h-4 w-4","aria-hidden":"true"}):l.jsx(Se,{className:"h-4 w-4","aria-hidden":"true"})})}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(YT,{}),l.jsx(_r,{asChild:!0,children:l.jsx(Ys,{variant:"outline",onClick:()=>{const e=(null==f?void 0:f.principals)||[];E(e.map((e=>({...e,isExisting:!0})))),P(null==x?void 0:x.defaultViewerRoleId),k(j),S(w||(null==x?void 0:x.defaultViewerRoleId)||""),R(!1),u(!1)},"aria-label":i("com_ui_cancel"),children:i("com_ui_cancel")})}),l.jsx(Ys,{onClick:async()=>{if(T.length||N||I)try{const e=new Map(y.map((e=>[`${e.type}-${e.idOnTheSource}`,e]))),n=new Map(T.map((e=>[`${e.type}-${e.idOnTheSource}`,e]))),r=T.filter((t=>{const n=`${t.type}-${t.idOnTheSource}`,a=e.get(n);return!a||a.accessRoleId!==t.accessRoleId})),o=y.filter((e=>{const t=`${e.type}-${e.idOnTheSource}`;return!n.has(t)}));await b.mutateAsync({resourceType:a,resourceId:t,data:{updated:r,removed:o,public:N,publicAccessRoleId:N?C:void 0}}),s&&s(T,N,C),c({message:i("com_ui_permissions_updated_success"),status:"success"}),R(!1)}catch(e){console.error("Error updating permissions:",e),c({message:i("com_ui_permissions_failed_update"),status:"error"})}},disabled:b.isLoading||!z||I&&!U,className:"min-w-[120px]","aria-label":i("com_ui_save_changes"),children:b.isLoading?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Xs,{className:"h-4 w-4"}),i("com_ui_saving")]}):i("com_ui_save_changes")})]})]})]})]})]})}function ZT({open:e,onOpenChange:t,children:n,triggerRef:a,server:s}){var r,o,i,c,d,u;const m=qN(),{showToast:p}=Ds(),{data:h}=K_(),g=function(){const e=j(N_.lang);return(t,n)=>{if(void 0===t)return n;if("string"==typeof t)return t;const a=(null==e?void 0:e.split("-")[0])??"en";return e&&t[e]||t[a]||t.en||Object.values(t)[0]||n}}(),x=Hb(),f=Gb(),v=Kb(),_=Ca((()=>{var e,t,n,a;if(s){let r=LT.None;s.config.oauth?r=LT.OAuth:"apiKey"in s.config&&s.config.apiKey&&(r=LT.ServiceHttp);const o="apiKey"in s.config?s.config.apiKey:void 0;return{title:s.config.title||"",description:s.config.description||"",url:"url"in s.config?s.config.url:"",type:s.config.type||"streamable-http",icon:s.config.iconPath||"",auth:{auth_type:r,api_key:"",api_key_source:(null==o?void 0:o.source)||"admin",api_key_authorization_type:(null==o?void 0:o.authorization_type)||MT.Bearer,api_key_custom_header:(null==o?void 0:o.custom_header)||"",oauth_client_id:(null==(e=s.config.oauth)?void 0:e.client_id)||"",oauth_client_secret:"",oauth_authorization_url:(null==(t=s.config.oauth)?void 0:t.authorization_url)||"",oauth_token_url:(null==(n=s.config.oauth)?void 0:n.token_url)||"",oauth_scope:(null==(a=s.config.oauth)?void 0:a.scope)||"",server_id:s.serverName},trust:!0}}return{title:"",description:"",url:"",type:"streamable-http",icon:"",auth:{auth_type:LT.None,api_key:"",api_key_source:"admin",api_key_authorization_type:MT.Bearer,api_key_custom_header:"",oauth_client_id:"",oauth_client_secret:"",oauth_authorization_url:"",oauth_token_url:"",oauth_scope:""},trust:!1}}),[s]),b=Oi({defaultValues:_}),{handleSubmit:y,register:w,formState:{errors:N},control:k,watch:C,reset:S}=b,T=C("icon"),[E,I]=ja(!1),[R,A]=ja(!1),[P,O]=ja(null),[L,M]=ja(!1),[D,F]=ja(!1);ya((()=>{e&&S(_)}),[e,s,S]);const U=y((async e=>{var n,r,o,i,l,c;I(!0);try{const n={type:e.type,url:e.url,title:e.title,...e.description&&{description:e.description},...e.icon&&{iconPath:e.icon}};if(e.auth.auth_type===LT.OAuth&&(e.auth.oauth_client_id||e.auth.oauth_client_secret||e.auth.oauth_authorization_url||e.auth.oauth_token_url||e.auth.oauth_scope)&&(n.oauth={},e.auth.oauth_client_id&&(n.oauth.client_id=e.auth.oauth_client_id),e.auth.oauth_client_secret&&(n.oauth.client_secret=e.auth.oauth_client_secret),e.auth.oauth_authorization_url&&(n.oauth.authorization_url=e.auth.oauth_authorization_url),e.auth.oauth_token_url&&(n.oauth.token_url=e.auth.oauth_token_url),e.auth.oauth_scope&&(n.oauth.scope=e.auth.oauth_scope)),e.auth.auth_type===LT.ServiceHttp){const t=e.auth.api_key_source||"admin",a=e.auth.api_key_authorization_type||"bearer";n.apiKey={source:t,authorization_type:a,..."admin"===t&&e.auth.api_key&&{key:e.auth.api_key},..."custom"===a&&e.auth.api_key_custom_header&&{custom_header:e.auth.api_key_custom_header}}}const r={config:n},o=s?await f.mutateAsync({serverName:s.serverName,data:r}):await x.mutateAsync(r);p({message:m(s?"com_ui_mcp_server_updated":"com_ui_mcp_server_created"),status:"success"}),s||e.auth.auth_type!==LT.OAuth?t(!1):(O(o.serverName),A(!0)),setTimeout((()=>{var e;null==(e=null==a?void 0:a.current)||e.focus()}),0)}catch(d){let e=m("com_ui_error");if(d&&"object"==typeof d&&"response"in d){const t=d;"MCP_INSPECTION_FAILED"===(null==(r=null==(n=t.response)?void 0:n.data)?void 0:r.error)?e=m("com_ui_mcp_server_connection_failed"):"MCP_DOMAIN_NOT_ALLOWED"===(null==(i=null==(o=t.response)?void 0:o.data)?void 0:i.error)?e=m("com_ui_mcp_domain_not_allowed"):(null==(c=null==(l=t.response)?void 0:l.data)?void 0:c.error)&&(e=t.response.data.error)}else d.message&&(e=d.message);p({message:e,status:"error"})}finally{I(!1)}})),{user:z}=nk(),V=ak({permissionType:Pp.MCP_SERVERS,permission:Op.SHARE}),{hasPermission:$,isLoading:B}=eT(Ph.MCPSERVER,(null==s?void 0:s.dbId)||""),H=$(Oh.SHARE),G=s&&((null==z?void 0:z.role)===gh.ADMIN||H)&&V&&!B,K=P?`${window.location.origin}/api/mcp/${P}/oauth/callback`:"";return l.jsxs(l.Fragment,{children:[l.jsx(rr,{open:L,onOpenChange:e=>{M(e)},children:l.jsx(hr,{title:m("com_ui_delete"),className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:m("com_ui_mcp_server_delete_confirm")}),selection:{selectHandler:async()=>{var e,n;if(s){F(!0);try{await v.mutateAsync(s.serverName),p({message:m("com_ui_mcp_server_deleted"),status:"success"}),M(!1),t(!1),setTimeout((()=>{var e;null==(e=null==a?void 0:a.current)||e.focus()}),0)}catch(r){let t=m("com_ui_error");if(r&&"object"==typeof r&&"response"in r){const a=r;(null==(n=null==(e=a.response)?void 0:e.data)?void 0:n.error)&&(t=a.response.data.error)}else r.message&&(t=r.message);p({message:t,status:"error"})}finally{F(!1)}}},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:D?l.jsx(Xs,{}):m("com_ui_delete")}})}),l.jsx(rr,{open:R,onOpenChange:e=>{A(e),e||(t(!1),O(null))},children:l.jsxs(ir,{className:"w-full max-w-lg border-none bg-surface-primary text-text-primary",children:[l.jsx(br,{className:"border-b border-border-light sm:p-3",children:l.jsx(lr,{children:m("com_ui_mcp_server_created")})}),l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[l.jsx("p",{className:"mb-4 text-sm text-text-primary",children:m("com_ui_redirect_uri_instructions")}),l.jsxs("div",{className:"rounded-lg border border-border-medium bg-surface-secondary p-3",children:[l.jsx("label",{className:"mb-2 block text-xs font-medium text-text-secondary",children:m("com_ui_redirect_uri")}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("input",{className:"flex-1 rounded border border-border-medium bg-surface-primary px-3 py-2 text-sm",value:K,readOnly:!0}),l.jsx(Ys,{onClick:()=>{navigator.clipboard.writeText(K),p({message:m("com_ui_copied"),status:"success"})},variant:"outline",className:"whitespace-nowrap",children:m("com_ui_copy_link")})]})]}),l.jsx("div",{className:"mt-6 flex justify-end",children:l.jsx(Ys,{onClick:()=>{A(!1),t(!1),O(null)},variant:"submit",className:"text-white",children:m("com_ui_done")})})]})]})}),l.jsxs(rr,{open:e,onOpenChange:t,triggerRef:a,children:[n,l.jsx(hr,{title:m(s?"com_ui_edit_mcp_server":"com_ui_add_mcp_server"),description:s?m("com_ui_edit_mcp_server_dialog_description",{serverName:s.serverName}):void 0,className:"w-11/12 md:max-w-2xl",main:l.jsx(Mi,{...b,children:l.jsxs("div",{className:"max-h-[60vh] space-y-4 overflow-y-auto px-1",children:[l.jsx("div",{children:l.jsx(VT,{icon:T,onIconChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];if(n){const e=new FileReader;e.onloadend=()=>{const t=e.result;b.setValue("icon",t)},e.readAsDataURL(n)}}})}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs(er,{htmlFor:"title",className:"text-sm font-medium",children:[m("com_ui_name")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{autoComplete:"off",...w("title",{required:!0,pattern:{value:/^[a-zA-Z0-9 ]+$/,message:m("com_ui_mcp_title_invalid")}}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:m("com_agents_mcp_name_placeholder")}),N.title&&l.jsx("span",{className:"text-xs text-red-500",children:"pattern"===N.title.type?N.title.message:m("com_ui_field_required")})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs(er,{htmlFor:"description",className:"text-sm font-medium",children:[m("com_ui_description"),l.jsx("span",{className:"ml-1 text-xs text-text-secondary-alt",children:m("com_ui_optional")})]}),l.jsx("input",{id:"description",...w("description"),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:m("com_agents_mcp_description_placeholder")})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs(er,{htmlFor:"url",className:"text-sm font-medium",children:[m("com_ui_mcp_url")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("input",{id:"url",...w("url",{required:!0}),className:"border-token-border-medium flex h-9 w-full rounded-lg border bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light",placeholder:"https://mcp.example.com"}),N.url&&l.jsx("span",{className:"text-xs text-red-500",children:"required"===N.url.type?m("com_ui_field_required"):N.url.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(er,{htmlFor:"type",className:"text-sm font-medium",children:m("com_ui_mcp_server_type")}),l.jsx(Li,{name:"type",control:k,render:({field:e})=>l.jsxs(Va,{value:e.value,onValueChange:e.onChange,className:"flex gap-4",children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"type-streamable-http",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",value:"streamable-http",id:"type-streamable-http",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),m("com_ui_mcp_type_streamable_http")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:"type-sse",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",value:"sse",id:"type-sse",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),m("com_ui_mcp_type_sse")]})})]})})]}),l.jsx(Li,{name:"auth",control:k,render:({field:e})=>l.jsx(FT,{value:e.value,onChange:e.onChange})}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Li,{name:"trust",control:k,rules:{required:!0},render:({field:e})=>l.jsx(jr,{id:"trust",checked:e.value,onCheckedChange:e.onChange,"aria-labelledby":"trust-this-mcp-label"})}),l.jsxs(er,{id:"trust-this-mcp-label",htmlFor:"trust",className:"flex cursor-pointer flex-col break-words text-sm font-medium",children:[l.jsxs("span",{children:[(null==(i=null==(o=null==(r=null==h?void 0:h.interface)?void 0:r.mcpServers)?void 0:o.trustCheckbox)?void 0:i.label)?l.jsx("span",{dangerouslySetInnerHTML:{__html:g(h.interface.mcpServers.trustCheckbox.label,m("com_ui_trust_app"))}}):m("com_ui_trust_app")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("span",{className:"text-xs font-normal text-text-secondary",children:(null==(u=null==(d=null==(c=null==h?void 0:h.interface)?void 0:c.mcpServers)?void 0:d.trustCheckbox)?void 0:u.subLabel)?l.jsx("span",{dangerouslySetInnerHTML:{__html:g(h.interface.mcpServers.trustCheckbox.subLabel,m("com_agents_mcp_trust_subtext"))}}):m("com_agents_mcp_trust_subtext")})]})]}),N.trust&&l.jsx("span",{className:"text-xs text-red-500",children:m("com_ui_field_required")})]})}),footerClassName:"sm:justify-between",leftButtons:s?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Ys,{type:"button",variant:"outline",size:"sm","aria-label":"Delete MCP server",onClick:()=>M(!0),disabled:E||D,children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:l.jsx(yr,{})})}),G&&l.jsx(JT,{resourceDbId:s.dbId,resourceName:s.config.title||"",resourceType:Ph.MCPSERVER})]}):null,buttons:l.jsx(Ys,{type:"button",variant:"submit",onClick:U,disabled:E,className:"text-white",children:E?l.jsx(Xs,{className:"size-4"}):m(s?"com_ui_update":"com_ui_create")})})]})]})}const eE=({server:e})=>{const t=qN(),[n,a]=ja(!1),s=ba(null);return l.jsx(ZT,{open:n,onOpenChange:a,triggerRef:s,server:e,children:l.jsx(or,{asChild:!0,children:l.jsx("button",{ref:s,onClick:()=>a(!0),className:"flex h-5 w-5 items-center justify-center rounded hover:bg-surface-secondary","aria-label":t("com_ui_edit"),children:l.jsx(Nr,{className:"h-4 w-4"})})})})};function tE({servers:e,getServerStatusIconProps:t,isFiltered:n=!1}){const a=ak({permissionType:Pp.MCP_SERVERS,permission:Op.CREATE}),s=qN();return 0===e.length?l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent p-8 text-center shadow-sm",children:n?l.jsx("p",{className:"text-sm text-text-secondary",children:s("com_ui_no_mcp_servers_match")}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-sm text-text-secondary",children:s("com_ui_no_mcp_servers")}),l.jsx("p",{className:"mt-1 text-xs text-text-tertiary",children:s("com_ui_add_first_mcp_server")})]})}):l.jsx("div",{className:"space-y-2",children:e.map((e=>{var n,s;const r=function(e,t){return(e&t)===t}(e.effectivePermissions,Oh.EDIT),o=(null==(n=e.config)?void 0:n.title)||e.serverName,i=`key_${e.serverName}`;return l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent p-3",children:l.jsxs("div",{className:"flex items-center gap-3",children:[(null==(s=e.config)?void 0:s.iconPath)?l.jsx("img",{src:e.config.iconPath,className:"h-5 w-5 rounded",alt:o}):l.jsx(wr,{className:"h-5 w-5"}),l.jsx("div",{className:"min-w-0 flex-1",children:l.jsx("h3",{className:"truncate font-semibold text-text-primary",children:o})}),a&&r&&l.jsx(eE,{server:e}),l.jsx(ST,{...t(e.serverName)})]})},i)}))})}function nE({serverName:e,requiresOAuth:t,conversationId:n,sidePanel:a=!1,hasCustomUserVars:s=!1}){const r=qN(),{getOAuthUrl:o,isCancellable:i,isInitializing:c,cancelOAuthFlow:d,initializeServer:u,availableMCPServers:m,revokeOAuthForServer:p}=aS({conversationId:n}),{connectionStatus:h}=nS({enabled:!!m&&m.length>0}),g=null==h?void 0:h[e],x="connected"===(null==g?void 0:g.connectionState),f=i(e),v=c(e),_=o(e),b=x&&(t||s);if(!b&&!(!x&&!_)&&!_)return null;if(_)return l.jsx(l.Fragment,{children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Ys,{onClick:()=>d(e),disabled:!f,variant:"outline",title:f?void 0:"disabled",children:r("com_ui_cancel")}),l.jsx(Ys,{variant:"submit",onClick:()=>window.open(_,"_blank","noopener,noreferrer"),className:"flex-1",children:r("com_ui_continue_oauth")})]})});const y=b?void 0:"default";let j="";j=r(v?"com_ui_loading":b?"com_ui_reinitialize":t?"com_ui_authenticate":"com_ui_mcp_initialize");const w=v?l.jsx(Xs,{className:"h-4 w-4"}):l.jsx(Ee,{className:"h-4 w-4","aria-hidden":"true"});return l.jsxs("div",{className:"flex items-center gap-2",children:[t&&p&&l.jsxs(Ys,{size:"sm",variant:"destructive",onClick:()=>p(e),"aria-label":r("com_ui_revoke"),children:[l.jsx(Te,{className:"h-4 w-4"}),r("com_ui_revoke")]}),l.jsxs(Ys,{variant:y,onClick:()=>u(e,!1),disabled:v,size:a?"sm":"default",className:"flex-1",children:[w,j]})]})}function aE({name:e,config:t,hasValue:n,control:a,errors:s}){var r;const o=qN(),i=o(n?"com_ui_set":"com_ui_unset"),c=Ca((()=>{const e=Ie();return e.addHook("afterSanitizeAttributes",(e=>{e.tagName&&"A"===e.tagName&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"))})),e}),[]),d=Ca((()=>{if(!t.description)return"";try{return c.sanitize(t.description,{ALLOWED_TAGS:["a","strong","b","em","i","br","code"],ALLOWED_ATTR:["href","class","target","rel"],ALLOW_DATA_ATTR:!1,ALLOW_ARIA_ATTR:!1})}catch(e){return console.error("Sanitization failed",e),t.description}}),[t.description,c]);return l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs(er,{htmlFor:e,className:"text-sm font-medium",children:[t.title," ",l.jsxs("span",{className:"sr-only",children:["(",i,")"]})]}),l.jsx("div",{"aria-hidden":"true",children:n?l.jsxs("div",{className:"flex min-w-fit items-center gap-2 whitespace-nowrap rounded-full border border-border-light px-2 py-0.5 text-xs font-medium text-text-secondary",children:[l.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),l.jsx("span",{children:o("com_ui_set")})]}):l.jsxs("div",{className:"flex min-w-fit items-center gap-2 whitespace-nowrap rounded-full border border-border-light px-2 py-0.5 text-xs font-medium text-text-secondary",children:[l.jsx("div",{className:"h-1.5 w-1.5 rounded-full border border-border-medium"}),l.jsx("span",{children:o("com_ui_unset")})]})})]}),l.jsx(Li,{name:e,control:a,defaultValue:"",render:({field:a})=>l.jsx(kr,{id:e,type:"text",...a,placeholder:o(n?"com_ui_mcp_update_var":"com_ui_mcp_enter_var",{0:t.title}),className:"w-full rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary placeholder:text-text-secondary focus:outline-none sm:text-sm"})}),d&&l.jsx("p",{className:"text-xs text-text-secondary [&_a]:text-blue-500 [&_a]:hover:underline",dangerouslySetInnerHTML:{__html:d}}),s[e]&&l.jsx("p",{className:"text-xs text-red-500",children:null==(r=s[e])?void 0:r.message})]})}function sE({fields:e,onSave:t,onRevoke:n,serverName:a,isSubmitting:s=!1}){const r=qN(),{data:o}=cb(a,{enabled:!!a}),{reset:i,control:c,handleSubmit:d,formState:{errors:u}}=Oi({defaultValues:Ca((()=>{const t={};return Object.keys(e).forEach((e=>{t[e]=""})),t}),[e])}),m=e=>{t(e)};return e&&0!==Object.keys(e).length?l.jsxs("div",{className:"flex-1 space-y-4",children:[l.jsx("form",{onSubmit:d(m),className:"space-y-4",children:Object.entries(e).map((([e,t])=>{var n;const a=(null==(n=null==o?void 0:o.authValueFlags)?void 0:n[e])||!1;return l.jsx(aE,{name:e,config:t,hasValue:a,control:c,errors:u},e)}))}),l.jsxs("div",{className:"flex justify-end gap-2",children:[l.jsx(Ys,{type:"button",variant:"destructive",disabled:s,onClick:()=>{n(),i()},children:r("com_ui_revoke")}),l.jsx(Ys,{type:"button",variant:"submit",disabled:s,onClick:d(m),children:r(s?"com_ui_saving":"com_ui_save")})]})]}):null}function rE({isOpen:e,onOpenChange:t,fieldsSchema:n,onSave:a,isSubmitting:s=!1,onRevoke:r,serverName:o,serverStatus:i,conversationId:c}){const d=qN(),u=Object.keys(n).length>0?d("com_ui_configure_mcp_variables_for",{0:o}):`${o} MCP Server`,m=Ca((()=>{if(!i)return d("com_ui_mcp_dialog_title",{serverName:o,status:""});const{connectionState:e,requiresOAuth:t}=i;let n="";return"connecting"===e?n=d("com_ui_connecting"):"error"===e?n=d("com_ui_error"):"connected"===e?n=d("com_ui_active"):"disconnected"===e&&(n=d(t?"com_ui_oauth":"com_ui_offline")),d("com_ui_mcp_dialog_title",{serverName:o,status:n})}),[i,o,d]);return l.jsx(rr,{open:e,onOpenChange:t,children:l.jsxs(ir,{className:"flex max-h-screen w-11/12 max-w-lg flex-col space-y-2",title:m,children:[l.jsx(br,{children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(lr,{className:"text-xl",children:u.charAt(0).toUpperCase()+u.slice(1)}),(()=>{if(!i)return null;const{connectionState:e,requiresOAuth:t}=i;return"connecting"===e?l.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-blue-50 px-2 py-0.5 text-xs font-medium text-blue-600 dark:bg-blue-950 dark:text-blue-400",children:[l.jsx(Xs,{className:"h-3 w-3"}),l.jsx("span",{children:d("com_ui_connecting")})]}):"disconnected"===e?t?l.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-600 dark:bg-amber-950 dark:text-amber-400",children:[l.jsx(oe,{className:"h-3 w-3","aria-hidden":"true"}),l.jsx("span",{children:d("com_ui_oauth")})]}):l.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-orange-50 px-2 py-0.5 text-xs font-medium text-orange-600 dark:bg-orange-950 dark:text-orange-400",children:[l.jsx(ie,{className:"h-3 w-3","aria-hidden":"true"}),l.jsx("span",{children:d("com_ui_offline")})]}):"error"===e?l.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-red-50 px-2 py-0.5 text-xs font-medium text-red-600 dark:bg-red-950 dark:text-red-400",children:[l.jsx(le,{className:"h-3 w-3","aria-hidden":"true"}),l.jsx("span",{children:d("com_ui_error")})]}):"connected"===e?l.jsxs("div",{className:"flex items-center gap-2 rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700 dark:bg-green-900 dark:text-green-300",children:[l.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500"}),l.jsx("span",{children:d("com_ui_active")})]}):null})()]})}),l.jsx(sE,{serverName:o,fields:n,onSave:a,onRevoke:r||(()=>{}),isSubmitting:s}),l.jsx(nE,{serverName:o,conversationId:c,requiresOAuth:(null==i?void 0:i.requiresOAuth)||!1,hasCustomUserVars:n&&Object.keys(n).length>0})]})})}const oE=({control:e,mcpServersPerm:t,label:n,getValues:a,setValue:s})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[l.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>s(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),l.jsx(Li,{name:t,control:e,render:({field:e})=>{var t;return l.jsx(dr,{...e,checked:e.value,onCheckedChange:e.onChange,value:null==(t=e.value)?void 0:t.toString()})}})]}),iE=()=>{const e=qN(),{showToast:t}=Ds(),{user:n,roles:a}=nk(),{mutate:s,isLoading:r}=(e=>{const t=xs(),{onMutate:n,onSuccess:a,onError:s}=e??{};return fs((e=>(Th.partial().parse(e.updates),Jh.updateMCPServersPermissions(e))),{onSuccess:(e,n,s)=>{t.invalidateQueries([Fh.roles,n.roleName]),a&&a(e,n,s)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update MCP servers permissions:",t),s&&s(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[o,i]=ja(!1),[c,d]=ja(gh.USER),u=Ca((()=>{var e;const t=null==(e=null==a?void 0:a[c])?void 0:e.permissions;return t?t[Pp.MCP_SERVERS]:Dh[c].permissions[Pp.MCP_SERVERS]}),[a,c]),{reset:m,control:p,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:f}}=Oi({mode:"onChange",defaultValues:u});if(ya((()=>{var e,t;const n=null==(t=null==(e=null==a?void 0:a[c])?void 0:e.permissions)?void 0:t[Pp.MCP_SERVERS];m(n||Dh[c].permissions[Pp.MCP_SERVERS])}),[a,c,m]),(null==n?void 0:n.role)!==gh.ADMIN)return null;const v=[{mcpServersPerm:Op.USE,label:e("com_ui_mcp_servers_allow_use")},{mcpServersPerm:Op.CREATE,label:e("com_ui_mcp_servers_allow_create")},{mcpServersPerm:Op.SHARE,label:e("com_ui_mcp_servers_allow_share")}],_=e=>{s({roleName:c,updates:e})},b=[{label:gh.USER,onClick:()=>{d(gh.USER)}},{label:gh.ADMIN,onClick:()=>{d(gh.ADMIN)}}];return l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-text-primary","aria-label":e("com_ui_admin_settings"),children:[l.jsx(ae,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),l.jsxs(ir,{className:"border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[l.jsx(lr,{children:`${e("com_ui_admin_settings")} - ${e("com_ui_mcp_servers")}`}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(cr,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:o,setIsOpen:i,trigger:l.jsx(se,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:c}),items:b,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:x(_),children:[l.jsx("div",{className:"py-5",children:v.map((({mcpServersPerm:t,label:n})=>l.jsxs("div",{children:[l.jsx(oE,{control:p,mcpServersPerm:t,label:n,getValues:g,setValue:h}),c===gh.ADMIN&&t===Op.USE&&l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[l.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",l.jsx("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t)))}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{type:"button",onClick:x(_),disabled:f||r,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600 focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-text-primary",children:e("com_ui_save")})})]})]})]})]})};function lE(){const e=qN(),{availableMCPServers:t,isLoading:n,getServerStatusIconProps:a,getConfigDialogProps:s}=aS(),r=ak({permissionType:Pp.MCP_SERVERS,permission:Op.CREATE}),[o,i]=ja(!1),[c,d]=ja(""),u=ba(null),m=s(),p=Ca((()=>{if(!c.trim())return t;const e=c.toLowerCase();return t.filter((t=>{var n;return((null==(n=t.config)?void 0:n.title)||t.serverName).toLowerCase().includes(e)||t.serverName.toLowerCase().includes(e)}))}),[t,c]);return l.jsx("div",{className:"flex h-full w-full flex-col overflow-visible",children:l.jsxs("div",{role:"region","aria-label":"MCP Builder",className:"mt-2 space-y-2",children:[l.jsx(iE,{}),l.jsxs("div",{className:"relative",children:[l.jsx(_e,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-text-secondary"}),l.jsx(kr,{value:c,onChange:e=>d(e.target.value),placeholder:e("com_ui_filter_mcp_servers"),className:"pl-9","aria-label":e("com_ui_filter_mcp_servers")})]}),r&&l.jsx(ZT,{open:o,onOpenChange:i,triggerRef:u,children:l.jsx(or,{asChild:!0,children:l.jsx("div",{className:"flex w-full justify-end",children:l.jsxs(Ys,{ref:u,variant:"outline",className:"w-full bg-transparent",onClick:()=>i(!0),children:[l.jsx(Re,{className:"size-4","aria-hidden":!0}),e("com_ui_add_mcp")]})})})}),n?l.jsx("div",{className:"flex items-center justify-center p-8",children:l.jsx(Xs,{className:"h-6 w-6"})}):l.jsx(tE,{servers:p,getServerStatusIconProps:a,isFiltered:c.trim().length>0}),m&&l.jsx(rE,{...m})]})})}const cE=(e,t,n)=>{if(!n||0===n.length)return!1;if(!t){return 0===n.findIndex((t=>t.name===e.name&&t.instructions===e.instructions&&t.artifacts===e.artifacts))}const a=e.name===t.name,s=e.description===t.description,r=e.instructions===t.instructions,o=e.artifacts===t.artifacts;return a&&s&&r&&o&&(()=>{if(!e.tools&&!t.tools)return!0;if(!e.tools||!t.tools)return!1;if(e.tools.length!==t.tools.length)return!1;const n=[...e.tools].sort(),a=[...t.tools].sort();return n.every(((e,t)=>e===a[t]))})()&&(()=>{if(!e.capabilities&&!t.capabilities)return!0;if(!e.capabilities||!t.capabilities)return!1;if(e.capabilities.length!==t.capabilities.length)return!1;const n=[...e.capabilities].sort(),a=[...t.capabilities].sort();return n.every(((e,t)=>e===a[t]))})()};function dE({version:e,index:t,isActive:n,versionsLength:a,onRestore:s}){const r=qN();return l.jsxs("div",{className:"rounded-md border border-border-light p-3",children:[l.jsxs("div",{className:"flex items-center justify-between font-medium",children:[l.jsx("span",{children:r("com_ui_agent_version_title",{versionNumber:a-t})}),n&&l.jsx("span",{className:"rounded-full border border-green-600 bg-green-600/20 px-2 py-0.5 text-xs font-medium text-green-700 dark:border-green-500 dark:bg-green-500/30 dark:text-green-300",children:r("com_ui_agent_version_active")})]}),l.jsx("div",{className:"text-sm text-text-secondary",children:(e=>{const t=e.updatedAt||e.createdAt;if(t)try{const e=new Date(t);return isNaN(e.getTime())||"Invalid Date"===e.toString()?r("com_ui_agent_version_unknown_date"):e.toLocaleString()}catch(n){return r("com_ui_agent_version_unknown_date")}return r("com_ui_agent_version_no_date")})(e)}),!n&&l.jsx("button",{className:"mt-2 text-sm text-blue-500 hover:text-blue-600",onClick:()=>{window.confirm(r("com_ui_agent_version_restore_confirm"))&&s(t)},"aria-label":r("com_ui_agent_version_restore"),children:r("com_ui_agent_version_restore")})]})}function uE({selectedAgentId:e,isLoading:t,error:n,versionContext:a,onRestore:s}){const{versions:r,versionIds:o}=a,i=qN();return e?t?l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsx(Xs,{className:"h-6 w-6"})}):n?l.jsx("div",{className:"py-8 text-center text-red-500",children:i("com_ui_agent_version_error")}):o.length>0?l.jsx("div",{className:"flex flex-col gap-2",children:o.map((({id:e,version:t,isActive:n})=>l.jsx(dE,{version:t,index:e,isActive:n,versionsLength:r.length,onRestore:s},e)))}):l.jsx("div",{className:"py-8 text-center text-text-secondary",children:i("com_ui_agent_version_empty")}):l.jsx("div",{className:"py-8 text-center text-text-secondary",children:i("com_ui_agent_version_no_agent")})}function mE(){const e=qN(),{showToast:t}=Ds(),{agent_id:n,setActivePanel:a}=lk(),s=n??"",{data:r,isLoading:o,error:i,refetch:c}=A_(s),d=B_({onSuccess:()=>{t({message:e("com_ui_agent_version_restore_success"),status:"success"}),c()},onError:()=>{t({message:e("com_ui_agent_version_restore_error"),status:"error"})}}),u=r,m=Ca((()=>u?{name:u.name,description:u.description,instructions:u.instructions,artifacts:u.artifacts,capabilities:u.capabilities,tools:u.tools}:null),[u]),p=Ca((()=>[...(null==u?void 0:u.versions)||[]].sort(((e,t)=>{const n=e.updatedAt?new Date(e.updatedAt).getTime():0;return(t.updatedAt?new Date(t.updatedAt).getTime():0)-n}))),[null==u?void 0:u.versions]),h=Ca((()=>p.length>0&&p.find((e=>cE(e,m,p)))||null),[p,m]),g=Ca((()=>{if(0===p.length)return[];const e=p.filter((e=>cE(e,m,p))),t=e.length>0?p.findIndex((t=>t===e[0])):-1;return p.map(((e,n)=>{var a;return{id:n,originalIndex:(null==(a=null==u?void 0:u.versions)?void 0:a.findIndex((t=>t.updatedAt===e.updatedAt&&t.createdAt===e.createdAt&&t.name===e.name)))??n,version:e,isActive:n===t}}))}),[p,m,null==u?void 0:u.versions]),x=Ca((()=>({versions:p,versionIds:g,currentAgent:m,selectedAgentId:s,activeVersion:h})),[p,g,m,s,h]),f=ka((e=>{const t=g.find((t=>t.id===e));if(t){const e=t.originalIndex;d.mutate({agent_id:s,version_index:e})}}),[d,s,g]);return l.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[l.jsxs("div",{className:"version-panel relative flex flex-col items-center px-16 py-4 text-center",children:[l.jsx("div",{className:"absolute left-0 top-4",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{a(rx.builder)},children:l.jsx("div",{className:"version-panel-content flex w-full items-center justify-center gap-2",children:l.jsx(Ae,{})})})}),l.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:e("com_ui_agent_version_history")})]}),l.jsx("div",{className:"flex flex-col gap-4 px-2",children:l.jsx(uE,{selectedAgentId:s,isLoading:o,error:i,versionContext:x,onRestore:f})})]})}function pE({disableOAuth:e}){const t=qN(),[n,a]=ja(!1),{watch:s,setValue:r,trigger:o}=Pi(),i=s("type");return l.jsxs(rr,{open:n,onOpenChange:a,children:[l.jsx(or,{asChild:!0,children:l.jsxs("div",{className:"relative mb-4",children:[l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:t("com_ui_authentication")})}),l.jsxs("div",{className:"border-token-border-medium flex rounded-lg border text-sm hover:cursor-pointer",children:[l.jsx("div",{className:"h-9 grow px-3 py-2",children:t(gE(i))}),l.jsx("div",{className:"bg-token-border-medium w-px"}),l.jsx("button",{type:"button",color:"neutral",className:"flex items-center gap-2 px-3",children:l.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-sm",children:[l.jsx("path",{d:"M11.6439 3C10.9352 3 10.2794 3.37508 9.92002 3.98596L9.49644 4.70605C8.96184 5.61487 7.98938 6.17632 6.93501 6.18489L6.09967 6.19168C5.39096 6.19744 4.73823 6.57783 4.38386 7.19161L4.02776 7.80841C3.67339 8.42219 3.67032 9.17767 4.01969 9.7943L4.43151 10.5212C4.95127 11.4386 4.95127 12.5615 4.43151 13.4788L4.01969 14.2057C3.67032 14.8224 3.67339 15.5778 4.02776 16.1916L4.38386 16.8084C4.73823 17.4222 5.39096 17.8026 6.09966 17.8083L6.93502 17.8151C7.98939 17.8237 8.96185 18.3851 9.49645 19.294L9.92002 20.014C10.2794 20.6249 10.9352 21 11.6439 21H12.3561C13.0648 21 13.7206 20.6249 14.08 20.014L14.5035 19.294C15.0381 18.3851 16.0106 17.8237 17.065 17.8151L17.9004 17.8083C18.6091 17.8026 19.2618 17.4222 19.6162 16.8084L19.9723 16.1916C20.3267 15.5778 20.3298 14.8224 19.9804 14.2057L19.5686 13.4788C19.0488 12.5615 19.0488 11.4386 19.5686 10.5212L19.9804 9.7943C20.3298 9.17767 20.3267 8.42219 19.9723 7.80841L19.6162 7.19161C19.2618 6.57783 18.6091 6.19744 17.9004 6.19168L17.065 6.18489C16.0106 6.17632 15.0382 5.61487 14.5036 4.70605L14.08 3.98596C13.7206 3.37508 13.0648 3 12.3561 3H11.6439Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),l.jsx("circle",{cx:"12",cy:"12",r:"2.5",stroke:"currentColor",strokeWidth:"2"})]})})]})]})}),l.jsxs(ir,{className:"w-full max-w-md border-none bg-surface-primary text-text-primary",children:[l.jsx(br,{className:"border-b border-border-light sm:p-3",children:l.jsx(lr,{children:t("com_ui_authentication")})}),l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-0",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:t("com_ui_authentication_type")}),l.jsxs(Va,{defaultValue:iu.None,onValueChange:e=>r("type",e),value:i,role:"radiogroup","aria-required":"false",dir:"ltr",className:"flex gap-4",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rf8:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:iu.None,id:":rf8:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_none")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rfa:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:iu.ServiceHttp,id:":rfa:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_api_key")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rfc:",className:Qf("flex items-center gap-1",!0===e?"cursor-not-allowed":"cursor-pointer"),children:[l.jsx($a,{type:"button",role:"radio",disabled:e,value:iu.OAuth,id:":rfc:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary",!0===e?"cursor-not-allowed":""),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),t("com_ui_oauth")]})})]})]}),"none"===i?null:"service_http"===i?l.jsx(hE,{}):l.jsx(xE,{}),l.jsxs("div",{className:"mt-5 flex flex-col gap-3 sm:mt-4 sm:flex-row-reverse",children:[l.jsx("button",{className:"btn relative bg-surface-submit text-primary-foreground hover:bg-surface-submit-hover",onClick:async()=>{const e=await o(void 0,{shouldFocus:!0});r("saved_auth_fields",e),a(!e)},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-white",children:t("com_ui_save")})}),l.jsx(_r,{className:"btn btn-neutral relative",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:t("com_ui_cancel")})})]})]})]})]})}const hE=()=>{const e=qN(),{register:t,watch:n,setValue:a}=Pi(),s=n("authorization_type"),r=n("type");return l.jsxs(l.Fragment,{children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_api_key")}),l.jsx("input",{placeholder:"<HIDDEN>",type:"new-password",autoComplete:"new-password",className:Qf("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),...t("api_key",{required:r===iu.ServiceHttp})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_type")}),l.jsxs(Va,{defaultValue:lu.Basic,onValueChange:e=>a("authorization_type",e),value:s,role:"radiogroup","aria-required":"true",dir:"ltr",className:"mb-2 flex gap-6 overflow-hidden rounded-lg",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rfu:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:lu.Basic,id:":rfu:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rg0:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:lu.Bearer,id:":rg0:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_bearer")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rg2:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:lu.Custom,id:":rg2:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_custom")]})})]}),s===lu.Custom&&l.jsxs("div",{className:"mt-2",children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_custom_header_name")}),l.jsx("input",{className:Qf("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring"),placeholder:"X-Api-Key",...t("custom_auth_header",{required:s===lu.Custom})})]})]})};function gE(e){switch(e){case iu.ServiceHttp:return"com_ui_api_key";case iu.OAuth:return"com_ui_oauth";default:return"com_ui_none"}}const xE=()=>{const e=qN(),{register:t,watch:n,setValue:a}=Pi(),s=n("token_exchange_method"),r=n("type"),o=Qf("mb-2 h-9 w-full resize-none overflow-y-auto rounded-lg border px-3 py-2 text-sm","border-border-medium bg-surface-primary outline-none","focus:ring-2 focus:ring-ring");return l.jsxs(l.Fragment,{children:[l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_id")}),l.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:o,...t("oauth_client_id",{required:!1})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_client_secret")}),l.jsx("input",{placeholder:"<HIDDEN>",type:"password",autoComplete:"new-password",className:o,...t("oauth_client_secret",{required:!1})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_auth_url")}),l.jsx("input",{className:o,...t("authorization_url",{required:r===iu.OAuth})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_url")}),l.jsx("input",{className:o,...t("client_url",{required:r===iu.OAuth})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_scope")}),l.jsx("input",{className:o,...t("scope",{required:r===iu.OAuth})}),l.jsx("label",{className:"mb-1 block text-sm font-medium",children:e("com_ui_token_exchange_method")}),l.jsxs(Va,{defaultValue:lu.Basic,onValueChange:e=>a("token_exchange_method",e),value:s,role:"radiogroup","aria-required":"true",dir:"ltr",style:{outline:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rj1:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:cu.DefaultPost,id:":rj1:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_default_post_request")]})}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("label",{htmlFor:":rj3:",className:"flex cursor-pointer items-center gap-1",children:[l.jsx($a,{type:"button",role:"radio",value:cu.BasicAuthHeader,id:":rj3:",className:Qf("mr-1 flex h-5 w-5 items-center justify-center rounded-full border","border-border-heavy bg-surface-primary"),children:l.jsx(Ba,{className:"h-2 w-2 rounded-full bg-text-primary"})}),e("com_ui_basic_auth_header")]})})]})]})};function fE({action_id:e}){const t=qN(),{watch:n}=Pi(),{showToast:a}=Ds(),[s,r]=ja(!1),o=`${window.location.protocol}//${window.location.host}/api/actions/${e}/oauth/callback`,i=gS({text:o});if(!e)return null;return n("type")!==iu.OAuth?null:l.jsxs("div",{className:"mb-1.5 flex flex-col space-y-2",children:[l.jsx("label",{className:"font-semibold",children:t("com_ui_callback_url")}),l.jsx("div",{className:"relative flex items-center",children:l.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-10 w-full rounded-lg border",children:[l.jsx("div",{className:"flex-1 overflow-hidden",children:l.jsx("div",{className:"relative w-full",children:l.jsx("input",{type:"text",readOnly:!0,value:o,className:"w-full border-0 bg-transparent px-3 py-2 pr-12 text-sm text-text-secondary-alt focus:outline-none",style:{direction:"rtl"}})})}),l.jsx("div",{className:"absolute right-0 flex h-full items-center pr-1",children:l.jsx(Ys,{size:"sm",variant:"ghost",type:"button",onClick:()=>{s||(a({message:t("com_ui_copied_to_clipboard")}),i(r))},className:Qf("h-8 rounded-md px-2",s?"cursor-default":""),"aria-label":t("com_ui_copy_link"),children:s?l.jsx(de,{className:"size-4","aria-hidden":"true"}):l.jsx(ue,{className:"size-4","aria-hidden":"true"})})})]})})]})}function vE({columns:e,data:t}){const n=_s({columns:e,data:t,getCoreRowModel:bs()});return l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{children:n.getHeaderGroups().map(((e,t)=>l.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map(((e,t)=>l.jsx("th",{className:"py-1 font-normal text-text-secondary-alt",children:e.isPlaceholder?null:ys(e.column.columnDef.header,e.getContext())},t)))},t)))}),l.jsx("tbody",{children:n.getRowModel().rows.map(((e,t)=>l.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map(((e,t)=>l.jsx("td",{className:"py-2",children:ys(e.column.columnDef.cell,e.getContext())},t)))},t)))})]})}const _E=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],bE=xi(((e,t)=>{t(hg(e))}),800);function yE({action:e,agent_id:t,setAction:n}){const a=e=>{e.status||(h(null),x(null)),d(e)},s=qN(),{showToast:r}=Ds(),{handleSubmit:o,reset:i}=Pi(),[c,d]=ja(null),[u,m]=ja(""),[p,h]=ja(null),[g,x]=ja(null);ya((()=>{const t=(null==e?void 0:e.metadata.raw_spec)??"";t&&(m(t),bE(t,a))}),[null==e?void 0:e.metadata.raw_spec]),ya((()=>{if(!c||!c.status||!c.spec)return;const{functionSignatures:e,requestBuilders:t}=pg(c.spec),n=Object.entries(t).map((([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain})));h(n),d(null),x(e.map((e=>e.toObjectTool())))}),[c]);const f=V_({onSuccess(e){r({message:s("com_assistants_update_actions_success"),status:"success"}),i(),n(e[1])},onError(e){r({message:e.message||s("com_assistants_update_actions_error"),status:"error"})}}),v=o((n=>{cx.log("actions","saving action",n);const a=t??"";if(!a)return;if(!g)return;if(!p)return;let{metadata:s={}}=e??{};const r=null==e?void 0:e.action_id;s.raw_spec=u;const o=new URL(p[0].domain).hostname;if(!o)return;s.domain=o;const{type:i,saved_auth_fields:l}=n,c=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};l&&i===iu.ServiceHttp?s={...s,api_key:n.api_key,auth:{type:i,authorization_type:n.authorization_type,custom_auth_header:n.custom_auth_header}}:l&&i===iu.OAuth?s={...s,auth:{type:i,authorization_url:n.authorization_url,client_url:n.client_url,scope:n.scope,token_exchange_method:n.token_exchange_method},oauth_client_id:n.oauth_client_id,oauth_client_secret:n.oauth_client_secret}:l?(c(s),s.auth={type:i}):c(s),f.mutate({action_id:r,metadata:s,functions:g,agent_id:a})}));return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"",children:[l.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[l.jsx("label",{htmlFor:"schemaInput",className:"text-token-text-primary whitespace-nowrap font-medium",children:"Schema"}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("select",{onChange:e=>cx.log("actions","selecting example action",e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[l.jsx("option",{value:"label",children:s("com_ui_examples")}),l.jsx("option",{value:"0",children:"Weather (JSON)"}),l.jsx("option",{value:"1",children:"Pet Store (YAML)"}),l.jsx("option",{value:"2",children:"Blank Template"})]})})]}),l.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[l.jsx("div",{className:"relative",children:l.jsx("textarea",{id:"schemaInput",value:u,onChange:e=>{const t=e.target.value;if(m(t),!t)return h(null),x(null),d(null);bE(t,a)},spellCheck:"false",placeholder:s("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),c&&"OpenAPI spec is valid."!==c.message&&l.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:c.message.split("\n").map(((e,t)=>l.jsx("div",{children:e},t)))})]})]}),!!p&&l.jsxs("div",{className:"my-2",children:[l.jsx("div",{className:"flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:s("com_assistants_available_actions")})}),l.jsx(vE,{columns:_E,data:p})]}),l.jsxs("div",{className:"relative my-1",children:[l.jsx(fE,{action_id:null==e?void 0:e.action_id}),l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:s("com_ui_privacy_policy_url")})}),l.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:l.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),l.jsx("div",{className:"flex items-center justify-end",children:l.jsx("button",{disabled:!g||!g.length,onClick:v,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:f.isLoading?l.jsx(Xs,{className:"icon-md"}):null!=(null==e?void 0:e.action_id)&&e.action_id?s("com_ui_update"):s("com_ui_create")})})]})}function jE(){const e=qN(),{showToast:t}=Ds(),{setActivePanel:n,action:a,setAction:s,agent_id:r}=lk(),o=$_({onSuccess:()=>{t({message:e("com_assistants_delete_actions_success"),status:"success"}),n(rx.builder),s(void 0)},onError(n){t({message:n.message??e("com_assistants_delete_actions_error"),status:"error"})}}),i=Oi({defaultValues:{type:iu.None,saved_auth_fields:!1,api_key:"",authorization_type:lu.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:cu.DefaultPost}}),{reset:c}=i;return ya((()=>{(null==a?void 0:a.metadata.auth)&&c({type:a.metadata.auth.type||iu.None,saved_auth_fields:!1,api_key:a.metadata.api_key??"",authorization_type:a.metadata.auth.authorization_type||lu.Basic,oauth_client_id:a.metadata.oauth_client_id??"",oauth_client_secret:a.metadata.oauth_client_secret??"",authorization_url:a.metadata.auth.authorization_url??"",client_url:a.metadata.auth.client_url??"",scope:a.metadata.auth.scope??"",token_exchange_method:a.metadata.auth.token_exchange_method??cu.DefaultPost})}),[a,c]),l.jsx(Mi,{...i,children:l.jsx("form",{className:"h-full grow overflow-hidden",children:l.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[l.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[l.jsx("div",{className:"absolute left-0 top-6",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{n(rx.builder),s(void 0)},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(Ae,{})})})}),!!a&&l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsx("div",{className:"absolute right-0 top-6",children:l.jsx("button",{type:"button",disabled:Zg(r)||!a.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:l.jsx(yr,{className:"text-red-500"})})})}),l.jsx(hr,{showCloseButton:!1,title:e("com_ui_delete_action"),className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:e("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{if(Zg(r))return t({message:e("com_agents_no_agent_id_error"),status:"error"});o.mutate({action_id:a.action_id,agent_id:r||""})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:e("com_ui_delete")}})]}),l.jsx("div",{className:"text-xl font-medium",children:(a?"Edit":"Add")+" actions"}),l.jsx("div",{className:"text-xs text-text-secondary",children:e("com_assistants_actions_info")})]}),l.jsx(pE,{}),l.jsx(yE,{action:a,agent_id:r,setAction:s})]})})})}function wE(){return l.jsxs("div",{className:"h-auto bg-white dark:bg-transparent",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:l.jsx(Ms,{className:"relative h-20 w-20 rounded-full"})}),l.jsx(Ms,{className:"mb-2 h-5 w-1/5 rounded-lg"}),l.jsx(Ms,{className:"mb-1 h-[40px] w-full rounded-lg"}),l.jsx(Ms,{className:"h-3 w-1/4 rounded-lg"})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx(Ms,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(Ms,{className:"h-[40px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(Ms,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(Ms,{className:"h-[100px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(Ms,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(Ms,{className:"h-[40px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(Ms,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(Ms,{className:"mb-2 h-5 w-36 rounded-lg"}),l.jsx(Ms,{className:"mb-4 h-[35px] w-full rounded-lg"}),l.jsx(Ms,{className:"mb-2 h-5 w-24 rounded-lg"}),l.jsx(Ms,{className:"h-[35px] w-full rounded-lg"})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx(Ms,{className:"mb-2 h-5 w-1/4 rounded-lg"}),l.jsx(Ms,{className:"mb-2 h-[35px] w-full rounded-lg"}),l.jsx(Ms,{className:"mb-2 h-[35px] w-full rounded-lg"}),l.jsxs("div",{className:"flex space-x-2",children:[l.jsx(Ms,{className:"h-8 w-1/2 rounded-lg"}),l.jsx(Ms,{className:"h-8 w-1/2 rounded-lg"})]})]}),l.jsx("div",{className:"mb-6",children:l.jsx(Ms,{className:"h-[35px] w-full rounded-lg"})}),l.jsxs("div",{className:"flex items-center justify-end gap-2",children:[l.jsx(Ms,{className:"h-[35px] w-16 rounded-lg"}),l.jsx(Ms,{className:"h-[35px] w-16 rounded-lg"}),l.jsx(Ms,{className:"h-[35px] w-16 rounded-lg"}),l.jsx(Ms,{className:"h-[35px] w-full rounded-lg"})]})]})}function NE(){const e=qN(),t=Pi(),{control:n}=t;return l.jsxs(Cr,{openDelay:50,children:[l.jsx(Li,{name:"recursion_limit",control:n,render:({field:t})=>l.jsx(Sr,{field:t,containerClass:"w-1/2",inputClass:"w-full",label:e("com_ui_agent_recursion_limit"),placeholder:e("com_nav_theme_system"),type:"number",labelClass:"w-fit",labelAdjacent:l.jsx(Tr,{children:l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})})})}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:e("com_ui_agent_recursion_limit_info")})})})})]})}function kE(e){const t=(null==e?void 0:e.toLowerCase())??"";return t&&(/\b(o\d)\b/i.test(t)||/\bgpt-[5-9](?:\.\d+)?\b/i.test(t))?"#000000":t.includes("gpt-4")?"#AB68FF":"#19C37D"}function CE(e,t){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?l.jsx(Ar,{size:.75*t}):/gemini|learnlm|gemma/.test((null==e?void 0:e.toLowerCase())??"")?l.jsx(Pr,{size:.7*t}):l.jsx(Or,{size:.7*t})}function SE(e){return!0===(null==e?void 0:e.toLowerCase().includes("code"))?"Codey":!0===(null==e?void 0:e.toLowerCase().includes("gemini"))||!0===(null==e?void 0:e.toLowerCase().includes("learnlm"))?"Gemini":!0===(null==e?void 0:e.toLowerCase().includes("gemma"))?"Gemma":"PaLM2"}const TE=Sa((e=>{const{error:t,iconURL:n="",endpoint:a,size:s=30,model:r="",assistantName:o,agentName:i}=e,c={icon:n?l.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:l.jsx("div",{title:o,style:{width:s,height:s},className:Qf("overflow-hidden rounded-full",e.className??""),children:l.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:n,alt:o,style:{height:"80",width:"80"}})})}):l.jsx("div",{className:"h-6 w-6",children:l.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(Ws,{className:"h-2/3 w-2/3 text-gray-400"})})}),name:a},u={icon:n?l.jsx("div",{className:"relative flex h-6 w-6 items-center justify-center",children:l.jsx("div",{title:i,style:{width:s,height:s},className:Qf("overflow-hidden rounded-full",e.className??""),children:l.jsx("img",{className:"shadow-stroke h-full w-full object-cover",src:n,alt:i,style:{height:"80",width:"80"}})})}):l.jsx("div",{className:"h-6 w-6",children:l.jsx("div",{className:"shadow-stroke flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(d,{className:"h-2/3 w-2/3 text-gray-400","aria-hidden":"true"})})}),name:a},m={[Yl.assistants]:c,[Yl.agents]:u,[Yl.azureAssistants]:c,[Yl.azureOpenAI]:{icon:l.jsx(Gs,{size:.5555555555555556*s}),bg:"linear-gradient(0.375turn, #61bde2, #4389d0)",name:"ChatGPT"},[Yl.openAI]:{icon:l.jsx(Hs,{size:.5555555555555556*s}),bg:kE(r),name:"ChatGPT"},[Yl.google]:{icon:CE(r,s),name:SE(r)},[Yl.anthropic]:{icon:l.jsx(Bs,{size:.5555555555555556*s}),bg:"#d09a74",name:"Claude"},[Yl.bedrock]:{icon:l.jsx(Ks,{className:"icon-xl text-white"}),bg:"#268672",name:Sm[Yl.bedrock]},[Yl.custom]:{icon:l.jsx(zs,{size:.7*s}),name:"Custom"},null:{icon:l.jsx(Hs,{size:.7*s}),bg:"grey",name:"N/A"},default:{icon:l.jsx("div",{className:"h-6 w-6",children:l.jsx("div",{className:"overflow-hidden rounded-full",children:l.jsx(GS,{iconURL:n,endpoint:a??"",className:"h-full w-full object-contain",context:"message"})})}),name:a}};let{icon:p,bg:h,name:g}=null!=a&&a&&m[a]?m[a]??{}:m.default;return n&&m[n]&&({icon:p,bg:h,name:g}=m[n]),lc(a)?p:l.jsxs("div",{title:g??"",style:{background:null!=h&&h||"transparent",width:s,height:s},className:Qf("relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",e.className??""),children:[p,!0===t&&l.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-3 w-3 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-white",children:"!"})]})})),EE=Sa((({iconURL:e,altName:t,containerStyle:n={width:20,height:20},imageStyle:a={width:"100%",height:"100%"},className:s="icon-md mr-1 shrink-0 overflow-hidden rounded-full",endpoint:r})=>{const[o,i]=ja(!1),c=r&&WS[r]?WS[r]:WS.unknown;return o||!e?l.jsxs("div",{className:"relative",style:{...n,margin:"2px"},children:[l.jsx("div",{className:s,children:l.jsx(c,{endpoint:r,context:"menu-item",size:n.width})}),o&&e&&l.jsx("div",{className:"absolute flex items-center justify-center rounded-full bg-red-500",style:{width:"14px",height:"14px",top:0,right:0},children:l.jsx(Pe,{size:10,className:"text-white","aria-hidden":"true"})})]}):l.jsx("div",{className:s,style:n,children:l.jsx("img",{src:e,alt:t??"Icon",style:a,className:"object-cover",onError:()=>{i(!0)},loading:"lazy",decoding:"async",width:Number(n.width)||20,height:Number(n.height)||20})})}));EE.displayName="URLIcon";const IE={"menu-item":"relative flex h-full items-center justify-center overflow-hidden rounded-full",message:"icon-md",default:"icon-xl relative flex h-full overflow-hidden rounded-full"},RE={"menu-item":{width:"20px",height:"20px"},default:{width:"100%",height:"100%"}},AE={default:{width:"100%",height:"100%"}},PE=Sa((({iconURL:e="",modelLabel:t="",endpointIconURL:n,assistantAvatar:a,assistantName:s,agentAvatar:r,agentName:o,context:i})=>{const c=Ca((()=>WS[e]??WS.unknown),[e]);return Ca((()=>!(!e||!e.includes("http")&&!e.startsWith("/images/"))),[e])?l.jsx(EE,{iconURL:e,altName:t,className:IE[i??"default"]??IE.default,containerStyle:RE[i??"default"]??RE.default,imageStyle:AE[i??"default"]??AE.default}):l.jsx("div",{className:"shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white text-black",children:c&&l.jsx(c,{size:41,context:i,className:"h-2/3 w-2/3",agentName:o,iconURL:n,assistantName:s,avatar:a||r})})}));function OE(e){var t,n;const{message:a,conversation:s,assistant:r,agent:o}=e,i=Ca((()=>({...s??{},...{...a,iconURL:(null==a?void 0:a.iconURL)??""}})),[s,a]),c=i.iconURL??"";let d=i.endpoint;d=Cf({endpointsConfig:void 0,iconURL:c,endpoint:d});const u=(r?r.name:"")??"",m=(r?null==(t=r.metadata)?void 0:t.avatar:"")??"",p=(o?o.name:"")??"",h=(o?null==(n=null==o?void 0:o.avatar)?void 0:n.filepath:"")??"",g=Ca((()=>{let e="";return r?e=m:o&&(e=h),e}),[r,o,m,h]);return cx.log("MessageIcon",{endpoint:d,iconURL:c,assistantName:u,assistantAvatar:m,agentName:p,agentAvatar:h}),!0!==(null==a?void 0:a.isCreatedByUser)&&c&&c.includes("http")?l.jsx(PE,{iconURL:c,modelLabel:i.chatGptLabel??i.modelLabel??"",context:"message",assistantAvatar:m,assistantName:u,agentAvatar:h,agentName:p}):!0===(null==a?void 0:a.isCreatedByUser)?l.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:l.jsx(Lr,{})}):l.jsx(TE,{...i,endpoint:d,iconURL:g,model:(null==a?void 0:a.model)??(null==s?void 0:s.model),assistantName:u,agentName:p,size:28.8})}const LE=({field:e,currentAgentId:t})=>{const n=qN(),[a,s]=ja(""),[r,o]=ja(new Set),i=WN(),c=e.value,d=Ca((()=>c||[]),[c]),u=Ca((()=>i?Object.values(i):[]),[i]),m=Ca((()=>u.filter((e=>(null==e?void 0:e.id)!==t)).map((e=>({label:(null==e?void 0:e.name)||"",value:(null==e?void 0:e.id)||"",icon:l.jsx(OE,{message:{endpoint:Yl.agents,isCreatedByUser:!1},agent:e})})))),[u,t]),p=ka((e=>null==i?void 0:i[e]),[i]);ya((()=>{if(a&&d.length<10){const n={from:t,to:a,edgeType:"handoff"};e.onChange([...d,n]),s("")}}),[a,d,e,t]);const h=(t,n)=>{const a=[...d];a[t]={...a[t],...n},e.onChange(a)};return l.jsxs(Cr,{openDelay:50,children:[l.jsxs("div",{className:"flex items-center justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"font-semibold text-text-primary",children:n("com_ui_agent_handoffs")}),l.jsx(Tr,{children:l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"rounded-full border border-purple-600/40 bg-purple-500/10 px-2 py-0.5 text-xs font-medium text-purple-700 hover:bg-purple-700/10 dark:text-purple-400",children:n("com_ui_beta")}),l.jsxs("div",{className:"text-xs text-text-secondary",children:[d.length," / ",10]})]})]}),l.jsxs("div",{className:"space-y-1",children:[d.map(((t,a)=>{var s;const c=(u=t.to,Array.isArray(u)?u[0]:u);var u;const g=r.has(a);return l.jsxs(_a.Fragment,{children:[l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex h-10 items-center gap-2 rounded-md border border-border-medium bg-surface-tertiary pr-2",children:[l.jsx(Mr,{isCollapsed:!1,ariaLabel:n("com_ui_agent_var",{0:n("com_ui_select")}),selectedValue:c,setValue:t=>((t,n)=>{const a=[...d];a[t]={...a[t],to:n},e.onChange(a)})(a,t),selectPlaceholder:n("com_ui_agent_var",{0:n("com_ui_select")}),searchPlaceholder:n("com_ui_agent_var",{0:n("com_ui_search")}),items:m,displayValue:(null==(s=p(c))?void 0:s.name)??"",SelectIcon:l.jsx(OE,{message:{endpoint:Yl.agents,isCreatedByUser:!1},agent:c&&i?i[c]:void 0}),className:"flex-1 border-border-heavy",containerClassName:"px-0"}),l.jsx("button",{type:"button",className:"rounded p-1 transition hover:bg-surface-hover",onClick:()=>{return e=a,void o((t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n}));var e},children:l.jsx(he,{size:16,className:"text-text-secondary transition-transform "+(g?"rotate-180":"")})}),l.jsx("button",{type:"button",className:"rounded-xl p-1 transition hover:bg-surface-hover",onClick:()=>{return t=a,e.onChange(d.filter(((e,n)=>n!==t))),void o((e=>{const n=new Set(e);return n.delete(t),n}));var t},children:l.jsx(re,{size:18,className:"text-text-secondary"})})]}),g&&l.jsxs("div",{className:"space-y-3 rounded-md border border-border-light bg-surface-primary p-3",children:[l.jsxs("div",{children:[l.jsx(er,{htmlFor:`handoff-desc-${a}`,className:"text-xs text-text-secondary",children:n("com_ui_agent_handoff_description")}),l.jsx(kr,{id:`handoff-desc-${a}`,placeholder:n("com_ui_agent_handoff_description_placeholder"),value:t.description||"",onChange:e=>h(a,{description:e.target.value}),className:"mt-1 h-8 text-sm"})]}),l.jsxs("div",{children:[l.jsx(er,{htmlFor:`handoff-prompt-${a}`,className:"text-xs text-text-secondary",children:n("com_ui_agent_handoff_prompt")}),l.jsx(Dr,{id:`handoff-prompt-${a}`,placeholder:n("com_ui_agent_handoff_prompt_placeholder"),value:"string"==typeof t.prompt?t.prompt:"",onChange:e=>h(a,{prompt:e.target.value}),className:"mt-1 h-20 resize-none text-sm"})]}),t.prompt&&l.jsxs("div",{children:[l.jsx(er,{htmlFor:`handoff-promptkey-${a}`,className:"text-xs text-text-secondary",children:n("com_ui_agent_handoff_prompt_key")}),l.jsx(kr,{id:`handoff-promptkey-${a}`,placeholder:n("com_ui_agent_handoff_prompt_key_placeholder"),value:t.promptKey||"",onChange:e=>h(a,{promptKey:e.target.value}),className:"mt-1 h-8 text-sm"})]})]})]}),a<d.length-1&&l.jsx(Oe,{className:"mx-auto text-text-secondary",size:14})]},a)})),d.length<10&&l.jsxs(l.Fragment,{children:[d.length>0&&l.jsx(Oe,{className:"mx-auto text-text-secondary",size:14}),l.jsx(Mr,{isCollapsed:!1,ariaLabel:n("com_ui_agent_var",{0:n("com_ui_add")}),selectedValue:"",setValue:s,selectPlaceholder:n("com_ui_agent_handoff_add"),searchPlaceholder:n("com_ui_agent_var",{0:n("com_ui_search")}),items:m,className:"h-10 w-full border-dashed border-border-heavy text-center text-text-secondary hover:text-text-primary",containerClassName:"px-0",SelectIcon:l.jsx(Le,{size:16,className:"text-text-secondary"})})]}),d.length>=10&&l.jsx("p",{className:"pt-1 text-center text-xs italic text-text-tertiary",children:n("com_ui_agent_handoff_max",{0:10})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_ui_agent_handoff_info")}),l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_ui_agent_handoff_info_2")})]})})})]})},ME=({field:e,currentAgentId:t})=>{var n;const a=qN(),[s,r]=ja(""),o=WN()||{},i=e.value||[],c=Ca((()=>Object.values(o)),[o]),d=Ca((()=>c.filter((e=>(null==e?void 0:e.id)!==t)).map((e=>({label:(null==e?void 0:e.name)||"",value:null==e?void 0:e.id,icon:l.jsx(OE,{message:{endpoint:Yl.agents,isCreatedByUser:!1},agent:e})})))),[c,t]),u=ka((e=>o[e]),[o]);ya((()=>{s&&i.length<10&&(e.onChange([...i,s]),r(""))}),[s,i,e]);return l.jsxs(Cr,{openDelay:50,children:[l.jsxs("div",{className:"flex items-center justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"font-semibold text-text-primary",children:a("com_ui_agent_chain")}),l.jsx(Tr,{children:l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsxs("div",{className:"text-xs text-text-secondary",children:[i.length," / ",10]})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"flex h-10 items-center justify-between rounded-md border border-border-medium bg-surface-primary-contrast px-3 py-2",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(OE,{message:{endpoint:Yl.agents,isCreatedByUser:!1},agent:t?o[t]:void 0})}),l.jsx("div",{className:"font-medium text-text-primary",children:null==(n=u(t))?void 0:n.name})]})}),l.jsx(Me,{className:"mx-auto text-text-secondary",size:14}),i.map(((t,n)=>{var s,r;return l.jsxs(_a.Fragment,{children:[l.jsxs("div",{className:"flex h-10 items-center gap-2 rounded-md border border-border-medium bg-surface-tertiary pr-2",children:[l.jsx(Mr,{isCollapsed:!1,ariaLabel:a("com_ui_agent_var",{0:a("com_ui_select")}),selectedValue:t,setValue:t=>((t,n)=>{const a=[...i];a[t]=n,e.onChange(a)})(n,t),selectPlaceholder:a("com_ui_agent_var",{0:a("com_ui_select")}),searchPlaceholder:a("com_ui_agent_var",{0:a("com_ui_search")}),items:d,displayValue:(null==(s=u(t))?void 0:s.name)??"",SelectIcon:l.jsx(OE,{message:{endpoint:Yl.agents,isCreatedByUser:!1},agent:t?o[t]:void 0}),className:"flex-1 border-border-heavy",containerClassName:"px-0"}),l.jsx("button",{className:"rounded-xl p-1 transition hover:bg-surface-hover",onClick:()=>{return t=n,void e.onChange(i.filter(((e,n)=>n!==t)));var t},"aria-label":a("com_ui_remove_agent_from_chain",{0:(null==(r=u(t))?void 0:r.name)||a("com_ui_agent")}),children:l.jsx(re,{size:18,className:"text-text-secondary","aria-hidden":"true"})})]}),n<i.length-1&&l.jsx(Me,{className:"mx-auto text-text-secondary",size:14})]},t)})),i.length<10&&l.jsxs(l.Fragment,{children:[i.length>0&&l.jsx(Me,{className:"mx-auto text-text-secondary",size:14}),l.jsx(Mr,{isCollapsed:!1,ariaLabel:a("com_ui_agent_var",{0:a("com_ui_add")}),selectedValue:"",setValue:r,selectPlaceholder:a("com_ui_agent_var",{0:a("com_ui_add")}),searchPlaceholder:a("com_ui_agent_var",{0:a("com_ui_search")}),items:d,className:"h-10 w-full border-dashed border-border-heavy text-center text-text-secondary hover:text-text-primary",containerClassName:"px-0",SelectIcon:l.jsx(Le,{size:16,className:"text-text-secondary"})})]}),i.length>=10&&l.jsx("p",{className:"pt-1 text-center text-xs italic text-text-tertiary",children:a("com_ui_agent_chain_max",{0:10})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:a("com_ui_agent_chain_info")})})})})]})};function DE(){const e=qN(),t=Pi(),{control:n,watch:a}=t,s=a("id"),{agentsConfig:r,setActivePanel:o}=lk(),i=Ca((()=>(null==r?void 0:r.capabilities.includes(Au.chain))??!1),[r]);return l.jsxs("div",{className:"scrollbar-gutter-stable h-full min-h-[40vh] overflow-auto pb-12 text-sm",children:[l.jsxs("div",{className:"advanced-panel relative flex flex-col items-center px-16 py-4 text-center",children:[l.jsx("div",{className:"absolute left-0 top-4",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{o(rx.builder)},"aria-label":e("com_ui_back_to_builder"),children:l.jsx("div",{className:"advanced-panel-content flex w-full items-center justify-center gap-2",children:l.jsx(Ae,{"aria-hidden":"true"})})})}),l.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:e("com_ui_advanced_settings")})]}),l.jsxs("div",{className:"flex flex-col gap-4 px-2",children:[l.jsx(NE,{}),l.jsx(Li,{name:"edges",control:n,defaultValue:[],render:({field:e})=>l.jsx(LE,{field:e,currentAgentId:s})}),i&&l.jsx(Li,{name:"agent_ids",control:n,defaultValue:[],render:({field:e})=>l.jsx(ME,{field:e,currentAgentId:s})})]})]})}const FE=({currentPage:e,maxPage:t,onChangePage:n})=>{const a=qN(),s=[...Array(t).keys()].map((e=>e+1)),r=e=>{e<1||e>t||n(e)};return l.jsxs("div",{className:"flex gap-2 text-sm text-black/60 dark:text-white/70",children:[l.jsxs("div",{role:"button",tabIndex:0,"aria-label":"Previous page",onClick:()=>r(e-1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e-1)},className:"flex cursor-default items-center text-sm "+(1===e?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"15 18 9 12 15 6"})}),a("com_ui_prev")]}),s.map((t=>l.jsx("div",{role:"button",tabIndex:0,className:"flex h-5 w-5 items-center justify-center text-sm "+(e===t?"text-blue-600 hover:text-blue-600 dark:text-blue-600 dark:hover:text-blue-600":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},onClick:()=>n(t),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||n(t)},children:t},t))),l.jsxs("div",{role:"button","aria-label":"Next page",tabIndex:0,onClick:()=>r(e+1),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||n(e+1)},className:"flex cursor-default items-center text-sm "+(e===t?"text-black/70 opacity-50 dark:text-white/70":"text-black/70 hover:text-black/50 dark:text-white/70 dark:hover:text-white/50"),style:{userSelect:"none"},children:[a("com_ui_next"),l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"9 18 15 12 9 6"})})]})]})};function UE({content:e,position:t}){return l.jsx(Ir,{children:l.jsx(Rr,{side:t,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:e})})})})}function zE({plugin:e,onSubmit:t,isEntityTool:n}){const{register:a,handleSubmit:s,formState:{errors:r,isDirty:o,isValid:i,isSubmitting:c}}=Oi(),d=qN(),u=(null==e?void 0:e.authConfig)??[];return l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:l.jsxs("form",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",method:"POST",onSubmit:s((a=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:a,isEntityTool:n}))),children:[u.map(((e,t)=>{var n;const s=e.authField.split("||")[0];return l.jsxs("div",{className:"flex w-full flex-col gap-1",children:[l.jsx("label",{htmlFor:s,className:"mb-1 text-left text-sm font-medium text-gray-700/70 dark:text-gray-50/70",children:e.label}),l.jsxs(Cr,{openDelay:300,children:[l.jsx(Tr,{className:"grid w-full items-center gap-2",children:l.jsx("input",{type:"text",autoComplete:"off",id:s,"aria-invalid":!!r[s],"aria-describedby":`${s}-error`,"aria-label":e.label,"aria-required":"true",...a(s,{required:`${e.label} is required.`,minLength:{value:1,message:`${e.label} must be at least 1 character long`}}),className:"flex h-10 max-h-10 w-full resize-none rounded-md border border-gray-200 bg-transparent px-3 py-2 text-sm text-gray-700 shadow-[0_0_10px_rgba(0,0,0,0.05)] outline-none placeholder:text-gray-400 focus:border-gray-400 focus:bg-gray-50 focus:outline-none focus:ring-0 focus:ring-gray-400 focus:ring-opacity-0 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] dark:focus:border-gray-400 focus:dark:bg-gray-600 dark:focus:outline-none dark:focus:ring-0 dark:focus:ring-gray-400 dark:focus:ring-offset-0"})}),l.jsx(UE,{content:e.description,position:"right"})]}),r[s]&&l.jsx("span",{role:"alert",className:"mt-1 text-sm text-red-400",children:(null==(n=null==r?void 0:r[s])?void 0:n.message)??""})]},`${s}-${t}`)})),l.jsx("button",{disabled:!o||!i||c,type:"button",className:"btn btn-primary relative",onClick:()=>{s((a=>t({pluginKey:(null==e?void 0:e.pluginKey)??"",action:"install",auth:a,isEntityTool:n})))()},children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d("com_ui_save"),l.jsx(De,{className:"flex h-4 w-4 items-center stroke-2","aria-hidden":"true"})]})})]})})})}function VE({tool:e,onAddTool:t,onRemoveTool:n,isInstalled:a=!1,isConfiguring:s=!1,isInitializing:r=!1}){var o,i,c;const d=qN(),u=(null==(o=e.metadata)?void 0:o.name)||e.tool_id,m=(null==(i=e.metadata)?void 0:i.description)||"",p=null==(c=e.metadata)?void 0:c.icon,h=a?{text:d("com_nav_tool_remove"),icon:l.jsx(Ue,{className:"flex h-4 w-4 items-center stroke-2","aria-hidden":"true"}),className:"btn relative bg-gray-300 hover:bg-gray-400 dark:bg-gray-50 dark:hover:bg-gray-200",disabled:!1}:s?{text:d("com_ui_confirm"),icon:l.jsx(Le,{className:"flex h-4 w-4 items-center stroke-2","aria-hidden":"true"}),className:"btn btn-primary relative",disabled:!1}:r?{text:d("com_ui_initializing"),icon:l.jsx(Fe,{className:"flex h-4 w-4 items-center stroke-2","aria-hidden":"true"}),className:"btn btn-primary relative opacity-75 cursor-not-allowed",disabled:!0}:{text:d("com_ui_add"),icon:l.jsx(Le,{className:"flex h-4 w-4 items-center stroke-2","aria-hidden":"true"}),className:"btn btn-primary relative",disabled:!1};return l.jsxs("div",{className:"flex flex-col gap-4 rounded border border-border-medium bg-transparent p-6",children:[l.jsxs("div",{className:"flex gap-4",children:[l.jsx("div",{className:"h-[70px] w-[70px] shrink-0",children:l.jsxs("div",{className:"relative h-full w-full",children:[p?l.jsx("img",{src:p,alt:d("com_ui_logo",{0:u}),className:"h-full w-full rounded-[5px] bg-white"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-[5px] border border-border-medium bg-transparent",children:l.jsx(Fe,{className:"h-8 w-8 text-text-secondary"})}),l.jsx("div",{className:"absolute inset-0 rounded-[5px] ring-1 ring-inset ring-black/10"})]})}),l.jsxs("div",{className:"flex min-w-0 flex-col items-start justify-between",children:[l.jsx("div",{className:"mb-2 line-clamp-1 max-w-full text-lg leading-5 text-text-primary",children:u}),l.jsx("button",{className:h.className,"aria-label":`${h.text} ${u}`,onClick:()=>{a?n():t()},disabled:h.disabled,children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[h.text,h.icon]})})]})]}),l.jsx("div",{className:"line-clamp-3 h-[60px] text-sm text-text-secondary",children:m})]})}function $E({isOpen:e,agentId:t,setIsOpen:n,mcpServerNames:a}){var s;const r=qN(),o=xs(),{initializeServer:i}=aS(),{getValues:c,setValue:d}=Pi(),{removeTool:u}=sS({showToast:!1}),{mcpServersMap:m,availableMCPServersMap:p}=lk(),{refetch:h}=Bb({enabled:m.size>0}),[g,x]=ja(!1),[f,v]=ja(null),[_,b]=ja(null),{maxPage:y,setMaxPage:j,currentPage:w,setCurrentPage:N,itemsPerPage:k,searchChanged:C,setSearchChanged:S,searchValue:T,setSearchValue:E,gridRef:I,handleSearch:R,handleChangePage:A,error:P,setError:O,errorMessage:L,setErrorMessage:M}=CS(),D=TN(),F=e=>{var t,n;O(!0);const a=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";a&&M(a),setTimeout((()=>{O(!1),M("")}),5e3)},U=async(e,t)=>{try{v(e),t&&Object.keys(t).length>0&&(await D.mutateAsync({pluginKey:`${Bm.mcp_prefix}${e}`,action:"install",auth:t,isEntityTool:!0}),await o.invalidateQueries([Fh.mcpAuthValues,e]),await new Promise((e=>setTimeout(e,500))));const n=m.get(e);if(!(null==n?void 0:n.isConnected)){const t=await i(e);if((null==t?void 0:t.success)&&t.oauthRequired&&t.oauthUrl)return void v(null)}await z(e),v(null)}catch(n){console.error("Error adding MCP server:",n),F(n),v(null)}},z=async e=>{var t;const{data:n}=await h(),a=c("tools")||[],s=[`${Bm.mcp_server}${Bm.mcp_delimiter}${e}`];if(null==(t=null==n?void 0:n.servers)?void 0:t[e]){n.servers[e].tools.forEach((e=>{s.push(e.pluginKey)}))}const r=s.filter((e=>!a.includes(e)));r.length>0&&d("tools",[...a,...r])},V=Ca((()=>new Set(a)),[a]),$=Ca((()=>Array.from(m.values()).filter((e=>!e.consumeOnly)).sort(((e,t)=>e.serverName.localeCompare(t.serverName)))),[m]),B=Ca((()=>T?$.filter((e=>e.serverName.toLowerCase().includes(T.toLowerCase()))):$),[$,T]);return ya((()=>{j(Math.ceil(B.length/k)),C&&(N(1),S(!1))}),[j,k,C,N,S,B.length]),l.jsxs($i,{open:e,onClose:()=>{n(!1),N(1),E(""),b(null),v(null)},className:"relative z-[102]",children:[l.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),l.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:l.jsxs(Bi,{className:"relative max-h-[90vh] w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[l.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[l.jsx("div",{className:"flex items-center",children:l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx(Hi,{className:"text-lg font-medium leading-6 text-text-primary",children:r("com_nav_tool_dialog_mcp_server_tools")}),l.jsx(Gi,{className:"text-sm text-text-secondary",children:r("com_nav_tool_dialog_description")})]})}),l.jsx("div",{children:l.jsx("button",{onClick:()=>{n(!1),N(1),b(null),v(null)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:l.jsx(re,{"aria-hidden":"true"})})})]}),P&&l.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[r("com_nav_plugin_auth_error")," ",L]}),_&&l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[l.jsx("div",{className:"mb-4",children:l.jsx("p",{className:"text-sm text-text-secondary",children:r("com_ui_mcp_configure_server_description",{0:_})})}),l.jsx(sE,{serverName:_,isSubmitting:g,fields:(null==(s=null==p?void 0:p[_])?void 0:s.customUserVars)||{},onSave:e=>(async(e,t)=>{try{x(!0);const n={};Object.entries(t).forEach((([e,t])=>{t&&t.trim()&&(n[e]=t.trim())})),await U(e,Object.keys(n).length>0?n:void 0),b(null)}catch(n){console.error("Error saving custom vars:",n),F(n)}finally{x(!1)}})(_,e),onRevoke:()=>{return e=_,x(!0),void D.mutate({pluginKey:`${Bm.mcp_prefix}${e}`,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{F(e),x(!1)},onSuccess:async()=>{b(null),x(!1)}});var e}})]}),l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[l.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[l.jsxs("div",{className:"flex items-center justify-center space-x-4",onClick:()=>b(null),children:[l.jsx(_e,{className:"h-6 w-6 text-text-tertiary"}),l.jsx("input",{type:"text",value:T,onChange:R,placeholder:r("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),l.jsx("div",{ref:I,className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:B.slice((w-1)*k,w*k).map((e=>{const n=V.has(e.serverName),a=_===e.serverName,s=f===e.serverName,r={agent_id:t,tool_id:e.serverName,metadata:{...e.metadata}};return l.jsx(VE,{tool:r,isInstalled:n,isConfiguring:a,isInitializing:s,onAddTool:()=>(async e=>{if(_===e)return b(null),void(await U(e));const t=null==p?void 0:p[e];(null==t?void 0:t.customUserVars)&&Object.keys(t.customUserVars).length>0?b(e):await U(e)})(e.serverName),onRemoveTool:()=>u(e.serverName)},e.serverName)}))})]}),l.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:y>0?l.jsx(FE,{currentPage:w,maxPage:y,onChangePage:A}):l.jsx("div",{style:{height:"21px"}})})]})]})})]})}function BE({tool:e,onAddTool:t,onRemoveTool:n,isInstalled:a=!1}){var s,r,o;const i=qN(),c=()=>{a?n():t()},d=(null==(s=e.metadata)?void 0:s.name)||e.tool_id||e.name,u=(null==(r=e.metadata)?void 0:r.description)||e.description||"",m=(null==(o=e.metadata)?void 0:o.icon)||e.icon;return l.jsxs("div",{className:"flex flex-col gap-4 rounded border border-border-medium bg-transparent p-6",children:[l.jsxs("div",{className:"flex gap-4",children:[l.jsx("div",{className:"h-[70px] w-[70px] shrink-0",children:l.jsxs("div",{className:"relative h-full w-full",children:[m?l.jsx("img",{src:m,alt:i("com_ui_logo",{0:d}),className:"h-full w-full rounded-[5px] bg-white"}):l.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-[5px] border border-border-medium bg-transparent",children:l.jsx(Fe,{className:"h-8 w-8 text-text-secondary"})}),l.jsx("div",{className:"absolute inset-0 rounded-[5px] ring-1 ring-inset ring-black/10"})]})}),l.jsxs("div",{className:"flex min-w-0 flex-col items-start justify-between",children:[l.jsx("div",{className:"mb-2 line-clamp-1 max-w-full text-lg leading-5 text-text-primary",children:d}),a?l.jsx("button",{className:"btn relative bg-gray-300 hover:bg-gray-400 dark:bg-gray-50 dark:hover:bg-gray-200",onClick:c,"aria-label":`${i("com_nav_tool_remove")} ${d}`,children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[i("com_nav_tool_remove"),l.jsx(Ue,{className:"flex h-4 w-4 items-center stroke-2","aria-hidden":"true"})]})}):l.jsx("button",{className:"btn btn-primary relative","aria-label":`${i("com_ui_add")} ${d}`,onClick:c,children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[i("com_ui_add"),l.jsx(Le,{className:"flex h-4 w-4 items-center stroke-2","aria-hidden":"true"})]})})]})]}),l.jsx("div",{className:"line-clamp-3 h-[60px] text-sm text-text-secondary",children:u})]})}function HE({isOpen:e,endpoint:t,setIsOpen:n}){const a=qN(),s=cc(t),{getValues:r,setValue:o}=Pi(),{regularTools:i}=lk(),{maxPage:c,setMaxPage:d,currentPage:u,setCurrentPage:m,itemsPerPage:p,searchChanged:h,setSearchChanged:g,searchValue:x,setSearchValue:f,gridRef:v,handleSearch:_,handleChangePage:b,error:y,setError:j,errorMessage:w,setErrorMessage:N,showPluginAuthForm:k,setShowPluginAuthForm:C,selectedPlugin:S,setSelectedPlugin:T}=CS(),E=TN(),I=e=>{var t,n;j(!0);const a=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";a&&N(a),setTimeout((()=>{j(!1),N("")}),5e3)},R=e=>{const t=()=>{const t=r("tools")||[];t.push(e.pluginKey),o("tools",Array.from(new Set(t)))};if(!e.auth)return t();E.mutate(e,{onError:e=>{I(e)},onSuccess:t}),C(!1)},A=(i||[]).filter((e=>{var t;return null==(t=e.name)?void 0:t.toLowerCase().includes(x.toLowerCase())}));return ya((()=>{A&&(d(Math.ceil(A.length/p)),h&&(m(1),g(!1)))}),[x,p,A,h,d,m,g]),l.jsxs($i,{open:e,onClose:()=>{n(!1),m(1),f("")},className:"relative z-[102]",children:[l.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),l.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:l.jsxs(Bi,{className:"relative max-h-[90vh] w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[l.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[l.jsx("div",{className:"flex items-center",children:l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx(Hi,{className:"text-lg font-medium leading-6 text-text-primary",children:a(s?"com_nav_tool_dialog_agents":"com_nav_tool_dialog")}),l.jsx(Gi,{className:"text-sm text-text-secondary",children:a("com_nav_tool_dialog_description")})]})}),l.jsx("div",{children:l.jsx("div",{className:"sm:mt-0",children:l.jsx("button",{onClick:()=>{n(!1),m(1)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:l.jsx(re,{"aria-hidden":"true"})})})})]}),y&&l.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[a("com_nav_plugin_auth_error")," ",w]}),k&&l.jsx("div",{className:"p-4 sm:p-6 sm:pt-4",children:l.jsx(zE,{plugin:S,onSubmit:e=>R(e),isEntityTool:!0})}),l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[l.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[l.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[l.jsx(_e,{className:"h-6 w-6 text-text-tertiary"}),l.jsx("input",{type:"text",value:x,onChange:_,placeholder:a("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),l.jsx("div",{ref:v,className:"grid grid-cols-1 grid-rows-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:A&&A.slice((u-1)*p,u*p).map(((e,t)=>{var n;return l.jsx(BE,{tool:{tool_id:e.pluginKey,metadata:e},isInstalled:(null==(n=r("tools"))?void 0:n.includes(e.pluginKey))||!1,onAddTool:()=>(e=>{C(!1);const t=null==i?void 0:i.find((t=>t.pluginKey===e));T(t);const{authConfig:n,authenticated:a=!1}=t??{};n&&n.length>0&&!a?C(!0):R({pluginKey:e,action:"install",auth:{}})})(e.pluginKey),onRemoveTool:()=>{return t=e.pluginKey,void E.mutate({pluginKey:t,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>I(e),onSuccess:()=>{var e;const n=(null==(e=r("tools"))?void 0:e.filter((e=>e!==t)))||[];o("tools",n)}});var t}},t)}))})]}),l.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:c>0?l.jsx(FE,{currentPage:u,maxPage:c,onChangePage:b}):l.jsx("div",{style:{height:"21px"}})})]})]})})]})}const GE=({className:e})=>{const t=qN(),n=Pi(),{categories:a}=XN(),s=Di({name:"id",control:n.control}),{syncCategory:r}=(e=>{const[t,n]=ja(!1);return{syncCategory:a=>{t||""!==e||a.value||(a.onChange("general"),n(!0))}}})(s),o=e=>e.label&&e.label.startsWith("com_")?t(e.label):e.label,i=a.map((e=>({label:o(e),value:e.value}))),c=t("com_ui_search_agent_category"),d=t("com_ui_agent_category_selector_aria");return l.jsx(Li,{name:"category",control:n.control,defaultValue:"general",render:({field:t})=>{r(t);const n=(e=>{var t;const n=i.find((t=>t.value===e));return(null==n?void 0:n.label)||(null==(t=i.find((e=>"general"===e.value)))?void 0:t.label)})(t.value);return l.jsx(Mr,{selectedValue:t.value,displayValue:n,searchPlaceholder:c,setValue:e=>{t.onChange(e)},items:i,className:Qf(e),ariaLabel:d,isCollapsed:!1,showCarat:!0})}})};function KE({action:e,onClick:t}){const[n,a]=ja(!1);return l.jsxs("div",{role:"button",tabIndex:0,onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},className:"group flex w-full rounded-lg border border-border-medium text-sm hover:cursor-pointer focus:outline-none focus:ring-2 focus:ring-text-primary",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),"aria-label":`Action for ${e.metadata.domain}`,children:[l.jsx("div",{className:"h-9 grow overflow-hidden text-ellipsis whitespace-nowrap px-3 py-2",style:{wordBreak:"break-all"},children:e.metadata.domain}),l.jsx("div",{className:Qf("h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-tertiary focus:outline-none focus:ring-2 focus:ring-text-primary group-focus:flex",n?"flex":"hidden"),"aria-label":"Settings",children:l.jsx(Nr,{className:"icon-sm","aria-hidden":"true"})})]})}const WE=Qf(ov,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",av),qE=Object.keys(Jm).map((e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`})));function QE(){const e=Ea(),t=qN(),n=Pi(),{control:a,setValue:s,getValues:r}=n,[o,i]=ja(!1);return l.jsxs("div",{className:"mb-4",children:[l.jsxs("div",{className:"mb-2 flex items-center",children:[l.jsx("label",{className:"text-token-text-primary flex-grow font-medium",htmlFor:"instructions",children:t("com_ui_instructions")}),l.jsx("div",{className:"ml-auto",title:"Add variables to instructions",children:l.jsx(cr,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:o,setIsOpen:i,trigger:l.jsxs(se,{id:"variables-menu-button","aria-label":"Add variable to instructions",className:"flex h-7 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[l.jsx(Le,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),t("com_ui_variables")]}),items:qE.map((e=>({label:t(e.label)||e.label,onClick:()=>((e,n)=>{const a=r("instructions")||"",o=a.length>0?"\n":"",l=t(e);s("instructions",a+o+l+": "+n),i(!1)})(e.label,e.value)}))),menuId:e,className:"z-30"})})]}),l.jsx(Li,{name:"instructions",control:a,render:({field:e,fieldState:{error:n}})=>l.jsxs(l.Fragment,{children:[l.jsx("textarea",{...e,value:e.value??"",className:Qf(WE,"min-h-[100px] resize-y"),id:"instructions",placeholder:t("com_agents_instructions_placeholder"),rows:3,"aria-label":"Agent instructions","aria-required":"true","aria-invalid":n?"true":"false"}),n&&l.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",role:"alert",children:t("com_ui_field_required")})]})})]})}function YE(){return l.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),l.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const XE=({url:e})=>{const[t,n]=ja(!1);return ya((()=>{n(!1)}),[e]),l.jsx("div",{children:l.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[l.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"Agent avatar",width:"80",height:"80",loading:"lazy",onLoad:()=>n(!0),onError:()=>n(!1),style:{opacity:t?1:0,transition:"opacity 0.2s ease-in-out"}},e||"default-key"),!t&&l.jsx(Ms,{className:"absolute inset-0 rounded-full","aria-hidden":"true"})]})})};function JE({trigger:e,handleFileChange:t,onReset:n,canReset:a}){const s=qN(),r=ba(null),[o,i]=ja(!1),c=[{id:"upload-avatar",label:s("com_ui_upload_image"),onClick:()=>{return r.current&&(r.current.value=""),void(null==(e=r.current)||e.click());var e}}];return a&&c.push({separate:!0},{id:"reset-avatar",label:s("com_ui_reset_var",{0:"Avatar"}),onClick:()=>{r.current&&(r.current.value=""),n()}}),l.jsxs(l.Fragment,{children:[l.jsx(cr,{trigger:l.jsx(se,{render:e}),items:c,isOpen:o,setIsOpen:i,menuId:"agent-avatar-menu",placement:"bottom",gutter:8,portal:!0,mountByState:!0}),l.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e=>{t(e),r.current?r.current.value="":e.currentTarget.value=""},ref:r,tabIndex:-1})]})}function ZE({avatar:e}){const t=qN(),{showToast:n}=Ds(),{control:a,setValue:s}=Pi(),r=Di({control:a,name:"avatar_preview"})??"",o=Di({control:a,name:"avatar_action"}),{data:i=xd}=Y_({select:e=>wd(e)}),c=Boolean(null==e?void 0:e.filepath);ya((()=>{o||((null==e?void 0:e.filepath)&&r!==e.filepath&&s("avatar_preview",e.filepath),(null==e?void 0:e.filepath)||""===r||s("avatar_preview",""))}),[null==e?void 0:e.filepath,o,r,s]);const d=ka((e=>{var a;const r=null==(a=e.target.files)?void 0:a[0],o=i.avatarSizeLimit??0;if(!r)return;if(o&&r.size>o){const e=o/1048576,a=Number.isInteger(e)?e:parseFloat(e.toFixed(1));return void n({message:t("com_ui_upload_invalid_var",{0:a}),status:"error"})}const l=new FileReader;l.onloadend=()=>{s("avatar_file",r,{shouldDirty:!0}),s("avatar_preview",l.result??"",{shouldDirty:!0}),s("avatar_action","upload",{shouldDirty:!0})},l.readAsDataURL(r)}),[i.avatarSizeLimit,t,s,n]),u=ka((()=>{const t=Boolean(null==e?void 0:e.filepath);s("avatar_preview","",{shouldDirty:!0}),s("avatar_file",null,{shouldDirty:!0}),s("avatar_action",t?"reset":null,{shouldDirty:!0})}),[null==e?void 0:e.filepath,s]),m=Boolean(r)||c;return l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:l.jsx(JE,{trigger:l.jsx("button",{type:"button",className:"f h-20 w-20 outline-none ring-offset-0 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring","aria-label":t("com_ui_upload_agent_avatar_label"),children:r?l.jsx(XE,{url:r}):l.jsx(YE,{})}),handleFileChange:d,onReset:u,canReset:m})})})}function eI({isOpen:e,onOpenChange:t,onFilesSelected:n,disabled:a=!1,isDownloading:s=!1,downloadProgress:r=null,maxSelectionCount:o}){const[i,c]=ja(null),d=qN(),{openSharePointPicker:u,closeSharePointPicker:m,cleanup:p}=function({containerNode:e,onFilesSelected:t,onClose:n,disabled:a=!1,maxSelectionCount:s=10}){const[r]=b(N_.lang),{user:o}=nk(),{showToast:i}=Ds(),l=qN(),c=ba(null),d=ba(null),u=ba(""),{data:m}=K_(),p=null==m?void 0:m.sharePointBaseUrl,h="openid"===(null==o?void 0:o.provider),{token:g,isLoading:x,error:f}=HC({enabled:h&&!a&&!!p,purpose:"Pick"}),v=ka((()=>`sharepoint-picker-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),[]),_=ka((async e=>{const a=d.current;if(a)try{switch(e.data.type){case"notification":console.log("SharePoint picker notification:",e.data);break;case"command":{a.postMessage({type:"acknowledge",id:e.data.id});const s=e.data.data;switch(console.log("SharePoint picker command:",s),s.command){case"authenticate":console.log("Authentication requested, providing token"),console.log("Command details:",s),console.log("Token available:",!!(null==g?void 0:g.access_token)),(null==g?void 0:g.access_token)?a.postMessage({type:"result",id:e.data.id,data:{result:"token",token:g.access_token}}):(console.error("No token available for authentication"),a.postMessage({type:"result",id:e.data.id,data:{result:"error",error:{code:"noToken",message:"No authentication token available"}}}));break;case"close":console.log("Close command received"),a.postMessage({type:"result",id:e.data.id,data:{result:"success"}}),null==n||n();break;case"pick":{console.log("Files picked from SharePoint:",s);const n=s.items||s.files||[];if(console.log("Extracted items:",n),n&&n.length>0){const e=n.map((e=>{var t,n,a,s,r,o,i,l,c;return{id:e.id||e.shareId||(null==(t=e.driveItem)?void 0:t.id),name:e.name||(null==(n=e.driveItem)?void 0:n.name),size:e.size||(null==(a=e.driveItem)?void 0:a.size),webUrl:e.webUrl||(null==(s=e.driveItem)?void 0:s.webUrl),downloadUrl:e.downloadUrl||(null==(r=e.driveItem)?void 0:r["@microsoft.graph.downloadUrl"]),driveId:e.driveId||(null==(o=e.parentReference)?void 0:o.driveId)||(null==(l=null==(i=e.driveItem)?void 0:i.parentReference)?void 0:l.driveId),itemId:e.id||(null==(c=e.driveItem)?void 0:c.id),sharePointItem:e}}));console.log("Processed SharePoint files:",e),t&&t(e),i({message:`Selected ${e.length} file(s) from SharePoint`,status:"success"})}a.postMessage({type:"result",id:e.data.id,data:{result:"success"}});break}default:console.warn(`Unsupported command: ${s.command}`),a.postMessage({type:"result",id:e.data.id,data:{result:"error",error:{code:"unsupportedCommand",message:s.command}}})}break}default:console.log("Unknown message type:",e.data.type)}}catch(s){console.error("Error processing port message:",s)}else console.error("No port available for communication")}),[g,t,i,n]),y=ka((e=>{var t;if(console.log("=== SharePoint picker init message received ==="),console.log("Event source:",e.source),console.log("Event data:",e.data),console.log("Expected channelId:",u.current),e.source&&e.source===(null==(t=c.current)?void 0:t.contentWindow)){const t=e.data;"initialize"===t.type&&t.channelId===u.current&&(console.log("Establishing MessagePort communication"),d.current=e.ports[0],d.current?(d.current.addEventListener("message",_),d.current.start(),d.current.postMessage({type:"activate"}),console.log("MessagePort established and activated")):console.error("No MessagePort found in initialize event"))}}),[_]),j=ba(null),w=ka((()=>{j.current&&(window.removeEventListener("message",j.current),j.current=null),d.current&&(d.current.close(),d.current=null),e&&(e.innerHTML=""),u.current=""}),[e]),N=ka((()=>{w()}),[w]);return{openSharePointPicker:(null==m?void 0:m.sharePointFilePickerEnabled)&&h&&!f?async()=>{if(g)if(e)try{const t=v();u.current=t,console.log("=== SharePoint File Picker v8 (MessagePort) ==="),console.log("Token available:",{hasToken:!!g.access_token,tokenType:g.token_type,expiresIn:g.expires_in,scopes:g.scope}),console.log("Channel ID:",t);const n={sdk:"8.0",entry:{sharePoint:{}},messaging:{origin:window.location.origin,channelId:t},authentication:{enabled:!1},typesAndSources:{mode:"files",pivots:{oneDrive:!0,recent:!0,shared:!0,sharedLibraries:!0,myOrganization:!0,site:!0}},selection:{mode:"multiple",maximumCount:s},title:l("com_files_sharepoint_picker_title"),commands:{upload:{enabled:!1},createFolder:{enabled:!1}},search:{enabled:!0}},a=document.createElement("iframe");a.style.width="100%",a.style.height="100%",a.style.background="#F5F5F5",a.style.border="none",a.title="SharePoint File Picker",a.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"),c.current=a,e.innerHTML="",e.appendChild(a),j.current=y,window.addEventListener("message",y),a.src="about:blank",a.onload=()=>{const e=a.contentWindow;if(!e)return;const t=new URLSearchParams({filePicker:JSON.stringify(n),locale:r||"en-US"}),s=p+`/_layouts/15/FilePicker.aspx?${t}`,o=e.document.createElement("form");o.setAttribute("action",s),o.setAttribute("method","POST");const i=e.document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name","access_token"),i.setAttribute("value",g.access_token),o.appendChild(i),e.document.body.appendChild(o),o.submit()}}catch(t){console.error("SharePoint file picker error:",t),i({message:"Failed to open SharePoint file picker.",status:"error"})}else console.error("No container ref provided for SharePoint picker");else i({message:"Unable to access SharePoint. Please ensure you are logged in with Microsoft.",status:"error"})}:()=>{},closeSharePointPicker:N,error:f?"Failed to authenticate with SharePoint":null,cleanup:w,isTokenLoading:x}}({containerNode:i,onFilesSelected:n,disabled:a,onClose:()=>h(!1),maxSelectionCount:o}),h=e=>{e||m(),t(e)},g=_a.useCallback((e=>{c(e)}),[]);return ya((()=>(i&&e&&u(),()=>{e||p()})),[i,e]),l.jsx(rr,{open:e,onOpenChange:h,children:l.jsxs(Fr,{children:[l.jsx(Ur,{className:"bg-black/50"}),l.jsxs(ir,{className:"sharepoint-picker-bg fixed left-1/2 top-1/2 z-50 h-[680px] max-h-[90vh] max-w-[90vw] -translate-x-1/2 -translate-y-1/2 rounded-lg border bg-surface-primary p-2 shadow-lg focus:outline-none",showCloseButton:!0,children:[l.jsx(lr,{className:"sr-only",children:d("com_files_sharepoint_picker_title")}),l.jsx("div",{ref:g,className:"sharepoint-picker-bg relative flex p-2",children:s&&l.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center rounded-lg bg-black/30 backdrop-blur-sm",children:l.jsx("div",{className:"mx-4 w-full max-w-sm rounded-lg bg-surface-primary p-6 shadow-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"mx-auto mb-4 h-8 w-8 animate-spin rounded-full border-b-2 border-blue-600"}),l.jsx("h3",{className:"mb-2 text-lg font-semibold text-text-primary",children:d("com_files_downloading")}),r&&l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-sm text-text-secondary",children:d("com_files_download_progress",{0:r.completed,1:r.total})}),r.currentFile&&l.jsx("p",{className:"truncate text-xs text-text-tertiary",children:r.currentFile}),l.jsx("div",{className:"h-2 w-full rounded-full bg-surface-tertiary",children:l.jsx("div",{className:"h-2 rounded-full bg-blue-600 transition-all duration-300",style:{width:`${Math.round(r.completed/r.total*100)}%`}})}),l.jsx("p",{className:"text-xs text-text-tertiary",children:d("com_files_download_percent_complete",{0:Math.round(r.completed/r.total*100)})}),r.failed.length>0&&l.jsx("p",{className:"text-xs text-red-500",children:d("com_files_download_failed",{0:r.failed.length})})]}),!r&&l.jsx("p",{className:"text-sm text-text-secondary",children:d("com_files_preparing_download")})]})})})})]})]})})}const tI=Sa((({size:e,user:t,avatarSrc:n,username:a,className:s})=>{const[r,o]=ja(!1);return l.jsx("div",{title:a,style:{width:e,height:e},className:Qf("relative flex items-center justify-center",s??""),children:((null==t?void 0:t.avatar)||(null==t?void 0:t.username)&&""!==(null==t?void 0:t.username.trim()))&&!r?l.jsx("img",{className:"rounded-full",src:((null==t?void 0:t.avatar)??"")||n,alt:"avatar",onError:()=>{o(!0)}}):l.jsx("div",{style:{backgroundColor:"rgb(121, 137, 255)",width:"20px",height:"20px",boxShadow:"rgba(240, 246, 252, 0.1) 0px 0px 0px 1px"},className:"relative flex h-9 w-9 items-center justify-center rounded-sm p-1 text-white",children:l.jsx(Lr,{})})})}));tI.displayName="UserAvatar";const nI=Sa((e=>{const{user:t}=nk(),{size:n=30,isCreatedByUser:a}=e,s=zr(t),r=qN();if(a){const a=(null==t?void 0:t.name)??(null==t?void 0:t.username)??r("com_nav_user");return l.jsx(tI,{size:n,user:t,avatarSrc:s,username:a,className:e.className})}return l.jsx(TE,{...e})}));nI.displayName="Icon";const aI=e=>{const{size:t=30,iconURL:n="",iconClassName:a,error:s}=e;let r="default";"string"==typeof e.endpoint&&(r=e.endpoint);const o={[Yl.azureOpenAI]:{icon:l.jsx(Gs,{className:a}),name:e.chatGptLabel??"ChatGPT"},[Yl.openAI]:{icon:l.jsx(Vr,{className:a}),name:e.chatGptLabel??"ChatGPT"},[Yl.google]:{icon:l.jsx($s,{}),name:e.modelLabel??"Google"},[Yl.anthropic]:{icon:l.jsx(Bs,{className:"icon-md shrink-0 dark:text-white"}),name:e.modelLabel??"Claude"},[Yl.custom]:{icon:l.jsx(zs,{}),name:"Custom"},[Yl.assistants]:{icon:l.jsx(qs,{className:"icon-sm"}),name:"Assistant"},[Yl.azureAssistants]:{icon:l.jsx(qs,{className:"icon-sm"}),name:"Assistant"},[Yl.agents]:{icon:l.jsx(d,{className:"icon-sm","aria-hidden":"true"}),name:e.modelLabel??Sm[Yl.agents]},[Yl.bedrock]:{icon:l.jsx(Ks,{className:"icon-xl text-text-primary"}),name:e.modelLabel??Sm[Yl.bedrock]},default:{icon:l.jsx(GS,{iconURL:n,endpoint:r,className:"icon-sm",context:"nav"}),name:r}};let{icon:i,name:c}=o[r]??o.default;return n&&null!=o[n]&&({icon:i,name:c}=o[n]),l.jsxs("div",{"data-testid":"convo-icon",title:c,"aria-hidden":"true",style:{width:t,height:t},className:Qf("relative flex items-center justify-center rounded-sm text-text-secondary",e.className??""),children:[i,!0===s&&l.jsx("span",{className:"absolute right-0 top-[20px] -mr-2 flex h-4 w-4 items-center justify-center rounded-full border border-white bg-red-500 text-[10px] text-text-secondary",children:"!"})]})};function sI({conversation:e,endpointsConfig:t,assistantMap:n,agentsMap:a,className:s="",containerClassName:r="",context:o,size:i}){var c,d;const u=(null==e?void 0:e.iconURL)??"";let m=null==e?void 0:e.endpoint;m=Cf({endpointsConfig:t,iconURL:u,endpoint:m});const{entity:p,isAgent:h}=Ca((()=>Tf({endpoint:m,agentsMap:a,assistantMap:n,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id})),[m,null==e?void 0:e.agent_id,null==e?void 0:e.assistant_id,a,n]),g=(null==p?void 0:p.name)??"",x=h?null==(c=null==p?void 0:p.avatar)?void 0:c.filepath:null==(d=null==p?void 0:p.metadata)?void 0:d.avatar,f=Zm(t,m,"iconURL"),v=Sf({endpoint:m,endpointsConfig:t,endpointIconURL:f}),_=WS[v]??null;return l.jsx(l.Fragment,{children:u&&u.includes("http")?l.jsx(PE,{iconURL:u,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",endpointIconURL:f,assistantAvatar:x,assistantName:g,agentAvatar:x,agentName:g,context:o}):l.jsx("div",{className:r,children:m&&null!=_&&l.jsx(_,{size:i,context:o,endpoint:m,className:s,iconURL:f,assistantName:g,agentName:g,avatar:x})})})}function rI({conversation:e,endpointsConfig:t,className:n="mr-0",assistantMap:a,context:s}){var r,o;const i=(null==e?void 0:e.iconURL)??"";let c=null==e?void 0:e.endpoint;c=Cf({endpointsConfig:t,iconURL:i,endpoint:c});const d=Zm(t,c,"type"),u=Zm(t,c,"iconURL"),m=lc(c)?null==(r=null==a?void 0:a[c])?void 0:r[(null==e?void 0:e.assistant_id)??""]:null,p=m&&(null==(o=m.metadata)?void 0:o.avatar)||"",h=m&&(m.name??""),g=p||i;return g&&(g.includes("http")||g.startsWith("/images/"))?l.jsx(PE,{iconURL:g,modelLabel:(null==e?void 0:e.chatGptLabel)??(null==e?void 0:e.modelLabel)??"",context:s,endpointIconURL:u,assistantAvatar:p,assistantName:h??""}):l.jsx(aI,{size:20,iconURL:u,endpoint:c,endpointType:d,model:null==e?void 0:e.model,error:!1,className:n,isCreatedByUser:!1,chatGptLabel:void 0,modelLabel:void 0})}const oI={max:"com_endpoint_openai_max",temp:"com_endpoint_openai_temp",topp:"com_endpoint_openai_topp",freq:"com_endpoint_openai_freq",pres:"com_endpoint_openai_pres",resend:"com_endpoint_openai_resend_files",detail:"com_endpoint_openai_detail"},iI={anthropic:{temp:"com_endpoint_anthropic_temp",topp:"com_endpoint_anthropic_topp",topk:"com_endpoint_anthropic_topk",maxoutputtokens:"com_endpoint_anthropic_maxoutputtokens",resend:oI.resend,promptcache:"com_endpoint_anthropic_prompt_cache"},google:{temp:"com_endpoint_google_temp",topp:"com_endpoint_google_topp",topk:"com_endpoint_google_topk",maxoutputtokens:"com_endpoint_google_maxoutputtokens"},openAI:oI,azureOpenAI:oI};function lI({endpoint:e,type:t,side:n}){var a;const s=qN(),r=null==(a=iI[e])?void 0:a[t];return r?l.jsx(Ir,{children:l.jsx(Rr,{side:n,className:"z-[999] w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:s(r)})})})}):null}function cI({conversation:e,setOption:t,models:n,readonly:a}){const s=qN(),r=Ca((()=>({label:s("com_endpoint_use_active_assistant"),value:""})),[s]),o=HN((e=>mx(e.data))),{model:i,endpoint:c,assistant_id:d,endpointType:u,promptPrefix:m,instructions:p}=e??{},h=Ca((()=>Object.values(o[c??""]??{})),[o,c]),g=Ca((()=>{const e=h.map((({id:e,name:t})=>({label:t,value:e})));return[r,...e].filter(Boolean)}),[h,r]),[x,f]=kC({setOption:t,optionKey:"promptPrefix",initialValue:m}),[v,_]=kC({setOption:t,optionKey:"instructions",initialValue:p}),b=Ca((()=>{var e;return null!=d&&d?null==(e=o[c??""])?void 0:e[d]:null}),[d,o,c]),y=Ca((()=>n.map((e=>({label:e===(null==b?void 0:b.model)?`${e} (${s("com_endpoint_assistant_model")})`:e,value:e})))),[n,b,s]),[j,w]=ja(null!=b?{label:b.name??"",value:b.id}:r);if(ya((()=>{""===j.value&&t("presetOverride")({assistant_id:j.value})}),[j]),!e)return null;const N=t("model"),k=u??c;return l.jsxs("div",{className:"grid grid-cols-6 gap-6",children:[l.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx($r,{value:i??"",title:s("com_ui_model"),setValue:Ax(N),availableValues:y,disabled:a,className:Qf(ov,"flex w-full resize-none",sv),containerClassName:"flex w-full resize-none"})})}),l.jsx("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-3",children:l.jsxs(Cr,{openDelay:300,children:[l.jsx(Tr,{className:"grid w-full items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx($r,{title:s("com_endpoint_assistant"),value:j,setValue:Ax((e=>{var n;if(!e)return void w(r);const a=null==(n=o[c??""])?void 0:n[e];a?(w({label:a.name??"",value:a.id||""}),t("assistant_id")(a.id),a.model&&N(a.model)):w(r)})),availableValues:g,disabled:a,className:Qf(ov,"flex w-full resize-none",sv),containerClassName:"flex w-full resize-none"})})}),l.jsx(lI,{endpoint:k??"",type:"temp",side:ix.Left})]})}),l.jsxs("div",{className:"col-span-6 flex flex-col items-center justify-start gap-6",children:[l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(er,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[s("com_endpoint_prompt_prefix_assistants")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default_blank"),")"]})]}),l.jsx(ze,{id:"promptPrefix",disabled:a,value:f??"",onChange:x,placeholder:s("com_endpoint_prompt_prefix_assistants_placeholder"),className:Qf(ov,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2")})]}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(er,{htmlFor:"instructions",className:"text-left text-sm font-medium",children:[s("com_endpoint_instructions_assistants")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default_blank"),")"]})]}),l.jsx(ze,{id:"instructions",disabled:a,value:_??"",onChange:v,placeholder:s("com_endpoint_instructions_assistants_placeholder"),className:Qf(ov,"flex max-h-[240px] min-h-[80px] w-full resize-none px-3 py-2")})]})]})]})}function dI({side:e,description:t,disabled:n,langCode:a,sideOffset:s=30,className:r}){const o=qN();if(n)return null;const i=a?o(t):t;return l.jsx(Ir,{children:l.jsx(Rr,{side:e,className:`z-[999] w-80 ${r}`,sideOffset:s,children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"whitespace-pre-wrap text-sm text-text-secondary",children:i})})})})}const uI={[xp.Slider]:function({label:e="",settingKey:t,defaultValue:n,range:a,description:s="",columnSpan:r,setOption:o,optionType:i,options:c,enumMappings:d,readonly:u=!1,showDefault:m=!1,includeInput:p=!0,labelCode:h=!1,descriptionCode:g=!1,conversation:x}){const f=qN(),{preset:v}=$N(),_=Ca((()=>(!a&&c&&c.length>0)??!1),[c,a]),[b,y,j]=kC({optionKey:t,initialValue:i!==vp.Custom?null==x?void 0:x[t]:n,setter:()=>({}),setOption:o,delay:_?0:ox});TC({preset:v,settingKey:t,defaultValue:n,conversation:x,inputValue:y,setInputValue:j});const w=Ca((()=>_?(null==x?void 0:x[t])??n:y),[x,n,t,y,_]),N=Ca((()=>_&&c?c.reduce(((e,t,n)=>(e[t]=n,e)),{}):{}),[_,c]),k=Ca((()=>_&&c?c.reduce(((e,t,n)=>(e[n]=t,e)),{}):{}),[_,c]),C=ka((e=>{if(_&&d&&null!=e){const t=String(e);if(t in d){const e=String(d[t]);return e.startsWith("com_")?f(e)??e:e}}return String(null!=e?e:n??"")}),[_,d,n,f]),S=ka((()=>{if(null!=n&&d){const e=String(n);if(e in d){const t=String(d[e]);return t.startsWith("com_")?f(t)??t:t}}return String(n??"")}),[n,d,f]),T=ka((e=>{b(_?k[e]:e)}),[_,b,k]),E=Ca((()=>_&&c?c.length-1:a?a.max:0),[_,c,a]);return a||_?l.jsx("div",{className:Qf("flex flex-col items-center justify-start gap-2",null!=r?`col-span-${r}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex w-full items-center justify-between",children:[l.jsxs(er,{htmlFor:`${t}-dynamic-setting`,className:"break-words text-left text-sm font-medium",children:[h?f(e)??e:e||t," ",m&&l.jsxs("small",{className:"opacity-40",children:["(",f("com_endpoint_default"),": ",S(),")"]})]}),p&&!_?l.jsx(Hr,{id:`${t}-dynamic-setting-input-number`,disabled:u,value:y??n,onChange:e=>b(Number(e)),max:a?a.max:((null==c?void 0:c.length)??0)-1,min:a?a.min:0,step:a?a.step??1:1,controls:!1,"aria-label":f(e),className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 py-1 text-xs group-hover/temp:border-gray-200"))}):l.jsx(kr,{id:`${t}-dynamic-setting-input`,disabled:u,value:C(w),"aria-label":f(e),onChange:()=>({}),className:Qf(ov,Qf(iv,"reset-rc-number-input h-auto w-14 border-0 py-1 pl-1 text-center text-xs group-hover/temp:border-gray-200"))})]}),l.jsx(Gr,{id:`${t}-dynamic-setting-slider`,disabled:u,value:[_?N[w??""]:y??n],onValueChange:e=>T(e[0]),onDoubleClick:()=>b(n),max:E,"aria-label":f(e),min:a?a.min:0,step:a?a.step??1:1,className:"flex h-4 w-full"})]}),s&&l.jsx(dI,{description:g?f(s)??s:s,side:ix.Left})]})}):null},[xp.Dropdown]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:s,setOption:r,optionType:o,options:i,readonly:c=!1,showLabel:d=!0,showDefault:u=!1,labelCode:m=!1,descriptionCode:p=!1,placeholder:h="",placeholderCode:g=!1,conversation:x}){const f=qN(),{preset:v}=$N(),[_,b]=ja(null),y=Ca((()=>o===vp.Custom?_:(null==x?void 0:x[t])??n),[x,n,o,t,_]);return TC({preset:v,settingKey:t,defaultValue:n,conversation:x,inputValue:_,setInputValue:b,preventDelayedUpdate:!0}),i&&0!==i.length?l.jsx("div",{className:Qf("flex flex-col items-center justify-start gap-6",null!=s?`col-span-${s}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[!0===d&&l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(er,{htmlFor:`${t}-dynamic-dropdown`,className:"text-left text-sm font-medium",children:[m?f(e)??e:e||t,u&&l.jsxs("small",{className:"opacity-40",children:["(",f("com_endpoint_default"),": ",n,")"]})]})}),l.jsx($r,{showLabel:!1,emptyTitle:!0,disabled:c,value:y,setValue:e=>{o!==vp.Custom?r(t)(e):b(e)},availableValues:i,containerClassName:"w-full",id:`${t}-dynamic-dropdown`,placeholder:g?f(h)??h:h})]}),a&&l.jsx(dI,{description:p?f(a)??a:a,side:ix.Left})]})}):null},[xp.Switch]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:s,setOption:r,readonly:o=!1,showDefault:i=!1,labelCode:c=!1,descriptionCode:d=!1,conversation:u}){const m=qN(),{preset:p}=$N(),[h,g]=ja(!!n);TC({preset:p,settingKey:t,defaultValue:n,conversation:u,inputValue:h,setInputValue:g,preventDelayedUpdate:!0});const x=(null==u?void 0:u[t])??n;return l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=s?`col-span-${s}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex justify-between",children:l.jsxs(er,{htmlFor:`${t}-dynamic-switch`,className:"break-words text-left text-sm font-medium",children:[c?m(e)??e:e||t," ",i&&l.jsxs("small",{className:"opacity-40",children:["(",m("com_endpoint_default"),":"," ",m(null!=n?"com_ui_on":"com_ui_off"),")"]})]})}),l.jsx(dr,{id:`${t}-dynamic-switch`,checked:x,onCheckedChange:e=>{g(e),r(t)(e)},disabled:o,className:"flex","aria-label":c?m(e)??e:e||t})]}),a&&l.jsx(dI,{description:d?m(a)??a:a,side:ix.Left})]})})},[xp.Textarea]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:s,setOption:r,optionType:o,placeholder:i="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:h}){const g=qN(),{preset:x}=$N(),[f,v,_]=kC({optionKey:t,initialValue:o!==vp.Custom?null==h?void 0:h[t]:n,setter:()=>({}),setOption:r});return TC({preset:x,settingKey:t,defaultValue:void 0===n?"":n,conversation:h,inputValue:v,setInputValue:_}),l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=s?`col-span-${s}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(er,{htmlFor:`${t}-dynamic-textarea`,className:"text-left text-sm font-medium",children:[u?g(e)??e:e||t," ",d&&l.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${g("com_endpoint_default")}: ${n}`:g("com_endpoint_default_blank"),")"]})]})}),l.jsx(Br,{id:`${t}-dynamic-textarea`,disabled:c,value:v??"",onChange:f,"aria-label":g(e),placeholder:p?g(i)??i:i,className:Qf("flex max-h-[138px] min-h-[100px] w-full resize-none rounded-lg bg-surface-secondary px-3 py-2 focus:outline-none")})]}),a&&l.jsx(dI,{description:m?g(a)??a:a,side:ix.Left})]})})},[xp.Input]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:s,setOption:r,optionType:o,placeholder:i="",readonly:c=!1,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,placeholderCode:p=!1,conversation:h}){const g=qN(),{preset:x}=$N(),[f,v,_]=kC({optionKey:t,initialValue:o!==vp.Custom?null==h?void 0:h[t]:n,setter:()=>({}),setOption:r});TC({preset:x,settingKey:t,defaultValue:void 0===n?"":n,conversation:h,inputValue:v,setInputValue:_});const b=p&&g(i)||i;return l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=s?`col-span-${s}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(er,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[u?g(e)||e:e||t," ",d&&l.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${g("com_endpoint_default")}: ${n}`:g("com_endpoint_default_blank"),")"]})]})}),l.jsx(kr,{id:`${t}-dynamic-input`,disabled:c,value:v??n??"",onChange:e=>{f(e,!isNaN(Number(e.target.value)))},placeholder:b,className:Qf("flex h-10 max-h-10 w-full resize-none border-none bg-surface-secondary px-3 py-2")})]}),a&&l.jsx(dI,{description:m&&g(a)||a,side:ix.Left})]})})},[xp.Checkbox]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:s,setOption:r,optionType:o,readonly:i=!1,showDefault:c=!1,labelCode:d=!1,descriptionCode:u=!1,conversation:m}){const p=qN(),{preset:h}=$N(),[g,x,f]=kC({optionKey:t,initialValue:o!==vp.Custom?null==m?void 0:m[t]:n,setter:()=>({}),setOption:r}),v=Ca((()=>(null==m?void 0:m[t])??n),[m,n,t]);return TC({preset:h,settingKey:t,defaultValue:n,conversation:m,inputValue:x,setInputValue:f}),l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=s?`col-span-${s}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsx(Tr,{className:"grid w-full items-center",children:l.jsxs("div",{className:"flex justify-start gap-4",children:[l.jsxs(er,{htmlFor:`${t}-dynamic-checkbox`,className:"text-left text-sm font-medium",children:[d?p(e)??e:e||t," ",c&&l.jsxs("small",{className:"opacity-40",children:["(",p("com_endpoint_default"),":"," ",p(null!=n?"com_ui_yes":"com_ui_no"),")"]})]}),l.jsx(jr,{id:`${t}-dynamic-checkbox`,disabled:i,checked:v,onCheckedChange:e=>{g(e),r(t)(e)},className:"mt-[2px] focus:ring-opacity-20 dark:border-gray-500 dark:bg-gray-700 dark:text-gray-50 dark:focus:ring-gray-600 dark:focus:ring-opacity-50 dark:focus:ring-offset-0","aria-label":p(e)})]})}),a&&l.jsx(dI,{description:u?p(a)??a:a,side:ix.Left})]})})},[xp.Tags]:function({label:e="",settingKey:t,defaultValue:n=[],description:a="",columnSpan:s,setOption:r,placeholder:o="",readonly:i=!1,showDefault:c=!1,labelCode:d=!1,descriptionCode:u=!1,placeholderCode:m=!1,descriptionSide:p=ix.Left,conversation:h,minTags:g,maxTags:x}){const f=qN(),{preset:v}=$N(),{showToast:_}=Ds(),b=ba(null),[y,j]=ja(""),[w,N]=ja(n??[]),k=ka((e=>{N(e),r(t)(e)}),[r,t]),C=ka((()=>{b.current&&b.current.focus()}),[b]),S=null==h?void 0:h[t],T=Ca((()=>S??n??[]),[S,n]),E=ka((e=>{if(!T)return;if(null!=g&&T.length<=g)return void _({message:f("com_ui_min_tags",{0:g+""}),status:"warning"});const t=T.filter(((t,n)=>n!==e));k(t)}),[f,g,T,_,k]),I=ka((()=>{if(!y)return;let e=[...T??[],y];null!=x&&e.length>x&&(_({message:f("com_ui_max_tags",{0:x+""}),status:"warning"}),e=e.slice(-x)),k(e),j("")}),[y,T,k,x,_,f]);return TC({preset:v,settingKey:t,defaultValue:void 0===n?[]:n,inputValue:w,setInputValue:N,preventDelayedUpdate:!0,conversation:h}),l.jsx("div",{className:"flex flex-col items-center justify-start gap-6 "+(null!=s?`col-span-${s}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(er,{htmlFor:`${t}-dynamic-input`,className:"text-left text-sm font-medium",children:[d?f(e)??e:e||t," ",c&&l.jsxs("small",{className:"opacity-40",children:["(",void 0!==n&&n.length?`${f("com_endpoint_default")}: ${n}`:f("com_endpoint_default_blank"),")"]})]})}),l.jsx("div",{children:l.jsxs("div",{className:"mb-2 flex flex-wrap break-all rounded-lg bg-surface-secondary",children:[T&&T.length>0&&l.jsx("div",{className:"flex w-full gap-1 p-1",children:T.map(((e,t)=>l.jsx(Kr,{label:e,onClick:C,onRemove:()=>{E(t),b.current&&b.current.focus()}},`${e}-${t}`)))}),l.jsx(kr,{ref:b,id:`${t}-dynamic-input`,disabled:i,value:y,onKeyDown:e=>{T&&("Backspace"!==e.key||y||E(T.length-1),"Enter"===e.key&&I())},onChange:e=>j(e.target.value),placeholder:m?f(o)??o:o,className:Qf("flex h-10 max-h-10 border-none bg-surface-secondary px-3 py-2")})]})})]}),a&&l.jsx(dI,{description:u?f(a)??a:a,side:p})]})})},[xp.Combobox]:function({label:e="",settingKey:t,defaultValue:n,description:a="",columnSpan:s,setOption:r,options:o,items:i,showLabel:c=!0,showDefault:d=!1,labelCode:u=!1,descriptionCode:m=!1,searchPlaceholderCode:p=!1,selectPlaceholderCode:h=!1,conversation:g,isCollapsed:x=!1,SelectIcon:f=null,selectPlaceholder:v="",searchPlaceholder:_=""}){const b=qN(),{preset:y}=$N(),[j,w]=ja(null),N=Ca((()=>(null==g?void 0:g[t])??n),[g,n,t]),k=Ca((()=>null!=i?i:(o??[]).map((e=>({label:e,value:e})))),[o,i]),C=ka((e=>{w(e),r(t)(e)}),[r,t]);return TC({preset:y,settingKey:t,defaultValue:n,conversation:g,inputValue:j,setInputValue:w,preventDelayedUpdate:!0}),0===(k??o??[]).length?null:l.jsx("div",{className:Qf("flex flex-col items-center justify-start gap-6",null!=s?`col-span-${s}`:"col-span-full"),children:l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[!0===c&&l.jsx("div",{className:"flex w-full justify-between",children:l.jsxs(er,{htmlFor:`${t}-dynamic-combobox`,className:"text-left text-sm font-medium",children:[u?b(e)??e:e||t,d&&l.jsxs("small",{className:"opacity-40",children:["(",b("com_endpoint_default"),": ",n,")"]})]})}),l.jsx(Mr,{displayValue:N,selectPlaceholder:!0===h?b(v):v,searchPlaceholder:!0===p?b(_):_,isCollapsed:x,ariaLabel:t,selectedValue:N??"",setValue:C,items:k,SelectIcon:f})]}),a&&l.jsx(dI,{description:m?b(a)??a:a,side:ix.Left})]})})}};function mI({conversation:e,setOption:t,models:n,readonly:a}){const s=Ca((()=>{const[t,n]=ic((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return Qg[t]??Qg[n]}),[e]);if(!s)return null;const r=s=>{if(!s)return null;const r=uI[s.component];if(!r)return null;const{key:o,default:i,...c}=s,d={key:o,settingKey:o,defaultValue:i,...c,readonly:a,setOption:t,conversation:e};return"model"===o?l.jsx(r,{...d,options:n}):l.jsx(r,{...d})};return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:l.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[l.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:s.col1.map(r)}),l.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:s.col2.map(r)})]})})}function pI({conversation:e,setOption:t,models:n,readonly:a}){const s=qN(),r=Cc[Yl.google],{model:o,modelLabel:i,promptPrefix:c,temperature:d,topP:u,topK:m,maxContextTokens:p,maxOutputTokens:h}=e??{},[g,x]=kC({setOption:t,optionKey:"maxContextTokens",initialValue:p});if(!e)return null;const f=t("model"),v=t("modelLabel"),_=t("promptPrefix"),b=t("temperature"),y=t("topP"),j=t("topK"),w=t("maxOutputTokens");return l.jsxs("div",{className:"grid grid-cols-5 gap-6",children:[l.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 sm:col-span-3",children:[l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx($r,{title:s("com_ui_model"),value:o??"",setValue:f,availableValues:n,disabled:a,className:Qf(ov,"flex w-full resize-none",sv),containerClassName:"flex w-full resize-none"})}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(er,{htmlFor:"modelLabel",className:"text-left text-sm font-medium",children:[s("com_endpoint_custom_name")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default_blank"),")"]})]}),l.jsx(kr,{id:"modelLabel",disabled:a,value:i||"",onChange:e=>v(e.target.value??null),placeholder:s("com_endpoint_google_custom_name_placeholder"),className:Qf(ov,"flex h-10 max-h-10 w-full resize-none px-3 py-2",av)})]}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(er,{htmlFor:"promptPrefix",className:"text-left text-sm font-medium",children:[s("com_endpoint_prompt_prefix")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default_blank"),")"]})]}),l.jsx(ze,{id:"promptPrefix",disabled:a,value:c||"",onChange:e=>_(e.target.value??null),placeholder:s("com_endpoint_prompt_prefix_placeholder"),className:Qf(ov,"flex max-h-[138px] min-h-[100px] w-full resize-none px-3 py-2")})]})]}),l.jsxs("div",{className:"col-span-5 flex flex-col items-center justify-start gap-6 px-3 sm:col-span-2",children:[l.jsxs(Cr,{openDelay:300,children:[l.jsx(Tr,{className:"grid w-full items-center gap-2",children:l.jsxs("div",{className:"mt-1 flex w-full justify-between",children:[l.jsxs(er,{htmlFor:"max-context-tokens",className:"text-left text-sm font-medium",children:[s("com_endpoint_context_tokens")," "]}),l.jsx(Hr,{id:"max-context-tokens",stringMode:!1,disabled:a,value:x,onChange:g,placeholder:s("com_nav_theme_system"),min:10,max:2e6,step:1e3,controls:!1,className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200","w-1/3"))})]})}),l.jsx(dI,{description:"com_endpoint_context_info",langCode:!0,side:ix.Left})]}),l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(er,{htmlFor:"temp-int",className:"text-left text-sm font-medium",children:[s("com_endpoint_temperature")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default"),": ",r.temperature.default,")"]})]}),l.jsx(Hr,{id:"temp-int",disabled:a,value:d,onChange:e=>b(e??r.temperature.default),max:r.temperature.max,min:r.temperature.min,step:r.temperature.step,controls:!1,className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(Gr,{disabled:a,value:[d??r.temperature.default],onValueChange:e=>b(e[0]),onDoubleClick:()=>b(r.temperature.default),max:r.temperature.max,min:r.temperature.min,step:r.temperature.step,className:"flex h-4 w-full","aria-labelledby":"temp-int"})]}),l.jsx(lI,{endpoint:e.endpoint??"",type:"temp",side:ix.Left})]}),l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(er,{htmlFor:"top-p-int",className:"text-left text-sm font-medium",children:[s("com_endpoint_top_p")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default_with_num",{0:r.topP.default+""}),")"]})]}),l.jsx(Hr,{id:"top-p-int",disabled:a,value:u,onChange:e=>y(e??r.topP.default),max:r.topP.max,min:r.topP.min,step:r.topP.step,controls:!1,className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(Gr,{disabled:a,value:[u??r.topP.default],onValueChange:e=>y(e[0]),onDoubleClick:()=>y(r.topP.default),max:r.topP.max,min:r.topP.min,step:r.topP.step,className:"flex h-4 w-full","aria-labelledby":"top-p-int"})]}),l.jsx(lI,{endpoint:e.endpoint??"",type:"topp",side:ix.Left})]}),l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(er,{htmlFor:"top-k-int",className:"text-left text-sm font-medium",children:[s("com_endpoint_top_k")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default_with_num",{0:r.topK.default+""}),")"]})]}),l.jsx(Hr,{id:"top-k-int",disabled:a,value:m,onChange:e=>j(e??r.topK.default),max:r.topK.max,min:r.topK.min,step:r.topK.step,controls:!1,className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(Gr,{disabled:a,value:[m??r.topK.default],onValueChange:e=>j(e[0]),onDoubleClick:()=>j(r.topK.default),max:r.topK.max,min:r.topK.min,step:r.topK.step,className:"flex h-4 w-full","aria-labelledby":"top-k-int"})]}),l.jsx(lI,{endpoint:e.endpoint??"",type:"topk",side:ix.Left})]}),l.jsxs(Cr,{openDelay:300,children:[l.jsxs(Tr,{className:"grid w-full items-center gap-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsxs(er,{htmlFor:"max-tokens-int",className:"text-left text-sm font-medium",children:[s("com_endpoint_max_output_tokens")," ",l.jsxs("small",{className:"opacity-40",children:["(",s("com_endpoint_default_with_num",{0:r.maxOutputTokens.default+""}),")"]})]}),l.jsx(Hr,{id:"max-tokens-int",disabled:a,value:h,onChange:e=>w(Number(e)),max:r.maxOutputTokens.max,min:r.maxOutputTokens.min,step:r.maxOutputTokens.step,controls:!1,className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]}),l.jsx(Gr,{disabled:a,value:[h??r.maxOutputTokens.default],onValueChange:e=>w(e[0]),onDoubleClick:()=>w(r.maxOutputTokens.default),max:r.maxOutputTokens.max,min:r.maxOutputTokens.min,step:r.maxOutputTokens.step,className:"flex h-4 w-full","aria-labelledby":"max-tokens-int"})]}),l.jsx(lI,{endpoint:e.endpoint??"",type:"maxoutputtokens",side:ix.Left})]})]})]})}function hI({readonly:e,examples:t,setExample:n,addExample:a,removeExample:s}){const r=qN();return l.jsxs(l.Fragment,{children:[l.jsx("div",{id:"examples-grid",className:"grid gap-6 sm:grid-cols-2",children:t.map(((a,s)=>l.jsxs(_a.Fragment,{children:[l.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(er,{htmlFor:`input-${s}`,className:"text-left text-sm font-medium",children:[r("com_ui_input")," ",l.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),l.jsx(ze,{id:`input-${s}`,disabled:e,value:a.input.content||"",onChange:e=>n(s,"input",e.target.value??null),placeholder:"Set example input. Example is ignored if empty.",className:Qf(ov,"flex max-h-[138px] min-h-[75px] w-full resize-none px-3 py-2")})]})}),l.jsx("div",{className:`col-span-${1===t.length?"1":"full"} flex flex-col items-center justify-start gap-6 sm:col-span-1`,children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsxs(er,{htmlFor:`output-${s}`,className:"text-left text-sm font-medium",children:[r("com_endpoint_output")," ",l.jsxs("small",{className:"opacity-40",children:["(",r("com_endpoint_default_blank"),")"]})]}),l.jsx(ze,{id:`output-${s}`,disabled:e,value:a.output.content||"",onChange:e=>n(s,"output",e.target.value??null),placeholder:"Set example output. Example is ignored if empty.",className:Qf(ov,"flex max-h-[300px] min-h-[75px] w-full resize-none px-3 py-2")})]})})]},s)))}),l.jsxs("div",{className:"flex justify-center",children:[l.jsx(Ys,{type:"button",className:"mr-2 mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:s,children:l.jsx(Ve,{className:"w-[16px]","aria-hidden":"true"})}),l.jsx(Ys,{type:"button",className:"mt-1 h-auto items-center justify-center bg-transparent px-3 py-2 text-xs font-medium font-normal text-black hover:bg-gray-100 hover:text-black focus:ring-0 focus:ring-offset-0 dark:bg-transparent dark:text-white dark:hover:bg-gray-700 dark:hover:text-white dark:focus:outline-none dark:focus:ring-offset-0",onClick:a,children:l.jsx(Re,{className:"w-[16px]","aria-hidden":"true"})})]})]})}function gI({conversation:e,models:t,isPreset:n=!1}){var a,s;const{optionSettings:r}=$N(),{setOption:o,setExample:i,addExample:c,removeExample:d}=SC(n?e:null);if(!e)return null;const{examples:u,model:m}=e,p=null==(a=null==m?void 0:m.toLowerCase())?void 0:a.includes("gemini"),h=!p&&(null==(s=null==m?void 0:m.toLowerCase())?void 0:s.includes("chat")),g=!p&&!h&&/code|text/.test(m??""),{showExamples:x}=r;return x&&h&&!g?l.jsx(hI,{examples:u??[{input:{content:""},output:{content:""}}],setExample:i,addExample:c,removeExample:d}):l.jsx(pI,{conversation:e,setOption:o,models:t})}const xI={[Yl.assistants]:cI,[Yl.azureAssistants]:cI,[Yl.agents]:mI,[Yl.openAI]:mI,[Yl.custom]:mI,[Yl.azureOpenAI]:mI,[Yl.anthropic]:function({conversation:e,setOption:t,models:n,readonly:a}){const s=Ca((()=>{const[t,n]=ic((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return Qg[t]??Qg[n]}),[e]);if(!s)return null;const r=s=>{if(!s)return null;const r=uI[s.component];if(!r)return null;const{key:o,default:i,...c}=s,d={key:o,settingKey:o,defaultValue:i,...c,readonly:a,setOption:t,conversation:e};return"model"===o?l.jsx(r,{...d,options:n}):l.jsx(r,{...d})};return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:l.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[l.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:s.col1.map(r)}),l.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:s.col2.map(r)})]})})},[Yl.bedrock]:function({conversation:e,setOption:t,models:n,readonly:a}){const s=Ca((()=>{const[t,n]=ic((null==e?void 0:e.endpointType)??(null==e?void 0:e.endpoint)??"",(null==e?void 0:e.model)??"");return Qg[t]??Qg[n]}),[e]);if(!s)return null;const r=s=>{if(!s)return null;const r=uI[s.component];if(!r)return null;const{key:o,default:i,...c}=s,d={key:o,settingKey:o,defaultValue:i,...c,readonly:a,setOption:t,conversation:e};return"model"===o?l.jsx(r,{...d,options:n}):l.jsx(r,{...d})};return l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:l.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-5",children:[l.jsx("div",{className:"flex flex-col gap-6 md:col-span-3",children:s.col1.map(r)}),l.jsx("div",{className:"flex flex-col gap-6 md:col-span-2",children:s.col2.map(r)})]})})}};function fI({conversation:e,setOption:t,isPreset:n=!1,className:a=""}){var s;const r=jN(),{data:o}=G_(),i=j(N_.currentSettingsView),c=Zm(o,(null==e?void 0:e.endpoint)??"","type")??(null==e?void 0:e.endpoint)??"";if(!c||i!==_u.default)return null;const{settings:d,multiViewSettings:u}={settings:xI,multiViewSettings:{[Yl.google]:gI}},{endpoint:m}=e,p=(null==(s=r.data)?void 0:s[m??""])??[],h=d[c];if(h)return l.jsx("div",{className:Qf("h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",a),children:l.jsx(h,{conversation:e,setOption:t,models:p,isPreset:n})});const g=u[c];return null==g?null:l.jsx("div",{className:Qf("hide-scrollbar h-[500px] overflow-y-auto md:mb-2 md:h-[350px]",a),children:l.jsx(g,{conversation:e,models:p,isPreset:n})})}const vI=({open:e,onOpenChange:t,preset:n})=>{const[a,s]=ja(n.title??"My Preset"),r=wN(),{showToast:o}=Ds(),i=qN(),c=()=>{const e=Jf({preset:{...n,title:a}}),s=e.title?`\`${e.title}\``:i("com_endpoint_preset_title");r.mutate(e,{onSuccess:()=>{o({message:`${s} ${i("com_ui_saved")}`}),t(!1)},onError:()=>{o({message:i("com_endpoint_preset_save_error"),severity:lx.ERROR})}})};ya((()=>{s(n.title??i("com_endpoint_my_preset"))}),[e]);return l.jsx(rr,{open:e,onOpenChange:t,children:l.jsx(hr,{title:i("com_endpoint_save_as_preset"),className:"z-[90] w-11/12 sm:w-1/4",overlayClassName:"z-[80]",showCloseButton:!1,main:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(er,{htmlFor:"preset-custom-name",className:"text-left text-sm font-medium",children:i("com_endpoint_preset_name")}),l.jsx(kr,{id:"preset-custom-name",value:a||"",onChange:e=>s(e.target.value||""),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),c())},placeholder:i("com_endpoint_preset_custom_name_placeholder"),"aria-label":i("com_endpoint_preset_name"),className:Qf(ov,"flex h-10 max-h-10 w-full resize-none border-border-medium px-3 py-2",av)})]})}),selection:{selectHandler:c,selectClasses:"bg-green-500 hover:bg-green-600 dark:hover:bg-green-600 text-white",selectText:i("com_ui_save")}})})},_I={[Sd.openai]:Yl.openAI,[Sd.azure]:Yl.azureOpenAI},bI={[Sd.openai]:"bg-white/75 dark:bg-black/65",[Sd.azure]:"azure-bg-color",[Sd.azure_blob]:"azure-bg-color",[Sd.execute_code]:"bg-black text-white opacity-85",[Sd.text]:"bg-blue-500 dark:bg-blue-900 opacity-85 text-white",[Sd.vectordb]:"bg-yellow-700 dark:bg-yellow-900 opacity-85 text-white"};function yI({source:e,isCodeFile:t,className:n="absolute right-0 bottom-0 rounded-full p-[0.15rem] text-gray-600 transition-colors"}){if(!0===t)return l.jsx("div",{className:Qf(n,bI[Sd.execute_code]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx($e,{className:"h-3 w-3","aria-hidden":"true"})})});if(e===Sd.text)return l.jsx("div",{className:Qf(n,bI[e]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx(Be,{className:"h-3 w-3","aria-hidden":"true"})})});if(e===Sd.vectordb)return l.jsx("div",{className:Qf(n,bI[e]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx(He,{className:"h-3 w-3","aria-hidden":"true"})})});const a=_I[e??""];return a?l.jsx("div",{className:Qf(n,bI[e??""]??""),children:l.jsx("span",{className:"flex items-center justify-center",children:l.jsx(aI,{endpoint:a,size:14,isCreatedByUser:!1,iconClassName:"h-3 w-3"})})}):null}const jI=({file:e,fileType:t,className:n=""})=>{var a;return l.jsxs("div",{className:Qf("relative size-10 shrink-0 overflow-hidden rounded-xl",n),children:[l.jsx(Wr,{file:e,fileType:t}),l.jsx(yI,{source:null==e?void 0:e.source,isCodeFile:!!(null==(a=null==e?void 0:e.metadata)?void 0:a.fileIdentifier)}),"number"==typeof(null==e?void 0:e.progress)&&(null==e?void 0:e.progress)<1&&l.jsx(Xs,{bgOpacity:.2,color:"white",className:"absolute inset-0 m-2.5 flex items-center justify-center"})]})};function wI({onRemove:e}){const t=qN();return l.jsx("button",{type:"button",className:"absolute right-1 top-1 -translate-y-1/2 translate-x-1/2 rounded-full bg-surface-secondary p-0.5 transition-colors duration-200 hover:bg-surface-primary",onClick:e,"aria-label":t("com_ui_attach_remove"),children:l.jsx("span",{"aria-hidden":"true",children:l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"icon-sm",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",children:[l.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),l.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})})}const NI=({file:e,overrideType:t,buttonClassName:n,containerClassName:a,onDelete:s,onClick:r})=>{const o=_x(t??e.type);return l.jsxs("div",{className:Qf("group relative inline-block text-sm text-text-primary",a),children:[l.jsx("button",{type:"button",onClick:r,"aria-label":e.filename,className:Qf("relative overflow-hidden rounded-2xl border border-border-light bg-surface-hover-alt",n),children:l.jsx("div",{className:"w-56 p-1.5",children:l.jsxs("div",{className:"flex flex-row items-center gap-2",children:[l.jsx(jI,{file:e,fileType:o,className:"relative"}),l.jsxs("div",{className:"overflow-hidden",children:[l.jsx("div",{className:"truncate font-medium",title:e.filename,children:e.filename}),l.jsx("div",{className:"truncate text-text-secondary",title:o.title,children:o.title})]})]})})}),s&&l.jsx(wI,{onRemove:s})]})};function kI({circumference:e,offset:t,circleCSSProperties:n}){return l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:l.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${e} ${e}`,strokeDashoffset:t,fill:"transparent",r:"55",cx:"60",cy:"60",style:n})]})})}const CI=({imageBase64:e,url:t,progress:n=1,className:a="",source:s,alt:r="Preview image"})=>{const[o,i]=ja(!1),[c,d]=ja(!1),u=ba(null),m=ka((()=>{i(!0)}),[]),p=ka((e=>{i(e),!e&&u.current&&requestAnimationFrame((()=>{var e;null==(e=u.current)||e.focus({preventScroll:!0})}))}),[]);ya((()=>(document.body.style.overflow=o?"hidden":"unset",()=>{document.body.style.overflow="unset"})),[o]);const h={backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},g=e??t??"",x=g?{...h,backgroundImage:`url(${g})`}:h;if("string"!=typeof x.backgroundImage||0===x.backgroundImage.length)return null;const f=2*Math.PI*55,v=f-n*f;return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Qf("relative size-14 rounded-xl",a),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[l.jsx("button",{ref:u,type:"button",className:"size-full overflow-hidden rounded-xl",style:x,"aria-label":`View ${r} in full size`,"aria-haspopup":"dialog",onClick:e=>{e.preventDefault(),e.stopPropagation(),m()}}),n<1?l.jsx(kI,{circumference:f,offset:v,circleCSSProperties:{transition:"stroke-dashoffset 0.3s linear"},"aria-label":`Loading progress: ${Math.round(100*n)}%`}):l.jsx("div",{className:Qf("absolute inset-0 flex transform-gpu cursor-pointer items-center justify-center rounded-xl transition-opacity duration-200 ease-in-out",c?"bg-black/20 opacity-100":"opacity-0"),onClick:e=>{e.stopPropagation(),m()},"aria-hidden":"true",children:l.jsx(Ge,{className:Qf("size-5 transform-gpu text-white drop-shadow-lg transition-all duration-200",c?"scale-110":"")})}),l.jsx(yI,{source:s,"aria-label":s?`Source: ${s}`:void 0})]}),l.jsx(rr,{open:o,onOpenChange:p,children:l.jsx(ir,{showCloseButton:!1,className:"w-11/12 overflow-x-auto bg-transparent p-0 sm:w-auto",disableScroll:!1,children:l.jsx("img",{src:g,alt:r,className:"max-w-screen h-full max-h-screen w-full object-contain"})})})]})},SI=({imageBase64:e,url:t,onDelete:n,progress:a=1,source:s=Sd.local})=>l.jsxs("div",{className:"group relative inline-block text-sm text-black/70 dark:text-white/90",children:[l.jsx("div",{className:"relative overflow-hidden rounded-2xl border border-gray-200 dark:border-gray-600",children:l.jsx(CI,{source:s,imageBase64:e,url:t,progress:a})}),l.jsx(wI,{onRemove:n})]});function TI({files:e,setFiles:t,abortUpload:n,setFilesLoading:a,assistant_id:s,agent_id:r,tool_resource:o,fileFilter:i,isRTL:c=!1,Wrapper:d}){const u=qN(),{showToast:m}=Ds(),p=Array.from((null==e?void 0:e.values())??[]).filter((e=>!i||i(e))),{mutateAsync:h}=W_({onMutate:async()=>cx.log("agents","Deleting files: agent_id, assistant_id, tool_resource",r,s,o),onSuccess:()=>{console.log("Files deleted")},onError:e=>{console.log("Error deleting files:",e)}}),{deleteFile:g}=MC({mutateAsync:h,agent_id:r,assistant_id:s,tool_resource:o});if(ya((()=>{0!==p.length?p.some((e=>e.progress<1))?a(!0):p.every((e=>1===e.progress))&&a(!1):a(!1)}),[p]),0===p.length)return null;const x=()=>{const e=c?{display:"flex",flexDirection:"row-reverse",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"}:{display:"flex",flexWrap:"wrap",gap:"4px",width:"100%",maxWidth:"100%"};return l.jsx("div",{style:e,children:p.reduce(((e,t)=>(e.map.has(t.file_id)||(e.map.set(t.file_id,!0),e.uniqueFiles.push(t)),e)),{map:new Map,uniqueFiles:[]}).uniqueFiles.map(((e,a)=>{var s;const r=()=>{m({message:u("com_ui_deleting_file"),status:"info"}),n&&e.progress<1&&n(),g({file:e,setFiles:t})},o=(null==(s=e.type)?void 0:s.startsWith("image"))??!1;return l.jsx("div",{style:{flexBasis:"70px",flexGrow:0,flexShrink:0},children:o?l.jsx(SI,{url:1===e.progress?e.filepath:e.preview??e.filepath,onDelete:r,progress:e.progress,source:e.source}):l.jsx(NI,{file:e,onDelete:r})},a)}))})};return d?l.jsx(d,{children:x()}):x()}function EI({agent_id:e,files:t}){const n=qN(),{setFilesLoading:a}=$N(),s=ba(null),[r,o]=ja(new Map),[i,c]=ja(!1),[d,u]=ja(!1),{data:m}=K_(),p=null==m?void 0:m.sharePointFilePickerEnabled,{data:h=null}=Y_({select:e=>wd(e)}),{handleFileChange:g}=BC({additionalMetadata:{agent_id:e,tool_resource:kl.context},fileSetter:o}),{handleSharePointFiles:x,isProcessing:f,downloadProgress:v}=GC({additionalMetadata:{agent_id:e,tool_resource:kl.file_search},fileSetter:o});KC((()=>{t&&o(new Map(t))}),[t],750);const _=jd({fileConfig:h,endpoint:Yl.agents,endpointType:Yl.agents});if((null==_?void 0:_.disabled)??!1)return null;const b=()=>{var e;s.current&&(s.current.value=""),null==(e=s.current)||e.click()},y=[{label:n("com_files_upload_local_machine"),onClick:b,icon:l.jsx(Ke,{className:"icon-md"})},{label:n("com_files_upload_sharepoint"),onClick:()=>u(!0),icon:l.jsx(qr,{className:"icon-md"})}],j=l.jsx(se,{className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx(Qr,{className:"text-token-text-primary h-4 w-4"}),n("com_ui_upload_file_context")]})});return l.jsxs("div",{className:"w-full",children:[l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[l.jsx(Tr,{asChild:!0,children:l.jsxs("span",{className:"flex items-center gap-2",children:[l.jsx("label",{className:"text-token-text-primary block font-medium",children:n("com_agents_file_context_label")}),l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})]})}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_file_context_description")})})})})]})}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(TI,{files:r,setFiles:o,setFilesLoading:a,agent_id:e,tool_resource:kl.context,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsxs("div",{children:[p?l.jsx(l.Fragment,{children:l.jsx(cr,{gutter:2,menuId:"file-search-upload-menu",isOpen:i,setIsOpen:c,trigger:j,items:y,modal:!0,unmountOnHide:!0})}):l.jsx("button",{type:"button",disabled:Zg(e),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:b,children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx(Qr,{className:"text-token-text-primary h-4 w-4"}),n("com_ui_upload_file_context")]})}),l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:s,disabled:Zg(e),onChange:g})]}),e?null:l.jsx("div",{className:"text-xs text-text-secondary",children:n("com_agents_file_context_disabled")})]}),l.jsx(eI,{isOpen:d,onOpenChange:u,onFilesSelected:async e=>{try{await x(e),u(!1)}catch(t){console.error("SharePoint file processing error:",t)}},isDownloading:f,downloadProgress:v,maxSelectionCount:null==_?void 0:_.fileLimit})]})}function II({title:e,selectedKey:t,onSelectionChange:n,dropdownOptions:a,showDropdown:s,register:r,dropdownOpen:o,setDropdownOpen:i,dropdownKey:c}){const d=qN(),[u,m]=ja({}),p=a.find((e=>e.key===t)),h=a.map((e=>({label:e.label,onClick:()=>n(e.key)})));return l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[l.jsx(er,{className:"text-md w-fit font-medium",children:e}),s?l.jsx(cr,{menuId:`${c}-dropdown`,items:h,isOpen:o,setIsOpen:i,trigger:l.jsxs(se,{onClick:()=>i(!o),className:"flex items-center rounded-md border border-border-light px-3 py-1 text-sm text-text-secondary",children:[null==p?void 0:p.label,l.jsx(he,{className:"ml-1 h-4 w-4"})]})}):l.jsx("div",{className:"text-sm text-text-secondary",children:null==p?void 0:p.label})]}),(null==p?void 0:p.inputs)&&Object.entries(p.inputs).map((([e,t],n)=>l.jsxs("div",{children:[l.jsxs("div",{className:"relative",children:[l.jsx(kr,{type:"text",placeholder:t.placeholder,autoComplete:"password"===t.type?"one-time-code":"off",readOnly:"password"===t.type,onFocus:"password"===t.type?e=>e.target.readOnly=!1:void 0,className:"mb-2 "+("password"===t.type?"pr-10":""),...r(e)}),"password"===t.type&&l.jsx("button",{type:"button",onClick:()=>{return t=e,void m((e=>({...e,[t]:!e[t]})));var t},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary transition-colors hover:text-text-primary","aria-label":u[e]?d("com_ui_hide_password"):d("com_ui_show_password"),children:l.jsx("div",{className:"relative h-4 w-4",children:u[e]?l.jsx(We,{className:"absolute inset-0 h-4 w-4 duration-200 animate-in fade-in","aria-hidden":"true"}):l.jsx(qe,{className:"absolute inset-0 h-4 w-4 duration-200 animate-in fade-in","aria-hidden":"true"})})})]}),t.link&&l.jsx("div",{className:"mt-1 text-xs text-text-secondary",children:l.jsx("a",{href:t.link.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:t.link.text})})]},e)))]})}function RI({isOpen:e,onSubmit:t,onRevoke:n,onOpenChange:a,authTypes:s,isToolAuthenticated:r,register:o,handleSubmit:i,triggerRef:c,triggerRefs:d}){var u,m,p,h,g,x,f,v,_;const b=qN(),{data:y}=K_(),[j,w]=ja((null==(u=null==y?void 0:y.webSearch)?void 0:u.searchProvider)||rm.SERPER),[N,k]=ja((null==(m=null==y?void 0:y.webSearch)?void 0:m.rerankerType)||im.JINA),[C,S]=ja((null==(p=null==y?void 0:y.webSearch)?void 0:p.scraperProvider)||om.FIRECRAWL),T=[{key:rm.SERPER,label:b("com_ui_web_search_provider_serper"),inputs:{serperApiKey:{placeholder:b("com_ui_enter_api_key"),type:"password",link:{url:"https://serper.dev/api-keys",text:b("com_ui_web_search_provider_serper_key")}}}},{key:rm.SEARXNG,label:b("com_ui_web_search_provider_searxng"),inputs:{searxngInstanceUrl:{placeholder:b("com_ui_web_search_searxng_instance_url"),type:"text"},searxngApiKey:{placeholder:b("com_ui_web_search_searxng_api_key"),type:"password"}}}],E=[{key:im.JINA,label:b("com_ui_web_search_reranker_jina"),inputs:{jinaApiKey:{placeholder:b("com_ui_web_search_jina_key"),type:"password",link:{url:"https://jina.ai/api-dashboard/",text:b("com_ui_web_search_reranker_jina_key")}},jinaApiUrl:{placeholder:b("com_ui_web_search_jina_url"),type:"text",link:{url:"https://api.jina.ai/v1/rerank",text:b("com_ui_web_search_reranker_jina_url_help")}}}},{key:im.COHERE,label:b("com_ui_web_search_reranker_cohere"),inputs:{cohereApiKey:{placeholder:b("com_ui_web_search_cohere_key"),type:"password",link:{url:"https://dashboard.cohere.com/welcome/login",text:b("com_ui_web_search_reranker_cohere_key")}}}}],I=[{key:om.FIRECRAWL,label:b("com_ui_web_search_scraper_firecrawl"),inputs:{firecrawlApiUrl:{placeholder:b("com_ui_web_search_firecrawl_url"),type:"text"},firecrawlApiKey:{placeholder:b("com_ui_enter_api_key"),type:"password",link:{url:"https://docs.firecrawl.dev/introduction#api-key",text:b("com_ui_web_search_scraper_firecrawl_key")}}}},{key:om.SERPER,label:b("com_ui_web_search_scraper_serper"),inputs:{serperApiKey:{placeholder:b("com_ui_enter_api_key"),type:"password",link:{url:"https://serper.dev/api-keys",text:b("com_ui_web_search_scraper_serper_key")}}}}],[R,A]=ja({provider:!1,reranker:!1,scraper:!1}),P=null==(h=s.find((([e])=>e===sm.PROVIDERS)))?void 0:h[1],O=null==(g=s.find((([e])=>e===sm.SCRAPERS)))?void 0:g[1],L=null==(x=s.find((([e])=>e===sm.RERANKERS)))?void 0:x[1];return l.jsx(rr,{open:e,onOpenChange:a,triggerRef:c,triggerRefs:d,children:l.jsx(hr,{className:"w-11/12 sm:w-[500px]",title:"",main:l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"mb-4 text-center font-medium",children:b("com_ui_web_search")}),l.jsxs("form",{onSubmit:i(t),children:[P!==Hl.SYSTEM_DEFINED&&l.jsx(II,{title:b("com_ui_web_search_provider"),selectedKey:j,onSelectionChange:e=>{w(e)},dropdownOptions:T,showDropdown:!(null==(f=null==y?void 0:y.webSearch)?void 0:f.searchProvider),register:o,dropdownOpen:R.provider,setDropdownOpen:e=>A((t=>({...t,provider:e}))),dropdownKey:"provider"}),O!==Hl.SYSTEM_DEFINED&&l.jsx(II,{title:b("com_ui_web_search_scraper"),selectedKey:C,onSelectionChange:e=>{S(e)},dropdownOptions:I,showDropdown:!(null==(v=null==y?void 0:y.webSearch)?void 0:v.scraperProvider),register:o,dropdownOpen:R.scraper,setDropdownOpen:e=>A((t=>({...t,scraper:e}))),dropdownKey:"scraper"}),L!==Hl.SYSTEM_DEFINED&&l.jsx(II,{title:b("com_ui_web_search_reranker"),selectedKey:N,onSelectionChange:e=>{k(e)},dropdownOptions:E,showDropdown:!(null==(_=null==y?void 0:y.webSearch)?void 0:_.rerankerType),register:o,dropdownOpen:R.reranker,setDropdownOpen:e=>A((t=>({...t,reranker:e}))),dropdownKey:"reranker"})]})]}),selection:{selectHandler:i(t),selectClasses:"bg-green-500 hover:bg-green-600 text-white",selectText:b("com_ui_save")},buttons:r&&l.jsx(Ys,{onClick:n,className:"bg-red-500 text-white hover:bg-red-600","aria-label":b("com_ui_revoke"),children:b("com_ui_revoke")}),showCancelButton:!0})})}function AI({authTypes:e=[],isToolAuthenticated:t=!1}){const n=qN(),a=Pi(),{control:s,setValue:r}=a,o=ba(null),{onSubmit:i,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=kS({onSubmit:()=>{r(Au.web_search,!0,{shouldDirty:!0}),setTimeout((()=>{var e;return null==(e=o.current)?void 0:e.focus()}),100)},onRevoke:()=>{r(Au.web_search,!1,{shouldDirty:!0}),setTimeout((()=>{var e;return null==(e=o.current)?void 0:e.focus()}),100)}}),p=Di({control:s,name:Au.web_search}),h=null==e?void 0:e.some((([,e])=>e===Hl.USER_PROVIDED)),g=e=>{t?r(Au.web_search,e,{shouldDirty:!0}):p?r(Au.web_search,!1,{shouldDirty:!0}):d(!0)};return l.jsxs(l.Fragment,{children:[l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Li,{name:Au.web_search,control:s,render:({field:e})=>l.jsx(jr,{...e,id:"web-search-checkbox",checked:p||t&&e.value,onCheckedChange:g,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t,"aria-labelledby":"web-search-label"})}),l.jsx("label",{id:"web-search-label",htmlFor:"web-search-checkbox",className:"form-check-label text-token-text-primary cursor-pointer",children:n("com_ui_web_search")}),l.jsxs("div",{className:"ml-2 flex gap-2",children:[h&&l.jsx("button",{ref:o,type:"button",onClick:()=>d(!0),"aria-label":n("com_ui_add_web_search_api_keys"),"aria-haspopup":"dialog",children:l.jsx(oe,{className:"h-5 w-5 text-text-primary"})}),l.jsx(Tr,{asChild:!0,children:l.jsx("button",{type:"button",className:"inline-flex items-center","aria-label":n("com_agents_search_info"),children:l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_search_info")})})})})]})}),l.jsx(RI,{onSubmit:i,authTypes:e,isOpen:c,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit,triggerRef:o})]})}function PI(){const e=qN(),{data:t}=ob({toolId:Nl.web_search},{retry:1});return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("div",{className:"flex flex-row items-center gap-1",children:l.jsx("div",{className:"flex items-center gap-1",children:l.jsx("span",{className:"text-token-text-primary block font-medium",children:e("com_ui_web_search")})})})}),l.jsx("div",{className:"flex flex-col items-start gap-2",children:l.jsx(AI,{authTypes:null==t?void 0:t.authTypes,isToolAuthenticated:null==t?void 0:t.authenticated})})]})}const OI=Sa((function(){const e=qN(),t=Pi(),{control:n}=t;return l.jsx(l.Fragment,{children:l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"my-2 flex items-center",children:[l.jsx(Li,{name:Au.file_search,control:n,render:({field:e})=>l.jsx(jr,{...e,id:"file-search-checkbox",checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":"file-search-label"})}),l.jsx("label",{id:"file-search-label",htmlFor:"file-search-checkbox",className:"form-check-label text-token-text-primary cursor-pointer",children:e("com_agents_enable_file_search")}),l.jsx(Tr,{asChild:!0,className:"ml-2",children:l.jsx("button",{type:"button",className:"inline-flex items-center","aria-label":e("com_agents_file_search_info"),children:l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})})}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:e("com_agents_file_search_info")})})})})]})})})}));function LI({agent_id:e,files:t}){const n=qN(),{setFilesLoading:a}=$N(),{watch:s}=Pi(),r=ba(null),[o,i]=ja(new Map),[c,d]=ja(!1),[u,m]=ja(!1),{data:p}=K_(),{data:h=null}=Y_({select:e=>wd(e)}),{handleFileChange:g}=BC({additionalMetadata:{agent_id:e,tool_resource:kl.file_search},fileSetter:i}),{handleSharePointFiles:x,isProcessing:f,downloadProgress:v}=GC({additionalMetadata:{agent_id:e,tool_resource:kl.file_search},fileSetter:i});KC((()=>{t&&i(new Map(t))}),[t],750);const _=s(Au.file_search),b=jd({fileConfig:h,endpoint:Yl.agents,endpointType:Yl.agents}),y=(null==b?void 0:b.disabled)??!1,j=null==p?void 0:p.sharePointFilePickerEnabled,w=Zg(e)||!1===_;if(y)return null;const N=[{label:n("com_files_upload_local_machine"),onClick:()=>{var e;r.current&&(r.current.value=""),null==(e=r.current)||e.click()},icon:l.jsx(Ke,{className:"icon-md"})},{label:n("com_files_upload_sharepoint"),onClick:()=>m(!0),icon:l.jsx(qr,{className:"icon-md"})}],k=l.jsx(se,{disabled:w,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx(Qr,{className:"text-token-text-primary h-4 w-4"}),n("com_ui_upload_file_search")]})});return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:n("com_assistants_file_search")})})}),l.jsx(OI,{}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(TI,{files:o,setFiles:i,setFilesLoading:a,agent_id:e,tool_resource:kl.file_search,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsxs("div",{children:[j?l.jsx(cr,{gutter:2,menuId:"file-search-upload-menu",isOpen:c,setIsOpen:d,trigger:k,items:N,modal:!0,unmountOnHide:!0}):l.jsx("button",{type:"button",disabled:w,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;r.current&&(r.current.value=""),null==(e=r.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx(Qr,{className:"text-token-text-primary h-4 w-4"}),n("com_ui_upload_file_search")]})}),l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:r,disabled:w,onChange:g})]}),e?null:l.jsx("div",{className:"text-xs text-text-secondary",children:n("com_agents_file_search_disabled")})]}),l.jsx(eI,{isOpen:u,onOpenChange:m,onFilesSelected:async e=>{try{await x(e),m(!1)}catch(t){console.error("SharePoint file processing error:",t)}},disabled:w,isDownloading:f,downloadProgress:v,maxSelectionCount:null==b?void 0:b.fileLimit})]})}function MI(){const e=qN(),t=Pi(),{setValue:n,watch:a}=t,s=a(Au.artifacts),r=void 0!==s&&""!==s,o=s===op.CUSTOM,i=s===op.SHADCNUI;return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:e("com_ui_artifacts")})})}),l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx(DI,{id:"artifacts",label:e("com_ui_artifacts_toggle_agent"),checked:r,onCheckedChange:e=>{n(Au.artifacts,e?op.DEFAULT:"",{shouldDirty:!0})},hoverCardText:e("com_nav_info_code_artifacts_agent")}),l.jsx(DI,{id:"includeShadcnui",label:e("com_ui_include_shadcnui"),checked:i,onCheckedChange:e=>{n(Au.artifacts,e?op.SHADCNUI:op.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_include_shadcnui"),disabled:!r||o}),l.jsx(DI,{id:"customPromptMode",label:e("com_ui_custom_prompt_mode"),checked:o,onCheckedChange:e=>{n(Au.artifacts,e?op.CUSTOM:op.DEFAULT,{shouldDirty:!0})},hoverCardText:e("com_nav_info_custom_prompt_mode"),disabled:!r})]})]})}function DI({id:e,label:t,checked:n,onCheckedChange:a,hoverCardText:s,disabled:r=!1}){return l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{className:r?"text-text-tertiary":"",children:t}),l.jsx(Tr,{children:l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:s})})})}),l.jsx(dr,{id:e,checked:n,onCheckedChange:a,className:"ml-4","data-testid":e,disabled:r,"aria-label":t})]})})}function FI({tool:e,regularTools:t}){const n=qN(),{showToast:a}=Ds(),s=TN(),{getValues:r,setValue:o}=Pi(),[i,c]=ja(!1),[d,u]=ja(!1);if(!t)return null;const m=t.find((t=>t.pluginKey===e));if(!m)return null;return l.jsxs(rr,{children:[l.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-gray-50 dark:hover:bg-gray-800/50",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),onFocus:()=>c(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||c(!1)},children:[l.jsxs("div",{className:"flex grow items-center",children:[m.icon&&l.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${m.icon})`,backgroundSize:"cover"}})}),l.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:m.name})]}),l.jsx(or,{asChild:!0,children:l.jsx("button",{type:"button",className:Qf("flex h-7 w-7 items-center justify-center rounded transition-all duration-200","hover:bg-gray-200 dark:hover:bg-gray-700","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1","focus:opacity-100",d||i?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${m.name}`,tabIndex:0,onFocus:()=>c(!0),children:l.jsx(yr,{className:"h-4 w-4"})})})]}),l.jsx(hr,{showCloseButton:!1,title:n("com_ui_delete_tool"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsxs("div",{className:"flex w-full flex-col items-start gap-2 text-sm text-text-secondary",children:[l.jsxs("p",{children:[n("com_ui_delete_tool_confirm")," ",l.jsxs("strong",{children:['"',m.name,'"']}),"?"]}),m.description&&l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(Er,{className:"h-4 w-4 flex-shrink-0 text-text-secondary"}),l.jsx("p",{className:"text-sm",children:m.description})]})]})}),selection:{selectHandler:()=>{var t;(t=e)&&s.mutate({pluginKey:t,action:"uninstall",auth:{},isEntityTool:!0},{onError:e=>{a({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{var e;const n=null==(e=r("tools"))?void 0:e.filter((e=>e!==t));o("tools",n),a({message:"Tool deleted successfully",status:"success"})}})},selectClasses:"bg-red-700 hover:bg-red-800 dark:bg-red-600 dark:hover:bg-red-800 text-white",selectText:n("com_ui_delete")}})]})}function UI({isOpen:e,onSubmit:t,onRevoke:n,onOpenChange:a,isUserProvided:s,isToolAuthenticated:r,register:o,handleSubmit:i,triggerRef:c,triggerRefs:d}){const u=qN();return l.jsx(rr,{open:e,onOpenChange:a,triggerRef:c,triggerRefs:d,children:l.jsx(hr,{className:"w-11/12 sm:w-[450px]",title:"",main:l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"mb-4 text-center font-medium",children:u("com_ui_librechat_code_api_title")}),l.jsx("div",{className:"mb-4 text-center text-sm",children:u("com_ui_librechat_code_api_subtitle")}),l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"mx-auto mb-4 flex max-w-[400px] flex-wrap justify-center gap-3",children:["python.svg","nodedotjs.svg","tsnode.svg","rust.svg","go.svg","c.svg","cplusplus.svg","php.svg","fortran.svg","r.svg"].map((e=>l.jsx("div",{className:"h-6 w-6",children:l.jsx("img",{src:`assets/${e}`,alt:"",className:"h-full w-full object-contain opacity-[0.85] dark:invert"})},e)))}),l.jsx("a",{href:"https://code.librechat.ai/pricing",target:"_blank",rel:"noopener noreferrer",className:"block text-center text-[15px] font-medium text-blue-500 underline decoration-1 hover:text-blue-600 dark:text-blue-400 dark:hover:text-blue-300",children:u("com_ui_librechat_code_api_key")})]}),l.jsx("form",{onSubmit:i(t),children:l.jsx(kr,{type:"password",placeholder:u("com_ui_enter_api_key"),autoComplete:"one-time-code",readOnly:!0,onFocus:e=>e.target.readOnly=!1,...o("apiKey",{required:!0})})})]}),selection:{selectHandler:i(t),selectClasses:"bg-green-500 hover:bg-green-600 text-white",selectText:u("com_ui_save")},buttons:s&&r&&l.jsx(Ys,{onClick:n,className:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80","aria-label":u("com_ui_revoke"),children:u("com_ui_revoke")}),showCancelButton:!0})})}function zI({authType:e="",isToolAuthenticated:t=!1}){const n=qN(),a=Pi(),{control:s,setValue:r}=a,o=ba(null),{onSubmit:i,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,methods:m}=wS({onSubmit:()=>{r(Au.execute_code,!0,{shouldDirty:!0}),setTimeout((()=>{var e;return null==(e=o.current)?void 0:e.focus()}),100)},onRevoke:()=>{r(Au.execute_code,!1,{shouldDirty:!0}),setTimeout((()=>{var e;return null==(e=o.current)?void 0:e.focus()}),100)}}),p=Di({control:s,name:Au.execute_code}),h=e===Hl.USER_PROVIDED,g=e=>{t?r(Au.execute_code,e,{shouldDirty:!0}):p?r(Au.execute_code,!1,{shouldDirty:!0}):d(!0)};return l.jsxs(l.Fragment,{children:[l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Li,{name:Au.execute_code,control:s,render:({field:e})=>l.jsx(jr,{...e,id:"execute-code-checkbox",checked:p||t&&e.value,onCheckedChange:g,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),disabled:!p&&!t,"aria-labelledby":"execute-code-label"})}),l.jsx("label",{id:"execute-code-label",htmlFor:"execute-code-checkbox",className:"form-check-label text-token-text-primary cursor-pointer",children:n("com_ui_run_code")}),l.jsxs("div",{className:"ml-2 flex gap-2",children:[h&&l.jsx("button",{ref:o,type:"button",onClick:()=>d(!0),"aria-label":n("com_ui_add_code_interpreter_api_key"),"aria-haspopup":"dialog","aria-expanded":c,children:l.jsx(oe,{className:"h-5 w-5 text-text-primary","aria-hidden":"true"})}),l.jsx(Tr,{asChild:!0,children:l.jsx("button",{type:"button",className:"inline-flex items-center","aria-label":n("com_agents_code_interpreter"),children:l.jsx(Er,{className:"h-4 w-4 text-text-tertiary"})})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:n("com_agents_code_interpreter")})})})})]})}),l.jsx(UI,{isOpen:c,onSubmit:i,onRevoke:u,onOpenChange:d,register:m.register,isToolAuthenticated:t,handleSubmit:m.handleSubmit,isUserProvided:e===Hl.USER_PROVIDED,triggerRef:o})]})}const VI=kl.execute_code;function $I({agent_id:e,files:t}){const n=qN(),{setFilesLoading:a}=$N(),{watch:s}=Pi(),r=ba(null),[o,i]=ja(new Map),{data:c=null}=Y_({select:e=>wd(e)}),{abortUpload:d,handleFileChange:u}=BC({fileSetter:i,additionalMetadata:{agent_id:e,tool_resource:VI}});KC((()=>{t&&i(new Map(t))}),[t],750);const m=s(Au.execute_code),p=jd({fileConfig:c,endpoint:Yl.agents,endpointType:Yl.agents});if((null==p?void 0:p.disabled)??!1)return null;return l.jsx("div",{className:"mb-2 w-full",children:l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:n("com_assistants_code_interpreter_files")}),l.jsx(TI,{files:o,setFiles:i,agent_id:e,abortUpload:d,tool_resource:VI,setFilesLoading:a,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:Zg(e)||!1===m,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;r.current&&(r.current.value=""),null==(e=r.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-1",children:[l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:r,disabled:Zg(e)||!1===m,onChange:u}),l.jsx(Qr,{className:"text-token-text-primary h-4 w-4"}),n("com_ui_upload_code_files")]})})})]})})}function BI({agent_id:e,files:t}){const n=qN(),{data:a}=ob({toolId:Nl.execute_code});return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("div",{className:"flex flex-row items-center gap-1",children:l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-token-text-primary block font-medium",children:n("com_agents_code_interpreter_title")}),l.jsx("span",{className:"text-xs text-text-secondary",children:n("com_agents_by_librechat")})]})})}),l.jsxs("div",{className:"flex flex-col items-start gap-2",children:[l.jsx(zI,{authType:null==a?void 0:a.message,isToolAuthenticated:null==a?void 0:a.authenticated}),l.jsx($I,{agent_id:e,files:t})]})]})}function HI({serverInfo:e}){const t=qN(),{removeTool:n}=sS(),[a,s]=ja(!1),[r,o]=ja(!1),{initializeServer:i,isInitializing:c,getServerStatusIconProps:d,getConfigDialogProps:u}=aS();if(!e)return null;const m=e.serverName,p=c(m),h=d(m),g=u(),x=h&&l.jsx("div",{onClick:e=>{e.stopPropagation()},className:"cursor-pointer rounded p-0.5 hover:bg-surface-secondary",children:l.jsx(ST,{...h})});return l.jsxs(rr,{children:[l.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-surface-primary-alt",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>s(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||s(!1)},children:[l.jsxs("div",{className:"flex grow cursor-pointer items-center gap-1 rounded bg-transparent p-0 text-left transition-colors",onClick:e=>{e.target.closest("[data-status-icon]")||p||i(m)},role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),p||i(m))},"aria-disabled":p,children:[x&&l.jsx("div",{className:"flex items-center","data-status-icon":!0,children:x}),e.metadata.icon&&l.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${e.metadata.icon})`,backgroundSize:"cover"}})}),l.jsxs("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:[m,p&&l.jsx("span",{className:"ml-2 text-xs text-text-secondary",children:t("com_ui_initializing")})]})]}),l.jsx(or,{asChild:!0,children:l.jsx("button",{type:"button",className:Qf("flex h-7 w-7 items-center justify-center rounded transition-all duration-200 hover:bg-surface-active-alt focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",r||a?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${m}`,tabIndex:0,onFocus:()=>s(!0),children:l.jsx(yr,{className:"h-4 w-4"})})})]}),l.jsx(hr,{showCloseButton:!1,title:t("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:t("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>n(m),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:t("com_ui_delete")}}),g&&l.jsx(rE,{...g})]})}function GI({serverName:e}){const t=qN(),{removeTool:n}=sS(),[a,s]=ja(!1),[r,o]=ja(!1);return e?l.jsxs(rr,{children:[l.jsxs("div",{className:"group relative flex w-full items-center gap-1 rounded-lg p-1 text-sm hover:bg-surface-primary-alt",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onFocus:()=>s(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||s(!1)},children:[l.jsx("div",{className:"flex items-center",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded p-1",children:l.jsx(Ue,{className:"h-4 w-4 text-red-500"})})}),l.jsx("div",{className:"flex grow cursor-not-allowed items-center gap-1 rounded bg-transparent p-0 text-left transition-colors",children:l.jsxs("div",{className:"grow select-none px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:[e,l.jsxs("span",{className:"ml-2 text-xs text-text-secondary",children:[" - ",t("com_ui_unavailable")]})]})}),l.jsx(or,{asChild:!0,children:l.jsx("button",{type:"button",className:Qf("flex h-7 w-7 items-center justify-center rounded transition-all duration-200 hover:bg-surface-active-alt focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",r||a?"opacity-100":"pointer-events-none opacity-0"),"aria-label":`Delete ${e}`,tabIndex:0,onFocus:()=>s(!0),children:l.jsx(yr,{className:"h-4 w-4"})})})]}),l.jsx(hr,{showCloseButton:!1,title:t("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:t("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>n(e||""),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:t("com_ui_delete")}})]}):null}function KI({serverInfo:e}){var t,n,a;const s=qN(),{removeTool:r}=sS(),{getValues:o,setValue:i}=Pi(),{getServerStatusIconProps:c,getConfigDialogProps:d}=aS(),[u,m]=ja(!1),[p,h]=ja(!1),[g,x]=ja("");if(!e)return null;const f=e.serverName,v=t=>{const n=(o("tools")||[]).filter((t=>{var n;return!(null==(n=null==e?void 0:e.tools)?void 0:n.some((e=>e.tool_id===t)))}));i("tools",[...n,...t])},_=(()=>{if(!(null==e?void 0:e.tools))return[];const t=o("tools")||[];return e.tools.filter((e=>t.includes(e.tool_id))).map((e=>e.tool_id))})(),b=g===f,y=c(f),j=d(),w=y&&l.jsx("div",{onClick:e=>{e.stopPropagation()},className:"cursor-pointer rounded p-0.5 hover:bg-surface-secondary",children:l.jsx(ST,{...y})});return l.jsxs(rr,{children:[l.jsx(Yr,{type:"single",value:g,onValueChange:x,collapsible:!0,children:l.jsxs(Xr,{value:f,className:"group relative w-full border-none",children:[l.jsx("div",{className:"relative flex w-full items-center gap-1 rounded-lg p-1 hover:bg-surface-primary-alt",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onFocus:()=>m(!0),onBlur:e=>{e.currentTarget.contains(e.relatedTarget)||m(!1)},children:l.jsx(Ha,{asChild:!0,children:l.jsxs("div",{className:"flex grow cursor-pointer select-none items-center gap-1 rounded bg-transparent p-0 text-left transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",onClick:()=>x((e=>e?"":f)),children:[w&&l.jsx("div",{className:"flex items-center",children:w}),e.metadata.icon&&l.jsx("div",{className:"flex h-8 w-8 items-center justify-center overflow-hidden rounded-full",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${e.metadata.icon})`,backgroundSize:"cover"}})}),l.jsx("div",{className:"grow px-2 py-1.5",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:f}),l.jsx("div",{className:"flex items-center",children:l.jsx("div",{className:"relative flex items-center",children:l.jsx("div",{className:Qf("absolute right-0 transition-all duration-300",p||u?"translate-x-0 opacity-100":"translate-x-8 opacity-0"),children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{"data-checkbox-container":!0,onClick:e=>e.stopPropagation(),className:"mt-1",children:l.jsx(jr,{id:`select-all-${f}`,checked:_.length===(null==(t=e.tools)?void 0:t.length)&&_.length>0,onCheckedChange:t=>{if(e.tools){const n=t?e.tools.map((e=>e.tool_id)):[`${Bm.mcp_server}${Bm.mcp_delimiter}${f}`];v(n)}},className:Qf("h-4 w-4 rounded border border-border-medium transition-all duration-200 hover:border-border-heavy",b?"visible":"pointer-events-none invisible"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();e.currentTarget.click()}},tabIndex:b?0:-1,"aria-label":_.length===(null==(n=e.tools)?void 0:n.length)&&_.length>0?s("com_ui_deselect_all"):s("com_ui_select_all")})}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(Ga,{asChild:!0,children:l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation()},className:Qf("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200 hover:bg-surface-active-alt focus:translate-x-0 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",b&&"bg-surface-active-alt"),"aria-label":s(b?"com_ui_tool_list_collapse":"com_ui_tool_list_expand",{serverName:f}),"aria-expanded":b,tabIndex:0,onFocus:()=>m(!0),children:l.jsx(he,{className:Qf("h-4 w-4 transition-transform duration-200",b&&"rotate-180")})})}),l.jsx(or,{asChild:!0,children:l.jsx("button",{type:"button",className:Qf("flex h-7 w-7 items-center justify-center rounded transition-colors duration-200","hover:bg-surface-active-alt focus:translate-x-0 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1"),onClick:e=>e.stopPropagation(),"aria-label":`Delete ${f}`,tabIndex:0,onFocus:()=>m(!0),children:l.jsx(yr,{className:"h-4 w-4"})})})]})]})})})})]})})}),l.jsx(Jr,{className:"relative ml-1 pt-1 before:absolute before:bottom-2 before:left-0 before:top-0 before:w-0.5 before:bg-border-medium",children:l.jsx("div",{className:"space-y-1",children:null==(a=e.tools)?void 0:a.map((e=>l.jsxs("label",{htmlFor:e.tool_id,className:Qf("group/item border-token-border-light hover:bg-token-surface-secondary flex cursor-pointer items-center rounded-lg border p-2","ml-2 mr-1 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 focus-within:ring-offset-background"),onClick:e=>e.stopPropagation(),onKeyDown:e=>{e.stopPropagation()},children:[l.jsx(jr,{id:e.tool_id,checked:_.includes(e.tool_id),onCheckedChange:t=>{const n=_.includes(e.tool_id)?_.filter((t=>t!==e.tool_id)):[..._,e.tool_id];v(n)},onKeyDown:e=>{if(e.stopPropagation(),"Enter"===e.key||" "===e.key){e.preventDefault();e.currentTarget.click()}},onClick:e=>e.stopPropagation(),className:Qf("relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer rounded border border-border-medium transition-[border-color] duration-200 hover:border-border-heavy focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background"),"aria-label":e.metadata.name}),l.jsx("span",{className:"text-token-text-primary select-none",children:e.metadata.name}),e.metadata.description&&l.jsx("div",{className:"ml-auto flex items-center opacity-0 transition-opacity duration-200 group-focus-within/item:opacity-100 group-hover/item:opacity-100",children:l.jsx(xr,{side:fr.Left,text:e.metadata.description})})]},e.tool_id)))})})]})}),l.jsx(hr,{showCloseButton:!1,title:s("com_ui_delete_tool"),mainClassName:"px-0",className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:s("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>r(f),selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:s("com_ui_delete")}}),j&&l.jsx(rE,{...j})]})}function WI({agentId:e,mcpServerNames:t,setShowMCPToolDialog:n}){const a=qN(),{mcpServersMap:s}=lk();return ak({permissionType:Pp.MCP_SERVERS,permission:Op.USE})?l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"text-token-text-primary mb-2 block font-medium",children:a("com_ui_mcp_servers")}),l.jsxs("div",{children:[l.jsx("div",{className:"mb-1",children:null==t?void 0:t.map((t=>{const n=s.get(t);return(null==n?void 0:n.isConfigured)?n?n.isConnected?l.jsx(KI,{serverInfo:n},`${n.serverName}-${e}`):l.jsx(HI,{serverInfo:n},`${n.serverName}-${e}`):null:l.jsx(GI,{serverName:t},`${t}-${e}`)}))}),l.jsx("div",{className:"mt-2",children:l.jsx("button",{type:"button",onClick:()=>n(!0),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:a("com_assistants_add_mcp_server_tools")})})})]})]}):null}const qI="mb-2 text-token-text-primary block font-medium",QI=Qf(ov,"flex w-full px-3 py-2 border-border-light bg-surface-secondary focus-visible:ring-2 focus-visible:ring-ring-primary",av);function YI(){const e=qN(),t=pk(),{showToast:n}=Ds(),a=Pi(),[s,r]=ja(!1),[o,i]=ja(!1),{actions:c,setAction:d,regularTools:u,agentsConfig:m,availableMCPServers:p,mcpServersMap:h,setActivePanel:g,endpointsConfig:x}=lk(),{control:f,formState:{errors:v}}=a,_=Di({control:f,name:"provider"}),b=Di({control:f,name:"model"}),y=Di({control:f,name:"agent"}),j=Di({control:f,name:"tools"}),w=Di({control:f,name:"id"}),{data:N=[]}=Q_(w),k=Ca((()=>{const e={...t};return N.forEach((t=>{t.file_id&&(e[t.file_id]=t)})),e}),[t,N]),{codeEnabled:C,toolsEnabled:S,contextEnabled:T,actionsEnabled:E,artifactsEnabled:I,webSearchEnabled:R,fileSearchEnabled:A}=JN(null==m?void 0:m.capabilities),P=Ca((()=>{if("string"==typeof y)return[];if((null==y?void 0:y.id)!==w)return[];if(y.context_files)return y.context_files;return Lx({agent:y,fileMap:k}).context_files??[]}),[y,w,k]),O=Ca((()=>{if("string"==typeof y)return[];if((null==y?void 0:y.id)!==w)return[];if(y.knowledge_files)return y.knowledge_files;return Lx({agent:y,fileMap:k}).knowledge_files??[]}),[y,w,k]),L=Ca((()=>{if("string"==typeof y)return[];if((null==y?void 0:y.id)!==w)return[];if(y.code_files)return y.code_files;return Lx({agent:y,fileMap:k}).code_files??[]}),[y,w,k]),M=ka((()=>{Zg(w)?n({message:e("com_assistants_actions_disabled"),status:"warning"}):g(rx.actions)}),[w,g,n,e]),D="string"==typeof _?_:null==_?void 0:_.value;let F,U,z,V;void 0!==D&&(U=Zm(x,D,"type"),z=Zm(x,D,"iconURL"),V=Sf({endpoint:D,endpointsConfig:x,endpointType:U,endpointIconURL:z}),F=WS[V]);const{toolIds:$,mcpServerNames:B}=function(e,t,n){return Ca((()=>{const a=new Set,s=[];for(const r of e??[])if(r.includes(Bm.mcp_delimiter)){const e=r.split(Bm.mcp_delimiter)[1];e&&a.add(e)}else n.has(r)?a.add(r):(null==t?void 0:t.some((e=>e.pluginKey===r)))&&s.push(r);return{toolIds:s.sort(((e,t)=>e.localeCompare(t))),mcpServerNames:Array.from(a).sort(((e,t)=>e.localeCompare(t)))}}),[t,n,e])}(j,u,h);return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"h-auto bg-white px-4 pt-3 dark:bg-transparent",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx(ZE,{avatar:(null==y?void 0:y.avatar)??null}),l.jsxs("label",{className:qI,htmlFor:"name",children:[e("com_ui_name"),l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Li,{name:"name",rules:{required:e("com_ui_agent_name_is_required")},control:f,render:({field:t})=>l.jsxs(l.Fragment,{children:[l.jsx("input",{...t,value:t.value??"",maxLength:256,className:QI,id:"name",type:"text",placeholder:e("com_agents_name_placeholder"),"aria-label":"Agent name"}),l.jsx("div",{className:Qf("mt-1 w-56 text-sm text-red-500",v.name?"visible h-auto":"invisible h-0"),children:v.name?v.name.message:" "})]})}),l.jsx(Li,{name:"id",control:f,render:({field:e})=>l.jsx("p",{className:"h-3 text-xs italic text-text-secondary","aria-live":"polite",children:e.value})})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:qI,htmlFor:"description",children:e("com_ui_description")}),l.jsx(Li,{name:"description",control:f,render:({field:t})=>l.jsx("input",{...t,value:t.value??"",maxLength:512,className:QI,id:"description",type:"text",placeholder:e("com_agents_description_placeholder"),"aria-label":"Agent description"})})]}),l.jsxs("div",{className:"mb-4",children:[l.jsxs("label",{className:qI,htmlFor:"category-selector",children:[e("com_ui_category")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(GE,{className:"w-full"})]}),l.jsx(QE,{}),l.jsxs("div",{className:"mb-4",children:[l.jsxs("label",{className:qI,htmlFor:"provider",children:[e("com_ui_model")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx("button",{type:"button",onClick:()=>g(rx.model),className:"btn btn-neutral border-token-border-light relative h-10 w-full rounded-lg font-medium","aria-haspopup":"true","aria-expanded":"false",children:l.jsxs("div",{className:"flex w-full items-center gap-2",children:[F&&l.jsx("div",{className:"shadow-stroke relative flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-white text-black dark:bg-white",children:l.jsx(F,{className:"h-2/3 w-2/3",endpoint:D,endpointType:U,iconURL:z})}),l.jsx("span",{children:null!=b&&b?b:e("com_ui_select_model")})]})})]}),(C||A||I||T||R)&&l.jsxs("div",{className:"mb-4 flex w-full flex-col items-start gap-3",children:[l.jsx("label",{className:"text-token-text-primary block font-medium",children:e("com_assistants_capabilities")}),C&&l.jsx(BI,{agent_id:w,files:L}),R&&l.jsx(PI,{}),T&&l.jsx(EI,{agent_id:w,files:P}),I&&l.jsx(MI,{}),A&&l.jsx(LI,{agent_id:w,files:O})]}),null!=p&&p.length>0&&l.jsx(WI,{agentId:w,mcpServerNames:B,setShowMCPToolDialog:i}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:qI,children:!0===S&&!0===E?e("com_ui_tools_and_actions"):!0===S?e("com_ui_tools"):!0===E?e("com_assistants_actions"):""}),l.jsxs("div",{children:[l.jsx("div",{className:"mb-1",children:$.map(((e,t)=>(null==u?void 0:u.find((t=>t.pluginKey===e)))?l.jsx(FI,{tool:e,regularTools:u,agent_id:w},`${e}-${t}-${w}`):null))}),l.jsx("div",{className:"flex flex-col gap-1",children:(c??[]).filter((e=>e.agent_id===w)).map(((e,t)=>l.jsx(KE,{action:e,onClick:()=>{d(e),g(rx.actions)}},t)))}),l.jsxs("div",{className:"mt-2 flex space-x-2",children:[(S??!1)&&l.jsx("button",{type:"button",onClick:()=>r(!0),className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:e("com_assistants_add_tools")})}),(E??!1)&&l.jsx("button",{type:"button",disabled:Zg(w),onClick:M,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium","aria-haspopup":"dialog",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:e("com_assistants_add_actions")})})]})]})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("div",{className:"mb-1.5 flex items-center gap-2",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:e("com_ui_support_contact")})})}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex flex-col",children:[l.jsx("label",{className:"mb-1 flex items-center justify-between",htmlFor:"support-contact-name",children:l.jsx("span",{className:"text-sm",children:e("com_ui_support_contact_name")})}),l.jsx(Li,{name:"support_contact.name",control:f,rules:{minLength:{value:3,message:e("com_ui_support_contact_name_min_length",{minLength:3})}},render:({field:t,fieldState:{error:n}})=>l.jsxs(l.Fragment,{children:[l.jsx("input",{...t,value:t.value??"",className:Qf(QI,n?"border-2 border-red-500":""),id:"support-contact-name",type:"text",placeholder:e("com_ui_support_contact_name_placeholder"),"aria-label":"Support contact name","aria-invalid":n?"true":"false","aria-describedby":n?"support-contact-name-error":void 0}),n&&l.jsx("span",{id:"support-contact-name-error",className:"text-sm text-red-500 transition duration-300 ease-in-out",role:"alert","aria-live":"polite",children:n.message})]})})]}),l.jsxs("div",{className:"flex flex-col",children:[l.jsx("label",{className:"mb-1 flex items-center justify-between",htmlFor:"support-contact-email",children:l.jsx("span",{className:"text-sm",children:e("com_ui_support_contact_email")})}),l.jsx(Li,{name:"support_contact.email",control:f,rules:{validate:t=>Bf(t??"",e("com_ui_support_contact_email_invalid"))},render:({field:t,fieldState:{error:n}})=>l.jsxs(l.Fragment,{children:[l.jsx("input",{...t,value:t.value??"",className:Qf(QI,n?"border-2 border-red-500":""),id:"support-contact-email",type:"email",placeholder:e("com_ui_support_contact_email_placeholder"),"aria-label":"Support contact email","aria-invalid":n?"true":"false","aria-describedby":n?"support-contact-email-error":void 0}),n&&l.jsx("span",{id:"support-contact-email-error",className:"text-sm text-red-500 transition duration-300 ease-in-out",role:"alert","aria-live":"polite",children:n.message})]})})]})]})]})]}),l.jsx(HE,{isOpen:s,setIsOpen:r,endpoint:Yl.agents}),null!=p&&p.length>0&&l.jsx($E,{agentId:w,isOpen:o,mcpServerNames:B,setIsOpen:i,endpoint:Yl.agents})]})}const XI=new Set(Object.keys(xc));function JI({agentQuery:e,selectedAgentId:t=null,setCurrentAgentId:n,createMutation:a}){const s=qN(),r=ba(null),{control:o,reset:i}=Pi(),d=sk(),{data:u=null}=R_({requiredPermission:d},{select:e=>e.data.map((e=>Lx({agent:{...e,name:e.name||e.id}})))}),m=ka((e=>{var t;const n=e.isPublic??!1,a={...e,provider:Px(e.provider),label:e.name??"",value:e.id||"",icon:n?l.jsx(c,{className:"icon-lg text-green-400"}):null},s={[Au.web_search]:!1,[Au.file_search]:!1,[Au.execute_code]:!1,[Au.end_after_tools]:!1,[Au.hide_sequential_outputs]:!1},r=[];(e.tools??[]).forEach((e=>{void 0===s[e]?r.push(e):s[e]=!0}));const o={...s,agent:a,model:a.model,tools:r,category:e.category||"general",support_contact:e.support_contact,avatar_file:null,avatar_preview:(null==(t=e.avatar)?void 0:t.filepath)??"",avatar_action:null};Object.entries(e).forEach((([e,t])=>{"model_parameters"!==e&&void 0===s[e]?"agent_ids"===e&&Array.isArray(t)&&t.every((e=>"string"==typeof e))||"edges"===e&&Array.isArray(t)?o[e]=t:XI.has(e)&&("recursion_limit"!==e||"number"!=typeof t?"number"!=typeof t&&"object"!=typeof t&&(o[e]=t):o[e]=t):o[e]=t})),i(o)}),[i]),p=ka((t=>{const s=!!(t?(u??[]).find((e=>e.id===t)):void 0);if(a.reset(),!s)return n(void 0),i(Ox());n(t);const r=e.data;r?m(r):console.warn("Agent not found")}),[u,a,n,e.data,m,i]);ya((()=>{e.data&&e.isSuccess&&m(e.data)}),[e.data,e.isSuccess,m]),ya((()=>{let e=null;if(t!==r.current)return null!=t&&""!==t&&u&&(e=setTimeout((()=>{r.current=t,p(t)}),5)),()=>{e&&clearTimeout(e)}}),[t,u,p]);const h=s("com_ui_create_new_agent");return l.jsx(Li,{name:"agent",control:o,render:({field:e})=>{var t,n,a,r;return l.jsx(Mr,{containerClassName:"px-0",selectedValue:((null==(t=null==e?void 0:e.value)?void 0:t.value)??"")+"",displayValue:(null==(n=null==e?void 0:e.value)?void 0:n.label)??"",selectPlaceholder:(null==(a=null==e?void 0:e.value)?void 0:a.value)??h,iconSide:"right",searchPlaceholder:s("com_agents_search_name"),SelectIcon:null==(r=null==e?void 0:e.value)?void 0:r.icon,setValue:p,items:(null==u?void 0:u.map((e=>({label:e.name??"",value:e.id??"",icon:e.icon}))))??[{label:"Loading...",value:""}],className:Qf("z-50 flex h-[40px] w-full flex-none items-center justify-center truncate rounded-md bg-transparent font-bold"),ariaLabel:s("com_ui_agent"),isCollapsed:!1,showCarat:!0})}})}const ZI=({setActivePanel:e})=>{const t=qN();return l.jsxs(Ys,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-text-primary",onClick:()=>e(rx.advanced),"aria-label":t("com_ui_advanced"),children:[l.jsx(Qe,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_advanced")]})},eR=({setActivePanel:e})=>{const t=qN();return l.jsxs(Ys,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium",onClick:()=>e(rx.version),"aria-label":t("com_ui_agent_version"),children:[l.jsx(Ye,{className:"h-4 w-4 cursor-pointer","aria-hidden":"true"}),t("com_ui_agent_version")]})};function tR({agent_id:e}){const t=qN(),{showToast:n}=Ds(),a=U_({onSuccess:()=>{n({message:t("com_ui_agent_duplicated"),status:"success"})},onError:e=>{console.error(e),n({message:t("com_ui_agent_duplicate_error"),status:"error"})}});if(Zg(e))return null;return l.jsx(Ys,{size:"sm",variant:"outline","aria-label":t("com_ui_duplicate_agent"),type:"button",onClick:()=>{a.mutate({agent_id:e})},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-primary",children:l.jsx(Xe,{className:"size-4"})})})}const nR=({control:e,agentPerm:t,label:n,getValues:a,setValue:s})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[l.jsx("button",{className:"cursor-pointer select-none",type:"button",onClick:()=>s(t,!a(t),{shouldDirty:!0}),tabIndex:0,children:n}),l.jsx(Li,{name:t,control:e,render:({field:e})=>l.jsx(dr,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString(),"aria-label":n})})]}),aR=()=>{const e=qN(),{showToast:t}=Ds(),{user:n,roles:a}=nk(),{mutate:s,isLoading:r}=(e=>{const t=xs(),{onMutate:n,onSuccess:a,onError:s}=e??{};return fs((e=>(xh.partial().parse(e.updates),Jh.updateAgentPermissions(e))),{onSuccess:(e,n,s)=>{t.invalidateQueries([Fh.roles,n.roleName]),null!=a&&a(e,n,s)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),null!=s&&s(...e)},onMutate:n})})({onSuccess:()=>{t({status:"success",message:e("com_ui_saved")})},onError:()=>{t({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[o,i]=ja(!1),[c,d]=ja(gh.USER),u=Ca((()=>{var e;const t=null==(e=null==a?void 0:a[c])?void 0:e.permissions;return t?t[Pp.AGENTS]:Dh[c].permissions[Pp.AGENTS]}),[a,c]),{reset:m,control:p,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:f}}=Oi({mode:"onChange",defaultValues:u});if(ya((()=>{var e,t;const n=null==(t=null==(e=null==a?void 0:a[c])?void 0:e.permissions)?void 0:t[Pp.AGENTS];m(n||Dh[c].permissions[Pp.AGENTS])}),[a,c,m]),(null==n?void 0:n.role)!==gh.ADMIN)return null;const v=[{agentPerm:Op.SHARED_GLOBAL,label:e("com_ui_agents_allow_share")},{agentPerm:Op.CREATE,label:e("com_ui_agents_allow_create")},{agentPerm:Op.USE,label:e("com_ui_agents_allow_use")}],_=e=>{s({roleName:c,updates:e})},b=[{label:gh.USER,onClick:()=>{d(gh.USER)}},{label:gh.ADMIN,onClick:()=>{d(gh.ADMIN)}}];return l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-text-primary","aria-label":e("com_ui_admin_settings"),children:[l.jsx(ae,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),l.jsxs(ir,{className:"border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[l.jsx(lr,{children:e("com_ui_admin_settings_section",{section:e("com_ui_agents")})}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(cr,{unmountOnHide:!0,menuId:"role-dropdown",isOpen:o,setIsOpen:i,trigger:l.jsx(se,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:c}),items:b,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:x(_),children:[l.jsx("div",{className:"py-5",children:v.map((({agentPerm:t,label:n})=>l.jsxs("div",{children:[l.jsx(nR,{control:p,agentPerm:t,label:n,getValues:g,setValue:h}),c===gh.ADMIN&&t===Op.USE&&l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[l.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",l.jsx("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t)))}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{type:"button",onClick:x(_),disabled:f||r,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600 focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-ring-primary",children:e("com_ui_save")})})]})]})]})]})};function sR({agent_id:e,setCurrentAgentId:t,createMutation:n}){const a=qN(),{reset:s}=Pi(),{showToast:r}=Ds(),{conversation:o}=$N(),{setOption:i}=SC(),c=F_({onSuccess:(e,l,c)=>{var d;const u=c;if(!u)return;r({message:a("com_ui_agent_deleted"),status:"success"}),(null==(d=n.data)?void 0:d.id)&&(cx.log("agents","resetting createMutation"),n.reset());const m=u[0];if(!m)return t(void 0),s(Ox()),i("agent_id")("");if(l.agent_id===(null==o?void 0:o.agent_id))return i("model")(""),i("agent_id")(m.id);const p=u.find((e=>e.id===(null==o?void 0:o.agent_id)));p&&t(p.id),t(m.id)},onError:e=>{console.error(e),r({message:a("com_ui_agent_delete_error"),status:"error"})}});return Zg(e)?null:l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{size:"sm",variant:"outline","aria-label":a("com_ui_delete_agent"),type:"button",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:l.jsx(yr,{})})})}),l.jsx(hr,{title:a("com_ui_delete_agent"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(er,{htmlFor:"delete-agent",className:"text-left text-sm font-medium",children:a("com_ui_delete_agent_confirm")})})})}),selection:{selectHandler:()=>c.mutate({agent_id:e}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:a("com_ui_delete")}})]})}function rR({activePanel:e,createMutation:t,updateMutation:n,setActivePanel:a,setCurrentAgentId:s,isAvatarUploading:r=!1}){const o=qN(),{user:i}=nk(),c=Pi(),{control:d}=c,u=Di({control:d,name:"agent"}),m=Di({control:d,name:"id"}),p=ak({permissionType:Pp.AGENTS,permission:Op.SHARED_GLOBAL}),{hasPermission:h,isLoading:g}=eT(Ph.AGENT,(null==u?void 0:u._id)||""),x=h(Oh.SHARE),f=h(Oh.DELETE),v=t.isLoading||n.isLoading||r,_=e===rx.builder;return l.jsxs("div",{className:"mb-1 flex w-full flex-col gap-2",children:[_&&l.jsx(ZI,{setActivePanel:a}),_&&m&&l.jsx(eR,{setActivePanel:a}),(null==i?void 0:i.role)===gh.ADMIN&&_&&l.jsx(aR,{}),l.jsxs("div",{className:"flex items-center justify-end gap-2",children:[((null==u?void 0:u.author)===(null==i?void 0:i.id)||(null==i?void 0:i.role)===gh.ADMIN||f)&&!g&&l.jsx(sR,{agent_id:m,setCurrentAgentId:s,createMutation:t}),((null==u?void 0:u.author)===(null==i?void 0:i.id)||(null==i?void 0:i.role)===gh.ADMIN||x)&&p&&!g&&l.jsx(JT,{resourceDbId:null==u?void 0:u._id,resourceId:m,resourceName:(null==u?void 0:u.name)??"",resourceType:Ph.AGENT}),u&&u.author===(null==i?void 0:i.id)&&l.jsx(tR,{agent_id:m}),l.jsx("button",{className:"btn btn-primary focus:shadow-outline flex h-9 w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"submit",disabled:v,"aria-busy":v,children:v?l.jsx(Xs,{className:"icon-md","aria-hidden":"true"}):o(m?"com_ui_save":"com_ui_create")})]})]})}function oR({providers:e,setActivePanel:t,models:n}){const a=qN(),{control:s,setValue:r}=Pi(),o=Di({control:s,name:"model"}),i=Di({control:s,name:"provider"}),c=Di({control:s,name:"model_parameters"}),d=Ca((()=>("string"==typeof i?i:null==i?void 0:i.value)??""),[i]),u=Ca((()=>d?n[d]??[]:[]),[n,d]);ya((()=>{const e=o??"";if(d&&e){if(!u.includes(e)){const e=n[d]??[];r("model",e[0]??"")}localStorage.setItem(Hm.LAST_AGENT_MODEL,e),localStorage.setItem(Hm.LAST_AGENT_PROVIDER,d)}d&&!e&&r("model",u[0]??"")}),[d,u,n,r,o]);const{data:m={}}=G_(),p=Ca((()=>{var e;return(null==(e=null==m?void 0:m[d])?void 0:e.availableRegions)??[]}),[m,d]),h=Ca((()=>Zm(m,d,"type")),[d,m]),g=Ca((()=>{var e,t,n;const a=(null==(e=m[d])?void 0:e.customParams)??{},[s,r]=ic(h??d,o??""),i=a.defaultParamsEndpoint??r,l=Yg[s]??Yg[i]??[],c=(null==(n=null==(t=m[d])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],u=yi(c,"key");return l.filter((e=>null!=e)).map((e=>u[e.key]??e))}),[h,m,o,d]),x=e=>t=>{r(`model_parameters.${e}`,t)};return l.jsxs("div",{className:"mx-1 mb-1 flex h-full min-h-[50vh] w-full flex-col gap-2 text-sm",children:[l.jsxs("div",{className:"model-panel relative flex flex-col items-center px-16 py-4 text-center",children:[l.jsx("div",{className:"absolute left-0 top-4",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{t(rx.builder)},"aria-label":a("com_ui_back_to_builder"),children:l.jsx("div",{className:"model-panel-content flex w-full items-center justify-center gap-2",children:l.jsx(Ae,{})})})}),l.jsx("div",{className:"mb-2 mt-2 text-xl font-medium",children:a("com_ui_model_parameters")})]}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"mb-4",children:[l.jsxs("label",{id:"provider-label",className:"text-token-text-primary model-panel-label mb-2 block font-medium",htmlFor:"provider",children:[a("com_ui_provider")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Li,{name:"provider",control:s,rules:{required:!0,minLength:1},render:({field:t,fieldState:{error:n}})=>{var s,r;const o="string"==typeof t.value?t.value:(null==(s=t.value)?void 0:s.value)??"",i="string"==typeof t.value?t.value:(null==(r=t.value)?void 0:r.label)??"";return l.jsxs(l.Fragment,{children:[l.jsx(Mr,{selectedValue:o,displayValue:Sm[i]??i,selectPlaceholder:a("com_ui_select_provider"),searchPlaceholder:a("com_ui_select_search_provider"),setValue:t.onChange,items:e.map((e=>({label:"string"==typeof e?e:e.label,value:"string"==typeof e?e:e.value}))),className:Qf(n?"border-2 border-red-500":""),ariaLabel:a("com_ui_provider"),isCollapsed:!1,showCarat:!0}),n&&l.jsx("span",{className:"model-panel-error text-sm text-red-500 transition duration-300 ease-in-out",children:a("com_ui_field_required")})]})}})]}),l.jsxs("div",{className:"model-panel-section mb-4",children:[l.jsxs("label",{id:"model-label",className:Qf("text-token-text-primary model-panel-label mb-2 block font-medium",!d&&"text-gray-500 dark:text-gray-400"),htmlFor:"model",children:[a("com_ui_model")," ",l.jsx("span",{className:"text-red-500",children:"*"})]}),l.jsx(Li,{name:"model",control:s,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:t}})=>l.jsxs(l.Fragment,{children:[l.jsx(Mr,{selectedValue:e.value||"",selectPlaceholder:a(d?"com_ui_select_model":"com_ui_select_provider_first"),searchPlaceholder:a("com_ui_select_model"),setValue:e.onChange,items:u.map((e=>({label:e,value:e}))),disabled:!d,className:Qf("disabled:opacity-50",t?"border-2 border-red-500":""),ariaLabel:a("com_ui_model"),isCollapsed:!1,showCarat:!0}),d&&t&&l.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:a("com_ui_field_required")})]})})]})]}),g&&l.jsx("div",{className:"h-auto max-w-full overflow-x-hidden p-2",children:l.jsx("div",{className:"grid grid-cols-2 gap-4",children:g.map((e=>{const t=uI[e.component];if(!t)return null;const{key:n,default:a,...s}=e;return"region"===n&&p.length&&(s.options=p),l.jsx(t,{settingKey:n,defaultValue:a,...s,setOption:x,conversation:c},n)}))})}),l.jsxs("button",{type:"button",onClick:()=>{r("model_parameters",{})},className:"btn btn-neutral my-1 flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[l.jsx(Je,{className:"h-4 w-4","aria-hidden":"true"}),a("com_ui_reset_var",{0:a("com_ui_model_parameters")})]})]})}const iR=new Set(["avatar_action","avatar_file","avatar_preview"]),lR=new Set(["agent"]),cR=e=>"object"==typeof e&&null!==e,dR=e=>{let t=!1;for(const[n,a]of Object.entries(e))if(a&&!lR.has(n))if(cR(a)){const e=dR(a);if(!e.onlyAvatarDirty)return{sawDirty:!0,onlyAvatarDirty:!1};t=t||e.sawDirty}else if(t=!0,!iR.has(n))return{sawDirty:!0,onlyAvatarDirty:!1};return{sawDirty:t,onlyAvatarDirty:!0}},uR=e=>{if(!e)return!1;const t=dR(e);return t.sawDirty&&t.onlyAvatarDirty};function mR(){var e,t;const n=qN(),{user:a}=nk(),{showToast:s}=Ds(),{activePanel:r,agentsConfig:o,setActivePanel:i,endpointsConfig:c,setCurrentAgentId:d,agent_id:u}=lk(),{onSelect:m}=function(){const e=xs(),t=zN(),{conversation:n,newConversation:a}=$N(),s=WN(),[r,o]=ja((null==n?void 0:n.agent_id)??null),i=A_(r),l=ka(((e,s)=>{if(cx.log("conversation","Updating conversation with agent",e),lc(null==n?void 0:n.endpoint))return void a({template:{...s},preset:s});const r=t({conversation:{...n??{},agent_id:e.id},preset:s});a({template:r,preset:s,keepLatestMessage:!0})}),[n,t,a]);return{onSelect:ka((async t=>{const n=null==s?void 0:s[t];if(!n)return;o(n.id);const a={endpoint:Yl.agents,agent_id:n.id,conversationId:Bm.NEW_CONVO};l({id:n.id},a);try{await e.invalidateQueries({queryKey:[Fh.agent,n.id],exact:!0,refetchType:"active"},{throwOnError:!0});const{data:t}=await i.refetch();t&&l(t,{...a,agent_id:t.id})}catch(r){if(null==r?void 0:r.silent)return void console.warn("Current fetch was cancelled");console.error("Error fetching full agent data:",r),l({},{...a,agent_id:void 0})}}),[s,l,e,i])}}(),p=jN(),h=A_(u),{hasPermission:g,isLoading:x}=eT(Ph.AGENT,(null==(e=h.data)?void 0:e._id)||""),f=g(Oh.EDIT),v=P_(u??"",{enabled:!Zg(u)&&f&&!x}),_=f&&v.data?v:h,b=Ca((()=>p.data??{}),[p.data]),y=Oi({defaultValues:Ox(),mode:"onChange"}),{control:j,handleSubmit:w,reset:N,getValues:k,setValue:C,formState:{dirtyFields:S}}=y,[T,E]=ja(!1),I=z_({onSuccess:e=>{var t;s({message:n("com_ui_upload_agent_avatar")}),C("avatar_preview",(null==(t=e.avatar)?void 0:t.filepath)??"",{shouldDirty:!1}),C("avatar_file",null,{shouldDirty:!1}),C("avatar_action",null,{shouldDirty:!1});const a=k("agent");a&&"string"!=typeof a&&C("agent",{...a,...e},{shouldDirty:!1})},onError:()=>{s({message:n("com_ui_upload_error"),status:"error"})}}),R=ka((async e=>{const t=k("avatar_action"),n=k("avatar_file");if(!e||Zg(e)||"upload"!==t||!n)return!1;E(!0);try{return await async function({agentId:e,avatarActionState:t,avatarFile:n,uploadAvatar:a}){if(!e||Zg(e))return!1;if("upload"!==t||!n)return!1;const s=new FormData;return s.append("file",n,n.name),await a({agent_id:e,formData:s}),!0}({agentId:e,avatarActionState:t,avatarFile:n,uploadAvatar:I.mutateAsync})}catch(a){throw console.error("[AgentPanel] Avatar upload failed",a),a}finally{E(!1)}}),[k,I]),A=Di({control:j,name:"id"}),P=ba(),O=Ca((()=>new Set(null==o?void 0:o.allowedProviders)),[null==o?void 0:o.allowedProviders]),L=Ca((()=>Object.keys(c??{}).filter((e=>!lc(e)&&(!(O.size>0)||O.has(e))&&e!==Yl.agents)).map((e=>Px(e)))),[c,O]),M=D_({onMutate:()=>{var e;P.current=null==(e=_.data)?void 0:e.version},onSuccess:async e=>{const t=k("avatar_action"),a=void 0!==P.current&&e.version===P.current,r=function(e,t,n,a){return e&&"upload"===t?null:e?a("com_ui_no_changes"):a("com_assistants_update_success_name",{name:n??a("com_ui_agent")})}(a,t,e.name,n);r&&s({message:r,status:a?"info":void 0});const o=k("agent");o&&"string"!=typeof o&&C("agent",{...o,...e},{shouldDirty:!1});try{await R(e.id??A)}catch(i){console.error("[AgentPanel] Avatar upload failed after update",i),s({message:n("com_agents_avatar_upload_error"),status:"error"})}"reset"===t&&(C("avatar_action",null,{shouldDirty:!1}),C("avatar_file",null,{shouldDirty:!1}),C("avatar_preview","",{shouldDirty:!1})),P.current=void 0},onError:e=>{const t=e;s({message:`${n("com_agents_update_error")}${t.message?` ${n("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),D=M_({onSuccess:async e=>{d(e.id),s({message:`${n("com_assistants_create_success")} ${e.name??n("com_ui_agent")}`});try{await R(e.id)}catch(t){console.error("[AgentPanel] Avatar upload failed after create",t),s({message:n("com_agents_avatar_upload_error"),status:"error"})}},onError:e=>{const t=e;s({message:`${n("com_agents_create_error")}${t.message?` ${n("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),F=ka((async e=>{const t=e.tools??[];!0===e.execute_code&&t.push(Nl.execute_code),!0===e.file_search&&t.push(Nl.file_search),!0===e.web_search&&t.push(Nl.web_search);const{payload:a,provider:r,model:o}=function(e,t){const{name:n,artifacts:a,description:s,instructions:r,model:o,model_parameters:i,provider:l,agent_ids:c,edges:d,end_after_tools:u,hide_sequential_outputs:m,recursion_limit:p,category:h,support_contact:g,avatar_action:x}=e,f="reset"===x&&Boolean(t)&&!Zg(t),v=o??"",_=("string"==typeof l?l:l.value)??"";return{payload:{name:n,artifacts:a,description:s,instructions:r,model:v,provider:_,model_parameters:i,agent_ids:c,edges:d,end_after_tools:u,hide_sequential_outputs:m,recursion_limit:p,category:h,support_contact:g,...f?{avatar:null}:{}},provider:_,model:v}}(e,A);if(!A)return r&&o?e.name?void D.mutate({...a,model:o,tools:t,provider:r}):s({message:n("com_agents_missing_name"),status:"error"}):s({message:n("com_agents_missing_provider_model"),status:"error"});if("upload"===e.avatar_action&&uR(S))try{await R(A)||s({message:n("com_agents_avatar_upload_error"),status:"error"})}catch(i){console.error("[AgentPanel] Avatar upload failed for avatar-only submission",i),s({message:n("com_agents_avatar_upload_error"),status:"error"})}else M.mutate({agent_id:A,data:{...a,tools:t}})}),[A,D,S,R,M,s,n]),U=ka((()=>{A&&m(A)}),[A,m]),z=Ca((()=>{var e;return!(null==(e=_.data)?void 0:e.id)||((null==a?void 0:a.role)===gh.ADMIN||f)}),[null==(t=_.data)?void 0:t.id,null==a?void 0:a.role,f]);return l.jsx(Mi,{...y,children:l.jsxs("form",{onSubmit:w(F),className:"scrollbar-gutter-stable h-auto w-full flex-shrink-0 overflow-x-visible","aria-label":"Agent configuration form",children:[l.jsxs("div",{className:"mx-1 mt-2 flex w-full flex-wrap gap-2",children:[l.jsx("div",{className:"w-full",children:l.jsx(JI,{createMutation:D,agentQuery:_,setCurrentAgentId:d,selectedAgentId:_.isInitialLoading?null:u??null})}),A&&l.jsxs("div",{className:"flex w-full gap-2",children:[l.jsxs(Ys,{type:"button",variant:"outline",className:"w-full justify-center",onClick:()=>{N(Ox()),d(void 0)},disabled:_.isInitialLoading,"aria-label":n("com_ui_create_new_agent"),children:[l.jsx(Re,{className:"mr-1 h-4 w-4","aria-hidden":"true"}),n("com_ui_create_new_agent")]}),l.jsx(Ys,{variant:"submit",disabled:Zg(A)||_.isInitialLoading,onClick:e=>{e.preventDefault(),U()},"aria-label":n("com_ui_select_agent"),children:n("com_ui_select")})]})]}),_.isInitialLoading&&l.jsx(wE,{}),!z&&!_.isInitialLoading&&l.jsx("div",{className:"flex h-[30vh] w-full items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-token-text-primary m-2 text-xl font-semibold",children:n("com_agents_not_available")}),l.jsx("p",{className:"text-token-text-secondary",children:n("com_agents_no_access")})]})}),z&&!_.isInitialLoading&&r===rx.model&&l.jsx(oR,{models:b,providers:L,setActivePanel:i}),z&&!_.isInitialLoading&&r===rx.builder&&l.jsx(YI,{}),z&&!_.isInitialLoading&&r===rx.advanced&&l.jsx(DE,{}),z&&!_.isInitialLoading&&l.jsx(rR,{createMutation:D,updateMutation:M,isAvatarUploading:T||I.isPending,activePanel:r,setActivePanel:i,setCurrentAgentId:d})]})})}function pR(){return l.jsx(ck,{children:l.jsx(hR,{})})}function hR(){const{conversation:e}=$N(),{activePanel:t,setCurrentAgentId:n}=lk();return ya((()=>{const t=(null==e?void 0:e.agent_id)??"";Zg(t)||n(t)}),[n,null==e?void 0:e.agent_id]),t===rx.actions?l.jsx(jE,{}):t===rx.version?l.jsx(mE,{}):l.jsx(mR,{})}const gR=({bookmark:e,tabIndex:t=0,onFocus:n,onBlur:a})=>{const s=qN(),{showToast:r}=Ds(),[o,i]=ja(!1),c=Sb({onSuccess:()=>{r({message:s("com_ui_bookmarks_delete_success")})},onError:()=>{r({message:s("com_ui_bookmarks_delete_error"),severity:lx.ERROR})}}),d=ka((async()=>{await c.mutateAsync(e)}),[e,c]);return l.jsx(l.Fragment,{children:l.jsxs(rr,{open:o,onOpenChange:i,children:[l.jsx(or,{asChild:!0,children:l.jsx(pr,{description:s("com_ui_delete"),render:l.jsx(Ys,{variant:"ghost","aria-label":s("com_ui_bookmarks_delete"),tabIndex:t,onFocus:n,onBlur:a,onClick:()=>i(!o),className:"h-8 w-8 p-0",children:l.jsx(yr,{})})})}),l.jsx(hr,{showCloseButton:!1,title:s("com_ui_bookmarks_delete"),className:"w-11/12 max-w-lg",main:l.jsxs(er,{className:"text-left text-sm font-medium",children:[s("com_ui_bookmark_delete_confirm")," ",e]}),selection:{selectHandler:d,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:s("com_ui_delete")}})]})})},xR=({tags:e,bookmark:t,mutation:n,conversationId:a,setOpen:s,formRef:r})=>{const o=qN(),i=xs(),{showToast:c}=Ds(),{bookmarks:d}=Nk(),{register:u,handleSubmit:m,setValue:p,getValues:h,control:g,formState:{errors:x}}=Oi({mode:"onBlur",reValidateMode:"onChange",defaultValues:{tag:(null==t?void 0:t.tag)??"",description:(null==t?void 0:t.description)??"",conversationId:a??"",addToConversation:!(null==a||!a)}});ya((()=>{t&&t.tag&&(p("tag",t.tag),p("description",t.description??""))}),[t,p]);return l.jsx("form",{ref:r,className:"mt-6","aria-label":"Bookmark form",method:"POST",onSubmit:m((a=>{if(cx.log("tag_mutation","BookmarkForm - onSubmit: data",a),n.isLoading)return;if(a.tag===(null==t?void 0:t.tag)&&a.description===(null==t?void 0:t.description))return;if(null!=a.tag&&(e??[]).includes(a.tag))return void c({message:o("com_ui_bookmarks_create_exists"),status:"warning"});(i.getQueryData([Fh.conversationTags])??[]).some((e=>e.tag===a.tag&&e.tag!==(null==t?void 0:t.tag)))?c({message:o("com_ui_bookmarks_create_exists"),status:"warning"}):(n.mutate(a),s(!1))})),children:l.jsxs("div",{className:"flex w-full flex-col items-center gap-2",children:[l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(er,{htmlFor:"bookmark-tag",className:"text-left text-sm font-medium",children:o("com_ui_bookmarks_title")}),l.jsx(kr,{type:"text",id:"bookmark-tag","aria-label":o("com_ui_bookmarks_title"),...u("tag",{required:o("com_ui_field_required"),maxLength:{value:128,message:o("com_ui_field_max_length",{field:o("com_ui_bookmarks_title"),length:128})},validate:e=>e===(null==t?void 0:t.tag)||d.every((t=>t.tag!==e))||o("com_ui_bookmarks_tag_exists")}),"aria-invalid":!!x.tag,placeholder:o(t?"com_ui_bookmarks_edit":"com_ui_bookmarks_new"),"aria-describedby":x.tag?"bookmark-tag-error":void 0}),x.tag&&l.jsx("span",{id:"bookmark-tag-error",role:"alert",className:"text-sm font-bold text-red-500",children:x.tag.message})]}),l.jsxs("div",{className:"mt-4 grid w-full items-center gap-2",children:[l.jsx(er,{id:"bookmark-description-label",htmlFor:"bookmark-description",className:"text-left text-sm font-medium",children:o("com_ui_bookmarks_description")}),l.jsx(Br,{...u("description",{maxLength:{value:1048,message:o("com_ui_field_max_length",{field:o("com_ui_bookmarks_description"),length:1048})}}),id:"bookmark-description",disabled:!1,className:Qf("flex h-10 max-h-[250px] min-h-[100px] w-full resize-none rounded-lg border border-input bg-transparent px-3 py-2 text-sm ring-offset-background focus-visible:outline-none"),"aria-labelledby":"bookmark-description-label"})]}),null!=a&&a&&l.jsxs("div",{className:"mt-2 flex w-full items-center",children:[l.jsx(Li,{name:"addToConversation",control:g,render:({field:e})=>{var t;return l.jsx(jr,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:null==(t=e.value)?void 0:t.toString(),"aria-label":o("com_ui_bookmarks_add_to_conversation")})}}),l.jsx("button",{type:"button","aria-label":o("com_ui_bookmarks_add_to_conversation"),className:"form-check-label w-full cursor-pointer text-text-primary",onClick:()=>p("addToConversation",!h("addToConversation"),{shouldDirty:!0}),children:l.jsx("div",{className:"flex select-none items-center",children:o("com_ui_bookmarks_add_to_conversation")})})]})]})})},fR=({open:e,setOpen:t,tags:n,setTags:a,context:s,bookmark:r,children:o,triggerRef:i,conversationId:c})=>{const d=qN(),u=ba(null),{showToast:m}=Ds(),p=Cb({context:s,tag:null==r?void 0:r.tag,options:{onSuccess:(e,s)=>{if(m({message:d(r?"com_ui_bookmarks_update_success":"com_ui_bookmarks_create_success")}),t(!1),cx.log("tag_mutation","tags before setting",n),a&&!0===s.addToConversation){const e=[...n||[],s.tag].filter((e=>void 0!==e));if(a(e),cx.log("tag_mutation","tags after",e),null==s.tag||""===s.tag)return;setTimeout((()=>{const e=document.getElementById(s.tag??"");console.log("tagElement",e),e&&e.focus()}),5)}},onError:()=>{m({message:d(r?"com_ui_bookmarks_update_error":"com_ui_bookmarks_create_error"),severity:lx.ERROR})}}});return l.jsxs(rr,{open:e,onOpenChange:t,triggerRef:i,children:[o,l.jsx(hr,{title:d(r?"com_ui_bookmarks_edit":"com_ui_bookmarks_new"),showCloseButton:!1,className:"w-11/12 md:max-w-2xl",main:l.jsx(xR,{tags:n,setOpen:t,mutation:p,conversationId:c,bookmark:r,formRef:u}),buttons:l.jsx(Ys,{variant:"submit",type:"submit",disabled:p.isLoading,onClick:()=>{u.current&&u.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},className:"text-white",children:p.isLoading?l.jsx(Xs,{}):d("com_ui_save")})})]})},vR=({bookmark:e,tabIndex:t=0,onFocus:n,onBlur:a})=>{const s=qN(),[r,o]=ja(!1);return l.jsx(fR,{context:"EditBookmarkButton",bookmark:e,open:r,setOpen:o,children:l.jsx(or,{asChild:!0,children:l.jsx(pr,{description:s("com_ui_edit"),render:l.jsx(Ys,{variant:"ghost","aria-label":s("com_ui_bookmarks_edit"),tabIndex:t,onFocus:n,onBlur:a,onClick:()=>o(!r),className:"h-8 w-8 p-0",children:l.jsx(Zr,{})})})})})},_R=({row:e,moveRow:t,position:n})=>{const a=ba(null),s=Cb({context:"BookmarkTableRow",tag:e.tag}),r=qN(),{showToast:o}=Ds(),[,i]=ls({accept:"bookmark",drop:t=>{s.mutate({...e,position:t.index},{onSuccess:()=>{o({message:r("com_ui_bookmarks_update_success"),severity:lx.SUCCESS})},onError:()=>{o({message:r("com_ui_bookmarks_update_error"),severity:lx.ERROR})}})},hover(e){a.current&&e.index!==n&&(t(e.index,n),e.index=n)}}),[{isDragging:c},d]=ds({type:"bookmark",item:{index:n},collect:e=>({isDragging:e.isDragging()})});return d(i(a)),l.jsxs(eo,{ref:a,className:"cursor-move hover:bg-surface-secondary",style:{opacity:c?.5:1},children:[l.jsx(to,{className:"w-[70%] px-4 py-4",children:l.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:e.tag})}),l.jsx(to,{className:"w-[10%] px-12 py-4",children:e.count}),l.jsx(to,{className:"w-[20%] px-4 py-4",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(vR,{bookmark:e,tabIndex:0}),l.jsx(gR,{bookmark:e.tag,tabIndex:0})]})})]})},bR=()=>{const e=qN(),[t,n]=ja([]),[a,s]=ja(0),[r,o]=ja(""),[i,c]=ja(!1),{bookmarks:d=[]}=Nk();ya((()=>{const e=(e=>{const t=new Set;return e.filter((e=>{const n=t.has(e._id);return t.add(e._id),!n}))})(d).sort(((e,t)=>e.position-t.position));n(e)}),[d]);const u=ka(((e,t)=>{n((n=>{const a=[...n],[s]=a.splice(e,1);return a.splice(t,0,s),a.map(((e,t)=>({...e,position:t})))}))}),[]),m=ka((e=>l.jsx(_R,{moveRow:u,row:e,position:e.position},e._id)),[u]),p=t.filter((e=>e.tag&&e.tag.toLowerCase().includes(r.toLowerCase()))),h=p.slice(10*a,10*(a+1));return l.jsx(wk.Provider,{value:{bookmarks:d},children:l.jsxs("div",{role:"region","aria-label":e("com_ui_bookmarks"),className:"mt-2 space-y-2",children:[l.jsxs("div",{className:"relative flex items-center gap-4",children:[l.jsx(kr,{id:"bookmarks-filter",placeholder:" ",value:r,onChange:e=>o(e.target.value),"aria-label":e("com_ui_bookmarks_filter"),className:"peer"}),l.jsx("label",{htmlFor:"bookmarks-filter",className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-sm text-text-secondary transition-all duration-200 peer-focus:top-0 peer-focus:bg-background peer-focus:px-1 peer-focus:text-xs peer-[:not(:placeholder-shown)]:top-0 peer-[:not(:placeholder-shown)]:bg-background peer-[:not(:placeholder-shown)]:px-1 peer-[:not(:placeholder-shown)]:text-xs",children:e("com_ui_bookmarks_filter")})]}),l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:l.jsxs(no,{className:"w-full table-fixed",children:[l.jsx(ao,{children:l.jsxs(eo,{className:"border-b border-border-light",children:[l.jsx(so,{className:"w-[70%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:e("com_ui_bookmarks_title")})}),l.jsx(so,{className:"w-[30%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:e("com_ui_bookmarks_count")})}),l.jsx(so,{className:"w-[40%] bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:e("com_assistants_actions")})})]})}),l.jsx(ro,{children:h.length?h.map(m):l.jsx(eo,{children:l.jsx(to,{colSpan:3,className:"h-24 text-center text-sm text-text-secondary",children:e("com_ui_no_bookmarks")})})})]})}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex justify-between gap-2",children:l.jsx(fR,{context:"BookmarkPanel",open:i,setOpen:c,children:l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{variant:"outline",size:"sm",className:"w-full gap-2 text-sm","aria-label":e("com_ui_bookmarks_new"),onClick:()=>c(!i),children:[l.jsx(Ze,{className:"size-4","aria-hidden":"true"}),l.jsx("div",{className:"break-all",children:e("com_ui_bookmarks_new")})]})})})}),l.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(Ys,{variant:"outline",size:"sm",onClick:()=>s((e=>Math.max(e-1,0))),disabled:0===a,"aria-label":e("com_ui_prev"),children:e("com_ui_prev")}),l.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${a+1} / ${Math.ceil(p.length/10)}`}),l.jsx(Ys,{variant:"outline",size:"sm",onClick:()=>s((e=>10*(e+1)<p.length?e+1:e)),disabled:10*(a+1)>=p.length,"aria-label":e("com_ui_next"),children:e("com_ui_next")})]})]})]})})},yR=()=>{const{data:e}=xb();return l.jsx("div",{className:"h-auto max-w-full overflow-x-visible",children:l.jsx(wk.Provider,{value:{bookmarks:e||[]},children:l.jsx(bR,{})})})};function jR({open:e,onOpenChange:t,children:n,triggerRef:a}){const s=qN(),{showToast:r}=Ds(),o=ak({permissionType:Pp.MEMORIES,permission:Op.CREATE}),{mutate:i,isLoading:c}=nb({onSuccess:()=>{r({message:s("com_ui_memory_created"),status:"success"}),t(!1),u(""),p(""),setTimeout((()=>{var e;null==(e=null==a?void 0:a.current)||e.focus()}),0)},onError:e=>{var t,n,a;let o=s("com_ui_error");if(e&&"object"==typeof e&&"response"in e){const r=e;(null==(n=null==(t=r.response)?void 0:t.data)?void 0:n.error)&&(o=r.response.data.error,409===(null==(a=r.response)?void 0:a.status)||o.includes("already exists")?o=s("com_ui_memory_key_exists"):o.includes("lowercase letters and underscores")&&(o=s("com_ui_memory_key_validation")))}else e.message&&(o=e.message);r({message:o,status:"error"})}}),[d,u]=ja(""),[m,p]=ja(""),h=()=>{o&&(d.trim()&&m.trim()?i({key:d.trim(),value:m.trim()}):r({message:s("com_ui_field_required"),status:"error"}))},g=e=>{"Enter"===e.key&&e.ctrlKey&&o&&h()};return l.jsxs(rr,{open:e,onOpenChange:t,triggerRef:a,children:[n,l.jsx(hr,{title:s("com_ui_create_memory"),showCloseButton:!1,className:"max-h-[90vh] w-11/12 overflow-y-auto md:max-w-lg",main:l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(er,{htmlFor:"memory-key",className:"text-sm font-medium",children:s("com_ui_key")}),l.jsx(kr,{id:"memory-key",value:d,onChange:e=>u(e.target.value),onKeyDown:g,placeholder:s("com_ui_enter_key"),className:"w-full"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(er,{htmlFor:"memory-value",className:"text-sm font-medium",children:s("com_ui_value")}),l.jsx("textarea",{id:"memory-value",value:m,onChange:e=>p(e.target.value),onKeyDown:g,placeholder:s("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3})]})]}),buttons:l.jsx(Ys,{type:"button",variant:"submit",onClick:h,disabled:c||!d.trim()||!m.trim(),className:"text-white","aria-label":s("com_ui_create_memory"),children:c?l.jsx(Xs,{className:"size-4"}):s("com_ui_create")})})]})}function wR({memory:e,open:t,onOpenChange:n,children:a,triggerRef:s}){const r=qN(),{showToast:o}=Ds(),{data:i}=eb(),c=ak({permissionType:Pp.MEMORIES,permission:Op.UPDATE}),{mutate:d,isLoading:u}=(e=>{const t=xs();return fs((({key:e,value:t,originalKey:n})=>Jh.updateMemory(e,t,n)),{...e,onSuccess:(...n)=>{var a;t.invalidateQueries([Fh.memories]),null==(a=null==e?void 0:e.onSuccess)||a.call(e,...n)}})})({onMutate:()=>{n(!1),setTimeout((()=>{var e;null==(e=null==s?void 0:s.current)||e.focus()}),0)},onSuccess:()=>{o({message:r("com_ui_saved"),status:"success"})},onError:e=>{var t,n,a;let s=r("com_ui_error");if(e&&"object"==typeof e&&"response"in e){const o=e;(null==(n=null==(t=o.response)?void 0:t.data)?void 0:n.error)&&(s=o.response.data.error,409===(null==(a=o.response)?void 0:a.status)||s.includes("already exists")?s=r("com_ui_memory_key_exists"):s.includes("lowercase letters and underscores")&&(s=r("com_ui_memory_key_validation")))}else e.message&&(s=e.message);o({message:s,status:"error"})}}),[m,p]=ja(""),[h,g]=ja(""),[x,f]=ja("");ya((()=>{e&&(p(e.key),g(e.value),f(e.key))}),[e]);const v=()=>{c&&e&&(m.trim()&&h.trim()?d({key:m.trim(),value:h.trim(),...x!==m.trim()&&{originalKey:x}}):o({message:r("com_ui_field_required"),status:"error"}))},_=e=>{"Enter"===e.key&&e.ctrlKey&&c&&v()};return l.jsxs(rr,{open:t,onOpenChange:n,triggerRef:s,children:[a,l.jsx(hr,{title:r(c?"com_ui_edit_memory":"com_ui_view_memory"),showCloseButton:!1,className:"w-11/12 md:max-w-lg",main:l.jsxs("div",{className:"space-y-4",children:[e&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary",children:[l.jsxs("div",{children:[r("com_ui_date"),":"," ",new Date(e.updated_at).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),void 0!==e.tokenCount&&l.jsxs("div",{children:[e.tokenCount.toLocaleString(),(null==i?void 0:i.tokenLimit)&&` / ${i.tokenLimit.toLocaleString()}`," ",r(1===e.tokenCount?"com_ui_token":"com_ui_tokens")]})]}),(null==i?void 0:i.tokenLimit)&&null!==(null==i?void 0:i.usagePercentage)&&l.jsxs("div",{className:"text-xs text-text-secondary",children:[r("com_ui_usage"),": ",i.usagePercentage,"%"," "]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(er,{htmlFor:"memory-key",className:"text-sm font-medium",children:r("com_ui_key")}),l.jsx(kr,{id:"memory-key",value:m,onChange:e=>c&&p(e.target.value),onKeyDown:_,placeholder:r("com_ui_enter_key"),className:"w-full",disabled:!c})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(er,{htmlFor:"memory-value",className:"text-sm font-medium",children:r("com_ui_value")}),l.jsx("textarea",{id:"memory-value",value:h,onChange:e=>c&&g(e.target.value),onKeyDown:_,placeholder:r("com_ui_enter_value"),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",rows:3,disabled:!c})]})]}),buttons:c?l.jsx(Ys,{type:"button",variant:"submit",onClick:v,"aria-label":r("com_ui_save"),disabled:u||!m.trim()||!h.trim(),className:"text-white",children:u?l.jsx(Xs,{className:"size-4"}):r("com_ui_save")}):null})]})}const NR=({control:e,memoryPerm:t,label:n})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,l.jsx(Li,{name:t,control:e,render:({field:e})=>l.jsx(dr,{...e,checked:e.value,onCheckedChange:e.onChange,value:e.value.toString(),"aria-label":n})})]}),kR=()=>{const e=qN(),{user:t,roles:n}=nk(),{showToast:a}=Ds(),{mutate:s,isLoading:r}=(e=>{const t=xs(),{onMutate:n,onSuccess:a,onError:s}=e??{};return fs((e=>(vh.partial().parse(e.updates),Jh.updateMemoryPermissions(e))),{onSuccess:(e,n,s)=>{t.invalidateQueries([Fh.roles,n.roleName]),a&&a(e,n,s)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update memory permissions:",t),s&&s(...e)},onMutate:n})})({onSuccess:()=>{a({status:"success",message:e("com_ui_saved")})},onError:()=>{a({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[o,i]=ja(!1),[c,d]=ja(gh.USER),u=Ca((()=>{var e,t,a;return(null==(e=null==n?void 0:n[c])?void 0:e.permissions)?null==(a=null==(t=null==n?void 0:n[c])?void 0:t.permissions)?void 0:a[Pp.MEMORIES]:Dh[c].permissions[Pp.MEMORIES]}),[n,c]),{reset:m,control:p,setValue:h,getValues:g,handleSubmit:x,formState:{isSubmitting:f}}=Oi({mode:"onChange",defaultValues:u});if(ya((()=>{var e,t,a,s;(null==(t=null==(e=null==n?void 0:n[c])?void 0:e.permissions)?void 0:t[Pp.MEMORIES])?m(null==(s=null==(a=null==n?void 0:n[c])?void 0:a.permissions)?void 0:s[Pp.MEMORIES]):m(Dh[c].permissions[Pp.MEMORIES])}),[n,c,m]),(null==t?void 0:t.role)!==gh.ADMIN)return null;const v=[{memoryPerm:Op.USE,label:e("com_ui_memories_allow_use")},{memoryPerm:Op.CREATE,label:e("com_ui_memories_allow_create")},{memoryPerm:Op.UPDATE,label:e("com_ui_memories_allow_update")},{memoryPerm:Op.READ,label:e("com_ui_memories_allow_read")},{memoryPerm:Op.OPT_OUT,label:e("com_ui_memories_allow_opt_out")}],_=[{label:gh.USER,onClick:()=>{d(gh.USER)}},{label:gh.ADMIN,onClick:()=>{d(gh.ADMIN)}}];return l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{size:"sm",variant:"outline",className:"btn btn-neutral border-token-border-light relative h-9 w-full gap-1 rounded-lg font-medium focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-text-primary","aria-label":e("com_ui_admin_settings"),children:[l.jsx(ae,{className:"cursor-pointer","aria-hidden":"true"}),e("com_ui_admin_settings")]})}),l.jsxs(ir,{className:"border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[l.jsx(lr,{children:e("com_ui_admin_settings_section",{section:e("com_ui_memories")})}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(cr,{unmountOnHide:!0,menuId:"memory-role-dropdown",isOpen:o,setIsOpen:i,trigger:l.jsx(se,{className:"inline-flex w-1/4 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:c}),items:_,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:x((e=>{s({roleName:c,updates:e})})),children:[l.jsx("div",{className:"py-5",children:v.map((({memoryPerm:t,label:n})=>l.jsxs("div",{children:[l.jsx(NR,{control:p,memoryPerm:t,label:n,getValues:g,setValue:h}),c===gh.ADMIN&&t===Op.USE&&l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[l.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",l.jsx("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"text-blue-500 underline",children:e("com_ui_more_info")})]})})]},t)))}),l.jsx("div",{className:"flex justify-end",children:l.jsx("button",{type:"submit",disabled:f||r,className:"btn rounded bg-green-500 font-bold text-white transition-all hover:bg-green-600 focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-text-primary",children:e("com_ui_save")})})]})]})]})]})},CR=({memory:e})=>{const t=qN(),[n,a]=ja(!1),s=ba(null);return l.jsx(wR,{open:n,memory:e,onOpenChange:a,triggerRef:s,children:l.jsx(or,{asChild:!0,children:l.jsx(pr,{description:t("com_ui_edit_memory"),render:l.jsx(Ys,{variant:"ghost","aria-label":t("com_ui_bookmarks_edit"),onClick:()=>a(!n),className:"h-8 w-8 p-0",children:l.jsx(Zr,{})})})})})},SR=({memory:e})=>{const t=qN(),{showToast:n}=Ds(),[a,s]=ja(!1),{mutate:r}=(()=>{const e=xs();return fs((e=>Jh.deleteMemory(e)),{onSuccess:()=>{e.invalidateQueries([Fh.memories])}})})(),[o,i]=ja(null);return l.jsxs(rr,{open:a,onOpenChange:s,children:[l.jsx(or,{asChild:!0,children:l.jsx(pr,{description:t("com_ui_delete_memory"),render:l.jsx(Ys,{variant:"ghost","aria-label":t("com_ui_delete"),onClick:()=>s(!a),className:"h-8 w-8 p-0",children:o===e.key?l.jsx(Xs,{className:"size-4 animate-spin"}):l.jsx(yr,{className:"size-4"})})})}),l.jsx(hr,{showCloseButton:!1,title:t("com_ui_delete_memory"),className:"w-11/12 max-w-lg",main:l.jsx(er,{className:"text-left text-sm font-medium",children:l.jsx(Ai,{i18nKey:"com_ui_delete_confirm_strong",values:{title:e.key},components:{strong:l.jsx("strong",{})}})}),selection:{selectHandler:async()=>{i(e.key),r(e.key,{onSuccess:()=>{n({message:t("com_ui_deleted"),status:"success"}),s(!1)},onError:()=>n({message:t("com_ui_error"),status:"error"}),onSettled:()=>i(null)})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white",selectText:t("com_ui_delete")}})]})},TR=10;function ER(){var e;const t=qN(),{user:n}=nk(),{data:a}=C_(),{data:s,isLoading:r}=eb(),{showToast:o}=Ds(),[i,c]=ja(0),[d,u]=ja(""),[m,p]=ja(!1),[h,g]=ja(!0),x=tb({onSuccess:()=>{o({message:t("com_ui_preferences_updated"),status:"success"})},onError:()=>{o({message:t("com_ui_error_updating_preferences"),status:"error"}),g((e=>!e))}});ya((()=>{var e;void 0!==(null==(e=null==a?void 0:a.personalization)?void 0:e.memories)&&g(a.personalization.memories)}),[null==(e=null==a?void 0:a.personalization)?void 0:e.memories]);const f=ak({permissionType:Pp.MEMORIES,permission:Op.READ}),v=ak({permissionType:Pp.MEMORIES,permission:Op.UPDATE}),_=ak({permissionType:Pp.MEMORIES,permission:Op.CREATE}),b=ak({permissionType:Pp.MEMORIES,permission:Op.OPT_OUT}),y=Ca((()=>(null==s?void 0:s.memories)??[]),[s]),j=Ca((()=>et(y,d,{keys:["key","value"]})),[y,d]),w=Ca((()=>j.slice(i*TR,(i+1)*TR)),[j,i]);return r?l.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:l.jsx(Xs,{})}):f?l.jsx("div",{className:"flex h-full w-full flex-col",children:l.jsxs("div",{role:"region","aria-label":t("com_ui_memories"),className:"mt-2 space-y-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx(kr,{id:"memory-search",placeholder:" ",value:d,onChange:e=>u(e.target.value),"aria-label":t("com_ui_memories_filter"),className:"peer"}),l.jsx(er,{htmlFor:"memory-search",className:"pointer-events-none absolute -top-1 left-3 w-auto origin-[0] translate-y-3 scale-100 rounded bg-background px-1 text-base text-text-secondary transition-transform duration-200 peer-placeholder-shown:translate-y-3 peer-placeholder-shown:scale-100 peer-focus:-translate-y-2 peer-focus:scale-75 peer-focus:text-text-primary peer-[:not(:placeholder-shown)]:-translate-y-2 peer-[:not(:placeholder-shown)]:scale-75",children:t("com_ui_memories_filter")})]}),((null==s?void 0:s.tokenLimit)||b)&&l.jsxs("div",{className:Qf("flex items-center rounded-lg",null!=(null==s?void 0:s.tokenLimit)&&b?"justify-between":"justify-end"),children:[(null==s?void 0:s.tokenLimit)&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("div",{className:"relative size-10",children:[l.jsxs("svg",{className:"size-10 -rotate-90 transform",children:[l.jsx("circle",{cx:"20",cy:"20",r:"16",stroke:"currentColor",strokeWidth:"3",fill:"none",className:"text-gray-200 dark:text-gray-700"}),l.jsx("circle",{cx:"20",cy:"20",r:"16",strokeWidth:"3",fill:"none",strokeDasharray:""+2*Math.PI*16,strokeDashoffset:""+2*Math.PI*16*(1-(s.usagePercentage??0)/100),className:"transition-all "+(N=s.usagePercentage??0,N>90?"stroke-red-500":N>75?"stroke-yellow-500":"stroke-green-500"),strokeLinecap:"round"})]}),l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsxs("span",{className:"text-xs font-medium",children:[s.usagePercentage,"%"]})})]}),l.jsx("div",{className:"text-sm text-text-secondary",children:t("com_ui_usage")})]}),b&&l.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[l.jsx("span",{children:t("com_ui_use_memory")}),l.jsx(dr,{checked:h,onCheckedChange:e=>{g(e),x.mutate({memories:e})},"aria-label":t("com_ui_use_memory"),disabled:x.isLoading})]})]}),_&&l.jsx("div",{className:"flex w-full justify-end",children:l.jsx(jR,{open:m,onOpenChange:p,children:l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{variant:"outline",className:"w-full bg-transparent","aria-label":t("com_ui_create_memory"),children:[l.jsx(Re,{className:"size-4","aria-hidden":"true"}),t("com_ui_create_memory")]})})})}),l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:l.jsxs(no,{className:"w-full table-fixed",children:[l.jsx(ao,{children:l.jsxs(eo,{className:"border-b border-border-light hover:bg-surface-secondary",children:[l.jsx(so,{className:(v?"w-[75%]":"w-[100%]")+" bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{children:t("com_ui_memory")})}),v&&l.jsx(so,{className:"w-[25%] bg-surface-secondary py-3 text-center text-sm font-medium text-text-secondary",children:l.jsx("div",{children:t("com_assistants_actions")})})]})}),l.jsx(ro,{children:w.length?w.map(((e,t)=>l.jsxs(eo,{className:"border-b border-border-light hover:bg-surface-secondary",children:[l.jsx(to,{className:(v?"w-[75%]":"w-[100%]")+" px-4 py-4",children:l.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap text-sm text-text-primary",title:e.value,children:e.value})}),v&&l.jsx(to,{className:"w-[25%] px-4 py-4",children:l.jsxs("div",{className:"flex justify-center gap-2",children:[l.jsx(CR,{memory:e}),l.jsx(SR,{memory:e})]})})]},t))):l.jsx(eo,{children:l.jsx(to,{colSpan:v?2:1,className:"h-24 text-center text-sm text-text-secondary",children:t("com_ui_no_memories")})})})]})}),j.length>TR&&l.jsxs("div",{className:"flex items-center justify-end gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(Ys,{variant:"outline",size:"sm",onClick:()=>c((e=>Math.max(e-1,0))),disabled:0===i,"aria-label":t("com_ui_prev"),children:t("com_ui_prev")}),l.jsx("div",{className:"text-sm","aria-live":"polite",children:`${i+1} / ${Math.ceil(j.length/TR)}`}),l.jsx(Ys,{variant:"outline",size:"sm",onClick:()=>c((e=>(e+1)*TR<j.length?e+1:e)),disabled:(i+1)*TR>=j.length,"aria-label":t("com_ui_next"),children:t("com_ui_next")})]}),(null==n?void 0:n.role)===gh.ADMIN&&l.jsx("div",{className:"mt-4",children:l.jsx(kR,{})})]})}):l.jsx("div",{className:"flex h-full w-full items-center justify-center p-4",children:l.jsx("div",{className:"text-center",children:l.jsx("p",{className:"text-sm text-text-secondary",children:t("com_ui_no_read_access")})})});var N}const IR=({field:e,inputClass:t,labelClass:n})=>{const a=qN(),s=ba([]),r=ba(null),[o,i]=ja(""),c=()=>{if(o.trim()&&e.value.length<Bm.MAX_CONVO_STARTERS){const t=[o,...e.value];e.onChange(t),i("")}},d={transition:"opacity 200ms ease-in-out",opacity:0},u={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0}},m=e.value.length>=Bm.MAX_CONVO_STARTERS,p=a(m?"com_assistants_max_starters_reached":"com_ui_add");return l.jsxs("div",{className:"relative",children:[l.jsx("label",{className:n,htmlFor:"conversation_starters",children:a("com_assistants_conversation_starters")}),l.jsxs("div",{className:"mt-4 space-y-2",children:[l.jsxs("div",{className:"relative",children:[l.jsx("input",{ref:e=>s.current[0]=e,value:o,maxLength:64,className:`${t} pr-10`,type:"text",placeholder:a(m?"com_assistants_max_starters_reached":"com_assistants_conversation_starters_placeholder"),onChange:e=>i(e.target.value),onKeyDown:e=>{var t;"Enter"===e.key&&(e.preventDefault(),m?((t=e.currentTarget).classList.remove("shake"),t.offsetWidth,t.classList.add("shake"),setTimeout((()=>{t.classList.remove("shake")}),200)):c())}}),l.jsx(qi,{nodeRef:r,in:e.value.length<Bm.MAX_CONVO_STARTERS,timeout:200,unmountOnExit:!0,children:e=>l.jsx("div",{ref:r,style:{...d,...u[e],transition:"entering"===e?"none":d.transition},className:"absolute right-1 top-1",children:l.jsx(pr,{side:"top",description:p,"aria-label":p,className:"flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:c,disabled:m,children:l.jsx(Re,{className:"size-4","aria-hidden":"true"})})})})]}),e.value.map(((n,r)=>l.jsxs("div",{className:"relative",children:[l.jsx("input",{ref:e=>s.current[r+1]=e,value:n,onChange:t=>{const n=[...e.value];n[r]=t.target.value,e.onChange(n)},className:`${t} pr-10`,type:"text",maxLength:64}),l.jsx(pr,{side:"top",description:a("com_ui_delete"),"aria-label":a("com_ui_delete"),className:"absolute right-1 top-1 flex size-7 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-surface-hover",onClick:()=>(t=>{const n=e.value.filter(((e,n)=>n!==t));e.onChange(n)})(r),children:l.jsx(re,{className:"size-4","aria-hidden":"true"})})]},r)))]})]})};function RR({isOpen:e,endpoint:t,setIsOpen:n}){const a=qN(),{getValues:s,setValue:r}=Pi(),{data:o}=fb(t),i=cc(t),{maxPage:c,setMaxPage:d,currentPage:u,setCurrentPage:m,itemsPerPage:p,searchChanged:h,setSearchChanged:g,searchValue:x,setSearchValue:f,gridRef:v,handleSearch:_,handleChangePage:b,error:y,setError:j,errorMessage:w,setErrorMessage:N,showPluginAuthForm:k,setShowPluginAuthForm:C,selectedPlugin:S,setSelectedPlugin:T}=CS(),E=TN(),I=e=>{var t,n;j(!0);const a=(null==(n=null==(t=e.response)?void 0:t.data)?void 0:n.message)??"";a&&N(a),setTimeout((()=>{j(!1),N("")}),5e3)},R=e=>{const t=()=>{const t=s("functions").slice();t.push(e.pluginKey),r("functions",t)};if(!e.auth)return t();E.mutate(e,{onError:e=>{I(e)},onSuccess:t}),C(!1)},A=null==o?void 0:o.filter((e=>e.name.toLowerCase().includes(x.toLowerCase())));return ya((()=>{A&&(d(Math.ceil(A.length/p)),h&&(m(1),g(!1)))}),[o,p,x,A,h,d,m,g]),l.jsxs($i,{open:e,onClose:()=>{n(!1),m(1),f("")},className:"relative z-[102]",children:[l.jsx("div",{className:"fixed inset-0 bg-surface-primary opacity-60 transition-opacity dark:opacity-80"}),l.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:l.jsxs(Bi,{className:"relative w-full transform overflow-hidden overflow-y-auto rounded-lg bg-surface-secondary text-left shadow-xl transition-all max-sm:h-full sm:mx-7 sm:my-8 sm:max-w-2xl lg:max-w-5xl xl:max-w-7xl",style:{minHeight:"610px"},children:[l.jsxs("div",{className:"flex items-center justify-between border-b-[1px] border-border-medium px-4 pb-4 pt-5 sm:p-6",children:[l.jsx("div",{className:"flex items-center",children:l.jsxs("div",{className:"text-center sm:text-left",children:[l.jsx(Hi,{className:"text-lg font-medium leading-6 text-text-primary",children:a(i?"com_nav_tool_dialog_agents":"com_nav_tool_dialog")}),l.jsx(Gi,{className:"text-sm text-text-secondary",children:a("com_nav_tool_dialog_description")})]})}),l.jsx("div",{children:l.jsx("div",{className:"sm:mt-0",children:l.jsx("button",{onClick:()=>{n(!1),m(1)},className:"inline-block rounded-full text-text-secondary transition-colors hover:text-text-primary","aria-label":"Close dialog",type:"button",children:l.jsx(re,{"aria-hidden":"true"})})})})]}),y&&l.jsxs("div",{className:"relative m-4 rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",role:"alert",children:[a("com_nav_plugin_auth_error")," ",w]}),k&&l.jsx("div",{className:"p-4 sm:p-6 sm:pt-4",children:l.jsx(zE,{plugin:S,onSubmit:e=>R(e),isEntityTool:!0})}),l.jsxs("div",{className:"p-4 sm:p-6 sm:pt-4",children:[l.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[l.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[l.jsx(_e,{className:"h-6 w-6 text-text-tertiary"}),l.jsx("input",{type:"text",value:x,onChange:_,placeholder:a("com_nav_tool_search"),className:"w-64 rounded border border-border-medium bg-transparent px-2 py-1 text-text-primary focus:outline-none"})]}),l.jsx("div",{ref:v,className:"grid grid-cols-1 grid-rows-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",style:{minHeight:"410px"},children:A&&A.slice((u-1)*p,u*p).map(((e,t)=>l.jsx(BE,{tool:e,isInstalled:s("functions").includes(e.pluginKey),onAddTool:()=>(e=>{C(!1);const t=null==o?void 0:o.find((t=>t.pluginKey===e));T(t);const{authConfig:n,authenticated:a=!1}=t??{};n&&n.length>0&&!a?C(!0):R({pluginKey:e,action:"install",auth:null})})(e.pluginKey),onRemoveTool:()=>(e=>{C(!1),E.mutate({pluginKey:e,action:"uninstall",auth:null,isEntityTool:!0},{onError:e=>{I(e)},onSuccess:()=>{const t=s("functions").filter((t=>t!==e));r("functions",t)}})})(e.pluginKey)},t)))})]}),l.jsx("div",{className:"mt-2 flex flex-col items-center gap-2 sm:flex-row sm:justify-between",children:c>0?l.jsx(FE,{currentPage:u,maxPage:c,onChangePage:b}):l.jsx("div",{style:{height:"21px"}})})]})]})})]})}function AR({control:e,setValue:t}){const n=qN(),a=e=>{t("append_current_datetime",e,{shouldDirty:!0})};return l.jsx("div",{className:"mb-6",children:l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Li,{name:"append_current_datetime",control:e,render:({field:e})=>l.jsx(jr,{...e,id:"append_current_datetime",checked:e.value,onCheckedChange:a,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":"append-date-label"})}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("label",{id:"append-date-label",htmlFor:"append_current_datetime",className:"form-check-label text-token-text-primary w-full cursor-pointer",children:n("com_assistants_append_date")}),l.jsx(Tr,{children:l.jsx(Er,{className:"h-5 w-5 text-gray-500","aria-label":n("com_assistants_append_date_tooltip")})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:n("com_assistants_append_date_tooltip")})})})})]})})})}function PR(){const e=qN(),t=Pi(),{control:n,setValue:a,getValues:s}=t;return l.jsxs("div",{className:"flex items-center",children:[l.jsx(Li,{name:Ru.image_vision,control:n,render:({field:e})=>l.jsx(jr,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":Ru.image_vision})}),l.jsx("label",{id:Ru.image_vision,className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Ru.image_vision,onClick:()=>a(Ru.image_vision,!s(Ru.image_vision),{shouldDirty:!0}),children:l.jsx("div",{className:"flex items-center",children:e("com_assistants_image_vision")})})]})}function OR({version:e,retrievalModels:t}){const n=qN(),a=Pi(),{control:s,setValue:r,getValues:o}=a,i=Di({control:s,name:"model"}),c=Di({control:s,name:"assistant"});Ca((()=>{var e;return"string"==typeof c?[]:null==(e=c.tool_resources)?void 0:e.file_search}),[c]);const d=Ca((()=>!t.has(i)),[i,t]);return ya((()=>{i&&d&&r(Ru.retrieval,!1)}),[i,r,d]),l.jsx(l.Fragment,{children:l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Li,{name:Ru.retrieval,control:s,render:({field:e})=>l.jsx(jr,{...e,checked:e.value,disabled:d,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":Ru.retrieval})}),l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("label",{id:Ru.retrieval,className:Qf("form-check-label text-token-text-primary w-full select-none",d?"cursor-no-drop opacity-50":"cursor-pointer"),htmlFor:Ru.retrieval,onClick:()=>t.has(i)&&r(Ru.retrieval,!o(Ru.retrieval),{shouldDirty:!0}),children:n(1==e?"com_assistants_retrieval":"com_assistants_file_search")}),l.jsx(Tr,{children:l.jsx(Er,{className:"h-5 w-5 text-gray-500"})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,disabled:d,className:"ml-16 w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&n("com_assistants_file_search_info")})})})}),l.jsx(dI,{side:ix.Top,disabled:!d,description:"com_assistants_non_retrieval_model",langCode:!0,sideOffset:20,className:"ml-16"})]})})})}const LR=kl.code_interpreter;function MR({endpoint:e,assistant_id:t,files:n}){const a=qN(),{setFilesLoading:s}=$N(),r=ba(null),[o,i]=ja(new Map),{data:c=null}=Y_({select:e=>wd(e)}),{handleFileChange:d}=BC({additionalMetadata:{assistant_id:t,tool_resource:LR},fileSetter:i});ya((()=>{n&&i(new Map(n))}),[n]);const u=jd({fileConfig:c,endpoint:e,endpointType:e});if((null==u?void 0:u.disabled)??!1)return null;return l.jsx("div",{className:"mb-2 w-full",children:l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsx("div",{className:"rounded-lg text-xs text-text-secondary",children:a("com_assistants_code_interpreter_files")}),l.jsx(TI,{files:o,setFiles:i,assistant_id:t,tool_resource:LR,setFilesLoading:s,Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-9 w-full rounded-lg font-medium",onClick:()=>{var e;r.current&&(r.current.value=""),null==(e=r.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:r,disabled:!t,onChange:d}),a("com_ui_upload_files")]})})})]})})}function DR({version:e}){const t=qN(),n=Pi(),{control:a,setValue:s,getValues:r}=n;return l.jsx(l.Fragment,{children:l.jsx(Cr,{openDelay:50,children:l.jsxs("div",{className:"flex items-center",children:[l.jsx(Li,{name:Ru.code_interpreter,control:a,render:({field:e})=>l.jsx(jr,{...e,checked:e.value,onCheckedChange:e.onChange,className:"relative float-left mr-2 inline-flex h-4 w-4 cursor-pointer",value:e.value.toString(),"aria-labelledby":Ru.code_interpreter})}),l.jsxs("button",{type:"button",className:"flex items-center space-x-2",onClick:()=>s(Ru.code_interpreter,!r(Ru.code_interpreter),{shouldDirty:!0}),children:[l.jsx("label",{id:Ru.code_interpreter,className:"form-check-label text-token-text-primary w-full cursor-pointer",htmlFor:Ru.code_interpreter,children:t("com_assistants_code_interpreter")}),l.jsx(Tr,{children:l.jsx(Er,{className:"h-5 w-5 text-gray-500"})})]}),l.jsx(Ir,{children:l.jsx(Rr,{side:ix.Top,className:"w-80",children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:2==e&&t("com_assistants_code_interpreter_info")})})})})]})})})}function FR({version:e,endpoint:t,codeEnabled:n,retrievalEnabled:a,assistantsConfig:s}){const r=qN(),o=Pi(),{control:i}=o,c=Di({control:i,name:"assistant"}),d=Di({control:i,name:"id"}),u=Ca((()=>"string"==typeof c?[]:c.code_files),[c]),m=Ca((()=>new Set((null==s?void 0:s.retrievalModels)??[])),[s]),p=Ca((()=>{var e;return null==(e=null==s?void 0:s.capabilities)?void 0:e.includes(Ru.image_vision)}),[s]);return l.jsxs("div",{className:"mb-4",children:[l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:r("com_assistants_capabilities")})})}),l.jsxs("div",{className:"flex flex-col items-start gap-2",children:[n&&l.jsx(DR,{version:e}),a&&l.jsx(OR,{endpoint:t,version:e,retrievalModels:m}),p&&1==e&&l.jsx(PR,{}),n&&e&&l.jsx(MR,{assistant_id:d,version:e,endpoint:t,files:u})]})]})}function UR(){return l.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-black",children:l.jsxs("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"text-4xl",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[l.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),l.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})}const zR=({url:e,progress:t=1})=>{const n=2*Math.PI*55,a=n-t*n;return l.jsx("div",{children:l.jsxs("div",{className:"relative h-20 w-20 overflow-hidden rounded-full",children:[l.jsx("img",{src:e,className:"bg-token-surface-secondary dark:bg-token-surface-tertiary h-full w-full rounded-full object-cover",alt:"GPT",width:"80",height:"80",style:{opacity:t<1?.4:1}}),t<1&&l.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:l.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"h-6 w-6",children:[l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 stroke-gray-400",strokeWidth:"10",fill:"transparent",r:"55",cx:"60",cy:"60"}),l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"10",strokeDasharray:`${n} ${n}`,strokeDashoffset:a,fill:"transparent",r:"55",cx:"60",cy:"60",style:{transition:"stroke-dashoffset 0.3s linear"}})]})})]})})};function VR({handleFileChange:e}){const t=ba(null);return l.jsx(Ka,{children:l.jsxs(Wa,{className:"flex min-w-[100px] max-w-xs flex-col rounded-xl border border-gray-400 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-850 dark:text-white",sideOffset:5,children:[l.jsx("div",{role:"menuitem",className:"group m-1.5 flex cursor-pointer gap-2 rounded p-2.5 text-sm hover:bg-gray-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-800 dark:hover:bg-white/5",tabIndex:-1,"data-orientation":"vertical",onClick:()=>{var e;t.current&&(t.current.value=""),null==(e=t.current)||e.click()},children:"Upload Photo"}),l.jsx("input",{accept:"image/png,.png,image/jpeg,.jpg,.jpeg,image/gif,.gif,image/webp,.webp",multiple:!1,type:"file",style:{display:"none"},onChange:e,ref:t,tabIndex:-1})]})})}function $R({endpoint:e,version:t,assistant_id:n,metadata:a,createMutation:s}){const r=xs(),o=Ik(),[i,c]=ja(!1),[d,u]=ja(1),[m,p]=ja(null),[h,g]=ja(null),x=ba(null),{data:f=xd}=Y_({select:e=>wd(e)}),v=qN(),{showToast:_}=Ds(),b=Ca((()=>{var t;return(null==(t=null==o?void 0:o[e][n??""])?void 0:t.model)??""}),[o,e,n]),{mutate:y}=Ob({onMutate:()=>{u(.4)},onSuccess:(t,a)=>{var o,i,l;!0!==a.postCreation?_({message:v("com_ui_upload_success")}):x.current!==(null==(o=s.data)?void 0:o.id)&&(x.current=(null==(i=s.data)?void 0:i.id)??""),p(null),g(null==(l=t.metadata)?void 0:l.avatar);const c=r.getQueryData([Fh.assistants,e,Dl]);if(!(null==c?void 0:c.data)||!c)return;const d=c.data.map((e=>e.id===n?{...e,...t}:e));r.setQueryData([Fh.assistants,e,Dl],{...c,data:d}),u(1)},onError:e=>{console.error("Error:",e),p(null),g(null),_({message:v("com_ui_upload_error"),status:"error"}),u(1)}});ya((()=>{if(m){const e=new FileReader;e.onloadend=()=>{g(e.result)},e.readAsDataURL(m)}}),[m]),ya((()=>{g((null==a?void 0:a.avatar)??null)}),[a]),ya((()=>{const n=!!(s.isSuccess&&m&&h&&h.includes("base64"));if((!n||x.current!==s.data.id)&&n&&s.data.id){console.log("[AssistantAvatar] Uploading Avatar after Assistant Creation");const n=new FormData;n.append("file",m,m.name),n.append("assistant_id",s.data.id),y({assistant_id:s.data.id,model:b,postCreation:!0,formData:n,endpoint:e,version:t})}}),[s.data,s.isSuccess,m,h,y,b,e,t]);return l.jsxs(qa,{open:i,onOpenChange:c,children:[l.jsx("div",{className:"flex w-full items-center justify-center gap-4",children:l.jsx(Qa,{asChild:!0,children:l.jsx("button",{type:"button",className:"h-20 w-20","aria-label":v("com_ui_upload_avatar_label"),children:h?l.jsx(zR,{url:h,progress:d}):l.jsx(UR,{})})})}),l.jsx(VR,{handleFileChange:a=>{var s;const r=null==(s=a.target.files)?void 0:s[0];if(f.avatarSizeLimit&&r&&r.size<=f.avatarSizeLimit){if(!r)return void console.error("No file selected");if(p(r),c(!1),!n)return void console.log("[AssistantAvatar] No assistant_id, will wait until form submission + upload");const a=new FormData;a.append("file",r,r.name),a.append("assistant_id",n),y({assistant_id:n,model:b,formData:a,endpoint:e,version:t})}else{const e=f.avatarSizeLimit?jx(f.avatarSizeLimit):2;_({message:v("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}c(!1)}})]})}const BR=new Set(["name","id","description","instructions","conversation_starters","model","append_current_datetime"]);function HR({reset:e,value:t,endpoint:n,documentsMap:a,selectedAssistant:s,setCurrentAssistantId:r,createMutation:o,allTools:i}){const c=qN(),d=pk(),u=ba(null),[m]=JS(Hm.LAST_MODEL,{}),p=Ca((()=>new Set(null==i?void 0:i.filter((e=>!0===e.toolkit)).map((e=>e.pluginKey)))),[i]),h=vb(n,void 0,{select:e=>e.data.map((e=>{var t,s,r,o;const i=n===Yl.assistants?Sd.openai:Sd.azure,l={...e,label:e.name??"",value:e.id,files:e.file_ids?[]:void 0,code_files:(null==(s=null==(t=e.tool_resources)?void 0:t.code_interpreter)?void 0:s.file_ids)?[]:void 0},c=(e,t)=>{const a=null==d?void 0:d[e];a?null==t||t.push([e,{file_id:a.file_id,type:a.type,filepath:a.filepath,filename:a.filename,width:a.width,height:a.height,size:a.bytes,preview:a.filepath,progress:1,source:i}]):null==t||t.push([e,{file_id:e,type:"",filename:"",size:1,progress:1,filepath:n,source:i}])};l.files&&e.file_ids&&e.file_ids.forEach((e=>c(e,l.files))),l.code_files&&(null==(o=null==(r=e.tool_resources)?void 0:r.code_interpreter)?void 0:o.file_ids)&&e.tool_resources.code_interpreter.file_ids.forEach((e=>c(e,l.code_files)));const u=null==a?void 0:a.get(e.id);return u&&(l.conversation_starters||(l.conversation_starters=u.conversation_starters),l.append_current_datetime=u.append_current_datetime??!1),l}))}),g=ka((t=>{var a;const s=null==(a=h.data)?void 0:a.find((e=>e.id===t));if(o.reset(),!s)return r(void 0),e({...gc,model:(null==m?void 0:m[n])??""});const i={...s,label:s.name??"",value:s.id||""},l={[Ru.code_interpreter]:!1,[Ru.image_vision]:!1,[Ru.retrieval]:!1};(s.tools??[]).filter((e=>"function"!==e.type||vc(e))).map((e=>{var t;return((null==(t=e.function)?void 0:t.name)??"")||e.type})).forEach((e=>{e===Nl.file_search&&(l[Ru.retrieval]=!0),l[e]=!0}));const c=new Set,d=(s.tools??[]).filter((e=>"function"===e.type&&!vc(e))).map((e=>{var t;return(null==(t=e.function)?void 0:t.name)??""})).filter((e=>{const t=e.split("_")[0],n=p.has(t);return n&&c.add(t),!n}));c.size>0&&d.push(...Array.from(c));const u={functions:d,...l,assistant:i,model:i.model};Object.entries(s).forEach((([e,t])=>{BR.has(e)&&("append_current_datetime"!==e?("conversation_starters"===e&&Array.isArray(t)&&t.every((e=>"string"==typeof e))||"number"!=typeof t&&"object"!=typeof t)&&(u[e]=t):u[e]=!!t)})),e(u),r(s.id)}),[h.data,e,r,o,n,m,p]);ya((()=>{let e=null;if(s!==u.current)return""!==s&&null!=s&&h.data&&(e=setTimeout((()=>{u.current=s,g(s)}),5)),()=>{e&&clearTimeout(e)}}),[s,h.data,g]);const x=c("com_ui_create_assistant");return l.jsx($r,{value:t||x,setValue:Ax(g),availableValues:h.data??[{label:"Loading...",value:""}],iconSide:"left",showAbove:!1,showLabel:!1,emptyTitle:!0,containerClassName:"flex-grow",searchClassName:"dark:from-gray-850",searchPlaceholder:c("com_assistants_search_name"),optionsClass:"hover:bg-gray-20/50 dark:border-gray-700",optionsListClass:"rounded-lg shadow-lg dark:bg-gray-850 dark:border-gray-700 dark:last:border",currentValueClass:Qf("text-md font-semibold text-gray-900 dark:text-white",""===t?"text-gray-500":""),className:Qf("mt-1 rounded-md dark:border-gray-700 dark:bg-gray-850","z-50 flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer hover:border-green-500 focus:border-gray-400"),renderOption:()=>l.jsxs("span",{className:"flex items-center gap-1.5 truncate",children:[l.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-2 text-gray-800 dark:text-gray-100",children:l.jsx(Re,{className:"w-[16px]"})}),l.jsx("span",{className:Qf("ml-4 flex h-6 items-center gap-1 text-gray-800 dark:text-gray-100"),children:x})]})})}function GR({activeModel:e,assistant_id:t,setCurrentAssistantId:n,createMutation:a,endpoint:s}){const r=qN(),{showToast:o}=Ds(),{conversation:i}=$N(),{setOption:c}=SC(),d=Pb({onSuccess:(e,t,s)=>{var l;const d=s;if(!d)return;o({message:r("com_ui_assistant_deleted"),status:"success"}),void 0!==(null==(l=a.data)?void 0:l.id)&&(console.log("[deleteAssistant] resetting createMutation"),a.reset());const u=d[0];if(!u)return c("assistant_id")("");if(t.assistant_id===(null==i?void 0:i.assistant_id))return c("assistant_id")(u.id);const m=d.find((e=>e.id===(null==i?void 0:i.assistant_id)));m&&n(m.id),n(u.id)},onError:e=>{console.error(e),o({message:r("com_ui_assistant_delete_error"),status:"error"})}});return t?0===(null==e?void 0:e.length)||void 0===e?null:l.jsxs(oo,{children:[l.jsx(io,{asChild:!0,children:l.jsx("button",{className:Qf("btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",av),type:"button",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2 text-red-500",children:l.jsx(yr,{})})})}),l.jsx(lo,{title:r("com_ui_delete_assistant"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(er,{htmlFor:"delete-assistant",className:"text-left text-sm font-medium",children:r("com_ui_delete_assistant_confirm")})})})}),selection:{selectHandler:()=>d.mutate({assistant_id:t,model:e,endpoint:s}),selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:r("com_ui_delete")}})]}):null}function KR({tool:e,allTools:t,assistant_id:n=""}){const[a,s]=ja(!1),r=qN(),{showToast:o}=Ds(),i=TN(),{getValues:c,setValue:d}=Pi(),u=t.find((t=>t.pluginKey===e));return u?l.jsxs(rr,{children:[l.jsxs("div",{className:Qf("flex w-full items-center rounded-lg text-sm",n?"":"opacity-40"),onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[l.jsxs("div",{className:"flex grow items-center",children:[u.icon&&l.jsx("div",{className:"flex h-9 w-9 items-center justify-center overflow-hidden rounded-full",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full bg-center bg-no-repeat dark:bg-white/20",style:{backgroundImage:`url(${u.icon})`,backgroundSize:"cover"}})}),l.jsx("div",{className:"h-9 grow px-3 py-2",style:{textOverflow:"ellipsis",wordBreak:"break-all",overflow:"hidden"},children:u.name})]}),a&&l.jsx(or,{asChild:!0,children:l.jsx("button",{type:"button",className:"flex h-9 w-9 min-w-9 items-center justify-center rounded-lg transition-colors duration-200 hover:bg-gray-200 dark:hover:bg-gray-700",children:l.jsx(yr,{})})})]}),l.jsx(hr,{showCloseButton:!1,title:r("com_ui_delete_tool"),className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:r("com_ui_delete_tool_confirm")}),selection:{selectHandler:()=>{var e;(e=u.pluginKey)&&i.mutate({pluginKey:e,action:"uninstall",auth:null,isEntityTool:!0},{onError:e=>{o({message:`Error while deleting the tool: ${e}`,status:"error"})},onSuccess:()=>{const t=c("functions").filter((t=>t!==e));d("functions",t),o({message:"Tool deleted successfully",status:"success"})}})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-colors duration-200 text-white",selectText:r("com_ui_delete")}})]}):null}const WR=({children:e})=>{const t=qN();return l.jsxs("div",{children:[l.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:t("com_assistants_code_interpreter_files")}),l.jsx("div",{className:"flex flex-wrap gap-2",children:e})]})};function qR({endpoint:e,assistant_id:t,files:n}){const a=qN(),{setFilesLoading:s}=$N(),r=ba(null),[o,i]=ja(new Map),{data:c=null}=Y_({select:e=>wd(e)}),{handleFileChange:d}=BC({additionalMetadata:{assistant_id:t},fileSetter:i});ya((()=>{n&&i(new Map(n))}),[n]);const u=jd({fileConfig:c,endpoint:e,endpointType:e});if((null==u?void 0:u.disabled)??!1)return null;return l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("span",{children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:a(t?"com_assistants_knowledge":"com_assistants_knowledge_disabled")})})}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsx("div",{className:"text-token-text-tertiary rounded-lg",children:t?a("com_assistants_knowledge_info"):""}),l.jsx(TI,{files:o,setFiles:i,setFilesLoading:s,assistant_id:t,fileFilter:e=>ud.some((t=>t.test(e.type??""))),Wrapper:({children:e})=>l.jsx("div",{className:"flex flex-wrap gap-2",children:e})}),l.jsx(TI,{files:o,setFiles:i,setFilesLoading:s,assistant_id:t,fileFilter:e=>!ud.some((t=>t.test(e.type??""))),Wrapper:WR}),l.jsx("div",{children:l.jsx("button",{type:"button",disabled:!t,className:"btn btn-neutral border-token-border-light relative h-8 rounded-lg font-medium",onClick:()=>{var e;r.current&&(r.current.value=""),null==(e=r.current)||e.click()},children:l.jsxs("div",{className:"flex w-full items-center justify-center gap-2",children:[l.jsx("input",{multiple:!0,type:"file",style:{display:"none"},tabIndex:-1,ref:r,disabled:!t,onChange:d}),a("com_ui_upload_files")]})})})]})]})}const QR="mb-2 text-token-text-primary block font-medium",YR=Qf(ov,"flex w-full px-3 py-2 dark:border-gray-800 dark:bg-gray-800 rounded-xl mb-2",av);function XR({setAction:e,endpoint:t,actions:n=[],setActivePanel:a,documentsMap:s,assistant_id:r,setCurrentAssistantId:o,assistantsConfig:i,version:c}){const d=jN(),u=Ik(),{data:m=[]}=I_(),{onSelect:p}=function(e){const t=zN(),{conversation:n,newConversation:a}=$N(),s=HN((e=>mx(e.data)));return{onSelect:ka((r=>{var o;const i=null==(o=s[e])?void 0:o[r];if(!i)return;const l={endpoint:e,assistant_id:i.id,model:i.model,conversationId:"new"};if(cx.log("conversation","Updating conversation with assistant",i),lc(null==n?void 0:n.endpoint)){const e=t({conversation:{...n??{}},preset:l});a({template:e,preset:l,keepLatestMessage:!0})}else a({template:{...l},preset:l})}),[e,s,n,t,a])}}(t),{showToast:h}=Ds(),g=qN(),x=Oi({defaultValues:gc}),[f,v]=ja(!1),{control:_,handleSubmit:b,reset:y,setValue:j,getValues:w}=x,N=Di({control:_,name:"assistant"}),k=Di({control:_,name:"functions"}),C=Di({control:_,name:"id"}),S=Ca((()=>{var e,n;return null==(n=null==(e=null==u?void 0:u[t])?void 0:e[C])?void 0:n.model}),[u,t,C]),T=Ca((()=>{var e;return null==(e=null==i?void 0:i.capabilities)?void 0:e.includes(Ru.tools)}),[i]),E=Ca((()=>{var e;return null==(e=null==i?void 0:i.capabilities)?void 0:e.includes(Ru.actions)}),[i]),I=Ca((()=>{var e;return null==(e=null==i?void 0:i.capabilities)?void 0:e.includes(Ru.retrieval)}),[i]),R=Ca((()=>{var e;return null==(e=null==i?void 0:i.capabilities)?void 0:e.includes(Ru.code_interpreter)}),[i]),A=Ab({onSuccess:e=>{h({message:`${g("com_assistants_update_success")} ${e.name??g("com_ui_assistant")}`})},onError:e=>{const t=e;h({message:`${g("com_assistants_update_error")}${t.message?` ${g("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),P=Rb({onSuccess:e=>{o(e.id),h({message:`${g("com_assistants_create_success")} ${e.name??g("com_ui_assistant")}`})},onError:e=>{const t=e;h({message:`${g("com_assistants_create_error")}${t.message?` ${g("com_ui_error")}: ${t.message}`:""}`,status:"error"})}}),O=Ca((()=>"string"==typeof N?[]:N.files),[N]);let L;return L=P.isLoading||A.isLoading?l.jsx(Xs,{className:"icon-md"}):g(C?"com_ui_save":"com_ui_create"),l.jsx(Mi,{...x,children:l.jsxs("form",{onSubmit:b((e=>{const n=[...k].map((e=>{var n,a;if(!e.includes(Ll))return e;{const s=null==(n=null==u?void 0:u[t])?void 0:n[C],r=null==(a=null==s?void 0:s.tools)?void 0:a.find((t=>{var n;return(null==(n=t.function)?void 0:n.name)===e}));if(s&&r)return r}return e}));e.code_interpreter&&n.push({type:Nl.code_interpreter}),e.retrieval&&n.push({type:2==c?Nl.file_search:Nl.retrieval}),e.image_vision&&n.push(fc);const{name:a,description:s,instructions:r,conversation_starters:o,model:i,append_current_datetime:l}=e;C?A.mutate({assistant_id:C,data:{name:a,description:s,instructions:r,conversation_starters:o.filter((e=>""!==e.trim())),model:i,tools:n,endpoint:t,append_current_datetime:l}}):P.mutate({name:a,description:s,instructions:r,conversation_starters:o.filter((e=>""!==e.trim())),model:i,tools:n,endpoint:t,version:c,append_current_datetime:l})})),className:"h-auto w-full flex-shrink-0 overflow-x-hidden",children:[l.jsxs("div",{className:"flex w-full flex-wrap",children:[l.jsx(Li,{name:"assistant",control:_,render:({field:e})=>l.jsx(HR,{reset:y,value:e.value,endpoint:t,documentsMap:s,allTools:m,setCurrentAssistantId:o,selectedAssistant:r??null,createMutation:P})}),C&&l.jsx("button",{className:"btn btn-primary focus:shadow-outline mx-2 mt-1 h-[40px] rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0",type:"button",disabled:!C,onClick:e=>{e.preventDefault(),p(C)},children:g("com_ui_select")})]}),l.jsxs("div",{className:"bg-surface-50 h-auto px-4 pb-8 pt-3 dark:bg-transparent",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx($R,{createMutation:P,assistant_id:C,metadata:N.metadata??null,endpoint:t,version:c}),l.jsx("label",{className:QR,htmlFor:"name",children:g("com_ui_name")}),l.jsx(Li,{name:"name",control:_,render:({field:e})=>l.jsx("input",{...e,value:e.value??"",max:256,className:YR,id:"name",type:"text",placeholder:g("com_assistants_name_placeholder")})}),l.jsx(Li,{name:"id",control:_,render:({field:e})=>l.jsx("p",{className:"h-3 text-xs italic text-text-secondary",children:e.value})})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:QR,htmlFor:"description",children:g("com_ui_description")}),l.jsx(Li,{name:"description",control:_,render:({field:e})=>l.jsx("input",{...e,value:e.value??"",max:512,className:YR,id:"description",type:"text",placeholder:g("com_assistants_description_placeholder")})})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:QR,htmlFor:"instructions",children:g("com_ui_instructions")}),l.jsx(Li,{name:"instructions",control:_,render:({field:e})=>l.jsx("textarea",{...e,value:e.value??"",max:32768,className:Qf(YR,"min-h-[100px] resize-y"),id:"instructions",placeholder:g("com_assistants_instructions_placeholder"),rows:3})})]}),l.jsx(AR,{control:_,setValue:j,getValues:w}),l.jsx("div",{className:"relative mb-6",children:l.jsx(Li,{name:"conversation_starters",control:_,defaultValue:[],render:({field:e})=>l.jsx(IR,{field:e,inputClass:YR,labelClass:QR})})}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:QR,htmlFor:"model",children:g("com_ui_model")}),l.jsx(Li,{name:"model",control:_,rules:{required:!0,minLength:1},render:({field:e,fieldState:{error:n}})=>{var a;return l.jsxs(l.Fragment,{children:[l.jsx($r,{emptyTitle:!0,value:e.value,setValue:e.onChange,availableValues:(null==(a=d.data)?void 0:a[t])??[],showAbove:!1,showLabel:!1,className:Qf(rv,"flex h-[40px] w-full flex-none items-center justify-center px-4 hover:cursor-pointer"),containerClassName:Qf("rounded-md",n?"border-red-500 border-2":"")}),n&&l.jsx("span",{className:"text-sm text-red-500 transition duration-300 ease-in-out",children:g("com_ui_field_required")})]})}})]}),(!0===R||!0===I)&&1==c&&l.jsx(qR,{assistant_id:C,files:O,endpoint:t}),l.jsx(FR,{version:c,endpoint:t,codeEnabled:R,assistantsConfig:i,retrievalEnabled:I}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:QR,children:`${!0===T?g("com_ui_tools"):""}\n              ${!0===T&&!0===E?" + ":""}\n              ${!0===E?g("com_assistants_actions"):""}`}),l.jsxs("div",{className:"space-y-2",children:[k.map(((e,t)=>l.jsx(KR,{tool:e,allTools:m,assistant_id:C},`${e}-${t}-${C}`))),n.filter((e=>e.assistant_id===C)).map(((t,n)=>l.jsx(KE,{action:t,onClick:()=>e(t)},n))),l.jsxs("div",{className:"flex space-x-2",children:[!0===T&&l.jsx("button",{type:"button",onClick:()=>v(!0),className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:g("com_assistants_add_tools")})}),!0===E&&l.jsx("button",{type:"button",disabled:!C,onClick:()=>{if(!C)return h({message:g("com_assistants_actions_disabled"),status:"warning"});a(rx.actions)},className:"btn btn-neutral border-token-border-light relative h-8 w-full rounded-lg font-medium",children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:g("com_assistants_add_actions")})})]})]})]}),l.jsxs("div",{className:"flex items-center justify-end gap-2",children:[l.jsx(GR,{assistant_id:C,activeModel:S,setCurrentAssistantId:o,createMutation:P,endpoint:t}),l.jsx("button",{className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"submit",children:L})]})]}),l.jsx(RR,{endpoint:t,isOpen:f,setIsOpen:v})]})})}function JR({columns:e,data:t}){const n=_s({columns:e,data:t,getCoreRowModel:bs()});return l.jsxs("table",{className:"w-full text-sm",children:[l.jsx("thead",{children:n.getHeaderGroups().map(((e,t)=>l.jsx("tr",{className:"border-token-border-light text-token-text-tertiary border-b text-left text-xs",children:e.headers.map(((e,t)=>l.jsx("th",{className:"py-1 font-normal",children:e.isPlaceholder?null:ys(e.column.columnDef.header,e.getContext())},t)))},t)))}),l.jsx("tbody",{children:n.getRowModel().rows.map(((e,t)=>l.jsx("tr",{className:"border-token-border-light border-b",children:e.getVisibleCells().map(((e,t)=>l.jsx("td",{className:"py-2",children:ys(e.column.columnDef.cell,e.getContext())},t)))},t)))})]})}const ZR=[{header:"Name",accessorKey:"name"},{header:"Method",accessorKey:"method"},{header:"Path",accessorKey:"path"}],eA=xi(((e,t)=>{t(hg(e))}),800);function tA({action:e,assistant_id:t,endpoint:n,version:a,setAction:s}){var r;const o=e=>{e.status||(v(null),b(null)),h(e)},i=qN(),{showToast:c}=Ds(),d=Ik(),{handleSubmit:u,reset:m}=Pi(),[p,h]=ja(null),[g,x]=ja(""),[f,v]=ja(null),[_,b]=ja(null);ya((()=>{var t;const n=(null==(t=null==e?void 0:e.metadata)?void 0:t.raw_spec)??"";n&&(x(n),eA(n,o))}),[null==(r=null==e?void 0:e.metadata)?void 0:r.raw_spec]),ya((()=>{if(!p||!p.status||!p.spec)return;const{functionSignatures:e,requestBuilders:t}=pg(p.spec),n=Object.entries(t).map((([e,t])=>({name:e,method:t.method,path:t.path,domain:t.domain})));v(n),h(null),b(e.map((e=>e.toObjectTool())))}),[p]);const y=Lb({onSuccess(e){c({message:i("com_assistants_update_actions_success"),status:"success"}),m(),s(e[2])},onError(e){c({message:(null==e?void 0:e.message)??i("com_assistants_update_actions_error"),status:"error"})}}),j=u((s=>{console.log("authFormData",s);const r=t??"";if(!r)return;if(!_)return;if(!f)return;let{metadata:o}=e??{};o||(o={});const i=null==e?void 0:e.action_id;o.raw_spec=g;const l=new URL(f[0].domain).hostname;if(!l)return;o.domain=l;const{type:c,saved_auth_fields:u}=s,m=e=>{delete e.auth,delete e.api_key,delete e.oauth_client_id,delete e.oauth_client_secret};u&&c===iu.ServiceHttp?o={...o,api_key:s.api_key,auth:{type:c,authorization_type:s.authorization_type,custom_auth_header:s.custom_auth_header}}:u&&c===iu.OAuth?o={...o,auth:{type:c,authorization_url:s.authorization_url,client_url:s.client_url,scope:s.scope,token_exchange_method:s.token_exchange_method},oauth_client_id:s.oauth_client_id,oauth_client_secret:s.oauth_client_secret}:u?(m(o),o.auth={type:c}):m(o),y.mutate({action_id:i,metadata:o,functions:_,assistant_id:r,endpoint:n,version:a,model:(null==d?void 0:d[n][r].model)??""})}));return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"",children:[l.jsxs("div",{className:"mb-1 flex flex-wrap items-center justify-between gap-4",children:[l.jsx("label",{htmlFor:"example-schema",className:"text-token-text-primary whitespace-nowrap font-medium",children:i("com_ui_schema")}),l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("select",{id:"example-schema",onChange:e=>console.log(e.target.value),className:"border-token-border-medium h-8 min-w-[100px] rounded-lg border bg-transparent px-2 py-0 text-sm",children:[l.jsx("option",{value:"label",children:i("com_ui_examples")}),l.jsx("option",{value:"0",children:"Weather (JSON)"}),l.jsx("option",{value:"1",children:"Pet Store (YAML)"}),l.jsx("option",{value:"2",children:"Blank Template"})]})})]}),l.jsxs("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover mb-4 w-full overflow-hidden rounded-lg border ring-0",children:[l.jsx("div",{className:"relative",children:l.jsx("textarea",{id:"schemaInput",value:g,onChange:e=>{const t=e.target.value;if(x(t),!t)return v(null),b(null),h(null);eA(t,o)},spellCheck:"false",placeholder:i("com_ui_enter_openapi_schema"),className:"text-token-text-primary block h-96 w-full bg-transparent p-2 font-mono text-xs outline-none focus:ring-1 focus:ring-border-light"})}),p&&"OpenAPI spec is valid."!==p.message&&l.jsx("div",{className:"border-token-border-light border-t p-2 text-red-500",children:p.message.split("\n").map(((e,t)=>l.jsx("div",{children:e},t)))})]})]}),!!f&&l.jsxs("div",{className:"my-2",children:[l.jsx("div",{className:"flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:i("com_assistants_available_actions")})}),l.jsx(JR,{columns:ZR,data:f})]}),l.jsxs("div",{className:"relative my-1",children:[l.jsx(fE,{action_id:null==e?void 0:e.action_id}),l.jsx("div",{className:"mb-1.5 flex items-center",children:l.jsx("label",{className:"text-token-text-primary block font-medium",children:i("com_ui_privacy_policy_url")})}),l.jsx("div",{className:"border-token-border-medium bg-token-surface-primary hover:border-token-border-hover flex h-9 w-full rounded-lg border",children:l.jsx("input",{type:"text",placeholder:"https://api.example-weather-app.com/privacy",className:"flex-1 rounded-lg bg-transparent px-3 py-1.5 text-sm outline-none placeholder:text-text-secondary-alt focus:ring-1 focus:ring-border-light"})})]}),l.jsx("div",{className:"flex items-center justify-end",children:l.jsx("button",{disabled:!_||!_.length,onClick:j,className:"focus:shadow-outline mt-1 flex min-w-[100px] items-center justify-center rounded bg-green-500 px-4 py-2 font-semibold text-white hover:bg-green-400 focus:border-green-500 focus:outline-none focus:ring-0 disabled:bg-green-400",type:"button",children:y.isLoading?l.jsx(Xs,{className:"icon-md"}):(null==e?void 0:e.action_id.length)?i("com_ui_update"):i("com_ui_create")})})]})}function nA({action:e,endpoint:t,version:n,setAction:a,assistant_id:s,setActivePanel:r}){const o=qN(),{showToast:i}=Ds(),c=Ik(),d=Mb({onSuccess:()=>{i({message:o("com_assistants_delete_actions_success"),status:"success"}),r(rx.builder),a(void 0)},onError(e){i({message:(null==e?void 0:e.message)??o("com_assistants_delete_actions_error"),status:"error"})}}),u=Oi({defaultValues:{type:iu.None,saved_auth_fields:!1,api_key:"",authorization_type:lu.Basic,custom_auth_header:"",oauth_client_id:"",oauth_client_secret:"",authorization_url:"",client_url:"",scope:"",token_exchange_method:cu.DefaultPost}}),{reset:m,watch:p}=u;return ya((()=>{var t;(null==(t=null==e?void 0:e.metadata)?void 0:t.auth)&&m({type:e.metadata.auth.type||iu.None,saved_auth_fields:!1,api_key:e.metadata.api_key??"",authorization_type:e.metadata.auth.authorization_type||lu.Basic,oauth_client_id:e.metadata.oauth_client_id??"",oauth_client_secret:e.metadata.oauth_client_secret??"",authorization_url:e.metadata.auth.authorization_url??"",client_url:e.metadata.auth.client_url??"",scope:e.metadata.auth.scope??"",token_exchange_method:e.metadata.auth.token_exchange_method??cu.DefaultPost})}),[e,m]),l.jsx(Mi,{...u,children:l.jsx("form",{className:"h-full grow overflow-hidden",children:l.jsxs("div",{className:"h-full overflow-auto px-2 pb-12 text-sm",children:[l.jsxs("div",{className:"relative flex flex-col items-center px-16 py-6 text-center",children:[l.jsx("div",{className:"absolute left-0 top-6",children:l.jsx("button",{type:"button",className:"btn btn-neutral relative",onClick:()=>{r(rx.builder),a(void 0)},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(Ae,{})})})}),!!e&&l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsx("div",{className:"absolute right-0 top-6",children:l.jsx("button",{type:"button",disabled:!s||!e.action_id,className:"btn btn-neutral border-token-border-light relative h-9 rounded-lg font-medium",children:l.jsx(yr,{className:"text-red-500"})})})}),l.jsx(hr,{showCloseButton:!1,title:o("com_ui_delete_action"),className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:o("com_ui_delete_action_confirm")}),selection:{selectHandler:()=>{const n=s??"";if(!n)return i({message:"No assistant_id found, is the assistant created?",status:"error"});d.mutate({model:(null==c?void 0:c[t][n].model)??"",action_id:e.action_id,assistant_id:n,endpoint:t})},selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 transition-color duration-200 text-white",selectText:o("com_ui_delete")}})]}),l.jsx("div",{className:"text-xl font-medium",children:(e?"Edit":"Add")+" actions"}),l.jsx("div",{className:"text-xs text-text-secondary",children:o("com_assistants_actions_info")})]}),l.jsx(pE,{disableOAuth:!0}),l.jsx(tA,{action:e,assistant_id:s,setAction:a,endpoint:t,version:n})]})})})}function aA(){const{conversation:e,index:t}=$N(),[n,a]=ja(rx.builder),[s,r]=ja(void 0),[o,i]=ja(null==e?void 0:e.assistant_id),{data:c={}}=G_(),{data:d=[]}=_b(null==e?void 0:e.endpoint),{data:u=null}=bb((null==e?void 0:e.endpoint)??"",{select:e=>new Map(e.map((e=>[e.assistant_id,e])))}),m=Ca((()=>null==c?void 0:c[(null==e?void 0:e.endpoint)??""]),[null==e?void 0:e.endpoint,c]);if(ya((()=>{const t=(null==e?void 0:e.assistant_id)??"";t&&i(t)}),[null==e?void 0:e.assistant_id]),!(null==e?void 0:e.endpoint))return null;const p=(null==m?void 0:m.version)??Fu[e.endpoint];return n===rx.actions||s?l.jsx(nA,{index:t,action:s,actions:d,setAction:r,activePanel:n,documentsMap:u,setActivePanel:a,assistant_id:o,setCurrentAssistantId:i,endpoint:e.endpoint,version:p}):n===rx.builder?l.jsx(XR,{index:t,activePanel:n,action:s,actions:d,setAction:r,documentsMap:u,setActivePanel:a,assistant_id:o,setCurrentAssistantId:i,endpoint:e.endpoint,assistantsConfig:m,version:p}):void 0}function sA({className:e}){const t=qN(),n=y(N_.promptsName),a=y(N_.promptsCategory),s=LC("/d/prompts",ka((()=>{n(""),a("")}),[n,a]));return l.jsx(Ys,{variant:"outline",className:Qf(e,"bg-transparent"),onClick:e=>{s(e)},"aria-label":"Manage Prompts",role:"button",children:t("com_ui_manage")})}const rA=Sa((function({group:e,instanceProjectId:t}){const n=W(),a=E(),s=qN(),r=ba(null),[o,i]=ja(e.name),{hasPermission:d}=eT(Ph.PROMPTGROUP,e._id||""),u=d(Oh.EDIT),m=d(Oh.DELETE),p=Ca((()=>{var n;return t&&(null==(n=e.projectIds)?void 0:n.includes(t))}),[e.projectIds,t]),h=Fb({onMutate:()=>{r.current&&clearTimeout(r.current)}}),g=(e=>{const t=xs(),{onSuccess:n,...a}=e||{},s=j(N_.promptsName),r=j(N_.promptsPageSize),o=j(N_.promptsCategory);return fs({mutationFn:e=>Jh.deletePromptGroup(e.id),...a,onSuccess:(e,a,i)=>{t.setQueryData([Fh.promptGroups,s,o,r],(e=>e?Df(e,a.id):e)),Vf(t,a.id),n&&n(e,a,i)}})})({onSuccess:(t,n)=>{n.id===e._id&&a("/d/prompts")}}),{isLoading:x}=h,f=ka((()=>{console.log(e._id??"",{name:o}),h.mutate({id:e._id??"",payload:{name:o}})}),[e._id,o,h]),v=ka((t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),a(`/d/prompts/${e._id}`,{replace:!0}))}),[e._id,a]),_=ka((()=>{g.mutate({id:e._id??""})}),[e._id,g]),b=ka((()=>{a(`/d/prompts/${e._id}`,{replace:!0})}),[e._id,a]);return l.jsxs("div",{className:Qf("relative mx-2 my-2 rounded-lg border border-border-light bg-surface-primary shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-secondary",n.promptId===e._id&&"bg-surface-hover"),children:[l.jsxs("button",{type:"button",className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-3 text-left",onClick:b,onKeyDown:v,"aria-label":e.category?s("com_ui_prompt_group_button",{name:e.name,category:e.category}):s("com_ui_prompt_group_button_no_category",{name:e.name}),children:[l.jsxs("div",{className:"flex items-center gap-2 truncate pr-2",children:[l.jsx(eC,{category:e.category??"",className:"icon-lg","aria-hidden":"true"}),l.jsx(er,{className:"text-md cursor-pointer truncate font-semibold text-text-primary",children:e.name})]}),l.jsx("div",{className:"flex h-full items-center gap-2",children:p&&l.jsx(c,{className:"icon-md text-green-500","aria-label":s("com_ui_global_group")})})]}),l.jsxs("div",{className:"absolute right-0 top-0 mr-1 mt-2.5 flex items-start gap-1 pl-2",children:[u&&l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsx("button",{type:"button",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border-medium bg-transparent p-0 text-sm font-medium transition-all duration-300 ease-in-out hover:border-border-heavy hover:bg-surface-hover focus:border-border-heavy focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","aria-label":s("com_ui_rename_prompt_name",{name:e.name}),children:l.jsx(tt,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),l.jsx(hr,{showCloseButton:!1,title:s("com_ui_rename_prompt"),className:"w-11/12 max-w-lg",main:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(kr,{value:o,onChange:e=>i(e.target.value),className:"w-full","aria-label":s("com_ui_rename_prompt_name",{name:e.name})})})}),selection:{selectHandler:f,selectClasses:"bg-surface-submit hover:bg-surface-submit-hover text-white disabled:hover:bg-surface-submit",selectText:s("com_ui_save"),isLoading:x}})]}),m&&l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsx("button",{type:"button",onClick:e=>e.stopPropagation(),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},className:"inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border-medium bg-transparent p-0 text-sm font-medium transition-all duration-300 ease-in-out hover:border-border-heavy hover:bg-surface-hover focus:border-border-heavy focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","aria-label":s("com_ui_delete_prompt_name",{name:e.name}),children:l.jsx(yr,{className:"icon-sm text-text-primary","aria-hidden":"true"})})}),l.jsx(hr,{showCloseButton:!1,title:s("com_ui_delete_prompt"),className:"w-11/12 max-w-lg",main:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(er,{htmlFor:"confirm-delete",className:"text-left text-sm font-medium",children:l.jsx(Ai,{i18nKey:"com_ui_delete_confirm_strong",values:{title:e.name},components:{strong:l.jsx("strong",{})}})})})}),selection:{selectHandler:_,selectClasses:"bg-red-600 dark:bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white",selectText:s("com_ui_delete")}})]})]})]})})),oA=({currentIndex:e,totalCount:t,onPrevious:n,onNext:a})=>t<=1?null:l.jsxs("div",{className:"flex items-center justify-start gap-1 self-center bg-gray-700 pb-2 text-xs",children:[l.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:n,disabled:0===e,children:l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"15 18 9 12 15 6"})})}),l.jsxs("span",{className:"flex-shrink-0 tabular-nums",children:[e+1," / ",t]}),l.jsx("button",{className:"hover-button rounded-md p-1 text-gray-400 hover:bg-gray-700 hover:text-gray-200 disabled:hover:text-gray-400",type:"button",onClick:a,disabled:e===t-1,children:l.jsx("svg",{stroke:"currentColor",fill:"none",strokeWidth:"1.5",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("polyline",{points:"9 18 15 12 9 6"})})})]});function iA({isOpen:e,onOpenChange:t,src:n="",downloadImage:a,args:s}){const r=qN(),[o,i]=ja(!1),[c,d]=ja(null),[u,m]=ja(1),[p,h]=ja(0),[g,x]=ja(0),[f,v]=ja(!1),[_,b]=ja({x:0,y:0}),y=ba(null),j=ka((async e=>{try{const t=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(t){const e=parseInt(t,10);return w(e)}const n=await fetch(e),a=await n.blob();return w(a.size)}catch(t){return console.error("Error getting image size:",t),null}}),[]),w=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},N=ka((()=>{m(1),h(0),x(0)}),[]),k=ka((()=>{u>1?N():m(2)}),[u,N]),C=ka((e=>{if(e.preventDefault(),!y.current)return;const t=y.current.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,s=e.deltaY>0?.9:1.1,r=Math.min(Math.max(u*s,1),5);if(r===u)return;if(1===r)return m(1),h(0),void x(0);const o=t.width/2,i=t.height/2,l=r/u,c=(n-o-p)*(l-1),d=(a-i-g)*(l-1);m(r),h(p-c),x(g-d)}),[u,p,g]),S=ka((e=>{e.preventDefault(),u<=1||(v(!0),b({x:e.clientX-p,y:e.clientY-g}))}),[u,p,g]),T=ka((e=>{if(!f||u<=1)return;const t=e.clientX-_.x,n=e.clientY-_.y;h(t),x(n)}),[f,_,u]),E=ka((()=>{v(!1)}),[]);ya((()=>{const e=e=>"Escape"===e.key&&N();return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[N]),ya((()=>{e&&n&&(j(n).then(d),N())}),[e,n,j,N]),ya((()=>{1===u&&(h(0),x(0))}),[u]),ya((()=>{1===u&&(h(0),x(0))}),[o,u]);const I=r(o?"com_ui_hide_image_details":"com_ui_show_image_details");return l.jsx(rr,{open:e,onOpenChange:t,children:l.jsxs(ir,{showCloseButton:!1,className:"h-full w-full rounded-none bg-transparent",disableScroll:!1,overlayClassName:"bg-surface-primary opacity-95 z-50",children:[l.jsxs("div",{className:"ease-[cubic-bezier(0.175,0.885,0.32,1.275)] absolute left-0 top-0 z-10 flex items-center justify-between p-3 transition-all duration-500 sm:p-4 "+(o?"right-0 sm:right-80":"right-0"),children:[l.jsx(pr,{description:r("com_ui_close"),render:l.jsx(Ys,{onClick:()=>t(!1),variant:"ghost",className:"h-10 w-10 p-0 hover:bg-surface-hover","aria-label":r("com_ui_close"),children:l.jsx(re,{className:"size-7 sm:size-6","aria-hidden":"true"})})}),l.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[u>1&&l.jsx(pr,{description:r("com_ui_reset_zoom"),render:l.jsx(Ys,{onClick:N,variant:"ghost",className:"h-10 w-10 p-0","aria-label":r("com_ui_reset_zoom"),children:l.jsx(Je,{className:"size-6","aria-hidden":"true"})})}),l.jsx(pr,{description:r("com_ui_download"),render:l.jsx(Ys,{onClick:()=>a(),variant:"ghost",className:"h-10 w-10 p-0","aria-label":r("com_ui_download"),children:l.jsx(nt,{className:"size-6","aria-hidden":"true"})})}),l.jsx(pr,{description:I,render:l.jsx(Ys,{onClick:()=>i(!o),variant:"ghost",className:"h-10 w-10 p-0","aria-label":I,children:o?l.jsx(at,{className:"size-7 sm:size-6","aria-hidden":"true"}):l.jsx(st,{className:"size-7 sm:size-6","aria-hidden":"true"})})})]})]}),l.jsx("div",{className:"ease-[cubic-bezier(0.175,0.885,0.32,1.275)] flex h-full transition-all duration-500 "+(o?"mr-0 sm:mr-80":"mr-0"),children:l.jsx("div",{ref:y,className:"flex flex-1 items-center justify-center px-2 pb-4 pt-16 sm:px-4 sm:pt-20",onWheel:C,onMouseDown:S,onMouseMove:T,onMouseUp:E,onMouseLeave:E,onDoubleClick:k,style:{cursor:u<=1?"default":f?"grabbing":"grab",overflow:u>1?"hidden":"visible",minHeight:0},children:l.jsx("div",{className:"flex items-center justify-center transition-transform duration-100 ease-out",style:{transform:`translate(${p}px, ${g}px) scale(${u})`,transformOrigin:"center center",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:l.jsx("img",{src:n,alt:"Image",className:"block object-contain",style:{maxHeight:"calc(100vh - 8rem)",maxWidth:o&&window.innerWidth>=640?"calc(100vw - 22rem)":"calc(100vw - 2rem)",width:"auto",height:"auto"}})})})}),l.jsx("div",{className:"sm:shadow-l-lg ease-[cubic-bezier(0.175,0.885,0.32,1.275)] fixed right-0 top-0 z-20 h-full w-full transform border-l border-border-light bg-surface-primary shadow-2xl backdrop-blur-sm transition-transform duration-500 sm:w-80 sm:rounded-l-2xl "+(o?"translate-x-0":"translate-x-full"),children:l.jsxs("div",{className:"h-full overflow-y-auto p-4 sm:p-6",children:[l.jsxs("div",{className:"mb-4 flex items-center justify-between sm:hidden",children:[l.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:r("com_ui_image_details")}),l.jsx(Ys,{onClick:()=>i(!1),variant:"ghost",className:"h-12 w-12 p-0",children:l.jsx(re,{className:"size-6","aria-hidden":"true"})})]}),l.jsxs("div",{className:"mb-4 hidden sm:block",children:[l.jsx("h3",{className:"mb-2 text-lg font-semibold text-text-primary",children:r("com_ui_image_details")}),l.jsx("div",{className:"mb-4 h-px bg-border-medium"})]}),l.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"mb-2 text-sm font-medium text-text-primary",children:r("com_ui_prompt")}),l.jsx("div",{className:"rounded-md bg-surface-tertiary p-3",children:l.jsx("p",{className:"text-sm leading-relaxed text-text-primary",children:(null==s?void 0:s.prompt)||"No prompt available"})})]}),l.jsxs("div",{children:[l.jsx("h4",{className:"mb-3 text-sm font-medium text-text-primary",children:r("com_ui_generation_settings")}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-sm text-text-primary",children:[r("com_ui_size"),":"]}),l.jsx("span",{className:"text-sm font-medium text-text-primary",children:(null==s?void 0:s.size)||"Unknown"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-sm text-text-primary",children:[r("com_ui_quality"),":"]}),l.jsx("span",{className:"rounded px-2 py-1 text-xs font-medium capitalize "+(R=(null==s?void 0:s.quality)||"","high"===R?"bg-green-100 text-green-800":"low"===R?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:(null==s?void 0:s.quality)||"Standard"})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"text-sm text-text-primary",children:[r("com_ui_file_size"),":"]}),l.jsx("span",{className:"text-sm font-medium text-text-primary",children:c||"Loading..."})]})]})]})]})]})})]})});var R}const lA=({imagePath:e,altText:t,height:n,width:a,placeholderDimensions:s,className:r,args:o})=>{const[i,c]=ja(!1),[d,u]=ja(!1),m=ba(null),p=Ca((()=>{if(!e)return e;if(e.startsWith("http")||e.startsWith("data:")||!e.startsWith("/images/"))return e;return`${Td()}${e}`}),[e]),{width:h,height:g}=Ca((()=>{var e,t;return Yf({originalWidth:Number((null==(e=null==s?void 0:s.width)?void 0:e.split("px")[0])??a),originalHeight:Number((null==(t=null==s?void 0:s.height)?void 0:t.split("px")[0])??n),containerRef:m})}),[s,n,a]);return l.jsx("div",{ref:m,children:l.jsxs("div",{className:Qf("relative mt-1 flex h-auto w-full max-w-lg items-center justify-center overflow-hidden rounded-lg border border-border-light text-text-secondary-alt shadow-md",r),children:[l.jsx("button",{type:"button","aria-label":`View ${t} in dialog`,onClick:()=>c(!0),className:"cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:l.jsx(rt.LazyLoadImage,{alt:t,onLoad:()=>u(!0),visibleByDefault:!0,className:Qf("opacity-100 transition-opacity duration-100",d?"opacity-100":"opacity-0"),src:p,style:{width:`${h}`,height:"auto",color:"transparent",display:"block"},placeholder:l.jsx(Ms,{className:Qf("h-auto w-full",`h-[${g}] w-[${h}]`),"aria-label":"Loading image","aria-busy":"true"})})}),d&&l.jsx(iA,{isOpen:i,onOpenChange:c,src:p,downloadImage:async()=>{try{const e=await fetch(p);if(!e.ok)throw new Error(`Failed to fetch image: ${e.status}`);const n=await e.blob(),a=window.URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=t||"image.png",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(e){console.error("Download failed:",e);const n=document.createElement("a");n.href=p,n.download=t||"image.png",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},args:o})]})})},cA=({href:e,filename:t})=>{const{showToast:n}=Ds(),{refetch:a}=((e="")=>gs([Fh.fileDownload,e],(async()=>{if(!e)return void console.warn("No user ID provided for file download");const t=(await Jh.getCodeOutputDownload(e)).data;return window.URL.createObjectURL(t)}),{enabled:!1,retry:!1}))(e);return{handleDownload:async e=>{e.preventDefault();try{const e=await a();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void n({status:"error",message:"Error downloading file"});const s=document.createElement("a");s.href=e.data,s.setAttribute("download",t),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(e.data)}catch(s){console.error("Error downloading file:",s)}}}},dA=({href:e,filename:t,children:n})=>{const{handleDownload:a}=cA({href:e,filename:t});return l.jsx("a",{href:e,onClick:a,target:"_blank",rel:"noopener noreferrer",className:"!text-blue-400 visited:!text-purple-400 hover:underline",children:n})},uA=Sa((({attachment:e})=>{var t;const[n,a]=ja(!1),{handleDownload:s}=cA({href:e.filepath??"",filename:e.filename??""}),r=null==(t=e.filename)?void 0:t.split(".").pop();return ya((()=>{const e=setTimeout((()=>a(!0)),50);return()=>clearTimeout(e)}),[]),e.filepath?l.jsx("div",{className:Qf("file-attachment-container","transition-all duration-300 ease-out",n?"translate-y-0 opacity-100":"translate-y-2 opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx(NI,{file:e,onClick:s,overrideType:r,containerClassName:"max-w-fit",buttonClassName:"bg-surface-secondary hover:cursor-pointer hover:bg-surface-hover active:bg-surface-secondary focus:bg-surface-hover hover:border-border-heavy active:border-border-heavy"})}):null})),mA=Sa((({attachment:e})=>{const[t,n]=ja(!1),{width:a,height:s,filepath:r=null}=e;return ya((()=>{n(!1);const e=setTimeout((()=>n(!0)),100);return()=>clearTimeout(e)}),[e]),l.jsx("div",{className:Qf("image-attachment-container","transition-all duration-500 ease-out",t?"scale-100 opacity-100":"scale-[0.98] opacity-0"),style:{transformOrigin:"center top",willChange:"opacity, transform",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx(lA,{altText:e.filename||"attachment image",imagePath:r??"",height:s??0,width:a??0,className:"mb-4"})})}));function pA({attachments:e}){if(!e||0===e.length)return null;const t=[],n=[];return e.forEach((e=>{const{width:a,height:s,filepath:r=null}=e;!!e.filename&&(td.test(e.filename)&&null!=a&&null!=s&&null!=r)?n.push(e):e.type!==Nl.web_search&&t.push(e)})),l.jsxs(l.Fragment,{children:[t.length>0&&l.jsx("div",{className:"my-2 flex flex-wrap items-center gap-2.5",children:t.map(((e,t)=>e.filepath?l.jsx(uA,{attachment:e},`file-${t}`):null))}),n.length>0&&l.jsx("div",{className:"mb-2 flex flex-wrap items-center",children:n.map(((e,t)=>l.jsx(mA,{attachment:e},`image-${t}`)))})]})}function hA({progress:e,error:t,toolName:n="image_gen_oai"}){const a=qN(),s=a(t?"com_ui_error":"image_edit_oai"===n?e>=1?"com_ui_image_edited":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_edit_editing_image":"com_ui_getting_started":e>=1?"com_ui_image_created":e>=.7?"com_ui_final_touch":e>=.5?"com_ui_adding_details":e>=.3?"com_ui_creating_image":"com_ui_getting_started");return l.jsx("div",{className:Qf("progress-text-content pointer-events-none absolute left-0 top-0 inline-flex w-full items-center gap-2 overflow-visible whitespace-nowrap"),children:l.jsx("span",{className:"font-medium "+(e<1?"shimmer":""),children:s})})}function gA({initialProgress:e=.1,isSubmitting:t,toolName:n,args:a="",output:s,attachments:r}){var o,i;const[c,d]=ja(e),u=ba(null),m="string"==typeof s&&s.toLowerCase().includes("error processing tool"),p=!t&&e<1||!0===m;let h,g,x,f="high";try{x="string"==typeof a?JSON.parse(a):a}catch(E){console.error("Error parsing args:",E),x={}}try{const e=x;if(e&&"string"==typeof e.size){const[t,n]=e.size.split("x").map((e=>parseInt(e,10)));isNaN(t)||isNaN(n)||(h=t,g=n)}else!e||"string"==typeof e.size&&e.size||(h=void 0,g=void 0);if(e&&"string"==typeof e.quality){const t=e.quality.toLowerCase();"low"!==t&&"medium"!==t&&"high"!==t||(f=t)}}catch(I){h=void 0,g=void 0}const v=null==r?void 0:r[0],{width:_,height:b,filepath:y=null,filename:j=""}=v||{};let w=h??_,N=g??b;void 0!==w&&void 0!==N||(w=1024,N=1024);const[k,C]=ja({width:"auto",height:"auto"}),S=ba(null),T=ka((()=>{if(w&&N&&S.current){const e=Yf({originalWidth:w,originalHeight:N,containerRef:S});C(e)}}),[w,N]);return ya((()=>{if(t){d(e),u.current&&clearInterval(u.current);let t=2e4;"low"===f?t=1e4:"high"===f&&(t=5e4);const n=Math.floor(.3*t),a=200,s=(Math.floor(Math.random()*n)+t)/a;let r=0;u.current=setInterval((()=>{if(r++,r>=s)clearInterval(u.current),d(.9);else{const e=r/s;let t;if(e<.8)t=Math.pow(e,1.1);else{const n=(e-.8)/.2;t=.8+.2*(1-Math.pow(1-n,2))}d(.1+.8*t)}}),a)}return()=>{u.current&&clearInterval(u.current)}}),[t,e,f]),ya((()=>{(e>=1||p)&&(d(e),u.current&&clearInterval(u.current))}),[e,p]),ya((()=>{T();const e=new ResizeObserver((()=>{T()}));return S.current&&e.observe(S.current),()=>{e.disconnect()}}),[T]),l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:l.jsx(hA,{progress:c,error:p,toolName:n})}),l.jsx("div",{className:"relative mb-2 flex w-full justify-start",children:l.jsxs("div",{ref:S,className:"w-full max-w-lg",children:["auto"!==k.width&&c<1&&l.jsx(co,{variant:"default",progress:c,randomness:.6,width:k.width,height:k.height}),l.jsx(lA,{altText:j,imagePath:y??"",width:Number(null==(o=k.width)?void 0:o.split("px")[0]),height:Number(null==(i=k.height)?void 0:i.split("px")[0]),placeholderDimensions:{width:k.width,height:k.height},args:x})]})})]})}class xA extends _a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Markdown rendering error:",e,t)}componentDidUpdate(e){e.content!==this.props.content&&this.state.hasError&&this.setState({hasError:!1,error:void 0})}render(){if(this.state.hasError){const{content:e,codeExecution:t=!0}=this.props,n=[[Ji,{detect:!0,ignoreMissing:!0,subset:hf}]];return l.jsx(Dk,{children:l.jsx(Xi,{remarkPlugins:[Zi,el],rehypePlugins:n,components:{code:t?mP:pP,a:hP,p:gP},children:e})})}return this.props.children}}const fA=Sa((({content:e="",codeExecution:t=!0})=>{const n=[[tl],[Ji,{detect:!0,ignoreMissing:!0,subset:hf}]];return l.jsx(xA,{content:e,codeExecution:t,children:l.jsx(Lk,{children:l.jsx(Dk,{children:l.jsx(Xi,{remarkPlugins:[Zi,el,[nl,{singleDollarTextMath:!1}]],rehypePlugins:n,components:{code:t?mP:pP,a:hP,p:gP,img:xP},children:e})})})})}));function vA(e){return`https://www.google.com/s2/favicons?domain=${e}&sz=32`}function _A(e){const t=e.replace(/(^\w+:|^)\/\//,"").split("/")[0];return t.startsWith("www.")?t.substring(4):t}function bA({domain:e,className:t=""}){return l.jsxs("div",{className:Qf("relative size-4 flex-shrink-0 overflow-hidden rounded-full",t),children:[l.jsx("div",{className:"absolute inset-0 rounded-full bg-white"}),l.jsx("img",{src:vA(e),alt:e,className:"relative size-full"}),l.jsx("div",{className:"border-border-light/10 absolute inset-0 rounded-full border dark:border-transparent"})]})}function yA({source:e,label:t,onMouseEnter:n,onMouseLeave:a,onClick:s,isFile:r=!1,isLocalFile:o=!1,children:i}){const c=qN(),d=_A(e.link||"");return l.jsx("span",{className:"relative ml-0.5 inline-block",children:l.jsx(ot,{showTimeout:150,hideTimeout:150,children:l.jsxs("span",{className:"flex items-center",children:[l.jsx(it,{render:r?l.jsx("button",{onClick:s,className:"ml-1 inline-block h-5 max-w-36 cursor-pointer items-center overflow-hidden text-ellipsis whitespace-nowrap rounded-xl border border-border-heavy bg-surface-secondary px-2 text-xs font-medium text-blue-600 no-underline transition-colors hover:bg-surface-hover dark:border-border-medium dark:text-blue-400 dark:hover:bg-surface-tertiary",onMouseEnter:n,onMouseLeave:a,title:o?c("com_sources_download_local_unavailable"):void 0,children:t}):l.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"ml-1 inline-block h-5 max-w-36 cursor-pointer items-center overflow-hidden text-ellipsis whitespace-nowrap rounded-xl border border-border-heavy bg-surface-secondary px-2 text-xs font-medium no-underline transition-colors hover:bg-surface-hover dark:border-border-medium dark:hover:bg-surface-tertiary",onMouseEnter:n,onMouseLeave:a,children:t})}),l.jsxs(lt,{className:"ml-0.5 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(ct,{children:c("com_citation_more_details",{label:t})}),l.jsx(he,{className:"icon-sm","aria-hidden":"true"})]}),l.jsxs(dt,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:[i,!i&&l.jsxs(l.Fragment,{children:[l.jsxs("span",{className:"mb-2 flex items-center",children:[r?l.jsx("div",{className:"mr-2 flex h-4 w-4 items-center justify-center",children:l.jsx(ut,{className:"h-3 w-3 text-text-secondary"})}):l.jsx(bA,{domain:d,className:"mr-2"}),r?l.jsx("button",{onClick:s,className:"line-clamp-2 cursor-pointer overflow-hidden text-left text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||e.title||c("com_file_source")}):l.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||d})]}),r?l.jsx(l.Fragment,{children:e.snippet&&l.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})}):l.jsxs(l.Fragment,{children:[l.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),e.snippet&&l.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]})]})]})]})})})}const jA=wa({hoveredCitationId:null,setHoveredCitationId:()=>{}}),wA={search:"organic",ref:"references",news:"topStories",file:"references"};function NA(e){var t;const n=qN(),{citations:a,citationId:s}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:r}=Na(jA),[o,i]=ja(0),c=function(e){const{searchResults:t}=Vk(),n=[];for(const{turn:a,refType:s,index:r}of e){const e=wA[s.toLowerCase()]?wA[s.toLowerCase()]:s;if(!t||!t[a]||!t[a][e])continue;const o=t[a][e][r];o&&n.push({...o,turn:a,refType:s.toLowerCase(),index:r,link:o.link??"",title:o.title??"",snippet:o.snippet??"",attribution:o.attribution??""})}return n}(a||[]);if(!c||0===c.length)return null;const d=c.length,u=null==c?void 0:c[o];return l.jsxs(yA,{source:u,label:(()=>{if(!c||0===c.length)return n("com_citation_source");const e=c[0],t=c.length-1,a=e.attribution||e.title||_A(e.link||"")||n("com_citation_source");return t>0?`${a} +${t}`:a})(),onMouseEnter:()=>r(s||null),onMouseLeave:()=>r(null),children:[d>1&&l.jsxs("span",{className:"mb-2 flex items-center justify-between border-b border-border-heavy pb-2",children:[l.jsxs("span",{className:"flex gap-2",children:[l.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),o>0&&i(o-1)},disabled:0===o,style:{opacity:0===o?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:""}),l.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),o<d-1&&i(o+1)},disabled:o===d-1,style:{opacity:o===d-1?.5:1},className:"flex cursor-pointer items-center justify-center border-none bg-transparent p-0 text-base",children:""})]}),l.jsxs("span",{className:"text-xs text-text-tertiary",children:[o+1,"/",d]})]}),l.jsxs("span",{className:"mb-2 flex items-center",children:[l.jsx(bA,{domain:_A(u.link||""),className:"mr-2"}),l.jsx("a",{href:u.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:u.attribution})]}),l.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:u.title}),l.jsx("p",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:u.snippet})]})}function kA(e){var t,n;const a=qN(),s=j(N_.user),{showToast:r}=Ds(),{citation:o,citationId:i}=(null==(t=e.node)?void 0:t.properties)??{},{setHoveredCitationId:c}=Na(jA),d=function({turn:e,index:t,refType:n}){const{searchResults:a}=Vk();if(!n)return;const s=wA[n.toLowerCase()]?wA[n.toLowerCase()]:n;if(!a||!a[e]||!a[e][s])return;const r=a[e][s][t];return r?{...r,turn:e,refType:n.toLowerCase(),index:t,link:r.link??"",title:r.title??"",snippet:r.snippet??"",attribution:r.attribution??""}:void 0}({turn:(null==o?void 0:o.turn)||0,refType:null==o?void 0:o.refType,index:(null==o?void 0:o.index)||0}),u="file"===(null==d?void 0:d.refType)&&(null==d?void 0:d.fileId),m=u&&"local"===(null==(n=null==d?void 0:d.metadata)?void 0:n.storageType),{refetch:p}=X_((null==s?void 0:s.id)??"",u&&!m?d.fileId:""),h=ka((async e=>{if(e.preventDefault(),e.stopPropagation(),u&&(null==d?void 0:d.fileId))if(m)r({status:"error",message:a("com_sources_download_local_unavailable")});else try{const e=await p();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void r({status:"error",message:a("com_ui_download_error")});const t=document.createElement("a");t.href=e.data,t.setAttribute("download",d.fileName||"file"),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e.data)}catch(t){console.error("Error downloading file:",t),r({status:"error",message:a("com_ui_download_error")})}}),[p,u,m,d,a,r]);if(!d)return null;return l.jsx(yA,{source:d,label:d.attribution||d.title||_A(d.link||"")||a("com_citation_source"),onMouseEnter:()=>c(i||null),onMouseLeave:()=>c(null),onClick:u&&!m?h:void 0,isFile:u,isLocalFile:m})}const CA=Sa((function({children:e,citationId:t}){const n=function(e){const{hoveredCitationId:t}=Na(jA);return e&&t===e}(t);return l.jsx("span",{className:"rounded px-0 py-0.5 transition-colors "+(n?"bg-amber-300/20":""),children:e})})),SA=/\\ui\{([\w]+(?:,[\w]+)*)\}/g;function TA(){return e=>{!function(e){mt(e,"text",((e,t,n)=>{var a;const s=e,r=n;if("string"!=typeof s.value)return;const o=s.value,i=[];let l,c=0;for(SA.lastIndex=0;null!==(l=SA.exec(o));){const e=l.index,t=l[0],n=l[1].split(",").map((e=>e.trim())).filter(Boolean);if(e>c){const t=o.substring(c,e);t&&i.push({type:"text",value:t})}1===n.length?i.push({type:"mcp-ui-resource",data:{hName:"mcp-ui-resource",hProperties:{resourceId:n[0]}}}):n.length>1?i.push({type:"mcp-ui-carousel",data:{hName:"mcp-ui-carousel",hProperties:{resourceIds:n}}}):i.push({type:"text",value:t}),c=e+t.length}if(c<o.length){const e=o.substring(c);e&&i.push({type:"text",value:e})}return i.length>0&&void 0!==t?(null==(a=r.children)||a.splice(t,1,...i),t+i.length):void 0}))}(e)}}function EA(e){const{getMessages:t}=lC(),n=j(N_.conversationAttachmentsSelector(e));return Ca((()=>{var a;const s=new Map,r=e=>{null==e||e.filter((e=>(null==e?void 0:e.type)===Nl.ui_resources)).forEach((e=>{const t=null==e?void 0:e[Nl.ui_resources];Array.isArray(t)&&t.forEach((e=>{(null==e?void 0:e.resourceId)&&s.set(e.resourceId,e)}))}))};return null==(a=t())||a.forEach((e=>{r(e.attachments)})),e&&Object.values(n).forEach(r),s}),[e,t,n])}function IA(e){const{resourceId:t}=e.node.properties,n=qN(),{ask:a}=lC(),{conversation:s}=iC(),r=EA((null==s?void 0:s.conversationId)??void 0).get(t??"");if(!r)return l.jsx("span",{className:"inline-flex items-center rounded bg-gray-100 px-2 py-1 text-xs font-medium text-gray-600",children:n("com_ui_ui_resource_not_found",{0:t??""})});try{return l.jsx("span",{className:"mx-1 inline-block w-full align-middle",children:l.jsx(pt,{resource:r,onUIAction:async e=>uv(e,a),htmlProps:{autoResizeIframe:{width:!0,height:!0},sandboxPermissions:"allow-popups"}})})}catch(o){return console.error("Error rendering UI resource:",o),l.jsx("span",{className:"inline-flex items-center rounded bg-red-50 px-2 py-1 text-xs font-medium text-red-600",children:n("com_ui_ui_resource_error",{0:r.name||t})})}}const RA=_a.memo((({uiResources:e})=>{const[t,n]=ja(!1),[a,s]=ja(!0),[r,o]=ja(!1),i=_a.useRef(null),{ask:c}=lC(),d=_a.useCallback((()=>{if(!i.current)return;const{scrollLeft:e,scrollWidth:t,clientWidth:a}=i.current;n(e>0),s(e<t-a-10)}),[]),u=_a.useCallback((e=>{if(!i.current)return;const t=i.current.clientWidth,n=Math.floor(.9*t),a=i.current.scrollLeft,s="left"===e?a-n:a+n;i.current.scrollTo({left:s,behavior:"smooth"})}),[]);return _a.useEffect((()=>{const e=i.current;if(e)return e.addEventListener("scroll",d),d(),()=>e.removeEventListener("scroll",d)}),[d]),0===e.length?null:l.jsxs("div",{className:"relative mb-4 pt-3",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[l.jsx("div",{className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-24 bg-gradient-to-r from-surface-primary to-transparent transition-opacity duration-500 ease-in-out "+(t?"opacity-100":"opacity-0")}),l.jsx("div",{className:"pointer-events-none absolute right-0 top-0 z-10 h-full w-24 bg-gradient-to-l from-surface-primary to-transparent transition-opacity duration-500 ease-in-out "+(a?"opacity-100":"opacity-0")}),t&&l.jsx("button",{type:"button",onClick:()=>u("left"),className:"absolute left-2 top-1/2 z-20 -translate-y-1/2 rounded-xl bg-white p-2 text-gray-800 shadow-lg transition-all duration-200 hover:scale-110 hover:bg-gray-100 hover:shadow-xl active:scale-95 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-300 "+(r?"opacity-100":"pointer-events-none opacity-0"),"aria-label":"Scroll left",children:l.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),l.jsx("div",{ref:i,className:"hide-scrollbar flex gap-4 overflow-x-auto scroll-smooth",children:e.map(((e,t)=>l.jsx("div",{className:"flex-shrink-0 transform-gpu transition-all duration-300 ease-out animate-in fade-in-0 slide-in-from-bottom-5",style:{width:"230px",minHeight:"360px",animationDelay:100*t+"ms"},children:l.jsx("div",{className:"flex h-full flex-col",children:l.jsx(pt,{resource:{uri:e.uri,mimeType:e.mimeType,text:e.text},onUIAction:async e=>uv(e,c),htmlProps:{autoResizeIframe:{width:!0,height:!0}}})})},t)))}),a&&l.jsx("button",{type:"button",onClick:()=>u("right"),className:"absolute right-2 top-1/2 z-20 -translate-y-1/2 rounded-xl bg-white p-2 text-gray-800 shadow-lg transition-all duration-200 hover:scale-110 hover:bg-gray-100 hover:shadow-xl active:scale-95 dark:bg-gray-200 dark:text-gray-800 dark:hover:bg-gray-300 "+(r?"opacity-100":"pointer-events-none opacity-0"),"aria-label":"Scroll right",children:l.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}));function AA(e){const{conversation:t}=iC(),n=EA((null==t?void 0:t.conversationId)??void 0),a=Ca((()=>{const{resourceIds:t=[]}=e.node.properties;return t.map((e=>n.get(e))).filter(Boolean)}),[e.node.properties,n]);return 0===a.length?null:l.jsx(RA,{uiResources:a})}const PA=({artifact:e})=>{const t=qN(),n=T(),a=y(N_.artifactsVisibility),[s,r]=b(N_.artifactsState),[o,i]=b(N_.currentArtifactId),c=S(N_.currentArtifactId),d=(null==e?void 0:e.id)===o,[u,m]=b(N_.visibleArtifacts),p=ba(xi((e=>{cx.log("artifacts_visibility","Setting artifact to visible state from Artifact button",e),m((t=>({...t,[e.id]:e})))}),750));if(ya((()=>{if(null==e||null==(null==e?void 0:e.id)||""===e.id)return;if(!Xx(n.pathname))return;const t=p.current;return t(e),()=>{t.cancel()}}),[e,n.pathname]),null==e)return null;const h=_x("artifact");return l.jsxs("div",{className:"group relative my-4 rounded-xl text-sm text-text-primary",children:[(()=>{const n=Qf("relative overflow-hidden rounded-xl transition-all duration-300 hover:border-border-medium hover:bg-surface-hover hover:shadow-lg active:scale-[0.98]",{"border-border-medium bg-surface-hover shadow-lg":d,"border-border-light bg-surface-tertiary shadow-sm":!d}),o=t(d?"com_ui_click_to_close":"com_ui_artifact_click");return l.jsx("button",{type:"button",onClick:()=>{if(d)return c(),void a(!1);c(),a(!0),null==(null==s?void 0:s[e.id])&&r(u),setTimeout((()=>{i(e.id)}),15)},className:n,children:l.jsx("div",{className:"w-fit p-2",children:l.jsxs("div",{className:"flex flex-row items-center gap-2",children:[l.jsx(jI,{fileType:h,className:"relative"}),l.jsxs("div",{className:"overflow-hidden text-left",children:[l.jsx("div",{className:"truncate font-medium",children:e.title}),l.jsx("div",{className:"truncate text-text-secondary",children:o})]})]})})})})(),l.jsx("br",{})]})},OA=()=>e=>{mt(e,["textDirective","leafDirective","containerDirective"],((e,t,n)=>{if("textDirective"===e.type){const a=`:${e.name}`;n&&Array.isArray(n.children)&&"number"==typeof t&&(n.children[t]={type:"text",value:a})}if("artifact"===e.name)return e.data={hName:e.name,hProperties:e.attributes,...e.data},e}))},LA="untitled",MA="unknown",DA="lc-no-identifier";function FA({node:e,...t}){const n=T(),{messageId:a}=Ck(),{getNextIndex:s,resetCounter:r}=Na(Ok),o=ba(s(!1)).current,i=y(mv),[c,d]=ja(null),u=ba(_i((e=>{e()}),25)),m=ka((()=>{const e=cv(t.children);cx.log("artifacts","updateArtifact: content.length",e.length);const s=t.title??LA,r=t.type??MA,l=t.identifier??DA,c=`${l}_${r}_${s}_${a}`.replace(/\s+/g,"_").toLowerCase();u.current((()=>{const t=Date.now();if(c===`${DA}_${MA}_${LA}_${a}`)return;const u={id:c,identifier:l,title:s,type:r,content:e,messageId:a,index:o,lastUpdateTime:t};if(!Xx(n.pathname))return d(u);i((t=>{var n;return null!=(null==t?void 0:t[c])&&(null==(n=t[c])?void 0:n.content)===e?t:{...t,[c]:u}})),d(u)}))}),[t.type,t.title,i,t.children,t.identifier,a,o,n.pathname]);return ya((()=>{r(),m()}),[m,r]),l.jsx(PA,{artifact:c})}function UA(e,t){const n=e.substring(0,t),a=n.lastIndexOf("\\ue200"),s=n.lastIndexOf(""),r=Math.max(a,s),o=n.lastIndexOf("\\ue201"),i=n.lastIndexOf(""),l=Math.max(o,i);return-1===r||-1!==l&&l>r}function zA(e,t){cS.lastIndex=t,dS.lastIndex=t,uS.lastIndex=t;const n=cS.exec(e),a=dS.exec(e);let s,r=null;for(uS.lastIndex=t;!r&&null!==(s=uS.exec(e));)UA(e,s.index)&&(r=s);let o=null,i="",l=-1,c=-1;return n&&(!o||n.index<l||-1===l)&&(o=n,i="span",l=n.index,c=0),a&&(!o||a.index<l||-1===l)&&(o=a,i="composite",l=a.index,c=0),r&&(!o||r.index<l||-1===l)&&(o=r,i="standalone",l=r.index,c=0),o?{type:i,match:o,index:c}:null}function VA(){return e=>{!function(e){mt(e,"text",((e,t,n)=>{var a;const s=e,r=n;if("string"!=typeof s.value)return;const o=s.value,i=[];let l=0;const c=new Map,d={span:0,composite:0,standalone:0};for(;l<o.length;){const e=zA(o,l);if(!e){const e=o.substring(l).replace(mS,"");e&&i.push({type:"text",value:e});break}const{type:t,match:n}=e,a=n.index,s=n[0];if(a>l){const e=o.substring(l,a).replace(mS,"");e&&i.push({type:"text",value:e})}const r=`${t}-${d[t]}-${a}`;switch(c.set(a,r),t){case"span":{const e=s.replace(/\\ue203|\\ue204/g,"");let t=null;const n=a+s.length,r=zA(o,n);if(r&&("standalone"===r.type||"composite"===r.type)&&r.match.index-n<5){const e=r.match.index,n=r.type;t=`${n}-${d[n]}-${e}`}i.push({type:"highlighted-text",data:{hName:"highlighted-text",hProperties:{citationId:t}},children:[{type:"text",value:e}]}),d.span++;break}case"composite":{const e=s,t=new RegExp(uS.source,"g");let n;const a=[];for(;null!==(n=t.exec(e));){const e=Number(n[1]),t=n[2],s=Number(n[3]);a.push({turn:e,refType:t,index:s})}a.length>0&&i.push({type:"composite-citation",data:{hName:"composite-citation",hProperties:{citations:a,citationId:r}}}),d.composite++;break}case"standalone":{const e=Number(n[1]),t=n[2],a=Number(n[3]);i.push({type:"citation",data:{hName:"citation",hProperties:{citation:{turn:e,refType:t,index:a},citationType:"standalone",citationId:r}}}),d.standalone++;break}}l=a+s.length}if(i.length>0&&void 0!==t)return null==(a=r.children)||a.splice(t,1,...i),t+i.length;s.value!==s.value.replace(mS,"")&&(s.value=s.value.replace(mS,""))}))}(e)}}const $A=Sa((({content:e="",isLatestMessage:t})=>{const n=j(N_.LaTeXParsing),a=""===e,s=Ca((()=>a?"":n?Rx(e):e),[e,n,a]),r=Ca((()=>[[tl],[Ji,{detect:!0,ignoreMissing:!0,subset:hf}]]),[]),o=[Zi,el,al,OA,[nl,{singleDollarTextMath:!1}],VA,TA];return a?l.jsx("div",{className:"absolute",children:l.jsx("p",{className:"relative",children:l.jsx("span",{className:t?"result-thinking":""})})}):l.jsx(xA,{content:e,codeExecution:!0,children:l.jsx(Lk,{children:l.jsx(Dk,{children:l.jsx(Xi,{remarkPlugins:o,rehypePlugins:r,components:{code:mP,a:hP,p:gP,img:xP,artifact:FA,citation:kA,"highlighted-text":CA,"composite-citation":NA,"mcp-ui-resource":IA,"mcp-ui-carousel":AA},children:s})})})})})),BA=Sa((({text:e,isCreatedByUser:t,showCursor:n})=>{const{isSubmitting:a=!1,isLatestMessage:s=!1}=Ck(),r=j(N_.enableUserMsgMarkdown),o=Ca((()=>n&&a),[n,a]),i=Ca((()=>t?r?l.jsx(fA,{content:e}):l.jsx(l.Fragment,{children:e}):l.jsx($A,{content:e,isLatestMessage:s})),[t,r,e,s]);return l.jsx("div",{className:Qf(a?"submitting":"",o&&e.length?"result-streaming":"","markdown prose message-content dark:prose-invert light w-full break-words",t&&!r&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:i})})),HA=j_("showThinking",!1),GA=Sa((({children:e})=>{const t=ht(oT);return l.jsx("div",{className:"relative rounded-3xl border border-border-medium bg-surface-tertiary p-4 text-text-secondary",children:l.jsx("p",{className:Qf("whitespace-pre-wrap leading-[26px]",t),children:e})})})),KA=Sa((({isExpanded:e,onClick:t,label:n,content:a,showCopyButton:s=!0})=>{const r=qN(),o=ht(oT),[i,c]=ja(!1),d=ka((e=>{e.stopPropagation(),a&&(navigator.clipboard.writeText(a),c(!0),setTimeout((()=>c(!1)),2e3))}),[a]);return l.jsxs("div",{className:"group/thinking flex w-full items-center justify-between gap-2",children:[l.jsxs("button",{type:"button",onClick:t,"aria-expanded":e,className:Qf("group/button flex flex-1 items-center justify-start rounded-lg leading-[18px]",o),children:[l.jsxs("span",{className:"relative mr-1.5 inline-flex h-[18px] w-[18px] items-center justify-center",children:[l.jsx(U,{className:"icon-sm absolute text-text-secondary opacity-100 transition-opacity group-hover/button:opacity-0","aria-hidden":"true"}),l.jsx(he,{className:Qf("icon-sm absolute transform-gpu text-text-primary opacity-0 transition-all duration-300 group-hover/button:opacity-100",e&&"rotate-180"),"aria-hidden":"true"})]}),n]}),a&&s&&l.jsx("button",{type:"button",onClick:d,title:r(i?"com_ui_copied_to_clipboard":"com_ui_copy_thoughts_to_clipboard"),className:Qf("rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200",e?"opacity-0 group-focus-within/thinking-container:opacity-100 group-hover/thinking-container:opacity-100":"opacity-0","hover:bg-surface-hover hover:text-text-primary","focus-visible:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white"),children:i?l.jsx(uo,{className:"h-[18px] w-[18px]"}):l.jsx(mo,{size:"19"})})]})})),WA=Sa((({children:e})=>{const t=qN(),n=ht(HA),[a,s]=ja(n),r=ka((e=>{e.preventDefault(),s((e=>!e))}),[]),o=Ca((()=>t("com_ui_thoughts")),[t]),i=Ca((()=>"string"==typeof e?e:""),[e]);return null==e?null:l.jsxs("div",{className:"group/thinking-container",children:[l.jsx("div",{className:"sticky top-0 z-10 mb-4 bg-presentation pb-2 pt-2",children:l.jsx(KA,{isExpanded:a,onClick:r,label:o,content:i})}),l.jsx("div",{className:Qf("grid transition-all duration-300 ease-out",a&&"mb-8"),style:{gridTemplateRows:a?"1fr":"0fr"},children:l.jsx("div",{className:"overflow-hidden",children:l.jsx(GA,{children:e})})})]})}));KA.displayName="ThinkingButton",GA.displayName="ThinkingContent",WA.displayName="Thinking";const qA=Sa(WA),QA=Sa((({reasoning:e,isLast:t})=>{const n=qN(),[a]=X(HA),[s,r]=ja(a),{isSubmitting:o,isLatestMessage:i,nextType:c}=Ck(),d=Ca((()=>e.replace(/^<think>\s*/,"").replace(/\s*<\/think>$/,"").trim()),[e]),u=ka((e=>{e.preventDefault(),r((e=>!e))}),[]),m=!!i&&o,p=Ca((()=>n(m&&t?"com_ui_thinking":"com_ui_thoughts")),[m,n,t]);return d?l.jsx("div",{className:"group/reasoning",children:l.jsxs("div",{className:"group/thinking-container",children:[l.jsx("div",{className:"sticky top-0 z-10 mb-2 bg-presentation pb-2 pt-2",children:l.jsx(KA,{isExpanded:s,onClick:u,label:p,content:d})}),l.jsx("div",{className:Qf("grid transition-all duration-300 ease-out",c!==qm.THINK&&s&&"mb-4"),style:{gridTemplateRows:s?"1fr":"0fr"},children:l.jsx("div",{className:"overflow-hidden",children:l.jsx(GA,{children:d})})})]})}):null})),YA=Sa((()=>l.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:l.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:l.jsx("div",{className:"absolute",children:l.jsx("p",{className:"submitting relative",children:l.jsx("span",{className:"result-thinking"})})})})}))),XA=({output:e="",renderImages:t,attachments:n})=>{const a=qN(),s=Ca((()=>{if(!e)return"";return e.split("Generated files:")[0].trim()}),[e]),{imageAttachments:r,nonImageAttachments:o}=Ca((()=>{const e=[],a=[];return null==n||n.forEach((t=>{const{width:n,height:s,filepath:r=null}=t;td.test(t.filename??"")&&null!=n&&null!=s&&null!=r?e.push(t):a.push(t)})),{imageAttachments:!0===t?e:null,nonImageAttachments:a}}),[n,t]),i=e=>{const t=new Date,n="expiresAt"in e&&"number"==typeof e.expiresAt?new Date(e.expiresAt):null,s=!!n&&Ii(t,n),r=e.filename||"";if(s)return`${r} ${a("com_download_expired")}`;const o=e.filepath||"";return l.jsxs(dA,{href:o,filename:r,children:["- ",r," ",a("com_click_to_download")]})};return l.jsxs(l.Fragment,{children:[s&&l.jsx("div",{children:s}),o.length>0&&l.jsxs("div",{children:[l.jsx("p",{children:a("com_generated_files")}),o.map(((e,t)=>l.jsxs(_a.Fragment,{children:[i(e),t<o.length-1&&", "]},e.filepath)))]}),null==r?void 0:r.map(((e,t)=>{const{width:n,height:a,filepath:s}=e;return l.jsx(lA,{altText:e.filename,imagePath:s,height:a,width:n},t)}))]})};function JA(){return l.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full bg-transparent text-text-secondary",children:l.jsx(re,{className:"size-4","aria-hidden":"true"})})}function ZA(){return l.jsx("div",{className:"flex size-4 items-center justify-center rounded-full bg-brand-purple text-white","data-projection-id":"162",children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 8",fill:"none",width:"8",height:"8",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.66607 0.376042C8.01072 0.605806 8.10385 1.07146 7.87408 1.4161L3.54075 7.9161C3.40573 8.11863 3.18083 8.24304 2.93752 8.24979C2.69421 8.25654 2.46275 8.1448 2.31671 7.95008L0.150044 5.06119C-0.098484 4.72982 -0.0313267 4.25972 0.300044 4.01119C0.631415 3.76266 1.10152 3.82982 1.35004 4.16119L2.88068 6.20204L6.62601 0.584055C6.85577 0.239408 7.32142 0.146278 7.66607 0.376042Z",fill:"currentColor"})})})}const eP="progress-text-wrapper text-token-text-secondary relative -mt-[0.75px] h-5 w-full leading-5",tP=({popover:e,children:t})=>e?l.jsx("div",{className:eP,children:l.jsx(Qa,{asChild:!0,children:l.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})})}):l.jsx("div",{className:eP,children:l.jsx("div",{className:"progress-text-content absolute left-0 top-0 overflow-visible whitespace-nowrap",style:{opacity:1,transform:"none"},"data-projection-id":"78",children:t})});function nP({progress:e,onClick:t,inProgressText:n,finishedText:a,authText:s,hasInput:r=!0,popover:o=!1,isExpanded:i=!1,error:c=!1}){const d=c?a:e<1?s??n:a,u=c?l.jsx(JA,{}):e<1?l.jsx(Xs,{}):l.jsx(ZA,{}),m=e<1&&!c;return l.jsx(tP,{popover:o,children:l.jsxs("button",{type:"button",className:Qf("inline-flex w-full items-center gap-2",r?"":"pointer-events-none"),disabled:!r,onClick:r?t:void 0,"aria-expanded":r?i:void 0,children:[u,l.jsx("span",{className:m?"shimmer":"",children:d}),r&&(i?l.jsx(gt,{className:"size-4 shrink-0 translate-y-[1px]","aria-hidden":"true"}):l.jsx(he,{className:"size-4 shrink-0 translate-y-[1px]","aria-hidden":"true"}))]})})}const aP=({output:e=""})=>{const t=Ca((()=>{if(!e)return"";return e.split("Generated files:")[0].trim()}),[e]);return t&&l.jsx("pre",{className:"shrink-0",children:l.jsx("div",{className:"text-text-primary",children:t})})};function sP({isSubmitting:e,initialProgress:t=.1,args:n,output:a="",attachments:s}){const r=qN(),o=a.length>0,i=ba(a),c=ba(null),[d,u]=ja(!1),m=j(N_.showCode),[p,h]=ja(m),[g,x]=ja(0),f=ba(p),{lang:v,code:_}=function(e){return Ca((()=>{let t=e;try{t=JSON.parse(e||"")}catch{}if("object"==typeof t)return t;const n=null==e?void 0:e.match(/"lang"\s*:\s*"(\w+)"/),a=null==e?void 0:e.match(/"code"\s*:\s*"(.+?)(?="\s*,\s*"(session_id|args)"|"\s*})/s);let s="";return a&&(s=a[1],s.endsWith('"}')&&(s=s.slice(0,-2)),s=s.replace(/\\n/g,"\n").replace(/\\"/g,'"').replace(/\\\\/g,"\\")),{lang:n?n[1]:"",code:s}}),[e])}(n)??{},b=rS(t);ya((()=>{a!==i.current&&(i.current=a,p&&c.current&&setTimeout((()=>{if(c.current){const e=c.current.scrollHeight;x(e)}}),10))}),[a,p]),ya((()=>{if(p!==f.current)if(f.current=p,p&&c.current)u(!0),requestAnimationFrame((()=>{if(c.current){const e=c.current.scrollHeight;x(e)}const e=setTimeout((()=>{u(!1)}),500);return()=>clearTimeout(e)}));else if(!p){u(!0),x(0);const e=setTimeout((()=>{u(!1)}),500);return()=>clearTimeout(e)}}),[p]),ya((()=>{if(!c.current)return;const e=new ResizeObserver((e=>{if(p&&!d)for(const t of e)t.target===c.current&&x(t.contentRect.height)}));return e.observe(c.current),()=>{e.disconnect()}}),[p,d]);const y=!e&&b<1;return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:l.jsx(nP,{progress:b,onClick:()=>h((e=>!e)),inProgressText:r("com_ui_analyzing"),finishedText:r(y?"com_ui_cancelled":"com_ui_analyzing_finished"),hasInput:!!(null==_?void 0:_.length),isExpanded:p,error:y})}),l.jsx("div",{className:"relative mb-2",style:{height:p?g:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:p?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsxs("div",{className:Qf("code-analyze-block mt-0.5 overflow-hidden rounded-xl bg-surface-primary",p&&"shadow-lg"),ref:c,style:{transform:p?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:p?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:[p&&l.jsx("div",{style:{transform:p?"translateY(0)":"translateY(-4px)",opacity:p?1:0,transition:"transform 0.35s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.35s cubic-bezier(0.16, 1, 0.3, 1)"},children:l.jsx(fA,{content:_?`\`\`\`${v}\n${_}\n\`\`\``:"",codeExecution:!1})}),o&&l.jsx("div",{className:Qf("bg-surface-tertiary p-4 text-xs",p?"border-t border-surface-primary-contrast":""),style:{transform:p?"translateY(0)":"translateY(-6px)",opacity:p?1:0,transition:"transform 0.45s cubic-bezier(0.16, 1, 0.3, 1) 0.05s, opacity 0.45s cubic-bezier(0.19, 1, 0.22, 1) 0.05s",boxShadow:p?"0 -1px 0 rgba(0,0,0,0.05)":"none"},children:l.jsx("div",{className:"prose flex flex-col-reverse",children:l.jsx(aP,{output:a})})})]})}),s&&s.length>0&&l.jsx(pA,{attachments:s})]})}const rP=({currentAgentId:e})=>{const t=qN(),n=WN(),a=Ca((()=>null==n?void 0:n[e]),[n,e]);return e?l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute -left-6 flex h-full w-4 items-center justify-center",children:l.jsxs("div",{className:"relative h-full w-4",children:[l.jsx("div",{className:"absolute left-0 top-0 h-1/2 w-px border border-border-medium"}),l.jsx("div",{className:"absolute left-0 top-1/2 h-px w-3 border border-border-medium"})]})}),l.jsxs("div",{className:"my-4 flex items-center gap-2",children:[l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(OE,{message:{endpoint:Yl.agents,isCreatedByUser:!1},agent:a})}),l.jsx("div",{className:"text-base font-medium text-text-primary",children:(null==a?void 0:a.name)||t("com_ui_agent")})]})]}):null},oP=Sa((({message:e})=>{const t=Ca((()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")})))||[]}),[null==e?void 0:e.files]),n=Ca((()=>{var t;return(null==(t=null==e?void 0:e.files)?void 0:t.filter((e=>{var t;return!(!0===(null==(t=e.type)?void 0:t.startsWith("image/")))})))||[]}),[null==e?void 0:e.files]);return l.jsxs(l.Fragment,{children:[n.length>0&&n.map((e=>l.jsx(NI,{file:e},e.file_id))),t.length>0&&t.map((e=>l.jsx(lA,{imagePath:e.preview??e.filepath??"",height:e.height??1920,width:e.width??1080,altText:e.filename??"Uploaded Image",placeholderDimensions:{height:`${e.height??1920}px`,width:`${e.height??1080}px`}},e.file_id)))]})})),iP=({children:e,message:t})=>l.jsxs("div",{className:"text-message flex min-h-[20px] flex-col items-start gap-3 overflow-visible [.text-message+&]:mt-5",dir:"auto",children:[!0===(null==t?void 0:t.isCreatedByUser)&&l.jsx(oP,{message:t}),e]}),lP=({part:e,index:t,messageId:n,isSubmitting:a,enterEdit:s})=>{const r=qN(),{addedIndex:o}=gk(),{conversation:i}=iC(),{ask:c,getMessages:d,setMessages:u}=lC(),[m,p]=b(N_.latestMessageFamily(o)),{conversationId:h=""}=i??{},g=Ca((()=>{var e;return null==(e=d())?void 0:e.find((e=>e.messageId===n))}),[d,n]),x=j(N_.chatDirection),f=ba(null),v=function(e){var t=xs();return fs((function(e){return function(e){var t=e.conversationId,n=e.messageId,a=e.index,s=e.text;if(!t)throw new Error("conversationId is required");return sN.put(vj({conversationId:t,messageId:n}),{text:s,index:a})}(e)}),{onSuccess:function(){t.invalidateQueries([rN.messages,e])}})}(h??""),_="rtl"===(null==x?void 0:x.toLowerCase()),{register:y,handleSubmit:w,setValue:N}=Oi({defaultValues:{text:(qm.THINK in e?e.think:e.text)||""}});ya((()=>{const e=f.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}}),[]);const k=ka((e=>{"Escape"===e.key&&(e.preventDefault(),s(!0))}),[s]),{ref:C,...S}=y("text",{required:!0,onChange:e=>{N("text",e.target.value,{shouldValidate:!0})}});return l.jsxs(iP,{message:g,children:[e.type===qm.THINK&&l.jsx("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-text-secondary",children:l.jsxs("span",{className:"flex gap-2 rounded-lg bg-surface-tertiary px-1.5 py-1 font-medium",children:[l.jsx(U,{className:"size-3.5","aria-hidden":"true"}),r("com_ui_thoughts")]})}),e.type!==qm.THINK&&l.jsx("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-text-secondary",children:l.jsxs("span",{className:"flex gap-2 rounded-lg bg-surface-tertiary px-1.5 py-1 font-medium",children:[l.jsx(xt,{className:"size-3.5","aria-hidden":"true"}),r("com_ui_response")]})}),l.jsx("div",{className:"bg-token-main-surface-primary relative flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:l.jsx(Br,{...S,ref:e=>{C(e),f.current=e},onKeyDown:k,"data-testid":"message-text-editor",className:Qf("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",_?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",sv),"aria-label":r("com_ui_editable_message"),dir:_?"rtl":"ltr"})}),l.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[l.jsx("button",{className:"btn btn-primary relative mr-2",disabled:a,onClick:w((a=>{const r=d(),o=null==r?void 0:r.find((e=>e.messageId===(null==g?void 0:g.parentMessageId))),i=e.type===qm.THINK?{index:t,type:qm.THINK,[qm.THINK]:a.text}:{index:t,type:qm.TEXT,[qm.TEXT]:a.text};o&&(c({...o},{editedContent:i,editedMessageId:n,isRegenerate:!0,isEdited:!0}),s(!0))})),children:r("com_ui_save_submit")}),l.jsx("button",{className:"btn btn-secondary relative mr-2",disabled:a,onClick:w((e=>{var a;const r=d();if(!r)return;v.mutate({index:t,conversationId:h??"",text:e.text,messageId:n}),n===(null==m?void 0:m.messageId)&&p({...m,text:e.text});if(!r.some((e=>e.messageId===n)))return s(!0);const o=null==(a=null==g?void 0:g.content)?void 0:a.map(((n,a)=>n.type===qm.TEXT&&a===t?{...n,text:e.text}:n));u(r.map((e=>e.messageId===n?{...e,content:o}:e))),s(!0)})),children:r("com_ui_save")}),l.jsx("button",{className:"btn btn-neutral relative",onClick:()=>s(!0),children:r("com_ui_cancel")})]})]})},cP=_a.memo((({lang:e,codeRef:t,blockIndex:n})=>{const a=qN(),{showToast:s}=Ds(),r=((e,t)=>{const n=xs();return fs((t=>Jh.callTool({toolId:e,toolParams:t})),{onMutate:e=>{var n;return null==(n=null==t?void 0:t.onMutate)?void 0:n.call(t,e)},onError:(e,n,a)=>{var s;return null==(s=null==t?void 0:t.onError)?void 0:s.call(t,e,n,a)},onSuccess:(e,a,s)=>{var r;return n.setQueryData([Fh.toolCalls,a.conversationId],(t=>[...t??[],{user:"",toolId:Nl.execute_code,partIndex:a.partIndex,messageId:a.messageId,blockIndex:a.blockIndex,conversationId:a.conversationId,result:e.result,attachments:e.attachments}])),null==(r=null==t?void 0:t.onSuccess)?void 0:r.call(t,e,a,s)}})})(Nl.execute_code,{onError:()=>{s({message:a("com_ui_run_code_error"),status:"error"})}}),{messageId:o,conversationId:i,partIndex:c}=Ck(),d=Ca((()=>function(e){const t=e.toLowerCase().trim(),n=gf[t];return n||""}(e)),[e]),{data:u}=ob({toolId:Nl.execute_code},{retry:1}),m=Ca((()=>(null==u?void 0:u.message)??!1),[null==u?void 0:u.message]),p=Ca((()=>(null==u?void 0:u.authenticated)??!1),[null==u?void 0:u.authenticated]),{methods:h,onSubmit:g,isDialogOpen:x,setIsDialogOpen:f,handleRevokeApiKey:v}=wS({}),_=ka((async()=>{var e;if(!p)return void f(!0);const a=(null==(e=t.current)?void 0:e.textContent)??"";"string"==typeof a&&0!==a.length&&"string"==typeof d&&0!==d.length&&r.mutate({partIndex:c,messageId:o,blockIndex:n,conversationId:i??"",lang:d,code:a})}),[t,r,c,o,n,i,d,f,p]),b=Ca((()=>xi(_,1e3,{leading:!0})),[_]);return ya((()=>()=>{b.cancel()}),[b]),"string"!=typeof d||0===d.length?null:l.jsxs(l.Fragment,{children:[l.jsxs("button",{type:"button",className:Qf("ml-auto flex gap-2 rounded-sm focus:outline focus:outline-white"),onClick:b,disabled:r.isLoading,children:[r.isLoading?l.jsx(Xs,{className:"animate-spin",size:18}):l.jsx(A,{size:18,"aria-hidden":"true"}),a("com_ui_run_code")]}),l.jsx(UI,{onSubmit:g,isOpen:x,register:h.register,onRevoke:v,onOpenChange:f,handleSubmit:h.handleSubmit,isToolAuthenticated:p,isUserProvided:m===Hl.USER_PROVIDED})]})})),dP=_a.memo((({lang:e,error:t,codeRef:n,blockIndex:a,plugin:s=null,allowExecution:r=!0})=>{const o=qN(),[i,c]=ja(!1);return l.jsxs("div",{className:"relative flex items-center justify-between rounded-tl-md rounded-tr-md bg-gray-700 px-4 py-2 font-sans text-xs text-gray-200 dark:bg-gray-700",children:[l.jsx("span",{className:"",children:e}),!0===s?l.jsx(ft,{className:"ml-auto flex h-4 w-4 gap-2 text-white/50"}):l.jsxs("div",{className:"flex items-center justify-center gap-4",children:[!0===r&&l.jsx(cP,{lang:e,codeRef:n,blockIndex:a}),l.jsx("button",{type:"button",className:Qf("ml-auto flex gap-2 rounded-sm focus:outline focus:outline-white",!0===t?"h-4 w-4 items-start text-white/50":""),onClick:async()=>{var e;const t=null==(e=n.current)?void 0:e.textContent;null!=t&&(c(!0),J(t.trim(),{format:"text/plain"}),setTimeout((()=>{c(!1)}),3e3))},children:i?l.jsxs(l.Fragment,{children:[l.jsx(uo,{className:"h-[18px] w-[18px]"}),!0===t?"":o("com_ui_copied")]}):l.jsxs(l.Fragment,{children:[l.jsx(mo,{}),!0===t?"":o("com_ui_copy_code")]})})]})]})})),uP=({lang:e,blockIndex:t,codeChildren:n,classProp:a="",allowExecution:s=!0,plugin:r=null,error:o})=>{const i=ba(null),c=Na(Fk),{messageId:d,partIndex:u}=Ck(),m=s?`${d}_${u??0}_${t??0}_${Nl.execute_code}`:"",[p,h]=ja(0),g=null==c?void 0:c[m],[x,f]=ja((null==c?void 0:c[m])??null);ya((()=>{g&&(f(g),h(g.length-1))}),[g]);const v=Ca((()=>null==x?void 0:x[p]),[x,p]),_=!(!0!==r&&!0!==o),b=_?"json":e;return l.jsxs("div",{className:"w-full rounded-md bg-gray-900 text-xs text-white/80",children:[l.jsx(dP,{lang:e,error:o,codeRef:i,blockIndex:t,plugin:!0===r,allowExecution:s}),l.jsx("div",{className:Qf(a,"overflow-y-auto p-4"),children:l.jsx("code",{ref:i,className:Qf(_?"!whitespace-pre-wrap":`hljs language-${b} !whitespace-pre`),children:n})}),!0===s&&x&&x.length>0&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"bg-gray-700 p-4 text-xs",children:l.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:l.jsx("pre",{className:"shrink-0",children:l.jsx(XA,{output:(null==v?void 0:v.result)??"",attachments:(null==v?void 0:v.attachments)??[],renderImages:!0})})})}),x.length>1&&l.jsx(oA,{currentIndex:p,totalCount:x.length,onPrevious:()=>{p>0&&h(p-1)},onNext:()=>{x&&p<x.length-1&&h(p+1)}})]})]})},mP=Sa((({className:e,children:t})=>{const n=ak({permissionType:Pp.RUN_CODE,permission:Op.USE}),a=/language-(\w+)/.exec(e??""),s=a&&a[1],r="math"===s,o="string"==typeof t&&1===t.split("\n").length,{getNextIndex:i,resetCounter:c}=Na(Mk),d=ba(i(r||o)).current;return ya((()=>{c()}),[t,c]),r?l.jsx(l.Fragment,{children:t}):o?l.jsx("code",{onDoubleClick:lv,className:e,children:t}):l.jsx(uP,{lang:s??"text",codeChildren:t,blockIndex:d,allowExecution:n})})),pP=Sa((({className:e,children:t})=>{const n=/language-(\w+)/.exec(e??""),a=n&&n[1];return"math"===a?t:"string"==typeof t&&1===t.split("\n").length?l.jsx("code",{onDoubleClick:lv,className:e,children:t}):l.jsx(uP,{lang:a??"text",codeChildren:t,allowExecution:!1})})),hP=Sa((({href:e,children:t})=>{const n=j(N_.user),{showToast:a}=Ds(),s=qN(),{file_id:r="",filename:o="",filepath:i}=Ca((()=>{const t=new RegExp(`(?:files|outputs)/${null==n?void 0:n.id}/([^\\s]+)`),a=e.match(t);if(a&&a[0]){const e=a[0],t=e.split("/"),n=t.pop();return{file_id:t.pop(),filename:n,filepath:e}}return{file_id:"",filename:"",filepath:""}}),[null==n?void 0:n.id,e]),{refetch:c}=X_((null==n?void 0:n.id)??"",r),d={target:"_new"};if(!r||!o)return l.jsx("a",{href:e,...d,children:t});d.onClick=async e=>{e.preventDefault();try{const e=await c();if(null==e.data||""===e.data)return console.error("Error downloading file: No data found"),void a({status:"error",message:s("com_ui_download_error")});const t=document.createElement("a");t.href=e.data,t.setAttribute("download",o),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e.data)}catch(t){console.error("Error downloading file:",t)}},d.target="_blank";const u=`${Td()}/api`;return l.jsx("a",{href:(null==i?void 0:i.startsWith("files/"))?`${u}/${i}`:`${u}/files/${i}`,...d,children:t})})),gP=Sa((({children:e})=>l.jsx("p",{className:"mb-2 whitespace-pre-wrap",children:e}))),xP=Sa((({src:e,alt:t,title:n,className:a,style:s})=>{const r=Td(),o=Ca((()=>e?e.startsWith("http")||e.startsWith("data:")||!e.startsWith("/images/")?e:`${r}${e}`:e),[e,r]);return l.jsx("img",{src:o,alt:t,title:n,className:a,style:s})})),fP=/{{(.*?)}}/g,vP=({children:e})=>l.jsx("p",{children:_a.Children.map(e,(e=>(e=>"object"==typeof e&&null!==e||"string"!=typeof e?e:e.split(fP).map(((e,t)=>t%2==1?l.jsx("b",{className:"ml-[0.5] rounded-lg bg-amber-100 p-[1px] font-medium text-yellow-800 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90",children:`{{${e}}}`},t):e)))(e)))}),_P=e=>{const t=e.trim();if(t.includes(":")){const[e,n]=t.split(":");if(n&&n.includes("|"))return{variable:e.trim(),type:"select",options:n.split("|").map((e=>e.trim()))}}return{variable:t,type:"text"}};function bP({group:e,onClose:t}){var n;const a=qN(),{user:s}=nk(),r=Ca((()=>{var t;return hp({text:(null==(t=e.productionPrompt)?void 0:t.prompt)??"",user:s})}),[null==(n=e.productionPrompt)?void 0:n.prompt,s]),{allVariables:o,uniqueVariables:i,variableIndexMap:c}=Ca((()=>(e=>{const t=/{{(.*?)}}/g;let n;const a=[],s=[],r=new Set,o=new Map,i=new Map;for(;null!==(n=t.exec(e));){const e=n[1];a.push(e);const t=o.get(e)??0;o.set(e,t+1),t>0?r.add(e):(s.push(e),i.set(e,s.length-1))}return{allVariables:a,uniqueVariables:s,repeatedVariables:r,variableIndexMap:i}})(r)),[r]),{submitPrompt:d}=lS(),{control:u,handleSubmit:m}=Oi({defaultValues:{fields:i.map((e=>({variable:tf(e),value:"",config:_P(e)})))}}),{fields:p}=Fi({control:u,name:"fields"}),h=Di({control:u,name:"fields"});if(!i.length)return null;return l.jsx("div",{className:"mx-auto p-1 md:container",children:l.jsxs("form",{onSubmit:m((e=>{let n=r;e.fields.forEach((({variable:e,value:t})=>{if(!t)return;const a=e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"),s=new RegExp(a,"g");n=n.replace(s,t)})),d(n),t()})),className:"space-y-4",children:[l.jsx("div",{className:"mb-6 max-h-screen max-w-[80vw] overflow-auto rounded-md bg-surface-tertiary p-4 text-text-secondary dark:bg-surface-primary sm:max-w-full md:max-h-96",children:l.jsx(Xi,{remarkPlugins:[Zi,el,[nl,{singleDollarTextMath:!1}]],rehypePlugins:[[tl],[Ji,{ignoreMissing:!0}]],components:{code:pP,p:vP},className:"markdown prose dark:prose-invert light my-1 max-h-[50vh] max-w-full break-words dark:text-text-secondary",children:(()=>{let e=r;return o.forEach((t=>{const n=`{{${t}}}`,a=c.get(t),s=h[a].value;if(s===n||""===s||!s)return;const r=""!==s?`**${s}**`:n;e=e.replaceAll(n,r)})),e})()})}),l.jsx("div",{className:"space-y-4",children:p.map(((e,t)=>l.jsx("div",{className:"relative flex flex-col space-y-2",children:l.jsx(Li,{name:`fields.${t}.value`,control:u,render:({field:{onChange:n,onBlur:a,value:s,ref:r}})=>"select"===e.config.type?l.jsx(po,{options:e.config.options||[],placeholder:e.config.variable,className:Qf(ov,"mb-1 rounded px-3 py-2 focus:bg-surface-tertiary"),value:s,onChange:n,onBlur:a}):l.jsxs(l.Fragment,{children:[l.jsx(Br,{ref:r,value:s,onChange:n,onBlur:a,id:`fields.${t}.value`,className:Qf(ov,"peer rounded px-3 py-2 focus:bg-surface-tertiary"),placeholder:"",maxRows:8,"aria-label":e.config.variable}),l.jsx("label",{htmlFor:`fields.${t}.value`,className:"absolute left-3 top-0 text-sm text-text-secondary transition-all duration-200 peer-focus:-top-6 peer-focus:left-1 peer-focus:text-xs peer-focus:text-text-primary peer-[:not(:placeholder-shown)]:-top-6 peer-[:not(:placeholder-shown)]:left-1 peer-[:not(:placeholder-shown)]:text-xs",children:e.config.variable})]})})},e.id)))}),l.jsx("div",{className:"flex justify-end",children:l.jsx(Ys,{type:"submit",variant:"submit","aria-label":a("com_ui_submit"),children:a("com_ui_submit")})})]})})}const yP=({open:e,onClose:t,group:n})=>{var a;const s=Ca((()=>{var e;return ef((null==(e=null==n?void 0:n.productionPrompt)?void 0:e.prompt)??"")}),[null==(a=null==n?void 0:n.productionPrompt)?void 0:a.prompt]);return n&&s?l.jsx(rr,{open:e,onOpenChange:e=>{e||t()},children:l.jsxs(ir,{className:"max-h-[90vh] max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:max-w-[60vw]",children:[l.jsx(lr,{children:n.name}),l.jsx(bP,{group:n,onClose:t})]})}):null},jP={code:({children:e})=>l.jsx("code",{onDoubleClick:lv,className:"rounded-md bg-surface-primary-alt p-1 text-xs text-text-secondary md:text-sm",children:e})},wP=({promptText:e,showInfo:t=!0})=>{const n=qN(),a=Ca((()=>(e=>{const t=/{{(.*?)}}/g;let n;const a=new Set;for(;null!==(n=t.exec(e));)a.add(n[1]);return Array.from(a)})(e||"")),[e]);return l.jsxs("div",{className:"rounded-xl border border-border-light bg-transparent p-4 shadow-md",children:[l.jsxs("h3",{className:"flex items-center gap-2 py-2 text-lg font-semibold text-text-primary",children:[l.jsx(vt,{className:"icon-sm","aria-hidden":"true"}),n("com_ui_variables")]}),l.jsxs("div",{className:"flex flex-col space-y-4",children:[a.length?l.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(((e,t)=>l.jsx("span",{className:Qf("rounded-full border border-border-light px-3 py-1 text-text-primary",null!=Jm[e.toLowerCase()]?"bg-amber-100 text-yellow-800 border-yellow-600 dark:border-yellow-500/50 dark:bg-transparent dark:text-yellow-500/90":""),children:null!=Jm[e.toLowerCase()]?e.toLowerCase():e},t)))}):l.jsx("div",{className:"text-sm text-text-secondary",children:l.jsx(Xi,{components:jP,className:"markdown prose dark:prose-invert",children:n("com_ui_variables_info")})}),l.jsx(ho,{className:"my-3 text-text-primary"}),t&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-sm font-medium text-text-primary",children:n("com_ui_special_variables")}),l.jsx("span",{className:"text-sm text-text-secondary",children:l.jsx(Xi,{components:jP,className:"markdown prose dark:prose-invert",children:n("com_ui_special_variables_more_info")})})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-sm font-medium text-text-primary",children:n("com_ui_dropdown_variables")}),l.jsx("span",{className:"break-words text-sm text-text-secondary",children:l.jsx(Xi,{components:jP,className:"markdown prose dark:prose-invert",children:n("com_ui_dropdown_variables_info")})})]})]})]})]})},NP=({initialValue:e,onValueChange:t,disabled:n,tabIndex:a})=>{const s=qN(),[r,o]=ja(e||""),[i,c]=ja((null==e?void 0:e.length)||0);ya((()=>{o(e||""),c((null==e?void 0:e.length)||0)}),[e]),ya((()=>{c(r.length)}),[r]);return n&&!r?null:l.jsxs("div",{className:"rounded-xl border border-border-light shadow-md",children:[l.jsx("label",{htmlFor:"prompt-description",className:"block px-4 pt-2 text-sm text-text-secondary md:hidden",children:s("com_ui_description_placeholder")}),l.jsxs("div",{className:"relative flex h-10 items-center gap-1 pl-4 pr-2 text-sm text-text-secondary",children:[l.jsx(ft,{className:"icon-sm shrink-0","aria-hidden":"true"}),l.jsxs("div",{className:"relative min-w-0 flex-1",children:[l.jsx(kr,{type:"text",id:"prompt-description",tabIndex:a,disabled:n,placeholder:" ",value:r,onChange:e=>{e.target.value.length<=120&&(o(e.target.value),null==t||t(e.target.value))},className:"peer w-full border-none pr-14","aria-label":s("com_ui_description_placeholder")}),l.jsx("label",{htmlFor:"prompt-description",className:"pointer-events-none absolute left-0 top-0.5 hidden max-w-[calc(100%-3.5rem)] origin-[0] translate-y-2 scale-100 rounded bg-white px-1 text-sm text-text-secondary transition-transform duration-200 peer-placeholder-shown:translate-y-2 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 peer-focus:text-text-primary peer-[:not(:placeholder-shown)]:-translate-y-3 peer-[:not(:placeholder-shown)]:scale-75 dark:bg-gray-850 md:block",children:s("com_ui_description_placeholder")})]}),!n&&l.jsx("span",{className:"absolute right-2 shrink-0 text-xs text-text-secondary md:text-sm",children:`${i}/120`})]})]})},kP=({initialValue:e,onValueChange:t,disabled:n,tabIndex:a})=>{const s=qN(),[r,o]=ja(e||""),[i,c]=ja((null==e?void 0:e.length)||0);ya((()=>{o(e||""),c((null==e?void 0:e.length)||0)}),[e]),ya((()=>{c(r.length)}),[r]);return!0!==n||r?l.jsxs("div",{className:"rounded-xl border border-border-light shadow-md",children:[l.jsx("label",{htmlFor:"prompt-command",className:"block px-4 pt-2 text-sm text-text-secondary md:hidden",children:s("com_ui_command_placeholder")}),l.jsxs("div",{className:"relative flex h-10 items-center gap-1 pl-4 pr-2 text-sm text-text-secondary",children:[l.jsx(_t,{className:"icon-sm shrink-0","aria-hidden":"true"}),l.jsxs("div",{className:"relative min-w-0 flex-1",children:[l.jsx(kr,{type:"text",id:"prompt-command",tabIndex:a,disabled:n,placeholder:" ",value:r,onChange:e=>{let n=e.target.value.toLowerCase();n=n.replace(/\s/g,"-").replace(/[^a-z0-9-]/g,""),n.length<=Bm.COMMANDS_MAX_LENGTH&&(o(n),null==t||t(n))},className:"peer w-full border-none pr-14","aria-label":s("com_ui_command_placeholder")}),l.jsx("label",{htmlFor:"prompt-command",className:"pointer-events-none absolute left-0 top-0.5 hidden max-w-[calc(100%-3.5rem)] origin-[0] translate-y-2 scale-100 rounded bg-white px-1 text-sm text-text-secondary transition-transform duration-200 peer-placeholder-shown:translate-y-2 peer-placeholder-shown:scale-100 peer-focus:-translate-y-3 peer-focus:scale-75 peer-focus:text-text-primary peer-[:not(:placeholder-shown)]:-translate-y-3 peer-[:not(:placeholder-shown)]:scale-75 dark:bg-gray-850 md:block",children:s("com_ui_command_placeholder")})]}),!0!==n&&l.jsx("span",{className:"absolute right-2 shrink-0 text-xs text-text-secondary md:text-sm",children:`${i}/${Bm.COMMANDS_MAX_LENGTH}`})]})]}):null},CP=({group:e})=>{var t,n;const a=qN(),{user:s}=nk(),r=Ca((()=>{var t;return hp({text:(null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt)??"",user:s})}),[null==(t=null==e?void 0:e.productionPrompt)?void 0:t.prompt,s]);return e?l.jsxs("div",{children:[l.jsx("div",{className:"flex flex-col items-center justify-between p-4 text-text-primary sm:flex-row",children:l.jsx("div",{className:"mb-1 flex flex-row items-center font-bold sm:text-xl md:mb-0 md:text-2xl",children:l.jsxs("div",{className:"mb-1 flex items-center md:mb-0",children:[l.jsx("div",{className:"rounded pr-2",children:((null==(n=e.category)?void 0:n.length)??0)>0?l.jsx(eC,{category:e.category??""}):null}),l.jsx(er,{className:"text-2xl font-bold",children:e.name})]})})}),l.jsx("div",{className:"flex h-full max-h-screen flex-col overflow-y-auto md:flex-row",children:l.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-0 md:max-h-[calc(100vh-150px)] md:p-2",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-light py-2 pl-4 text-base font-semibold text-text-primary",children:a("com_ui_prompt_text")}),l.jsx("div",{className:"group relative min-h-32 rounded-b-lg border border-border-light p-4 transition-all duration-150",children:l.jsx(Xi,{remarkPlugins:[Zi,el,[nl,{singleDollarTextMath:!1}]],rehypePlugins:[[tl],[Ji,{ignoreMissing:!0}]],components:{p:vP,code:pP},className:"markdown prose dark:prose-invert light dark:text-gray-70 my-1 break-words",children:r})})]}),l.jsx(wP,{promptText:r,showInfo:!1}),l.jsx(NP,{initialValue:e.oneliner,disabled:!0}),l.jsx(kP,{initialValue:e.command,disabled:!0})]})})]}):null},SP=({group:e,open:t,onOpenChange:n,onCloseAutoFocus:a})=>l.jsx(rr,{open:t,onOpenChange:n,children:l.jsx(ir,{className:"max-h-[90vh] w-11/12 max-w-full overflow-y-auto md:max-w-[60vw]",onCloseAutoFocus:a,children:l.jsx("div",{children:l.jsx(CP,{group:e})})})});function TP({category:e,name:t,snippet:n,onClick:a,children:s}){const r=qN();return l.jsxs("div",{onClick:a,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),null==a||a(e))},className:"relative flex w-full cursor-pointer flex-col gap-2 rounded-xl px-3 pb-4 pt-3 text-start align-top text-[15px]",role:"button",tabIndex:0,"aria-labelledby":`card-title-${t}`,"aria-describedby":`card-snippet-${t}`,"aria-label":`${t} Prompt, ${e?`${r("com_ui_category")}: ${e}`:""}`,children:[l.jsxs("div",{className:"flex w-full justify-between gap-2",children:[l.jsxs("div",{className:"flex flex-row gap-2",children:[l.jsx(eC,{category:e,className:"icon-md","aria-hidden":"true"}),l.jsx(er,{id:`card-title-${t}`,className:"break-word select-none text-balance text-sm font-semibold text-text-primary",title:t,children:t})]}),l.jsx("div",{children:s})]}),l.jsx("div",{id:`card-snippet-${t}`,className:"ellipsis max-w-full select-none text-balance pt-1 text-sm text-text-secondary",children:n})]})}const EP=Sa((function({group:e,instanceProjectId:t}){var n;const a=qN(),{submitPrompt:s}=lS(),[r,o]=ja(!1),[i,d]=ja(!1),u=LC(`/d/prompts/${e._id}`),m=Ca((()=>{var n;return null!=t&&(null==(n=e.projectIds)?void 0:n.includes(t))}),[e,t]),{hasPermission:p}=eT(Ph.PROMPTGROUP,e._id||""),h=p(Oh.EDIT),g=ba(null);return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"relative my-2 items-stretch justify-between rounded-xl border border-border-light px-1 shadow-sm transition-all duration-300 ease-in-out hover:bg-surface-tertiary hover:shadow-lg",children:[l.jsx(TP,{name:e.name,category:e.category??"",onClick:()=>{var t;const n=null==(t=e.productionPrompt)?void 0:t.prompt;(null==n?void 0:n.trim())&&(ef(n)?d(!0):s(n))},snippet:"string"==typeof e.oneliner&&e.oneliner.length>0?e.oneliner:(null==(n=e.productionPrompt)?void 0:n.prompt)??""}),!0===m&&l.jsx("div",{className:"absolute right-14 top-[16px]",children:l.jsx(c,{className:"icon-md text-green-400","aria-label":a("com_ui_sr_global_prompt")})}),l.jsx("div",{className:"absolute right-0 top-0 mr-1 mt-2.5 items-start pl-2",children:l.jsxs(go,{modal:!1,children:[l.jsx(xo,{asChild:!0,children:l.jsx("button",{ref:g,id:`prompt-actions-${e._id}`,type:"button","aria-label":a("com_ui_sr_actions_menu",{0:e.name}),onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},className:"z-50 mr-2 inline-flex h-8 w-8 items-center justify-center rounded-lg border border-border-medium bg-transparent p-0 text-sm font-medium transition-all duration-300 ease-in-out hover:border-border-heavy hover:bg-surface-hover focus:border-border-heavy focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:l.jsx(bt,{className:"icon-md text-text-secondary","aria-hidden":"true"})})}),l.jsxs(fo,{id:`prompt-menu-${e._id}`,"aria-label":`Available actions for ${e.name}`,className:"z-50 w-fit rounded-xl",collisionPadding:2,align:"start",children:[l.jsxs(vo,{onClick:e=>{e.stopPropagation(),o(!0)},onKeyDown:e=>{e.stopPropagation()},className:"w-full cursor-pointer rounded-lg text-text-primary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",children:[l.jsx(yt,{className:"mr-2 h-4 w-4 text-text-primary","aria-hidden":"true"}),l.jsx("span",{children:a("com_ui_preview")})]}),h&&l.jsx(_o,{children:l.jsxs(vo,{disabled:!h,className:"cursor-pointer rounded-lg text-text-primary hover:bg-surface-hover focus:bg-surface-hover disabled:cursor-not-allowed",onClick:e=>{e.stopPropagation(),u(e)},onKeyDown:e=>{e.stopPropagation()},children:[l.jsx(jt,{className:"mr-2 h-4 w-4 text-text-primary","aria-hidden":"true"}),l.jsx("span",{children:a("com_ui_edit")})]})})]})]})})]}),l.jsx(SP,{group:e,open:r,onOpenChange:o,onCloseAutoFocus:()=>{requestAnimationFrame((()=>{var e;null==(e=g.current)||e.focus({preventScroll:!0})}))}}),l.jsx(yP,{open:i,onClose:()=>d(!1),group:e})]})}));function IP({groups:e=[],isChatRoute:t,isLoading:n}){const a=E(),s=qN(),{data:r={}}=K_(),{instanceProjectId:o}=r,i=ak({permissionType:Pp.PROMPTS,permission:Op.CREATE});return l.jsxs("div",{className:"flex h-full flex-col",children:[i&&l.jsx("div",{className:"flex w-full justify-end",children:l.jsxs(Ys,{variant:"outline",className:"w-full bg-transparent "+(t?"":"mx-2"),onClick:()=>a("/d/prompts/new"),"aria-label":s("com_ui_create_prompt"),children:[l.jsx(Re,{className:"size-4","aria-hidden":"true"}),s("com_ui_create_prompt")]})}),l.jsx("div",{className:"flex-grow overflow-y-auto","aria-label":s("com_ui_prompt_groups"),children:l.jsxs("div",{className:"overflow-y-auto overflow-x-hidden",children:[n&&t&&l.jsx(Ms,{className:"my-2 flex h-[84px] w-full rounded-2xl border-0 px-3 pb-4 pt-3"}),n&&!t&&Array.from({length:10}).map(((e,t)=>l.jsx(Ms,{className:"w-100 mx-2 my-2 flex h-14 rounded-lg border-0 p-4"},t))),!n&&0===e.length&&t&&l.jsx("div",{className:"my-2 flex h-[84px] w-full items-center justify-center rounded-2xl border border-border-light bg-transparent px-3 pb-4 pt-3 text-text-primary",children:s("com_ui_nothing_found")}),!n&&0===e.length&&!t&&l.jsx("div",{className:"my-12 flex w-full items-center justify-center text-lg font-semibold text-text-primary",children:s("com_ui_nothing_found")}),e.map((e=>t?l.jsx(EP,{group:e,instanceProjectId:o},e._id):l.jsx(rA,{group:e,instanceProjectId:o},e._id)))]})})]})}const RP=Sa((function({onPrevious:e,onNext:t,hasNextPage:n,hasPreviousPage:a,isLoading:s,isChatRoute:r,children:o}){const i=qN();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex gap-2 pl-1",children:[!r&&l.jsx(Zs,{returnThemeOnly:!0}),o]}),l.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(Ys,{variant:"outline",size:"sm",onClick:e,disabled:!a||s,"aria-label":i("com_ui_prev"),children:i("com_ui_prev")}),l.jsx(Ys,{variant:"outline",size:"sm",onClick:t,disabled:!n||s,"aria-label":i("com_ui_next"),children:i("com_ui_next")})]})]})}));function AP({children:e,className:t="",closePanelRef:n,onClose:a}){const s=T(),r=qN(),o=Ca((()=>{var e;return null==(e=s.pathname)?void 0:e.startsWith("/c/")}),[s.pathname]),{promptGroups:i,groupsQuery:c,nextPage:d,prevPage:u,hasNextPage:m,hasPreviousPage:p}=aC();return l.jsxs("div",{id:"prompts-panel",className:Qf("flex h-full w-full flex-col md:mr-2 md:w-auto md:min-w-72 lg:w-1/4 xl:w-1/4",t),children:[a&&l.jsx("div",{className:"flex items-center justify-between px-2 py-[2px] md:py-2",children:l.jsx(pr,{description:r("com_nav_close_sidebar"),render:l.jsx(Ys,{ref:n,size:"icon",variant:"outline","data-testid":"close-prompts-panel-button","aria-label":r("com_nav_close_sidebar"),"aria-expanded":!0,className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:a,children:l.jsx(bo,{})})})}),l.jsxs("div",{className:"flex flex-1 flex-col gap-2 overflow-visible",children:[e,l.jsx("div",{className:Qf("relative flex h-full flex-col",o?"":"px-2 md:px-0"),children:l.jsx(IP,{groups:i,isChatRoute:o,isLoading:!!c.isLoading})})]}),l.jsx("div",{className:Qf(o?"":"px-2 pb-3 pt-2 md:px-0"),children:l.jsx(RP,{onPrevious:u,onNext:d,hasNextPage:m,hasPreviousPage:p,isLoading:c.isFetching,isChatRoute:o,children:o&&l.jsx(sA,{className:"select-none"})})})]})}function PP({onCheckedChange:e,className:t=""}){const[n,a]=b(N_.autoSendPrompts),s=qN();return l.jsxs("div",{className:Qf("flex select-none items-center justify-end gap-2 text-right text-sm",t),children:[l.jsxs("div",{children:[" ",s("com_nav_auto_send_prompts")," "]}),l.jsx(dr,{"aria-label":s("com_nav_auto_send_prompts"),id:"autoSendPrompts",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},"data-testid":"autoSendPrompts"})]})}function OP({className:e=""}){const t=qN(),{name:n,setName:a,hasAccess:s,promptGroups:r}=aC(),{categories:o}=ES({className:"h-4 w-4",hasAccess:s}),[i,c]=ja(n||""),[d,u]=b(N_.promptsCategory),m=WC(i,500),p=ba(n),h=Ca((()=>[...[{value:Wm.ALL,label:t("com_ui_all_proper"),icon:l.jsx(wt,{className:"h-4 w-4 text-text-primary"})},{value:Wm.MY_PROMPTS,label:t("com_ui_my_prompts"),icon:l.jsx(me,{className:"h-4 w-4 text-text-primary"})},{value:Wm.SHARED_PROMPTS,label:t("com_ui_shared_prompts"),icon:l.jsx(Ne,{className:"h-4 w-4 text-text-primary"})},{divider:!0,value:null}],...o?[...o]:[{value:Wm.NO_CATEGORY,label:t("com_ui_no_category")}]]),[o,t]),g=ka((e=>{e===Wm.ALL?u(""):u(e)}),[u]);ya((()=>{p.current!==n&&(p.current=n,c(n||""))}),[n]),ya((()=>{a(m)}),[m,a]);const x=ka((e=>{c(e.target.value)}),[]),f=i!==m,v=(null==r?void 0:r.length)??0,_=Ca((()=>m.trim()?1===v?`${v} result found`:`${v} results found`:""),[m,v]);return l.jsxs("div",{role:"search",className:Qf("flex w-full gap-2 text-text-primary",e),children:[l.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:_}),l.jsx(yo,{value:d||Wm.ALL,onChange:g,options:h,className:"rounded-lg bg-transparent",icon:l.jsx(wt,{className:"h-4 w-4"}),label:"Filter: ",ariaLabel:t("com_ui_filter_prompts"),iconOnly:!0}),l.jsx(jo,{value:i,onChange:x,isSearching:f,placeholder:t("com_ui_filter_prompts_name")})]})}function LP(){const e=aC();return l.jsx("div",{className:"flex h-full w-full flex-col",children:l.jsxs(AP,{className:"mt-2 space-y-2 lg:w-full xl:w-full",...e,children:[l.jsx(OP,{className:"items-center justify-center"}),l.jsx("div",{className:"flex w-full flex-row items-center justify-end",children:l.jsx(PP,{className:"text-xs dark:text-white"})})]})})}function MP(){const e=qN(),{conversation:t,setConversation:n}=$N(),{setOption:a}=SC(),[s,r]=ja(!1),[o,i]=ja(null),{data:c={}}=G_(),d=(null==t?void 0:t.endpoint)??"",u=(null==t?void 0:t.model)??"",m=Ca((()=>{var e;return(null==(e=null==c?void 0:c[(null==t?void 0:t.endpoint)??""])?void 0:e.availableRegions)??[]}),[c,null==t?void 0:t.endpoint]),p=Ca((()=>Zm(c,null==t?void 0:t.endpoint,"type")),[null==t?void 0:t.endpoint,c]),h=Ca((()=>{var e,t,n;const a=(null==(e=c[d])?void 0:e.customParams)??{},[s,r]=ic(p??d,u),o=a.defaultParamsEndpoint??r,i=Kg[s]??Kg[o]??[],l=(null==(n=null==(t=c[d])?void 0:t.customParams)?void 0:n.paramDefinitions)??[],m=yi(l,"key");return i.filter((e=>null!=e)).map((e=>m[e.key]??e))}),[p,c,u,d]);ya((()=>{if(!h)return;const e=new Set(h.filter((e=>null!=e)).map((e=>e.key)));n((t=>{if(!t)return t;const n={...t},a=Object.keys(n),s=[];return a.forEach((a=>{e.has(a)||Tu.has(a)||null!=t[a]&&(s.push(a),delete n[a])})),cx.log("parameters","parameters effect, updated keys:",s),n}))}),[h,n]);const g=ka((()=>{n((e=>{if(!e)return e;const t={...e},n=[];return Object.keys(t).forEach((e=>{Tu.has(e)||void 0!==t[e]&&(n.push(e),delete t[e])})),cx.log("parameters","parameters reset, affected keys:",n),t}))}),[n]),x=ka((()=>{const e=Fc.parse({...t});i(e),r(!0)}),[t]);return h?l.jsxs("div",{className:"h-auto max-w-full overflow-x-hidden p-3",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[" ",h.map((e=>{const n=uI[e.component];if(!n)return null;const{key:s,default:r,...o}=e;return"region"===s&&m.length&&(o.options=m),l.jsx(n,{settingKey:s,defaultValue:r,...o,setOption:a,conversation:t},s)}))]}),l.jsx("div",{className:"mt-4 flex justify-center",children:l.jsxs("button",{type:"button",onClick:g,className:"btn btn-neutral flex w-full items-center justify-center gap-2 px-4 py-2 text-sm",children:[l.jsx(Je,{className:"h-4 w-4","aria-hidden":"true"}),e("com_ui_reset_var",{0:e("com_ui_model_parameters")})]})}),l.jsx("div",{className:"mt-2 flex justify-center",children:l.jsx("button",{onClick:x,className:"btn btn-primary focus:shadow-outline flex w-full items-center justify-center px-4 py-2 font-semibold text-white hover:bg-green-600 focus:border-green-500",type:"button",children:e("com_endpoint_save_as_preset")})}),o&&l.jsx(vI,{open:s,onOpenChange:r,preset:o})]}):null}function DP({row:e}){var t;const n=e.original;return l.jsxs("div",{className:"flex w-full items-center gap-2",children:[!0===(null==(t=null==n?void 0:n.type)?void 0:t.startsWith("image"))?l.jsx(CI,{url:n.filepath,className:"h-10 w-10 flex-shrink-0",source:n.source,alt:n.filename}):l.jsx(jI,{fileType:_x(null==n?void 0:n.type),file:n}),l.jsx("div",{className:"min-w-0 flex-1 overflow-hidden",children:l.jsx("span",{className:"block w-full overflow-hidden truncate text-ellipsis whitespace-nowrap text-xs",children:null==n?void 0:n.filename})})]})}const FP=[{accessorKey:"filename",header:({column:e})=>{const t=qN();return l.jsxs(Ys,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),"aria-label":t("com_ui_name"),children:[t("com_ui_name"),l.jsx(Nt,{className:"ml-2 h-4 w-4","aria-hidden":"true"})]})},meta:{size:"150px"},cell:({row:e})=>l.jsx(DP,{row:e})},{accessorKey:"updatedAt",meta:{size:"10%"},header:({column:e})=>{const t=qN();return l.jsxs(Ys,{variant:"ghost",className:"hover:bg-surface-hover",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),"aria-label":t("com_ui_date"),children:[t("com_ui_date"),l.jsx(Nt,{className:"ml-2 h-4 w-4"})]})},cell:({row:e})=>{var t,n;return l.jsx("span",{className:"flex justify-end text-xs",children:bx((null==(n=null==(t=e.original)?void 0:t.updatedAt)?void 0:n.toString())??"")})}}];function UP({column:e,title:t,className:n="",filters:a,valueMap:s,ariaLabel:r}){const o=qN(),i=Ea(),[c,d]=ja(!1),u=Ca((()=>{const t=[{label:o("com_ui_ascending"),onClick:()=>e.toggleSorting(!1),icon:l.jsx(Ya,{className:"icon-sm text-text-secondary"})},{label:o("com_ui_descending"),onClick:()=>e.toggleSorting(!0),icon:l.jsx(Xa,{className:"icon-sm text-text-secondary"})}];return a&&(t.push({separate:!0}),Object.entries(a).forEach((([n,a])=>{a.forEach((n=>{const a=null==s?void 0:s[n??""],r=null!=a&&a.length?o(a):String(n);if(r){const a=e.getFilterValue()===n;t.push({label:r,onClick:()=>e.setFilterValue(n),icon:l.jsx(wt,{className:"icon-sm text-text-secondary","aria-hidden":"true"}),show:!0,className:a?"border-l-2 border-l-border-xheavy":""})}}))})),t.push({separate:!0}),t.push({label:o("com_ui_show_all"),onClick:()=>e.setFilterValue(void 0),icon:l.jsx(kt,{className:"icon-sm text-text-secondary"}),show:!0})),t}),[e,a,s,o]);if(!e.getCanSort())return l.jsx("div",{className:Qf(n),children:t});const m=e.getIsSorted();let p="none";return"desc"===m?p="descending":"asc"===m&&(p="ascending"),l.jsx("div",{className:Qf("flex items-center space-x-2",n),children:l.jsx(cr,{portal:!1,isOpen:c,setIsOpen:d,trigger:l.jsx(pr,{description:r||t,side:"top",render:l.jsxs(se,{"aria-sort":p,"aria-label":r,"aria-pressed":e.getIsFiltered()?"true":"false","aria-current":m?"true":"false",className:Qf("inline-flex items-center gap-2 rounded-lg px-2 py-0 text-xs transition-colors hover:bg-surface-hover focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring data-[open]:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",e.getIsFiltered()&&"border-b-2 border-b-border-xheavy"),children:[l.jsx("span",{children:t}),e.getIsFiltered()?l.jsx(wt,{className:"icon-sm","aria-hidden":"true"}):l.jsx(wt,{className:"icon-sm text-text-secondary","aria-hidden":"true"}),(()=>{const t=e.getIsSorted();return"desc"===t?l.jsx(Xa,{className:"icon-sm"}):"asc"===t?l.jsx(Ya,{className:"icon-sm"}):l.jsx(Ja,{className:"icon-sm"})})()]})}),items:u,menuId:i,className:"z-[1001]"})})}const zP={[ou.avatar]:"com_ui_avatar",[ou.unknown]:"com_ui_unknown",[ou.assistants]:"com_ui_assistants",[ou.image_generation]:"com_ui_image_gen",[ou.assistants_output]:"com_ui_assistants_output",[ou.message_attachment]:"com_ui_attachment"},VP=[{id:"select",size:40,header:({table:e})=>{const t=qN();return l.jsx(pr,{description:t("com_ui_select_all"),side:"top",role:"checkbox",render:l.jsx(jr,{checked:e.getIsAllPageRowsSelected()||e.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>e.toggleAllPageRowsSelected(!!t),"aria-label":t("com_ui_select_all"),className:"flex"})})},cell:({row:e})=>{const t=qN();return l.jsx(jr,{checked:e.getIsSelected(),onCheckedChange:t=>e.toggleSelected(!!t),"aria-label":t("com_ui_select_row"),className:"flex"})},enableSorting:!1,enableHiding:!1},{meta:{size:"150px"},accessorKey:"filename",header:({column:e})=>{const t=qN(),n=e.getIsSorted();let a=Nt,s="none";return"desc"===n?(a=Ct,s="descending"):"asc"===n&&(a=St,s="ascending"),l.jsx(pr,{description:t("com_ui_name_sort"),side:"top",render:l.jsxs(Ys,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),"aria-sort":s,"aria-label":t("com_ui_name_sort"),"aria-hidden":"true","aria-current":n?"true":"false",children:[t("com_ui_name"),l.jsx(a,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})})},cell:({row:e})=>{var t;const n=e.original;if(null==(t=n.type)?void 0:t.startsWith("image"))return l.jsxs("div",{className:"flex gap-2",children:[l.jsx(CI,{url:n.filepath,className:"relative h-10 w-10 shrink-0 overflow-visible rounded-md",source:n.source}),l.jsx("span",{className:"self-center truncate",children:n.filename})]});const a=_x(n.type);return l.jsxs("div",{className:"flex gap-2",children:[a&&l.jsx(jI,{fileType:a,className:"relative",file:n}),l.jsx("span",{className:"self-center truncate",children:n.filename})]})}},{accessorKey:"updatedAt",header:({column:e})=>{const t=qN(),n=e.getIsSorted();let a=Nt,s="none";return"desc"===n?(a=Ct,s="descending"):"asc"===n&&(a=St,s="ascending"),l.jsx(pr,{description:t("com_ui_date_sort"),side:"top",render:l.jsxs(Ys,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm","aria-sort":s,"aria-label":t("com_ui_date_sort"),"aria-hidden":"true","aria-current":n?"true":"false",children:[t("com_ui_date"),l.jsx(a,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})})},cell:({row:e})=>{var t;const n=vr("(max-width: 768px)");return bx((null==(t=e.original.updatedAt)?void 0:t.toString())??"",n)}},{accessorKey:"filterSource",header:({column:e})=>{const t=qN();return l.jsx(UP,{column:e,title:t("com_ui_storage"),ariaLabel:t("com_ui_storage_filter_sort"),filters:{Storage:Object.values(Sd).filter((e=>e===Sd.local||e===Sd.openai||e===Sd.azure))},valueMap:{[Sd.azure]:"com_ui_azure",[Sd.openai]:"com_ui_openai",[Sd.local]:"com_ui_host"}})},cell:({row:e})=>{const t=qN(),{source:n}=e.original;return n===Sd.openai?l.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.jsx(Vr,{className:"icon-sm text-green-600/50"}),"OpenAI"]}):n===Sd.azure?l.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.jsx(Gs,{className:"icon-sm text-cyan-700"}),"Azure"]}):l.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.jsx(He,{className:"icon-sm text-cyan-700","aria-hidden":"true"}),t("com_ui_host")]})}},{accessorKey:"context",header:({column:e})=>{const t=qN();return l.jsx(UP,{column:e,title:t("com_ui_context"),ariaLabel:t("com_ui_context_filter_sort"),filters:{Context:Object.values(ou).filter((e=>e===ou[e??""]))},valueMap:zP})},cell:({row:e})=>{const{context:t}=e.original,n=qN();return l.jsx("div",{className:"flex flex-wrap items-center gap-2",children:n(zP[t??ou.unknown])})}},{accessorKey:"bytes",header:({column:e})=>{const t=qN(),n=e.getIsSorted();let a=Nt,s="none";return"desc"===n?(a=Ct,s="descending"):"asc"===n&&(a=St,s="ascending"),l.jsx(pr,{description:t("com_ui_size_sort"),side:"top",render:l.jsxs(Ys,{variant:"ghost",className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),"aria-sort":s,"aria-label":t("com_ui_size_sort"),"aria-hidden":"true","aria-current":n?"true":"false",children:[t("com_ui_size"),l.jsx(a,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})})},cell:({row:e})=>{const t=Number((Number(e.original.bytes)/1024/1024).toFixed(2));return t<.01?"< 0.01 MB":`${t} MB`}}];function $P({table:e,contextMap:t,isSmallScreen:n}){const a=qN(),s=Ea(),[r,o]=ja(!1),i=Ca((()=>e.getAllColumns().filter((e=>e.getCanHide())).map((e=>({label:a(t[e.id]),onClick:()=>e.toggleVisibility(!e.getIsVisible()),icon:e.getIsVisible()?"":"",id:e.id})))),[e,t,a]);return l.jsx(cr,{portal:!1,isOpen:r,setIsOpen:o,trigger:l.jsx(se,{"aria-label":a("com_files_filter_by"),className:Qf("inline-flex h-9 items-center justify-center gap-2 rounded-md border border-input bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",n&&"px-2 py-1"),children:l.jsx(wt,{className:"size-3.5 sm:size-4","aria-hidden":"true"})}),items:i,menuId:s,className:"z-50 max-h-[300px] overflow-y-auto"})}const BP={[ou.filename]:"com_ui_name",[ou.updatedAt]:"com_ui_date",[ou.filterSource]:"com_ui_storage",[ou.context]:"com_ui_context",[ou.bytes]:"com_ui_size"};function HP({columns:e,data:t}){var n;const a=qN(),[s,r]=ja(!1),o=y(N_.filesByIndex(0)),{deleteFiles:i}=function(e){const t=xs(),n=W_({onMutate:async e=>{const{files:t}=e;return t.length?{filesToDeleteMap:t.reduce(((e,t)=>(e.set(t.file_id,t),e)),new Map)}:new Map},onSuccess:(n,a,s)=>{console.log("Files deleted");const{filesToDeleteMap:r}=s;t.setQueryData([Fh.files],(e=>{const{files:t}=a;return t.length?null==e?void 0:e.filter((e=>!r.has(e.file_id))):e})),null==e||e()},onError:t=>{console.log("Error deleting files:",t),null==e||e()}});return MC({mutateAsync:n.mutateAsync})}((()=>r(!1))),[c,d]=ja({}),[u,m]=ja([]),p=vr("(max-width: 768px)"),[h,g]=ja([]),[x,f]=ja({}),v=_s({data:t,columns:e,defaultColumn:{minSize:0,size:Number.MAX_SAFE_INTEGER,maxSize:Number.MAX_SAFE_INTEGER},onSortingChange:m,getCoreRowModel:bs(),getSortedRowModel:Ns(),onColumnFiltersChange:g,getFilteredRowModel:ws(),onColumnVisibilityChange:f,getPaginationRowModel:js(),onRowSelectionChange:d,state:{sorting:u,columnFilters:h,columnVisibility:x,rowSelection:c}});return l.jsxs("div",{className:"flex h-full flex-col gap-4",children:[l.jsxs("div",{className:"flex flex-wrap items-center gap-2 py-2 sm:gap-4 sm:py-4",children:[l.jsxs(Ys,{variant:"outline",onClick:()=>{r(!0);const e=v.getFilteredSelectedRowModel().rows.map((e=>e.original));i({files:e,setFiles:o}),d({})},disabled:!v.getFilteredSelectedRowModel().rows.length||s,className:Qf("min-w-[40px] transition-all duration-200",p&&"px-2 py-1"),children:[s?l.jsx(Xs,{className:"size-3.5 sm:size-4"}):l.jsx(yr,{className:"size-3.5 text-red-400 sm:size-4"}),!p&&l.jsx("span",{className:"ml-2",children:a("com_ui_delete")})]}),l.jsxs("div",{className:"relative flex-1",children:[l.jsx(_e,{className:"absolute left-3 top-1/2 z-10 h-4 w-4 -translate-y-1/2 text-text-secondary"}),l.jsx(kr,{id:"files-filter",placeholder:" ",value:(null==(n=v.getColumn("filename"))?void 0:n.getFilterValue())??"",onChange:e=>{var t;return null==(t=v.getColumn("filename"))?void 0:t.setFilterValue(e.target.value)},className:"peer w-full pl-10 text-sm focus-visible:ring-2 focus-visible:ring-ring","aria-label":a("com_files_filter_input")}),l.jsx("label",{htmlFor:"files-filter",className:"pointer-events-none absolute left-10 top-1/2 -translate-y-1/2 text-sm text-text-secondary transition-all duration-200 peer-focus:top-0 peer-focus:bg-background peer-focus:px-1 peer-focus:text-xs peer-[:not(:placeholder-shown)]:top-0 peer-[:not(:placeholder-shown)]:bg-background peer-[:not(:placeholder-shown)]:px-1 peer-[:not(:placeholder-shown)]:text-xs",children:a("com_files_filter")})]}),l.jsx("div",{className:"relative focus-within:z-[100]",children:l.jsx($P,{table:v,contextMap:BP,isSmallScreen:p})})]}),l.jsx("div",{className:"relative grid h-full max-h-[calc(100vh-20rem)] min-h-[calc(100vh-20rem)] w-full flex-1 overflow-hidden overflow-x-auto overflow-y-auto rounded-md border border-black/10 dark:border-white/10",children:l.jsxs(no,{className:"w-full min-w-[300px] border-separate border-spacing-0",children:[l.jsx(ao,{className:"sticky top-0 z-50",children:v.getHeaderGroups().map((e=>l.jsx(eo,{className:"border-b border-border-light",children:e.headers.map(((e,t)=>{const n=e.getSize(),a={width:n===Number.MAX_SAFE_INTEGER?"auto":n};return l.jsx(so,{className:"whitespace-nowrap bg-surface-secondary px-2 py-2 text-left text-sm font-medium text-text-secondary sm:px-4",style:{...a},children:e.isPlaceholder?null:ys(e.column.columnDef.header,e.getContext())},e.id)}))},e.id)))}),l.jsx(ro,{className:"w-full",children:v.getRowModel().rows.length?v.getRowModel().rows.map((e=>l.jsx(eo,{"data-state":e.getIsSelected()&&"selected",className:"border-b border-border-light transition-colors hover:bg-surface-secondary [tr:last-child_&]:border-b-0",children:e.getVisibleCells().map(((e,t)=>{const n=e.column.getSize(),a={width:n===Number.MAX_SAFE_INTEGER?"auto":n};return l.jsx(to,{className:Qf("align-start px-2 py-1 text-xs sm:px-4 sm:py-2 sm:text-sm [tr[data-disabled=true]_&]:opacity-50","select"===e.column.id?"overflow-visible":"overflow-x-auto"),style:a,children:ys(e.column.columnDef.cell,e.getContext())},e.id)}))},e.id))):l.jsx(eo,{children:l.jsx(to,{colSpan:e.length,className:"h-24 text-center",children:a("com_files_no_results")})})})]})}),l.jsxs("div",{className:"flex items-center justify-end gap-2 py-4",children:[l.jsxs("div",{className:"ml-2 flex-1 truncate text-xs text-muted-foreground sm:ml-4 sm:text-sm",children:[l.jsx("span",{className:"hidden sm:inline",children:a("com_files_number_selected",{0:`${v.getFilteredSelectedRowModel().rows.length}`,1:`${v.getFilteredRowModel().rows.length}`})}),l.jsx("span",{className:"sm:hidden",children:`${v.getFilteredSelectedRowModel().rows.length}/${v.getFilteredRowModel().rows.length}`})]}),l.jsxs("div",{className:"flex items-center space-x-1 pr-2 text-xs font-bold text-text-primary sm:text-sm",children:[l.jsx("span",{className:"hidden sm:inline",children:a("com_ui_page")}),l.jsx("span",{children:v.getState().pagination.pageIndex+1}),l.jsx("span",{children:"/"}),l.jsx("span",{children:Math.max(v.getPageCount(),1)})]}),l.jsx(Ys,{className:"select-none",variant:"outline",size:"sm",onClick:()=>v.previousPage(),disabled:!v.getCanPreviousPage(),children:a("com_ui_prev")}),l.jsx(Ys,{className:"select-none",variant:"outline",size:"sm",onClick:()=>v.nextPage(),disabled:!v.getCanNextPage(),children:a("com_ui_next")})]})]})}function GP({open:e,onOpenChange:t,triggerRef:n}){const a=qN(),{data:s=[]}=q_({select:e=>e.map((e=>(e.context=e.context??ou.unknown,e.filterSource=e.source===Sd.firebase?Sd.local:e.source,e)))});return l.jsx(rr,{open:e,onOpenChange:t,triggerRef:n,children:l.jsxs(ir,{title:a("com_nav_my_files"),className:"w-11/12 bg-background text-text-primary shadow-2xl",children:[l.jsx(br,{children:l.jsx(lr,{children:a("com_nav_my_files")})}),l.jsx(HP,{columns:VP,data:s})]})})}function KP({columns:e,data:t}){var n;const a=qN(),[s,r]=ja([]),[o,i]=ja([]),[c,d]=ja({}),[{pageIndex:u,pageSize:m},p]=ja({pageIndex:0,pageSize:10}),[h,g]=ja(!1),x=ba(null),f=Ca((()=>({pageIndex:u,pageSize:m})),[u,m]),v=_s({data:t,columns:e,state:{sorting:s,columnFilters:o,columnVisibility:c,pagination:f},onSortingChange:r,onPaginationChange:p,getCoreRowModel:bs(),getSortedRowModel:Ns(),onColumnFiltersChange:i,getFilteredRowModel:ws(),onColumnVisibilityChange:d,getPaginationRowModel:js(),defaultColumn:{minSize:0,size:10,maxSize:10,enableResizing:!0}}),_=pk(),{showToast:b}=Ds(),{setFiles:y,conversation:j}=$N(),{data:w=null}=Y_({select:e=>wd(e)}),{addFile:N}=$C(y),k=ka((e=>{if(!(null==_?void 0:_[e.file_id])||!(null==j?void 0:j.endpoint))return void b({message:a("com_ui_attach_error"),status:"error"});const t=_[e.file_id],n=j.endpoint,s=j.endpointType;if(!t.source)return;const r=du(t.source),o=lc(n);if(r&&!o)return void b({message:a("com_ui_attach_error_openai"),status:"error"});!r&&o&&b({message:a("com_ui_attach_warn_endpoint"),status:"warning"});const i=jd({fileConfig:w,endpoint:n,endpointType:s});!0!==i.disabled?t.bytes>(i.fileSizeLimit??Number.MAX_SAFE_INTEGER)?b({message:`${a("com_ui_attach_error_size")} ${(i.fileSizeLimit??0)/md} MB (${n})`,status:"error"}):xd.checkType(e.type,i.supportedMimeTypes??[])?N({progress:1,attached:!0,file_id:t.file_id,filepath:t.filepath,preview:t.filepath,type:t.type,height:t.height,width:t.width,filename:t.filename,source:t.source,size:t.bytes,metadata:t.metadata}):b({message:`${a("com_ui_attach_error_type")} ${e.type} (${n})`,status:"error"}):b({message:a("com_ui_attach_error_disabled"),status:"error"})}),[N,_,j,a,b,w]),C=null==(n=v.getColumn("filename"))?void 0:n.getFilterValue();return l.jsxs("div",{role:"region","aria-label":a("com_files_table"),className:"mt-2 space-y-2",children:[l.jsxs("div",{className:"relative flex items-center gap-4",children:[l.jsx(kr,{id:"filename-filter",placeholder:" ",value:C??"",onChange:e=>{var t;return null==(t=v.getColumn("filename"))?void 0:t.setFilterValue(e.target.value)},"aria-label":a("com_files_filter"),className:"peer"}),l.jsx("label",{htmlFor:"filename-filter",className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-sm text-text-secondary transition-all duration-200 peer-focus:top-0 peer-focus:bg-background peer-focus:px-1 peer-focus:text-xs peer-[:not(:placeholder-shown)]:top-0 peer-[:not(:placeholder-shown)]:bg-background peer-[:not(:placeholder-shown)]:px-1 peer-[:not(:placeholder-shown)]:text-xs",children:a("com_files_filter")})]}),l.jsx("div",{className:"rounded-lg border border-border-light bg-transparent shadow-sm transition-colors",children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs(no,{children:[l.jsx(ao,{children:v.getHeaderGroups().map((e=>l.jsx(eo,{className:"border-b border-border-light",children:e.headers.map(((e,t)=>l.jsx(so,{style:{width:0===t?"75%":"25%"},className:"bg-surface-secondary py-3 text-left text-sm font-medium text-text-secondary",children:l.jsx("div",{className:"px-4",children:e.isPlaceholder?null:ys(e.column.columnDef.header,e.getContext())})},e.id)))},e.id)))}),l.jsx(ro,{children:v.getRowModel().rows.length?v.getRowModel().rows.map((e=>l.jsx(eo,{"data-state":e.getIsSelected()&&"selected",className:"border-b border-border-light transition-colors hover:bg-surface-secondary [&:last-child]:border-0",children:e.getVisibleCells().map((t=>{const n="filename"===t.column.id;return l.jsx(to,{style:{width:"150px",maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:n?"focus:outline-none focus-visible:outline-2 focus-visible:outline-offset-[-2px] focus-visible:outline-text-primary":"","data-skip-refocus":"true",role:n?"button":void 0,tabIndex:n?0:void 0,onClick:t=>{if(n){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),k(e.original))}},onKeyDown:t=>{if(n&&("Enter"===t.key||" "===t.key)){const n=t.target;n.closest("td")&&!n.closest("button, a")&&(t.preventDefault(),t.stopPropagation(),k(e.original))}},children:ys(t.column.columnDef.cell,t.getContext())},t.id)}))},e.id))):l.jsx(eo,{children:l.jsx(to,{colSpan:e.length,className:"h-24 text-center text-sm text-text-secondary",children:a("com_files_no_results")})})})]})})}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs(Ys,{ref:x,variant:"outline",size:"sm",onClick:()=>g(!0),"aria-label":a("com_sidepanel_manage_files"),children:[l.jsx(Tt,{className:"h-4 w-4","aria-hidden":"true"}),l.jsx("span",{className:"ml-2",children:a("com_sidepanel_manage_files")})]}),l.jsxs("div",{className:"flex items-center gap-2",role:"navigation","aria-label":"Pagination",children:[l.jsx(Ys,{variant:"outline",size:"sm",onClick:()=>v.previousPage(),disabled:!v.getCanPreviousPage(),"aria-label":a("com_ui_prev"),children:a("com_ui_prev")}),l.jsx("div",{"aria-live":"polite",className:"text-sm",children:`${u+1} / ${v.getPageCount()}`}),l.jsx(Ys,{variant:"outline",size:"sm",onClick:()=>v.nextPage(),disabled:!v.getCanNextPage(),"aria-label":a("com_ui_next"),children:a("com_ui_next")})]})]}),l.jsx(GP,{open:h,onOpenChange:g,triggerRef:x})]})}function WP(){const{data:e=[]}=q_();return l.jsx("div",{className:"h-auto max-w-full overflow-x-visible",children:l.jsx(KP,{columns:FP,data:e})})}function qP({onToggle:e,navVisible:t,isHovering:n,setIsHovering:a,side:s="left",className:r="",translateX:o=!0}){const i=qN(),c={transition:"transform 0.3s ease, opacity 0.2s ease"},d=n||!t?"15deg":"0deg",u="right"===s?`-${d}`:d,m="right"===s?d:`-${d}`;let p,h;p=i("left"===s?"com_ui_chat_history":"com_nav_control_panel"),h=t?"com_ui_close_var":"com_ui_open_var";const g=i(h,{0:p});return l.jsx("div",{className:Qf(r,"-translate-y-1/2 transition-transform",t?"rotate-0":"rotate-180",t&&o?"translate-x-[260px]":"translate-x-0"),onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:l.jsx(pr,{side:"right"===s?"left":"right","aria-label":g,"aria-expanded":t,"aria-controls":"left"===s?"chat-history-nav":"controls-nav",id:`toggle-${s}-nav`,onClick:e,role:"button",description:g,className:"flex items-center justify-center",tabIndex:0,children:l.jsx("span",{className:"","data-state":"closed",children:l.jsx("div",{className:"flex h-[72px] w-8 items-center justify-center",style:{...c,opacity:n?1:.25},children:l.jsxs("div",{className:"flex h-6 w-6 flex-col items-center",children:[l.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(0.15rem) rotate(${u}) translateZ(0px)`}}),l.jsx("div",{className:"h-3 w-1 rounded-full bg-black dark:bg-white",style:{...c,transform:`translateY(-0.15rem) rotate(${m}) translateZ(0px)`}})]})})})})})}function QP({links:e,isCollapsed:t,resize:n}){const a=qN(),{active:s,setActive:r}=function(){const e=Na(rk);if(void 0===e)throw new Error("useActivePanel must be used within an ActivePanelProvider");return e}();return l.jsx("div",{"data-collapsed":t,className:"bg-token-sidebar-surface-primary hide-scrollbar group flex-shrink-0 overflow-x-hidden",children:l.jsx("div",{className:"h-full",children:l.jsx("div",{className:"flex h-full min-h-0 flex-col",children:l.jsx("div",{className:"flex h-full min-h-0 flex-col opacity-100 transition-opacity",children:l.jsx("div",{className:"scrollbar-trigger relative h-full w-full flex-1 items-start border-white/20",children:l.jsx("div",{className:"flex h-full w-full flex-col gap-1 px-3 py-2.5 group-[[data-collapsed=true]]:items-center group-[[data-collapsed=true]]:justify-center group-[[data-collapsed=true]]:px-2",children:e.map(((e,o)=>{const i=(e=>e.id===s?"default":"ghost")(e);return t?l.jsx(pr,{description:a(e.title),side:"left",render:l.jsxs(Ys,{variant:"ghost",size:"icon",onClick:t=>{if(e.onClick)return e.onClick(t),void r("");r(e.id),n&&n(25)},children:[l.jsx(e.icon,{className:"h-4 w-4 text-text-secondary"}),l.jsx("span",{className:"sr-only",children:a(e.title)})]})},`nav-link-${o}`):l.jsx(Yr,{type:"single",value:s,onValueChange:r,collapsible:!0,children:l.jsxs(Xr,{value:e.id,className:"w-full border-none",children:[l.jsx(Ha,{asChild:!0,children:l.jsx(Ga,{asChild:!0,children:l.jsxs(Ys,{variant:"outline",size:"sm",className:"w-full justify-start bg-transparent text-text-secondary data-[state=open]:bg-surface-secondary data-[state=open]:text-text-primary",onClick:t=>{e.onClick&&(e.onClick(t),r(""))},children:[l.jsx(e.icon,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),a(e.title),null!=e.label&&e.label&&l.jsx("span",{className:Qf("ml-auto opacity-100 transition-all duration-300 ease-in-out","default"===i?"text-text-primary":""),children:e.label})]})})}),l.jsx(Jr,{className:"w-full text-text-primary",children:e.Component&&l.jsx(e.Component,{})})]})},o)}))})})})})})})}function YP({links:e,isCollapsed:t,resize:n,defaultActive:a}){return l.jsx(ok,{defaultActive:a,children:l.jsx(QP,{links:e,isCollapsed:t,resize:n})})}Sd.openai,Sd.local,Sd.local,Sd.local;const XP=Sa((({defaultSize:e,panelRef:t,navCollapsedSize:n=3,hasArtifacts:a,minSize:s,setMinSize:r,collapsedSize:o,setCollapsedSize:i,isCollapsed:c,setIsCollapsed:d,fullCollapse:u,setFullCollapse:m,interfaceConfig:p})=>{var h;const g=qN(),{endpoint:x}=function(){const e=Na(Gk);if(!e)throw new Error("useSidePanelContext must be used within SidePanelProvider");return e}(),[f,v]=ja(!1),[_,b]=JS("newUser",!0),{data:y={}}=G_(),j=vr("(max-width: 767px)"),{data:w={expiresAt:void 0}}=kN(x??""),N=Ca((()=>{const e=localStorage.getItem("side:active-panel");return"string"==typeof e?e:void 0}),[]),k=Ca((()=>Zm(y,x,"type")),[x,y]),C=Ca((()=>{var e;return!!(null==(e=null==y?void 0:y[x??""])?void 0:e.userProvide)}),[y,x]),S=Ca((()=>!C||!!w.expiresAt),[w.expiresAt,C]),T=ka((()=>{var e;d(!0),i(0),r(20),m(!0),localStorage.setItem("fullPanelCollapse","true"),null==(e=t.current)||e.collapse()}),[t,r,d,m,i]),E=function({hidePanel:e,keyProvided:t,endpoint:n,endpointType:a,interfaceConfig:s,endpointsConfig:r}){const o=ak({permissionType:Pp.PROMPTS,permission:Op.USE}),i=ak({permissionType:Pp.BOOKMARKS,permission:Op.USE}),l=ak({permissionType:Pp.MEMORIES,permission:Op.USE}),c=ak({permissionType:Pp.MEMORIES,permission:Op.READ}),d=ak({permissionType:Pp.AGENTS,permission:Op.USE}),u=ak({permissionType:Pp.AGENTS,permission:Op.CREATE}),m=ak({permissionType:Pp.MCP_SERVERS,permission:Op.USE}),p=ak({permissionType:Pp.MCP_SERVERS,permission:Op.CREATE}),{availableMCPServers:h}=aS();return Ca((()=>{const g=[];return lc(n)&&(n===Yl.assistants&&(null==r?void 0:r[Yl.assistants])&&!0!==r[Yl.assistants].disableBuilder||n===Yl.azureAssistants&&(null==r?void 0:r[Yl.azureAssistants])&&!0!==r[Yl.azureAssistants].disableBuilder)&&t&&g.push({title:"com_sidepanel_assistant_builder",label:"",icon:wo,id:Yl.assistants,Component:aA}),(null==r?void 0:r[Yl.agents])&&d&&u&&!0!==r[Yl.agents].disableBuilder&&g.push({title:"com_sidepanel_agent_builder",label:"",icon:wo,id:Yl.agents,Component:pR}),o&&g.push({title:"com_ui_prompts",label:"",icon:Et,id:"prompts",Component:LP}),l&&c&&g.push({title:"com_ui_memories",label:"",icon:He,id:"memories",Component:ER}),!0===s.parameters&&!0===dc(n??"",a??"")&&!cc(n)&&t&&g.push({title:"com_sidepanel_parameters",label:"",icon:Qe,id:"parameters",Component:MP}),g.push({title:"com_sidepanel_attach_files",label:"",icon:Qr,id:"files",Component:WP}),i&&g.push({title:"com_sidepanel_conversation_tags",label:"",icon:It,id:"bookmarks",Component:yR}),(m&&h&&h.length>0||p)&&g.push({title:"com_nav_setting_mcp",label:"",icon:wr,id:"mcp-builder",Component:lE}),g.push({title:"com_sidepanel_hide_panel",label:"",icon:Rt,onClick:e,id:"hide-panel"}),g}),[n,r,t,d,u,o,l,c,s.parameters,a,i,h,m,p,e])}({endpoint:x,hidePanel:T,keyProvided:S,endpointType:k,interfaceConfig:p,endpointsConfig:y}),I=ka((()=>{var e,a;_&&b(!1),d((e=>(e&&(r(20),i(n),m(!1),localStorage.setItem("fullPanelCollapse","false")),!e))),c?null==(a=t.current)||a.expand():null==(e=t.current)||e.collapse()}),[_,t,b,r,c,d,m,i,n]);return l.jsxs(l.Fragment,{children:[l.jsx("div",{onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),className:"relative flex w-px items-center justify-center",children:l.jsx(qP,{navVisible:!c,isHovering:f,onToggle:I,setIsHovering:v,className:Qf("fixed top-1/2",c&&(0===s||0===o)||u?"mr-9":"mr-16"),translateX:!1,side:"right"})}),(!c||s>0)&&!j&&!u&&l.jsx(ur,{withHandle:!0,className:"bg-transparent text-text-primary"}),l.jsx(mr,{tagName:"nav",id:"controls-nav",order:a?3:2,"aria-label":g("com_ui_controls"),role:"navigation",collapsedSize:o,defaultSize:e,collapsible:!0,minSize:s,maxSize:40,ref:t,style:{overflowY:"auto",transition:"width 0.2s ease, visibility 0s linear 0.2s"},onExpand:()=>{c&&(u||0===o)||(d(!1),localStorage.setItem("react-resizable-panels:collapsed","false"))},onCollapse:()=>{d(!0),localStorage.setItem("react-resizable-panels:collapsed","true")},className:Qf("sidenav hide-scrollbar border-l border-border-light bg-background py-1 transition-opacity",c?"min-w-[50px]":"min-w-[340px] sm:min-w-[352px]",j&&c&&(0===s||0===o)||u?"hidden min-w-0":"opacity-100"),children:l.jsx(YP,{resize:null==(h=t.current)?void 0:h.resize,isCollapsed:c,defaultActive:N,links:E})})]})})),JP=Nm().interface,ZP=Sa((({defaultLayout:e=[97,3],defaultCollapsed:t=!1,fullPanelCollapse:n=!1,navCollapsedSize:a=3,artifacts:s,children:r})=>{const{data:o}=K_(),i=Ca((()=>(null==o?void 0:o.interface)??JP),[o]),c=ba(null),[d,u]=ja(20),[m,p]=ja(t),[h,g]=ja(n),[x,f]=ja(a),[v,_]=ja(null!=s),b=vr("(max-width: 767px)"),y=j(N_.hideSidePanel),w=ka((()=>{if(null==s){const t=2===e.length?e[1]:e[2];return[100-t,t]}{const e=0,t=100-e,n=Math.floor(t/2);return[n,t-n,e]}}),[s,e]),N=Ca((()=>dv(w())),[w]),k=Ca((()=>_i((e=>{const t=dv(e);localStorage.setItem("react-resizable-panels:layout",JSON.stringify(t))}),350)),[]);ya((()=>{var e;if(b)return p(!0),f(0),u(20),g(!0),localStorage.setItem("fullPanelCollapse","true"),void(null==(e=c.current)||e.collapse());p(t),f(a),u(20)}),[b,t,a,n]);const C=Ca((()=>null!=s?15:30),[s]),S=ka((()=>{var e;p((()=>(localStorage.setItem("fullPanelCollapse","true"),g(!0),f(0),u(0),!1))),null==(e=c.current)||e.collapse()}),[]);return l.jsxs(l.Fragment,{children:[l.jsxs(No,{direction:"horizontal",onLayout:e=>k(e),className:"relative h-full w-full flex-1 overflow-auto bg-presentation",children:[l.jsx(mr,{defaultSize:N[0],minSize:C,order:1,id:"messages-view",children:r}),!b&&l.jsx(kT,{artifacts:s,currentLayout:N,minSizeMain:C,shouldRender:v,onRenderChange:_}),!y&&!0===i.sidePanel&&l.jsx(XP,{panelRef:c,minSize:d,setMinSize:u,isCollapsed:m,setIsCollapsed:p,collapsedSize:x,setCollapsedSize:f,fullCollapse:h,setFullCollapse:g,interfaceConfig:i,hasArtifacts:v,defaultSize:N[N.length-1]})]}),null!=s&&b&&l.jsx("div",{className:"fixed inset-0 z-[100]",children:s}),!y&&!0===i.sidePanel&&l.jsx("button",{"aria-label":"Close right side panel",className:"nav-mask "+(m?"":"active"),onClick:S})]})}));function eO({buttonClass:e,iconClass:t="",endpoint:n,endpointType:a,model:s}){const r=qN(),{conversation:o,optionSettings:i,setOptionSettings:c}=$N(),[d,u]=b(N_.currentSettingsView),{model:m,endpoint:p,endpointType:h}=o??{},g=a??n??h??p??"",x=s??m,f=/gemini|learnlm|gemma/.test(x??"")??!1,v=(!f&&(null==x?void 0:x.toLowerCase().includes("chat")))??!1,_=!f&&!v&&/code|text/.test(x??""),{showExamples:y}=i,j=!f&&!_&&v,w={[Yl.google]:[{label:r(!0===y?"com_hide_examples":"com_show_examples"),buttonClass:!0===f||_?"disabled":"",handler:()=>{u(_u.default),c((e=>({...e,showExamples:!e.showExamples})))},icon:l.jsx(ko,{className:Qf("mr-1 w-[14px]",t)})}]};if(!g)return null;if(g===Yl.google&&!j)return null;_u.default,Qf("mr-1 h-6 w-[14px]",t),_u.advanced,Qf("mr-1 h-6 w-[14px]",t);const N=w[g]??[];return l.jsxs("div",{className:"flex w-full justify-between",children:[l.jsx("div",{className:"flex items-center justify-start",children:N.map(((t,n)=>l.jsxs(Ys,{type:"button",className:Qf(t.buttonClass,"border border-gray-300/50 focus:ring-1 focus:ring-green-500/90 dark:border-gray-500/50 dark:focus:ring-green-500","ml-1 h-full bg-transparent px-2 py-1 text-xs font-normal text-black hover:bg-gray-100 hover:text-black dark:bg-transparent dark:text-white dark:hover:bg-gray-600 dark:hover:text-white",e??""),onClick:t.handler,children:[t.icon,t.label]},`button-${n}`)))}),null]})}ZP.displayName="SidePanelGroup";const tO=({exportPreset:e,submitPreset:t,triggerRef:n})=>{const a=qN(),s=xs(),{preset:r,setPreset:o}=$N(),{setOption:i,setOptions:c}=SC(r),[d,u]=kC({setOption:i,optionKey:"title",initialValue:null==r?void 0:r.title}),[m,p]=b(N_.presetModalVisible),{data:h=[]}=G_({select:_f}),g=Ca((()=>h.filter((e=>!cc(e)))),[h]);ya((()=>{if(!r)return;if(cc(r.endpoint))return;const e=r.endpoint??"";if(!e)return;const t=s.getQueryData([Fh.models]);if(!t)return;const n=t[e];n&&n.length&&r.model!==n[0]&&(n.includes(r.model??"")||(console.log("setting model",n[0]),i("model")(n[0])))}),[r,s,i]);const x=ka((e=>{if(!c)return console.warn("setOptions is not defined");const{newEndpointType:t}=yf({newEndpoint:e,modularChat:!0,conversation:null,endpointsConfig:s.getQueryData([Fh.endpoints])??{}});c({endpoint:e,endpointType:t})}),[s,c]),{endpoint:f,endpointType:v,model:_}=r||{},y=f??"";return y?cc(y)?null:l.jsx(rr,{open:m,onOpenChange:e=>{p(e),e||o(null)},triggerRef:n,children:l.jsxs(ir,{className:"h-[100dvh] max-h-[100dvh] w-full max-w-full overflow-y-auto bg-white dark:border-gray-700 dark:bg-gray-850 dark:text-gray-300 md:h-auto md:max-h-[90vh] md:max-w-[75vw] md:rounded-lg lg:max-w-[950px]",children:[l.jsx(lr,{children:a("com_ui_edit_preset_title",{title:null==r?void 0:r.title})}),l.jsxs("div",{className:"flex w-full flex-col gap-2 px-1 pb-4 md:gap-4",children:[l.jsxs("div",{className:"grid w-full gap-2 md:grid-cols-2 md:gap-4",children:[l.jsxs("div",{className:"flex w-full flex-col",children:[l.jsx(er,{htmlFor:"preset-name",className:"mb-1 text-left text-sm font-medium",children:a("com_endpoint_preset_name")}),l.jsx(kr,{id:"preset-name",value:u??"",onChange:d,placeholder:a("com_endpoint_set_custom_name"),className:Qf(ov,"flex h-10 max-h-10 w-full resize-none px-3 py-2",av)})]}),l.jsxs("div",{className:"flex w-full flex-col",children:[l.jsx(er,{htmlFor:"endpoint",className:"mb-1 text-left text-sm font-medium",children:a("com_endpoint")}),l.jsx($r,{value:y||"",setValue:x,showLabel:!1,emptyTitle:!0,searchPlaceholder:a("com_endpoint_search"),availableValues:g})]})]}),l.jsx("div",{className:"flex w-full",children:l.jsx(eO,{buttonClass:"ml-0 w-full border border-border-medium p-2 h-[40px] justify-center mt-0",iconClass:"hidden lg:block w-4",endpoint:y,endpointType:v,model:_})}),l.jsx("div",{className:"w-full border-t border-border-medium"}),l.jsx("div",{className:"w-full flex-1",children:l.jsx(fI,{conversation:r,setOption:i,isPreset:!0,className:"text-text-primary"})}),l.jsxs("div",{className:"flex justify-end gap-2 border-t border-border-medium pt-2 md:pt-4",children:[l.jsx("button",{onClick:e,className:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 md:px-4",children:a("com_endpoint_export")}),l.jsx("button",{onClick:t,className:"rounded-md bg-green-500 px-3 py-2 text-sm font-medium text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 md:px-4",children:a("com_ui_save")})]})]})]})}):null},nO=({onFileSelected:e,className:t="",containerClassName:n="",successText:a=null,invalidText:s=null,validator:r=null,text:o=null,id:i="1"})=>{const[c,d]=ja("text-gray-600"),[u,m]=ja(null),p=qN();let h;h=u?"success"===u?a??p("com_ui_upload_success"):s??p("com_ui_upload_invalid"):o??p("com_ui_import");return l.jsxs(l.Fragment,{children:[l.jsxs("button",{type:"button",onClick:()=>{const e=document.getElementById(`file-upload-${i}`);e&&e.click()},className:Qf("mr-1 flex h-auto cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-normal transition-colors hover:bg-gray-100 hover:text-green-600 focus:ring-ring dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-green-500",c,n),"aria-label":h,children:[l.jsx(At,{className:"mr-1 flex w-[22px] items-center stroke-1","aria-hidden":"true"}),l.jsx("span",{className:"flex text-xs",children:h})]}),l.jsx("input",{id:`file-upload-${i}`,value:"",type:"file",className:Qf("hidden",t),accept:".json",onChange:t=>{var n;const a=null==(n=t.target.files)?void 0:n[0];if(!a)return;const s=new FileReader;s.onload=t=>{var n;const a=JSON.parse(null==(n=t.target)?void 0:n.result);if(r&&!r(a))return m("invalid"),void d("text-red-600");r&&(m("success"),d("text-green-500 dark:text-green-500")),e(a)},s.readAsText(a)},tabIndex:-1})]})},aO=({title:e,description:t,selected:n,icon:a,className:s="",textClassName:r="",children:o,onClick:i,...c})=>l.jsx("div",{id:n?"selected-endpoint":void 0,role:"option","aria-selected":n,"aria-label":e,"data-testid":"chat-menu-item",className:Qf("group m-1.5 flex cursor-pointer gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 hover:bg-black/5 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 dark:hover:bg-gray-600 md:min-w-[240px]",s||""),tabIndex:0,onClick:i,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i&&i())},...c,children:l.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[l.jsx("div",{children:l.jsxs("div",{className:Qf("flex items-center gap-1"),children:[null!=a?a:null,l.jsxs("div",{className:Qf("truncate",r),children:[e,l.jsx("div",{className:"text-token-text-tertiary",children:t})]})]})}),l.jsxs("div",{className:"flex items-center gap-2",children:[o,n&&l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})}),sO=()=>l.jsx("div",{role:"separator","aria-orientation":"horizontal",className:"my-1.5 border-b bg-gray-200 dark:border-gray-700"}),rO=({presets:e,onSetDefaultPreset:t,onSelectPreset:n,onChangePreset:a,onDeletePreset:s,clearAllPresets:r,onFileSelected:o})=>{const{data:i}=G_(),c=j(N_.defaultPreset),d=qN();return l.jsxs(l.Fragment,{children:[l.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:l.jsxs("div",{className:"flex h-full grow items-center justify-end gap-2",children:[l.jsx("label",{htmlFor:"default-preset",className:"w-40 truncate rounded bg-transparent py-1 text-xs font-medium text-gray-600 transition-colors dark:bg-transparent dark:text-gray-300 sm:w-72",children:c?`${d("com_endpoint_preset_default_item")} ${c.title}`:d("com_endpoint_preset_default_none")}),l.jsxs(oo,{children:[l.jsx(io,{asChild:!0,children:l.jsxs("button",{type:"button",className:"mr-1 flex h-[32px] cursor-pointer items-center rounded bg-transparent px-2 py-1 text-xs font-medium text-gray-600 transition-colors hover:bg-gray-100 hover:text-red-700 focus:ring-ring dark:bg-transparent dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-red-700","aria-label":d("com_ui_clear_all"),children:[l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:"mr-1 flex w-[22px] items-center","aria-hidden":"true",children:l.jsx("path",{d:"M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M6.854 7.146 8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 1 1 .708-.708"})}),d("com_ui_clear_all")]})}),l.jsx(lo,{showCloseButton:!1,title:d("com_ui_clear_presets"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(er,{htmlFor:"preset-item-clear-all",className:"text-left text-sm font-medium",children:d("com_endpoint_presets_clear_warning")})})})}),selection:{selectHandler:r,selectClasses:"bg-red-600 hover:bg-red-700 dark:hover:bg-red-600 text-white",selectText:d("com_ui_clear")}}),l.jsx(nO,{onFileSelected:o})]})]})}),e&&0===e.length&&l.jsx("div",{role:"menuitem",className:"pointer-none group m-1.5 flex h-8 min-w-[170px] gap-2 rounded px-5 py-2.5 !pr-3 text-sm !opacity-100 focus:ring-0 radix-disabled:pointer-events-none radix-disabled:opacity-50 md:min-w-[240px]",tabIndex:-1,children:l.jsx("div",{className:"flex h-full grow items-center justify-end gap-2 text-gray-600 dark:text-gray-300",children:d("com_endpoint_no_presets")})}),l.jsx(us,{flipKey:null==e?void 0:e.map((e=>null==e?void 0:e.presetId)).filter((e=>e)).join("."),children:e&&e.length>0&&e.map(((r,o)=>{const u=(null==r?void 0:r.presetId)??"";if(!r||!u)return null;const m=Sf({endpoint:r.endpoint,endpointsConfig:i}),p=WS[m];return l.jsx(Za,{asChild:!0,children:l.jsxs("div",{children:[l.jsx(ms,{flipId:u,children:l.jsx(aO,{textClassName:"text-xs max-w-[150px] sm:max-w-[200px] truncate md:max-w-full ",title:Jx(r),onClick:()=>n(r),icon:null!=p&&l.jsx(p,{context:"menu-item",iconURL:Zm(i,r.endpoint,"iconURL"),className:"icon-md mr-1 dark:text-white",endpoint:r.endpoint}),selected:!1,"data-testid":`preset-item-${r}`,children:l.jsxs("div",{className:"flex h-full items-center justify-end gap-1",children:[l.jsx(pr,{description:(null==c?void 0:c.presetId)===u?d("com_ui_unpin"):d("com_ui_pin"),"aria-label":(null==c?void 0:c.presetId)===u?d("com_ui_unpin"):d("com_ui_pin"),render:l.jsx("button",{className:Qf("m-0 h-full rounded-md bg-transparent p-2 text-gray-400 hover:text-gray-700 focus:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 dark:focus:text-gray-200",(null==c?void 0:c.presetId)===u?"":"sm:invisible sm:group-focus-within:visible sm:group-hover:visible"),onClick:e=>{e.preventDefault(),e.stopPropagation(),t(r,(null==c?void 0:c.presetId)===u)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),t(r,(null==c?void 0:c.presetId)===u))},children:l.jsx(So,{unpin:(null==c?void 0:c.presetId)===u})})}),l.jsx(pr,{description:d("com_ui_edit"),"aria-label":d("com_ui_edit"),render:l.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-700 focus:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 dark:focus:text-gray-200 sm:invisible sm:group-focus-within:visible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),a(r)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),a(r))},children:l.jsx(Zr,{})})}),l.jsx(pr,{description:d("com_ui_delete"),"aria-label":d("com_ui_delete"),render:l.jsx("button",{className:"m-0 h-full rounded-md p-2 text-gray-400 hover:text-gray-600 focus:text-gray-600 dark:text-gray-400 dark:hover:text-gray-200 dark:focus:text-gray-200 sm:invisible sm:group-focus-within:visible sm:group-hover:visible",onClick:e=>{e.preventDefault(),e.stopPropagation(),s(r)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),s(r))},children:l.jsx(yr,{})})})]})},`preset-item-${u}`)}),o!==e.length-1&&l.jsx(sO,{})]},`preset-${u}`)},`preset-${u}`)}))})]})},oO=()=>{const e=qN(),t=ba(null),{presetsQuery:n,onSetDefaultPreset:a,onFileSelected:s,onSelectPreset:r,onChangePreset:o,clearAllPresets:i,onDeletePreset:c,submitPreset:d,exportPreset:u,showDeleteDialog:m,setShowDeleteDialog:p,presetToDelete:h,confirmDeletePreset:g}=NC(),{preset:x}=$N(),f=e=>{p(e),!e&&t.current&&setTimeout((()=>{var e;null==(e=t.current)||e.focus()}),0)};return l.jsxs(qa,{children:[l.jsx(Qa,{asChild:!0,children:l.jsx(pr,{ref:t,id:"presets-button","aria-label":e("com_endpoint_examples"),description:e("com_endpoint_examples"),tabIndex:0,role:"button","data-testid":"presets-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:l.jsx(Pt,{size:16,"aria-hidden":"true"})})}),l.jsx(Ka,{children:l.jsx("div",{style:{position:"fixed",left:"0px",top:"0px",transform:"translate3d(268px, 50px, 0px)",minWidth:"max-content",zIndex:"auto"},children:l.jsx(Wa,{side:"bottom",align:"center",className:"mt-2 max-h-[495px] overflow-x-hidden rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-700 dark:text-white md:min-w-[400px]",children:l.jsx(rO,{presets:n.data,onSetDefaultPreset:a,onSelectPreset:r,onChangePreset:o,onDeletePreset:c,clearAllPresets:i,onFileSelected:s})})})}),x&&l.jsx(tO,{submitPreset:d,exportPreset:u,triggerRef:t}),h&&l.jsx(rr,{open:m,onOpenChange:f,children:l.jsxs(ir,{title:e("com_endpoint_preset_delete_confirm"),className:"w-11/12 max-w-md",showCloseButton:!1,children:[l.jsx(br,{children:l.jsx(lr,{children:e("com_ui_delete_preset")})}),l.jsx("div",{className:"w-full truncate",children:l.jsx(Ai,{i18nKey:"com_ui_delete_confirm_strong",values:{title:h.title},components:{strong:l.jsx("strong",{})}})}),l.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[l.jsx(Ys,{"aria-label":"cancel",variant:"outline",onClick:()=>f(!1),children:e("com_ui_cancel")}),l.jsx(Ys,{variant:"destructive",onClick:g,children:e("com_ui_delete")})]})]})})]})},iO="close-sidebar-button",lO="open-sidebar-button";function cO({setNavVisible:e,className:t}){const n=qN();return l.jsx(pr,{description:n("com_nav_open_sidebar"),render:l.jsx(Ys,{id:lO,size:"icon",variant:"outline","data-testid":"open-sidebar-button","aria-label":n("com_nav_open_sidebar"),"aria-expanded":!1,"aria-controls":"chat-history-nav",className:Qf("rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover",t),onClick:()=>{e((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),setTimeout((()=>{var e;null==(e=document.getElementById(iO))||e.focus()}),250)},children:l.jsx(bo,{"aria-hidden":"true"})})})}function dO(){const e=qN(),t=xs(),{conversation:n,newConversation:a}=$N();return l.jsx(pr,{description:e("com_ui_new_chat"),render:l.jsx(Ys,{size:"icon",variant:"outline","data-testid":"wide-header-new-chat-button","aria-label":e("com_ui_new_chat"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(mf(t,null==n?void 0:n.conversationId),t.invalidateQueries([Fh.messages]),a()):window.open("/c/new","_blank")},children:l.jsx(To,{})})})}const uO=({isLoading:e,hasData:t,delay:n=150,loadingComponent:a,children:s,className:r=""})=>{const[o,i]=ja(!1);return ya((()=>{let a;return e&&!t?a=setTimeout((()=>{i(!0)}),n):i(!1),()=>{a&&clearTimeout(a)}}),[e,t,n]),o?l.jsx("div",{className:r,children:a}):l.jsx("div",{className:r,children:s})},mO=({categories:e,activeTab:t,isLoading:n,onChange:a})=>{const s=qN(),r=vr("(max-width: 768px)"),o=e=>"promoted"===e.value?s("com_agents_top_picks"):"all"===e.value?s("com_agents_all_category"):e.label&&e.label.startsWith("com_")?s(e.label):e.label||e.value.charAt(0).toUpperCase()+e.value.slice(1),i=l.jsx("div",{className:"w-full pb-2",children:l.jsx("div",{className:"flex flex-wrap justify-center gap-1.5 px-4",children:[...Array(6)].map(((e,t)=>l.jsx("div",{className:"h-[36px] min-w-[80px] animate-pulse rounded-lg bg-surface-tertiary"},t)))})});if(!(n||e&&0!==e.length))return l.jsx("div",{className:"text-center text-text-secondary",children:s("com_ui_no_categories")});const c=l.jsx("div",{className:"w-full pb-2",children:l.jsx("div",{className:Qf("px-4",r?"scrollbar-hide flex gap-2 overflow-x-auto scroll-smooth":"flex flex-wrap justify-center gap-1.5"),role:"tablist","aria-label":s("com_agents_category_tabs_label"),"aria-orientation":"horizontal",style:r?{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"}:void 0,children:e.map(((n,i)=>l.jsxs("button",{id:`category-tab-${n.value}`,onClick:()=>a(n.value),onKeyDown:t=>((t,n)=>{const s=e.findIndex((e=>e.value===n));let r=s;switch(t.key){case"ArrowLeft":t.preventDefault(),r=s>0?s-1:e.length-1;break;case"ArrowRight":t.preventDefault(),r=s<e.length-1?s+1:0;break;case"ArrowUp":t.preventDefault(),r=Math.max(0,s-5);break;case"ArrowDown":t.preventDefault(),r=Math.min(e.length-1,s+5);break;case"Home":t.preventDefault(),r=0;break;case"End":t.preventDefault(),r=e.length-1;break;default:return}const o=e[r];o&&(a(o.value),setTimeout((()=>{const e=document.getElementById(`category-tab-${o.value}`);e&&e.focus()}),0))})(t,n.value),className:Qf("relative cursor-pointer select-none whitespace-nowrap px-3 py-2 transition-all duration-200",r?"min-w-fit flex-shrink-0":"",t===n.value?"rounded-t-lg bg-surface-hover text-text-primary":"rounded-lg bg-surface-secondary text-text-secondary hover:bg-surface-hover hover:text-text-primary active:scale-95"),role:"tab","aria-selected":t===n.value,"aria-controls":`tabpanel-${n.value}`,tabIndex:t===n.value?0:-1,"aria-label":s("com_agents_category_tab_label",{category:o(n),position:i+1,total:e.length}),children:[o(n),t===n.value&&l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-text-primary","aria-hidden":"true"})]},n.value)))})});return l.jsx(uO,{isLoading:n,hasData:(null==e?void 0:e.length)>0,delay:100,loadingComponent:i,children:c})},pO=({value:e,onSearch:t,className:n=""})=>{const a=qN(),[s,r]=ja(e),o=WC(s,300);ya((()=>{r(e)}),[e]),ya((()=>{o!==e&&o===s&&t(o)}),[o,t,e,s]);const i=ka((()=>{t(""),r("")}),[t]);return l.jsxs("div",{className:`relative w-full max-w-4xl ${n}`,role:"search",children:[l.jsx("label",{htmlFor:"agent-search",className:"sr-only",children:a("com_agents_search_instructions")}),l.jsx(kr,{id:"agent-search",type:"text",value:s,onChange:e=>{r(e.target.value)},placeholder:a("com_agents_search_placeholder"),className:"h-12 rounded-xl border-border-medium bg-transparent pl-12 pr-12 text-lg text-text-primary shadow-md transition-[border-color,box-shadow] duration-200 placeholder:text-text-secondary focus:border-border-heavy focus:shadow-lg focus:ring-0","aria-label":a("com_agents_search_aria"),"aria-describedby":"search-instructions search-results-count",autoComplete:"off",spellCheck:"false"}),l.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-4","aria-hidden":"true",children:l.jsx(_e,{className:"size-5 text-text-secondary"})}),l.jsx("div",{id:"search-instructions",className:"sr-only",children:a("com_agents_search_instructions")}),s&&l.jsx("button",{type:"button",onClick:i,className:"group absolute right-4 top-1/2 flex size-5 -translate-y-1/2 items-center justify-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","aria-label":a("com_agents_clear_search"),title:a("com_agents_clear_search"),children:l.jsx(re,{className:"size-5 text-text-secondary transition-colors duration-200 group-hover:text-text-primary",strokeWidth:2.5,"aria-hidden":"true"})})]})},hO=({error:e,onRetry:t,context:n})=>{const a=qN(),s=e=>"object"==typeof e&&null!==e&&!(e instanceof Error),r=e=>e instanceof Error,o=()=>(null==n?void 0:n.searchQuery)?a("com_agents_error_search_title"):(null==n?void 0:n.category)?a("com_agents_error_category_title"):a("com_agents_error_title"),i=()=>(null==n?void 0:n.searchQuery)?a("com_agents_search_no_results",{query:n.searchQuery}):(null==n?void 0:n.category)&&"all"!==n.category?a("com_agents_category_empty",{category:n.category}):a("com_agents_error_not_found_message"),{title:c,message:d,suggestion:u}=(()=>{var t,n;let l;l="string"==typeof e?{message:e}:r(e)?{message:e.message}:s(e)&&((null==(t=null==e?void 0:e.response)?void 0:t.data)||(null==e?void 0:e.data))||e;let c="";(r(e)||s(e)&&(null==e?void 0:e.message))&&(c=e.message);const d=s(e)?null==e?void 0:e.code:"";if("ECONNABORTED"===d||(null==c?void 0:c.includes("timeout")))return{title:a("com_agents_error_timeout_title"),message:a("com_agents_error_timeout_message"),suggestion:a("com_agents_error_timeout_suggestion")};if("NETWORK_ERROR"===d||(null==c?void 0:c.includes("Network Error")))return{title:a("com_agents_error_network_title"),message:a("com_agents_error_network_message"),suggestion:a("com_agents_error_network_suggestion")};const u=s(e)?null==(n=null==e?void 0:e.response)?void 0:n.status:null;if(u){if(404===u)return{title:a("com_agents_error_not_found_title"),message:i(),suggestion:a("com_agents_error_not_found_suggestion")};if(400===u)return{title:a("com_agents_error_invalid_request"),message:(null==l?void 0:l.userMessage)||a("com_agents_error_bad_request_message"),suggestion:(null==l?void 0:l.suggestion)||a("com_agents_error_bad_request_suggestion")};if(u>=500)return{title:a("com_agents_error_server_title"),message:a("com_agents_error_server_message"),suggestion:a("com_agents_error_server_suggestion")}}return l&&"object"==typeof l&&(null==l?void 0:l.userMessage)?{title:o(),message:l.userMessage,suggestion:l.suggestion||a("com_agents_error_suggestion_generic")}:{title:o(),message:a("com_agents_error_generic"),suggestion:a("com_agents_error_suggestion_generic")}})();return l.jsx("div",{className:"py-12 text-center",role:"alert","aria-live":"assertive","aria-atomic":"true",children:l.jsxs("div",{className:"mx-auto max-w-md space-y-4",children:[l.jsx("div",{className:"flex justify-center",children:l.jsx("div",{className:Qf("flex h-12 w-12 items-center justify-center rounded-full","bg-red-100 dark:bg-red-900/20"),children:l.jsx("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",role:"img","aria-label":"Error icon",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})})}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",id:"error-title",children:c}),l.jsx("p",{className:"text-gray-600 dark:text-gray-400",id:"error-message","aria-describedby":"error-title",children:d}),l.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-500",id:"error-suggestion",role:"note","aria-label":`Suggestion: ${u}`,children:[" ",u]})]}),t&&l.jsx("div",{className:"pt-2",children:l.jsx(Ys,{onClick:t,variant:"outline",size:"sm",className:Qf("border-red-300 text-red-700 hover:bg-red-50 focus:ring-2 focus:ring-red-500","dark:border-red-600 dark:text-red-400 dark:hover:bg-red-900/20 dark:focus:ring-red-400"),"aria-describedby":"error-message error-suggestion","aria-label":`Retry action. ${d}`,children:a("com_agents_error_retry")})})]})})},gO=({agent:e})=>{const t=qN(),n=xs(),{showToast:a}=Ds(),s=zN(),{conversation:r,newConversation:o}=$N(),{isFavoriteAgent:i,toggleFavoriteAgent:c}=XS(),d=i(null==e?void 0:e.id),u=()=>{if(!(null==e?void 0:e.support_contact))return null;const{name:t,email:n}=e.support_contact;return t&&n?l.jsx("a",{href:`mailto:${n}`,className:"text-primary hover:underline",children:t}):n?l.jsx("a",{href:`mailto:${n}`,className:"text-primary hover:underline",children:n}):t?l.jsx("span",{children:t}):null};return l.jsxs(ir,{className:"max-h-[90vh] w-11/12 max-w-lg overflow-y-auto",children:[l.jsx("div",{className:"mt-6 flex justify-center",children:Dx(e,{size:"xl"})}),l.jsx("div",{className:"mt-3 text-center",children:l.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:(null==e?void 0:e.name)||t("com_agents_loading")})}),(null==e?void 0:e.support_contact)&&u()&&l.jsxs("div",{className:"mt-1 text-center text-sm text-text-secondary",children:[t("com_agents_contact"),": ",u()]}),l.jsx("div",{className:"mt-4 whitespace-pre-wrap px-6 text-center text-base text-text-primary",children:null==e?void 0:e.description}),l.jsxs("div",{className:"mb-4 mt-6 flex justify-center gap-2",children:[l.jsx(Ys,{variant:"outline",size:"icon",onClick:()=>{e&&c(e.id)},title:t(d?"com_ui_unpin":"com_ui_pin"),"aria-label":t(d?"com_ui_unpin":"com_ui_pin"),children:d?l.jsx(Ot,{className:"h-4 w-4"}):l.jsx(Lt,{className:"h-4 w-4"})}),l.jsx(Ys,{variant:"outline",size:"icon",onClick:()=>{const n=`${new URL(window.location.origin).origin}/c/new?agent_id=${e.id}`;navigator.clipboard.writeText(n).then((()=>{a({message:t("com_agents_link_copied")})})).catch((()=>{a({message:t("com_agents_link_copy_failed")})}))},title:t("com_agents_copy_link"),"aria-label":t("com_agents_copy_link"),children:l.jsx(Se,{className:"h-4 w-4","aria-hidden":"true"})}),l.jsx(Ys,{className:"w-full max-w-xs",onClick:()=>{if(e){const a=[Fh.agents,{requiredPermission:Oh.EDIT}],i=n.getQueryData(a);if(null!=i&&!i.data.some((t=>t.id===e.id))){const t=[e,...JSON.parse(JSON.stringify(i.data))];n.setQueryData(a,{...i,data:t})}localStorage.setItem(`${Hm.AGENT_ID_PREFIX}0`,e.id),mf(n,null==r?void 0:r.conversationId),n.invalidateQueries([Fh.messages]);const l={conversationId:Bm.NEW_CONVO,endpoint:Yl.agents,agent_id:e.id,title:t("com_agents_chat_with",{name:e.name||t("com_ui_agent")})},c=s({conversation:{...r??{},...l},preset:l});o({template:c,preset:l})}},disabled:!e,children:t("com_agents_start_chat")})]})]})},xO=({agent:e,onSelect:t,className:n=""})=>{const a=qN(),{categories:s}=XN(),[r,o]=ja(!1),i=Ca((()=>{if(!e.category)return"";const t=s.find((t=>t.value===e.category));return t?t.label&&t.label.startsWith("com_")?a(t.label):t.label:e.category.charAt(0).toUpperCase()+e.category.slice(1)}),[e.category,s,a]),c=(e=>{var t,n;if(!e)return null;const a=null==(t=e.support_contact)?void 0:t.name,s=null==(n=e.support_contact)?void 0:n.email,r=e.authorName;return a||r||s||null})(e);return l.jsxs(rr,{open:r,onOpenChange:n=>{o(n),n&&t&&t(e)},children:[l.jsx(or,{asChild:!0,children:l.jsxs("div",{className:Qf("group relative flex h-32 gap-5 overflow-hidden rounded-xl","cursor-pointer select-none px-6 py-4","bg-surface-tertiary transition-colors duration-150 hover:bg-surface-hover","md:h-36 lg:h-40","[&_*]:cursor-pointer",n),"aria-label":a("com_agents_agent_card_label",{name:e.name,description:e.description??""}),"aria-describedby":e.description?`agent-${e.id}-description`:void 0,tabIndex:0,role:"button",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o(!0))},children:[i&&l.jsx("span",{className:"absolute right-4 top-3 rounded-md bg-surface-hover px-2 py-0.5 text-xs text-text-secondary",children:i}),l.jsx("div",{className:"flex-shrink-0 self-center",children:l.jsx("div",{className:"overflow-hidden rounded-full shadow-[0_0_15px_rgba(0,0,0,0.3)] dark:shadow-[0_0_15px_rgba(0,0,0,0.5)]",children:Dx(e,{size:"sm",showBorder:!1})})}),l.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center overflow-hidden",children:[l.jsx(er,{className:"line-clamp-2 text-base font-semibold text-text-primary md:text-lg",children:e.name}),e.description&&l.jsx("p",{id:`agent-${e.id}-description`,className:"mt-0.5 line-clamp-2 text-sm leading-snug text-text-secondary md:line-clamp-5","aria-label":a("com_agents_description_card",{description:e.description}),children:e.description}),c&&l.jsx("div",{className:"mt-1 text-xs text-text-tertiary",children:l.jsx("span",{className:"truncate",children:a("com_ui_by_author",{0:c||""})})})]})]})}),l.jsx(gO,{agent:e})]})},fO=({category:e,searchQuery:t,onSelectAgent:n,scrollElementRef:a})=>{var s;const r=qN(),{categories:o}=XN(),i=Ca((()=>{const n={requiredPermission:Oh.VIEW,limit:6};return t?(n.search=t,"all"!==e&&"promoted"!==e&&(n.category=e)):"promoted"===e?n.promoted=1:"all"!==e&&(n.category=e),n}),[e,t]),{data:c,isLoading:d,error:u,isFetching:m,fetchNextPage:p,hasNextPage:h,refetch:g,isFetchingNextPage:x}=(f=i,vs({queryKey:[Fh.marketplaceAgents,f],queryFn:({pageParam:e})=>{const t={...f};return e&&(t.cursor=e.toString()),Jh.getMarketplaceAgents(t)},getNextPageParam:e=>(null==e?void 0:e.after)??void 0,enabled:!!f.requiredPermission,keepPreviousData:!0,staleTime:12e4,cacheTime:6e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...v}));var f,v;const _=Ca((()=>(null==c?void 0:c.pages)?c.pages.flatMap((e=>e.data||[])):[]),[null==c?void 0:c.pages]),b=(e=>{if(!e)return!1;if("object"==typeof e&&null!==e){if("agents"in e){const t=e.agents;return Array.isArray(t)&&t.length>0}if("id"in e||"name"in e)return!0}return!!Array.isArray(e)&&e.length>0})(null==(s=null==c?void 0:c.pages)?void 0:s[0]),{setScrollElement:y}=(({hasNextPage:e=!1,isLoading:t=!1,fetchNextPage:n,threshold:a=.8,throttleMs:s=200})=>{const r=ba(null),[o,i]=ja(null),l=ka((()=>{if(!o)return;const{scrollTop:s,scrollHeight:r,clientHeight:i}=o;(s+i)/r>=a&&e&&!t&&n()}),[o,e,t,n,a]),c=Ca((()=>vi.throttle(l,s)),[l,s]);return ya((()=>()=>{var e;null==(e=c.cancel)||e.call(c)}),[c]),ya((()=>{if(!1===t&&o){const e=requestAnimationFrame((()=>{c()}));return()=>cancelAnimationFrame(e)}}),[t,o,c]),ya((()=>{const e=o;if(e)return e.addEventListener("scroll",c,{passive:!0}),r.current&&r.current.disconnect(),r.current=new ResizeObserver((()=>{c()})),r.current.observe(e),c(),()=>{e.removeEventListener("scroll",c),r.current&&(r.current.disconnect(),r.current=null)}}),[o,c]),{setScrollElement:ka((e=>{i(e)}),[])}})({hasNextPage:h,isLoading:m||x,fetchNextPage:()=>{h&&!m&&p()},threshold:.8,throttleMs:200});ya((()=>{const e=null==a?void 0:a.current;e&&y(e)}),[a,y]);const j=e=>{const t=o.find((t=>t.value===e));return t?t.label:"promoted"===e?r("com_agents_top_picks"):"all"===e?"All":e.charAt(0).toUpperCase()+e.slice(1)},w=l.jsx("div",{className:"flex justify-center py-12",children:l.jsx(Xs,{className:"h-8 w-8 text-primary"})});if(u)return l.jsx(hO,{error:u||"Unknown error occurred",onRetry:()=>g(),context:{searchQuery:t,category:e}});const N=l.jsx("div",{className:"space-y-6",role:"tabpanel",id:`category-panel-${e}`,"aria-labelledby":`category-tab-${e}`,"aria-live":"polite","aria-busy":d&&!b,children:_&&0!==_.length||d||m?l.jsxs(l.Fragment,{children:[l.jsx("div",{id:"search-results-count",className:"sr-only","aria-live":"polite","aria-atomic":"true",children:r("com_agents_grid_announcement",{count:(null==_?void 0:_.length)||0,category:j(e)})}),_&&_.length>0&&l.jsx("div",{className:"mx-4 grid grid-cols-1 gap-6 md:grid-cols-2",role:"grid","aria-label":r("com_agents_grid_announcement",{count:_.length,category:j(e)}),children:_.map(((e,t)=>l.jsx("div",{role:"gridcell",children:l.jsx(xO,{agent:e,onSelect:n})},`${e.id}-${t}`)))}),x&&l.jsxs("div",{className:"flex justify-center py-8",role:"status","aria-live":"polite","aria-label":r("com_agents_loading"),children:[l.jsx(Xs,{className:"h-6 w-6 text-primary"}),l.jsx("span",{className:"sr-only",children:r("com_agents_loading")})]}),!h&&_&&_.length>0&&l.jsx("div",{className:"mt-8 text-center",children:l.jsx("p",{className:"text-sm text-text-secondary",children:r("com_agents_no_more_results")})})]}):l.jsx("div",{className:"py-12 text-center text-text-secondary",role:"status","aria-live":"polite","aria-label":r(t?"com_agents_search_empty_heading":"com_agents_empty_state_heading"),children:l.jsx("h3",{className:"mb-2 text-lg font-medium",children:r("com_agents_empty_state_heading")})})});return d||m&&!x?w:N},vO=({className:e=""})=>{const t=qN(),n=E(),{category:a}=W(),s=xs(),[r,o]=Da(),{conversation:i,newConversation:c}=$N(),d=vr("(max-width: 768px)"),{navVisible:u,setNavVisible:m}=ee(),[p,h]=b(N_.hideSidePanel),g=r.get("q")||"",[x,f]=ja(a||"all"),[v,_]=ja(null),[y,j]=ja(!1),[w,N]=ja("right"),k=ba(null);ZS(`${t("com_agents_marketplace")} | LibreChat`),ya((()=>{h(!1),localStorage.setItem("hideSidePanel","false"),localStorage.setItem("fullPanelCollapse","false")}),[h,p]),G_();const C=O_({staleTime:9e5,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1});ya((()=>{if(!a&&"/agents"===window.location.pathname&&C.data&&"all"===x){C.data.some((e=>"promoted"===e.value))&&f("promoted")}}),[a,C.data,x]);const S=e=>{const t=new URLSearchParams(r);t.set("agent_id",e.id),o(t)},T=Ca((()=>{const e=(C.data||[]).map((e=>e.value)),t=new Set(e);return Array.from(t)}),[C.data]),I=ka((e=>{const t=T.indexOf(e);return t>=0?t:0}),[T]);ya((()=>{a&&a!==x&&!y&&f(a)}),[a,x,y]);const R=Ca((()=>{const e=localStorage.getItem("react-resizable-panels:layout");return"string"==typeof e?JSON.parse(e):void 0}),[]),A=Ca((()=>{const e=localStorage.getItem("react-resizable-panels:collapsed");return"string"!=typeof e||JSON.parse(e)}),[]),P=Ca((()=>"true"===localStorage.getItem("fullPanelCollapse")),[]),O=ak({permissionType:Pp.MARKETPLACE,permission:Op.USE});return ya((()=>{let e;return O||(e=setTimeout((()=>{n("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[O,n]),O?l.jsx("div",{className:`relative flex w-full grow overflow-hidden bg-presentation ${e}`,children:l.jsx(Kk,{children:l.jsx(ZP,{defaultLayout:R,fullPanelCollapse:P,defaultCollapsed:A,children:l.jsx("main",{className:"flex h-full flex-col overflow-hidden",role:"main",children:l.jsxs("div",{ref:k,className:"scrollbar-gutter-stable relative flex h-full flex-col overflow-y-auto overflow-x-hidden",children:[!d&&l.jsx("div",{className:"sticky top-0 z-20 flex items-center justify-between bg-surface-secondary p-2 font-semibold text-text-primary md:h-14",children:l.jsx("div",{className:"mx-1 flex items-center gap-2",children:u?l.jsx("div",{className:"h-10 w-10"}):l.jsxs(l.Fragment,{children:[l.jsx(cO,{setNavVisible:m}),l.jsx(pr,{description:t("com_ui_new_chat"),render:l.jsx(Ys,{size:"icon",variant:"outline","data-testid":"agents-new-chat-button","aria-label":t("com_ui_new_chat"),className:"rounded-xl border border-border-light bg-surface-secondary p-2 hover:bg-surface-hover max-md:hidden",onClick:e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(mf(s,null==i?void 0:i.conversationId),s.invalidateQueries([Fh.messages]),c()):window.open("/c/new","_blank")},children:l.jsx(To,{})})})]})})}),!d&&l.jsx("div",{className:"container mx-auto max-w-4xl",children:l.jsxs("div",{className:Qf("mb-8 text-center","mt-12"),children:[l.jsx("h1",{className:"mb-3 text-3xl font-bold tracking-tight text-text-primary md:text-5xl",children:t("com_agents_marketplace")}),l.jsx("p",{className:"mx-auto mb-6 max-w-2xl text-lg text-text-secondary",children:t("com_agents_marketplace_subtitle")})]})}),l.jsx("div",{className:Qf("sticky z-10 bg-presentation pb-4",d?"top-0":"top-14"),children:l.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[l.jsxs("div",{className:"mx-auto flex max-w-2xl gap-2 pb-6",children:[l.jsx(pO,{value:g,onSearch:e=>{const t=new URLSearchParams(r),a=x;e.trim()?t.set("q",e.trim()):t.delete("q"),n("promoted"===a?"/agents"+(t.toString()?`?${t.toString()}`:""):`/agents/${a}${t.toString()?`?${t.toString()}`:""}`)}}),l.jsx(NT,{})]}),l.jsx(mO,{categories:C.data||[],activeTab:x,isLoading:C.isLoading,onChange:e=>{if(e===x||y)return;const t=I(x),a=I(e);N(a>t?"right":"left"),_(e),j(!0);const s=r.toString(),o=s?`?${s}`:"";n("promoted"===e?`/agents${o}`:`/agents/${e}${o}`),window.setTimeout((()=>{f(e),_(null),j(!1)}),300)}})]})}),l.jsx("div",{className:"container mx-auto max-w-4xl px-4 pb-8",children:l.jsxs("div",{className:"relative overflow-hidden",children:[l.jsxs("div",{className:Qf(y&&("right"===w?"motion-safe:animate-slide-out-left":"motion-safe:animate-slide-out-right")),children:[!g&&l.jsx("div",{className:"mb-6 mt-6",children:(()=>{const{name:e,description:n}=(()=>{var e,n,a;if("promoted"===x)return{name:t("com_agents_top_picks"),description:t("com_agents_recommended")};if("all"===x)return{name:t("com_agents_all"),description:t("com_agents_all_description")};const s=null==(e=C.data)?void 0:e.find((e=>e.value===x));return s?{name:(null==(n=s.label)?void 0:n.startsWith("com_"))?t(s.label):s.label,description:(null==(a=s.description)?void 0:a.startsWith("com_"))?t(s.description):s.description||""}:{name:x.charAt(0).toUpperCase()+x.slice(1),description:""}})();return l.jsxs("div",{className:"text-left",children:[l.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:e}),n&&l.jsx("p",{className:"mt-2 text-text-secondary",children:n})]})})()}),l.jsx(fO,{category:x,searchQuery:g,onSelectAgent:S,scrollElementRef:k},`grid-${x}`)]},`pane-current-${x}`),y&&v&&l.jsxs("div",{className:Qf("absolute inset-0","right"===w?"motion-safe:animate-slide-in-right":"motion-safe:animate-slide-in-left"),children:[!g&&l.jsx("div",{className:"mb-6 mt-6",children:(()=>{const{name:e,description:n}=(()=>{var e,n,a;if("promoted"===v)return{name:t("com_agents_top_picks"),description:t("com_agents_recommended")};if("all"===v)return{name:t("com_agents_all"),description:t("com_agents_all_description")};const s=null==(e=C.data)?void 0:e.find((e=>e.value===v));return s?{name:(null==(n=s.label)?void 0:n.startsWith("com_"))?t(s.label):s.label,description:(null==(a=s.description)?void 0:a.startsWith("com_"))?t(s.description):s.description||""}:{name:(v||"").charAt(0).toUpperCase()+(v||"").slice(1),description:""}})();return l.jsxs("div",{className:"text-left",children:[l.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:e}),n&&l.jsx("p",{className:"mt-2 text-text-secondary",children:n})]})})()}),l.jsx(fO,{category:v,searchQuery:g,onSelectAgent:S,scrollElementRef:k},`grid-${v}`)]},`pane-next-${v}-${w}`)]})})]})})})})}):null};function _O(){const e=qN(),[t]=Da(),[n,a]=ja(3),s=t.get("serverName");return ya((()=>{const e=setInterval((()=>{a((t=>t<=1?(clearInterval(e),window.close(),0):t-1))}),1e3);return()=>clearInterval(e)}),[]),l.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:l.jsxs("div",{className:"w-full max-w-md rounded-xl bg-white p-8 text-center shadow-lg",children:[l.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_success_title")||"Authentication Successful"}),l.jsxs("p",{className:"mb-2 text-sm text-gray-600",children:[e("com_ui_oauth_success_description")||"Your authentication was successful. This window will close in"," ",l.jsx("span",{className:"font-medium text-indigo-500",children:n})," ",e("com_ui_seconds")||"seconds","."]}),s&&l.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:[e("com_ui_oauth_connected_to")||"Connected to",":"," ",l.jsx("span",{className:"font-medium",children:s})]})]})})}function bO(){const e=qN(),[t]=Da(),n=t.get("error")||"unknown_error";return l.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 p-8",children:l.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-8 text-center shadow-lg",children:[l.jsx("div",{className:"mb-4 flex justify-center",children:l.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:l.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),l.jsx("h1",{className:"mb-4 text-3xl font-bold text-gray-900",children:e("com_ui_oauth_error_title")||"Authentication Failed"}),l.jsx("p",{className:"mb-6 text-sm text-gray-600",children:(t=>{switch(t){case"missing_code":return e("com_ui_oauth_error_missing_code")||"Authorization code is missing. Please try again.";case"missing_state":return e("com_ui_oauth_error_missing_state")||"State parameter is missing. Please try again.";case"invalid_state":return e("com_ui_oauth_error_invalid_state")||"Invalid state parameter. Please try again.";case"callback_failed":return e("com_ui_oauth_error_callback_failed")||"Authentication callback failed. Please try again.";default:return e("com_ui_oauth_error_generic")||t.replace(/_/g," ")}})(n)}),l.jsx("button",{onClick:()=>window.close(),className:"rounded-md bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2","aria-label":e("com_ui_close_window")||"Close Window",children:e("com_ui_close_window")||"Close Window"})]})})}const yO=e=>e.split("\n").map((e=>e.trim())).filter(Boolean).map(((e,t)=>({number:t+1,content:e}))),jO=async()=>{const e=await(async()=>{if("userAgentData"in navigator)try{const e=navigator.userAgentData,t=await e.getHighEntropyValues(["platform","platformVersion"]);return{os:t.platform,version:t.platformVersion}}catch(t){cx.warn("Failed to get high entropy values"),cx.error(t)}const e=navigator.userAgent.toLowerCase();return e.includes("mac")?{os:"macOS"}:e.includes("win")?{os:"Windows"}:e.includes("linux")?{os:"Linux"}:e.includes("android")?{os:"Android"}:e.includes("ios")||e.includes("iphone")||e.includes("ipad")?{os:"iOS"}:{os:"Unknown"}})();return{userAgent:navigator.userAgent,platform:e.os,platformVersion:e.version,language:navigator.language,windowSize:`${window.innerWidth}x${window.innerHeight}`}};function wO(){const e=qN(),t=Mt(),n={message:t.message??"An unexpected error occurred",stack:t.stack,status:t.status,statusText:t.statusText,data:t.data};return l.jsx("div",{role:"alert",className:"flex min-h-screen flex-col items-center justify-center bg-surface-primary bg-gradient-to-br",children:l.jsxs("div",{className:"bg-surface-primary/60 mx-4 w-11/12 max-w-4xl rounded-2xl border border-border-light p-8 shadow-2xl backdrop-blur-xl",children:[l.jsx("h2",{className:"mb-6 text-center text-3xl font-medium tracking-tight text-text-primary",children:e("com_ui_error_unexpected")}),l.jsxs("div",{className:"mb-4 rounded-xl border border-red-500/20 bg-red-500/5 p-4 text-sm text-gray-600 dark:text-gray-200",children:[l.jsx("h3",{className:"mb-2 font-medium",children:e("com_ui_error_message_prefix")}),l.jsx("pre",{className:"whitespace-pre-wrap text-sm font-light leading-relaxed text-text-primary",children:n.message})]}),("number"==typeof n.status||"string"==typeof n.statusText)&&l.jsxs("div",{className:"mb-4 rounded-xl border border-yellow-500/20 bg-yellow-500/5 p-4 text-sm text-text-primary",children:[l.jsxs("h3",{className:"mb-2 font-medium",children:[e("com_ui_status_prefix"),":"]}),l.jsxs("p",{className:"text-text-primary",children:["number"==typeof n.status&&`${n.status} `,"string"==typeof n.statusText&&n.statusText]})]}),null!=n.stack&&""!==n.stack.trim()&&l.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[l.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[l.jsx("span",{children:e("com_ui_stack_trace")}),l.jsx("div",{className:"flex items-center",children:l.jsx(Ys,{variant:"outline",size:"sm",onClick:async()=>{null!=n.stack&&""!==n.stack&&await navigator.clipboard.writeText(n.stack)},className:"ml-2 px-2 py-1 text-xs","aria-label":e("com_ui_copy_stack_trace"),children:e("com_ui_copy")})})]}),l.jsx("div",{className:"overflow-x-auto rounded-lg bg-black/5 p-4 dark:bg-white/5",children:yO(n.stack).map((({number:e,content:t})=>l.jsxs("div",{className:"flex",children:[l.jsx("span",{className:"select-none pr-4 font-mono text-xs text-text-secondary",children:String(e).padStart(3,"0")}),l.jsx("pre",{className:"flex-1 font-mono text-xs leading-relaxed text-text-primary",children:t})]},e)))})]}),null!=n.data&&l.jsxs("details",{className:"group mb-4 rounded-xl border border-border-light p-4",children:[l.jsxs("summary",{className:"mb-2 flex cursor-pointer items-center justify-between text-sm font-medium text-text-primary",children:[l.jsx("span",{children:e("com_ui_additional_details")}),l.jsx("span",{className:"transition-transform group-open:rotate-90",children:">"})]}),l.jsx("pre",{className:"whitespace-pre-wrap text-xs font-light leading-relaxed text-text-primary",children:JSON.stringify(n.data,null,2)})]}),l.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[l.jsxs("p",{className:"text-sm font-light text-text-secondary",children:[e("com_ui_error_try_following_prefix"),":"]}),l.jsxs("ul",{className:"list-inside list-disc text-sm text-text-secondary",children:[l.jsx("li",{children:e("com_ui_refresh_page")}),l.jsx("li",{children:e("com_ui_clear_browser_cache")}),l.jsx("li",{children:e("com_ui_check_internet")}),l.jsx("li",{children:e("com_ui_contact_admin_if_issue_persists")})]}),l.jsxs("div",{className:"mt-4 flex flex-col items-center gap-4 sm:flex-row sm:justify-center",children:[l.jsx(Ys,{variant:"submit",onClick:()=>window.location.reload(),className:"w-full sm:w-auto","aria-label":e("com_ui_refresh_page"),children:e("com_ui_refresh_page")}),l.jsx(Ys,{variant:"outline",onClick:async()=>{try{const e=await jO(),t={timestamp:(new Date).toISOString(),browser:e,error:{...n,stack:null!=n.stack&&""!==n.stack.trim()?yO(n.stack):void 0}},a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`error-log-${(new Date).toISOString()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}catch(e){cx.warn("Failed to download error logs:"),cx.error(e)}},className:"w-full sm:w-auto","aria-label":e("com_ui_download_error_logs"),children:e("com_ui_download_error_logs")})]})]})]})})}function NO({startupConfig:e}){var t;const n=qN();if(!e)return null;const a={discord:e.discordLoginEnabled&&l.jsx(uT,{enabled:e.discordLoginEnabled,serverDomain:e.serverDomain,oauthPath:"discord",Icon:Oo,label:n("com_auth_discord_login"),id:"discord"},"discord"),facebook:e.facebookLoginEnabled&&l.jsx(uT,{enabled:e.facebookLoginEnabled,serverDomain:e.serverDomain,oauthPath:"facebook",Icon:Po,label:n("com_auth_facebook_login"),id:"facebook"},"facebook"),github:e.githubLoginEnabled&&l.jsx(uT,{enabled:e.githubLoginEnabled,serverDomain:e.serverDomain,oauthPath:"github",Icon:Ao,label:n("com_auth_github_login"),id:"github"},"github"),google:e.googleLoginEnabled&&l.jsx(uT,{enabled:e.googleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"google",Icon:Ro,label:n("com_auth_google_login"),id:"google"},"google"),apple:e.appleLoginEnabled&&l.jsx(uT,{enabled:e.appleLoginEnabled,serverDomain:e.serverDomain,oauthPath:"apple",Icon:Io,label:n("com_auth_apple_login"),id:"apple"},"apple"),openid:e.openidLoginEnabled&&l.jsx(uT,{enabled:e.openidLoginEnabled,serverDomain:e.serverDomain,oauthPath:"openid",Icon:()=>e.openidImageUrl?l.jsx("img",{src:e.openidImageUrl,alt:"OpenID Logo",className:"h-5 w-5"}):l.jsx(Js,{}),label:e.openidLabel,id:"openid"},"openid"),saml:e.samlLoginEnabled&&l.jsx(uT,{enabled:e.samlLoginEnabled,serverDomain:e.serverDomain,oauthPath:"saml",Icon:()=>e.samlImageUrl?l.jsx("img",{src:e.samlImageUrl,alt:"SAML Logo",className:"h-5 w-5"}):l.jsx(Eo,{}),label:e.samlLabel?e.samlLabel:n("com_auth_saml_login"),id:"saml"},"saml")};return e.socialLoginEnabled&&l.jsxs(l.Fragment,{children:[e.emailLoginEnabled&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative mt-6 flex w-full items-center justify-center border border-t border-gray-300 uppercase dark:border-gray-600",children:l.jsx("div",{className:"absolute bg-white px-3 text-xs text-black dark:bg-gray-900 dark:text-white",children:"Or"})}),l.jsx("div",{className:"mt-8"})]}),l.jsx("div",{className:"mt-2",children:null==(t=e.socialLogins)?void 0:t.map((e=>a[e]||null))})]})}const kO=({active:e,children:t})=>e?l.jsxs(l.Fragment,{children:[l.jsx("style",{children:"\n  @keyframes blink-animation {\n    0%,\n    100% {\n      opacity: 1;\n    }\n    50% {\n      opacity: 0;\n    }\n  }"}),l.jsx("div",{style:{animation:"blink-animation 3s infinite"},children:t})]}):l.jsx(l.Fragment,{children:t}),CO=({onHeightChange:e})=>{const{data:t}=(e=>{const t=j(N_.queriesEnabled);return gs([Fh.banner],(()=>Jh.getBanner()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e,enabled:t})})(),[n,a]=b(N_.hideBannerHint),s=ba(null);if(ya((()=>{e&&s.current&&e(s.current.offsetHeight)}),[t,n,e]),!t||t.bannerId&&!t.persistable&&n.includes(t.bannerId))return null;return l.jsxs("div",{ref:s,className:"sticky top-0 z-20 flex items-center bg-surface-secondary px-2 py-1 text-text-primary dark:bg-gradient-to-r md:relative",children:[l.jsx("div",{className:Lo("text-md w-full truncate text-center",!t.persistable&&"px-4"),dangerouslySetInnerHTML:{__html:t.message}}),!t.persistable&&l.jsx(Ys,{size:"icon",variant:"ghost","aria-label":"Dismiss banner",className:"size-8",onClick:()=>{t.persistable||(a([...n,t.bannerId]),e&&e(0))},children:l.jsx(re,{className:"mx-auto h-4 w-4 text-text-primary","aria-hidden":"true"})})]})};function SO({startupConfig:e}){var t,n;const a=qN();if(!e)return null;const s=null==(t=e.interface)?void 0:t.privacyPolicy,r=null==(n=e.interface)?void 0:n.termsOfService,o=(null==s?void 0:s.externalUrl)&&l.jsx("a",{className:"text-sm text-green-600 underline decoration-transparent transition-all duration-200 hover:text-green-700 hover:decoration-green-700 focus:text-green-700 focus:decoration-green-700 dark:text-green-500 dark:hover:text-green-400 dark:hover:decoration-green-400 dark:focus:text-green-400 dark:focus:decoration-green-400",href:s.externalUrl,rel:"noreferrer",children:a("com_ui_privacy_policy")}),i=(null==r?void 0:r.externalUrl)&&l.jsx("a",{className:"text-sm text-green-600 underline decoration-transparent transition-all duration-200 hover:text-green-700 hover:decoration-green-700 focus:text-green-700 focus:decoration-green-700 dark:text-green-500 dark:hover:text-green-400 dark:hover:decoration-green-400 dark:focus:text-green-400 dark:focus:decoration-green-400",href:r.externalUrl,rel:"noreferrer",children:a("com_ui_terms_of_service")});return l.jsxs("div",{className:"align-end m-4 flex justify-center gap-2",role:"contentinfo",children:[o,o&&i&&l.jsx("div",{className:"border-r-[1px] border-gray-300 dark:border-gray-600"}),i]})}function TO({children:e,header:t,isFetching:n,startupConfig:a,startupConfigError:s,pathname:r,error:o}){const i=qN(),c=null!=s,d=()=>c?l.jsx("div",{className:"mx-auto sm:max-w-sm",children:l.jsx(dT,{children:i("com_auth_error_login_server")})}):"com_auth_error_invalid_reset_token"===o?l.jsx("div",{className:"mx-auto sm:max-w-sm",children:l.jsxs(dT,{children:[i("com_auth_error_invalid_reset_token")," ",l.jsx("a",{className:"font-semibold text-green-600 hover:underline",href:"/forgot-password",children:i("com_auth_click_here")})," ",i("com_auth_to_try_again")]})}):null!=o&&o?l.jsx("div",{className:"mx-auto sm:max-w-sm",children:l.jsx(dT,{children:i(o)})}):null;return l.jsxs("div",{className:"relative flex min-h-screen flex-col bg-white dark:bg-gray-900",children:[l.jsx(CO,{}),l.jsx(kO,{active:n,children:l.jsx("div",{className:"mt-6 h-10 w-full bg-cover",children:l.jsx("img",{src:"assets/logo.svg",className:"h-full w-full object-contain",alt:i("com_ui_logo",{0:(null==a?void 0:a.appTitle)??"LibreChat"})})})}),l.jsx(d,{}),l.jsx("div",{className:"absolute bottom-0 left-0 md:m-4",children:l.jsx(Zs,{})}),l.jsx("main",{className:"flex flex-grow items-center justify-center",children:l.jsxs("div",{className:"w-authPageWidth overflow-hidden bg-white px-6 py-4 dark:bg-gray-900 sm:max-w-md sm:rounded-lg",children:[!c&&!n&&t&&l.jsx("h1",{className:"mb-4 text-center text-3xl font-semibold text-black dark:text-white",style:{userSelect:"none"},children:t}),e,!r.includes("2fa")&&(r.includes("login")||r.includes("register"))&&l.jsx(NO,{startupConfig:a})]})}),l.jsx(SO,{startupConfig:a})]})}const EO={"/login":"com_auth_welcome_back","/register":"com_auth_create_account","/forgot-password":"com_auth_reset_password","/reset-password":"com_auth_reset_password","/login/2fa":"com_auth_verify_your_identity"};function IO({isAuthenticated:e}){const[t,n]=ja(null),[a,s]=ja(null),[r,o]=ja(null),{data:i,isFetching:c,error:d}=K_({enabled:!e||null===r}),u=qN(),m=E(),p=T();ya((()=>{e&&m("/c/new",{replace:!0}),i&&o(i)}),[e,m,i]),ya((()=>{document.title=(null==r?void 0:r.appTitle)||"LibreChat"}),[null==r?void 0:r.appTitle]),ya((()=>{n(null),s(null)}),[p.pathname]);const h={error:t,setError:n,headerText:a,setHeaderText:s,startupConfigError:d,startupConfig:r,isFetching:c};return l.jsx(TO,{header:u(a||EO[p.pathname]),isFetching:c,startupConfig:r,startupConfigError:d,pathname:p.pathname,error:t,children:l.jsx(Dt,{context:h})})}function RO(){const{isAuthenticated:e}=nk(),[t,n]=b(N_.queriesEnabled);return ya((()=>{if(t)return;const e=setTimeout((()=>{n(!0)}),500);return()=>{clearTimeout(e)}}),[t,n]),l.jsx(IO,{isAuthenticated:e})}const AO=({name:e,onSave:t})=>{const n=ba(null),a=ba(),[s,r]=ja(!1),[o,i]=ja(e),c=()=>{const e=null==o?void 0:o.trim();t(e||""),r(!1)};return ya((()=>{var e;s&&(null==(e=n.current)||e.focus())}),[s]),ya((()=>{i(e)}),[e]),l.jsx("div",{className:"flex items-center",children:l.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center"},className:"gap-2",children:s?l.jsxs(l.Fragment,{children:[l.jsx(kr,{type:"text",value:o??"",onChange:e=>{i(e.target.value)},onKeyDown:t=>{"Escape"===t.key&&(r(!1),i(e)),"Enter"===t.key&&c()},ref:n,className:"flex w-full max-w-none rounded-lg text-2xl font-bold transition duration-200",style:{whiteSpace:"nowrap",textOverflow:"ellipsis"}}),l.jsx(Ys,{onClick:()=>{c(),clearTimeout(a.current)},variant:"ghost",size:"sm",className:"h-10 flex-shrink-0","aria-label":"Save prompt name",children:l.jsx(Mo,{className:"icon-md"})})]}):l.jsxs(l.Fragment,{children:[l.jsx(er,{className:"text-2xl font-bold",style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:o}),l.jsx(Ys,{onClick:()=>{r(!0)},variant:"ghost",size:"sm","aria-label":"Edit prompt name",className:"h-10 flex-shrink-0",children:l.jsx(Zr,{className:"icon-md"})})]})})})},{promptsEditorMode:PO,alwaysMakeProd:OO}=N_,LO=()=>{const e=qN(),[t,n]=b(PO),a=y(OO);return l.jsx("div",{className:"relative flex h-10 items-center justify-center rounded-xl border border-border-light bg-surface-primary transition-all duration-300",children:l.jsxs("div",{className:"relative flex w-48 items-stretch md:w-64",children:[l.jsx("div",{className:"absolute rounded-lg bg-surface-hover shadow-lg transition-all duration-300 ease-in-out",style:{top:"1px",left:t===ex.SIMPLE?"2px":"calc(50% + 2px)",width:"calc(50% - 4px)",height:"calc(100% - 2px)"}}),l.jsx("button",{type:"button",onClick:()=>{a(!0),n(ex.SIMPLE)},"aria-pressed":t===ex.SIMPLE,"aria-label":e("com_ui_simple"),className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm transition-all duration-300 md:px-6 "+(t===ex.SIMPLE?"font-bold text-text-primary":"text-text-secondary hover:text-text-primary"),children:l.jsx("span",{className:"relative",children:e("com_ui_simple")})}),l.jsx("button",{type:"button",onClick:()=>n(ex.ADVANCED),"aria-pressed":t===ex.ADVANCED,"aria-label":e("com_ui_advanced"),className:"relative z-10 flex-1 rounded-xl px-3 py-2 text-sm transition-all duration-300 md:px-6 "+(t===ex.ADVANCED?"font-bold text-text-primary":"text-text-secondary hover:text-text-primary"),children:l.jsx("span",{className:"relative",children:e("com_ui_advanced")})})]})})},MO=({control:e,promptPerm:t,label:n,confirmChange:a})=>l.jsxs("div",{className:"mb-4 flex items-center justify-between gap-2",children:[n,l.jsx(Li,{name:t,control:e,render:({field:e})=>l.jsx(dr,{...e,checked:e.value,onCheckedChange:t=>{!1===t&&a?a(t,e.onChange):e.onChange(t)},value:e.value.toString(),"aria-label":n})})]}),DO=()=>{const e=qN(),{user:t,roles:n}=nk(),{showToast:a}=Ds(),[s,r]=ja(null),{mutate:o,isLoading:i}=(e=>{const t=xs(),{onMutate:n,onSuccess:a,onError:s}=e??{};return fs((e=>(xh.partial().parse(e.updates),Jh.updatePromptPermissions(e))),{onSuccess:(e,n,s)=>{t.invalidateQueries([Fh.roles,n.roleName]),a&&a(e,n,s)},onError:(...e)=>{const t=e[0];null!=t&&console.error("Failed to update prompt permissions:",t),s&&s(...e)},onMutate:n})})({onSuccess:()=>{a({status:"success",message:e("com_ui_saved")})},onError:()=>{a({status:"error",message:e("com_ui_error_save_admin_settings")})}}),[c,d]=ja(!1),[u,m]=ja(gh.USER),p=Ca((()=>{var e,t;return(null==(e=null==n?void 0:n[u])?void 0:e.permissions)?null==(t=n[u])?void 0:t.permissions[Pp.PROMPTS]:Dh[u].permissions[Pp.PROMPTS]}),[n,u]),{reset:h,control:g,setValue:x,getValues:f,handleSubmit:v,formState:{isSubmitting:_}}=Oi({mode:"onChange",defaultValues:p});if(ya((()=>{var e,t;h(null==(t=null==(e=null==n?void 0:n[u])?void 0:e.permissions)?void 0:t[Pp.PROMPTS])}),[n,u,h]),(null==t?void 0:t.role)!==gh.ADMIN)return null;const b=[{promptPerm:Op.SHARED_GLOBAL,label:e("com_ui_prompts_allow_share")},{promptPerm:Op.CREATE,label:e("com_ui_prompts_allow_create")},{promptPerm:Op.USE,label:e("com_ui_prompts_allow_use")}],y=[{label:gh.USER,onClick:()=>{m(gh.USER)}},{label:gh.ADMIN,onClick:()=>{m(gh.ADMIN)}}];return l.jsxs(l.Fragment,{children:[l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{size:"sm",variant:"outline",className:"mr-2 h-10 w-fit gap-1 border transition-all dark:bg-transparent dark:hover:bg-surface-tertiary sm:m-0",children:[l.jsx(ae,{className:"cursor-pointer","aria-hidden":"true"}),l.jsx("span",{className:"hidden sm:flex",children:e("com_ui_admin")})]})}),l.jsxs(ir,{className:"max-w-lg border-border-light bg-surface-primary text-text-primary lg:w-1/4",children:[l.jsx(lr,{children:e("com_ui_admin_settings_section",{section:e("com_ui_prompts")})}),l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"font-medium",children:[e("com_ui_role_select"),":"]}),l.jsx(cr,{unmountOnHide:!0,menuId:"prompt-role-dropdown",isOpen:c,setIsOpen:d,trigger:l.jsx(se,{className:"inline-flex w-1/5 items-center justify-center rounded-lg border border-border-light bg-transparent px-2 py-1 text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",children:u}),items:y,itemClassName:"items-center justify-center",sameWidth:!0})]}),l.jsxs("form",{onSubmit:v((e=>{o({roleName:u,updates:e})})),children:[l.jsx("div",{className:"py-5",children:b.map((({promptPerm:t,label:n})=>l.jsxs("div",{children:[l.jsx(MO,{control:g,promptPerm:t,label:n,getValues:f,setValue:x,...u===gh.ADMIN&&t===Op.USE?{confirmChange:(e,t)=>r({newValue:e,callback:t})}:{}}),u===gh.ADMIN&&t===Op.USE&&l.jsx(l.Fragment,{children:l.jsxs("div",{className:"mb-2 max-w-full whitespace-normal break-words text-sm text-red-600",children:[l.jsx("span",{children:e("com_ui_admin_access_warning")}),"\n",l.jsxs("a",{href:"https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/interface",target:"_blank",rel:"noreferrer",className:"inline-flex items-center text-blue-500 underline",children:[e("com_ui_more_info"),l.jsx(we,{size:16,className:"ml-1","aria-hidden":"true"})]})]})})]},t)))}),l.jsx("div",{className:"flex justify-end",children:l.jsx(Ys,{type:"submit",disabled:_||i,variant:"submit","aria-label":e("com_ui_save"),children:e("com_ui_save")})})]})]})]})]}),l.jsx(rr,{open:null!==s,onOpenChange:e=>{e||r(null)},children:l.jsx(hr,{showCloseButton:!0,title:e("com_ui_confirm_change"),className:"w-11/12 max-w-lg",main:l.jsx("p",{className:"mb-4",children:e("com_ui_confirm_admin_use_change")}),selection:{selectHandler:()=>{s&&s.callback(s.newValue),r(null)},selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover text-white transition-colors duration-200",selectText:e("com_ui_confirm_action"),isLoading:!1}})})]})},FO=/prompts\/(?!new(?:\/|$)).*$/,UO=e=>{if(!e||e.includes("/d/"))return"new";const t=e.split("/");return t[t.length-1]};function zO({showToggle:e=!1,onToggle:t,openPanelRef:n}){const a=T(),s=qN(),{user:r}=nk(),{prevLocationPath:o}=Tk(),i=Ca((()=>UO(o)),[o]),c=y(N_.promptsName),d=y(N_.promptsCategory),u=LC("/c/"+i,ka((()=>{c(""),d("")}),[c,d])),m=LC("/d/prompts"),p=Ca((()=>FO.test(a.pathname)),[a.pathname]);return l.jsxs("div",{className:"mr-2 mt-2 flex h-10 items-center justify-between",children:[l.jsx(Do,{className:"mt-1 px-2 dark:text-gray-200",children:l.jsxs(Fo,{children:[e&&t&&l.jsxs(l.Fragment,{children:[l.jsx(Uo,{children:l.jsx("button",{ref:n,type:"button",onClick:t,className:"flex h-8 w-8 items-center justify-center rounded-lg border border-border-medium bg-surface-primary text-text-primary transition-all hover:bg-surface-hover","aria-label":s("com_nav_open_sidebar"),"aria-expanded":!1,"aria-controls":"prompts-panel",children:l.jsx(bo,{className:"h-4 w-4"})})}),l.jsx(zo,{})]}),l.jsx(Uo,{className:"hover:dark:text-white",children:l.jsxs(Vo,{href:"/",className:"flex flex-row items-center gap-1",onClick:u,children:[l.jsx(Ft,{className:"icon-xs","aria-hidden":"true"}),l.jsx("span",{className:"hidden md:flex",children:s("com_ui_back_to_chat")}),l.jsx("span",{className:"flex md:hidden",children:s("com_ui_chat")})]})}),l.jsx(zo,{}),l.jsx(Uo,{className:"hover:dark:text-white",children:l.jsxs(Vo,{href:"/d/prompts",className:"flex flex-row items-center gap-1",onClick:m,children:[l.jsx(Et,{className:"h-4 w-4 dark:text-gray-300","aria-hidden":"true"}),s("com_ui_prompts")]})})]})}),l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p&&l.jsx(LO,{}),(null==r?void 0:r.role)===gh.ADMIN&&l.jsx(DO,{})]})]})}function VO(){const e=W(),t=E(),n=Ca((()=>!(!e.promptId&&"new"!==e["*"])),[e]),a=vr("(max-width: 768px)"),[s,r]=ja(!a),o=ba(null),i=ba(null),c=qN(),d=ak({permissionType:Pp.PROMPTS,permission:Op.USE});ya((()=>{let e;return d||(e=setTimeout((()=>{t("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[d,t]);const u=ka((()=>{r((e=>{const t=!e;return requestAnimationFrame((()=>{var e,n;t?null==(e=null==i?void 0:i.current)||e.focus():null==(n=null==o?void 0:o.current)||n.focus()})),t}))}),[]);return ya((()=>{a&&n&&r(!1)}),[a,n]),d?l.jsx(nC,{children:l.jsxs("div",{className:"flex h-screen w-full flex-col bg-surface-primary p-0 lg:p-2",children:[l.jsx(zO,{showToggle:a&&n,onToggle:u,openPanelRef:o}),l.jsxs("div",{className:"flex w-full flex-grow flex-row overflow-hidden",children:[a&&s&&n&&l.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 transition-opacity",onClick:u,role:"button",tabIndex:0,"aria-label":c("com_nav_toggle_sidebar")}),(!a||!n||s)&&l.jsx("div",{className:Qf("transition-transform duration-300 ease-in-out",a&&n?"fixed left-0 top-0 z-50 h-full w-[320px] bg-surface-primary":"flex"),children:l.jsx(AP,{closePanelRef:i,onClose:a&&n?u:void 0,children:l.jsx("div",{className:"mt-1 flex flex-row items-center justify-between px-2 md:px-2",children:l.jsx(OP,{})})})}),l.jsx("div",{className:Qf("scrollbar-gutter-stable w-full overflow-y-auto lg:w-3/4 xl:w-3/4",n?"block":"hidden md:block"),children:l.jsx(Dt,{})})]})]})}):null}function $O({onCheckedChange:e,className:t=""}){const[n,a]=b(N_.alwaysMakeProd),s=qN();return l.jsxs("div",{className:Qf("flex select-none items-center justify-end gap-2 text-xs",t),children:[l.jsx(dr,{id:"alwaysMakeProd",checked:n,onCheckedChange:t=>{a(t),e&&e(t)},"data-testid":"alwaysMakeProd","aria-label":s("com_nav_always_make_prod")}),l.jsxs("div",{children:[s("com_nav_always_make_prod")," "]})]})}const BO=Object.keys(Jm).map((e=>({label:`com_ui_special_var_${e}`,value:`{{${e}}}`})));function HO({fieldName:e="prompt",className:t=""}){const n=Ea(),a=qN(),s=Pi(),{setValue:r,getValues:o}=s,[i,c]=ja(!1);return l.jsx("div",{className:t,title:a("com_ui_add_special_variables"),children:l.jsx(cr,{portal:!0,mountByState:!0,unmountOnHide:!0,preserveTabOrder:!0,isOpen:i,setIsOpen:c,trigger:l.jsxs(se,{id:"variables-menu-button","aria-label":a("com_ui_add_special_variables"),className:"flex h-8 items-center gap-1 rounded-md border border-border-medium bg-surface-secondary px-2 py-0 text-sm text-text-primary transition-colors duration-200 hover:bg-surface-tertiary",children:[l.jsx(Le,{className:"mr-1 h-3 w-3 text-text-secondary","aria-hidden":!0}),a("com_ui_special_variables")]}),items:BO.map((t=>({label:a(t.label)||t.label,onClick:()=>((t,n)=>{const s=o(e)||"",i=s.length>0?"\n\n":"",l=a(t);r(e,s+i+l+": "+n),c(!1)})(t.label,t.value)}))),menuId:n,className:"z-30"})})}const{promptsEditorMode:GO}=N_,KO=Sa((({name:e,isEditing:t,setIsEditing:n})=>{const a=qN(),{control:s}=Pi(),r=j(GO),{dirtyFields:o}=Ui({control:s}),{prompt:i}=o,c=Ca((()=>t&&null==(null==i?void 0:i.length)?$o:t?Mo:jt),[t,i]),d=[[tl],[Ji,{detect:!0,ignoreMissing:!0,subset:hf}]];return l.jsxs("div",{className:"flex max-h-[85vh] flex-col sm:max-h-[85vh]",children:[l.jsx("h2",{className:"sr-only",children:a("com_ui_control_bar")}),l.jsxs("div",{className:"flex items-center justify-between rounded-t-xl border border-border-light py-1.5 pl-3 text-sm font-semibold text-text-primary sm:py-2 sm:pl-4 sm:text-base",children:[l.jsx("span",{className:"max-w-[200px] truncate sm:max-w-none",children:a("com_ui_prompt_text")}),l.jsxs("div",{className:"flex flex-shrink-0 flex-row items-center gap-3 sm:gap-6",children:[r===ex.ADVANCED&&l.jsx($O,{className:"hidden sm:flex"}),l.jsx(HO,{fieldName:e}),l.jsx("button",{type:"button",onClick:()=>n((e=>!e)),"aria-label":a(t?"com_ui_save":"com_ui_edit"),className:"mr-1 rounded-lg p-1.5 sm:mr-2 sm:p-1",children:l.jsx(c,{className:Qf("h-5 w-5 sm:h-6 sm:w-6",t?"p-[0.05rem]":"text-secondary-alt hover:text-text-primary")})})]})]}),l.jsxs("div",{role:"button",className:Qf("w-full flex-1 overflow-auto rounded-b-xl border border-border-light p-2 shadow-md transition-all duration-150 sm:p-4",{"cursor-pointer bg-surface-primary hover:bg-surface-secondary active:bg-surface-tertiary":!t}),onClick:()=>!t&&n(!0),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!t&&n(!0)},tabIndex:0,children:[!t&&l.jsx(jt,{className:"icon-xl absolute inset-0 m-auto hidden h-6 w-6 text-text-primary opacity-25 group-hover:block sm:h-8 sm:w-8"}),l.jsx(Li,{name:e,control:s,render:({field:e})=>t?l.jsx(Br,{...e,autoFocus:!0,className:"w-full resize-none overflow-y-auto rounded bg-transparent text-sm text-text-primary focus:outline-none sm:text-base",minRows:3,maxRows:14,onBlur:()=>n(!1),onKeyDown:e=>{"Escape"===e.key&&(e.preventDefault(),n(!1))},"aria-label":a("com_ui_prompt_input")}):l.jsx("div",{className:Qf("overflow-y-auto text-sm sm:text-base"),style:{minHeight:"4.5em",maxHeight:"21em",overflow:"auto"},children:l.jsx(Xi,{remarkPlugins:[Zi,el,[nl,{singleDollarTextMath:!1}]],rehypePlugins:d,components:{p:vP,code:pP},className:"markdown prose dark:prose-invert light my-1 w-full break-words text-text-primary",children:e.value})})})]})]})})),WO=({currentCategory:e,onValueChange:t,className:n=""})=>{const{t:a}=Ri(),s=Pi(),[r,o]=ja(!1),{hasAccess:i}=aC(),{categories:c,emptyCategory:d}=ES({hasAccess:i}),u=null==s?void 0:s.control,m=null==s?void 0:s.watch,p=null==s?void 0:s.setValue,h=m?m("category"):e,g=Ca((()=>(c??[]).find((t=>t.value===(h??e)))??d),[h,c,e,d]),x=Ca((()=>g.value||"icon"in g?g:{...g,icon:l.jsx("span",{className:"i-heroicons-tag"}),label:g.label||a("com_ui_empty_category")}),[g,a]),f=Ca((()=>c?c.map((e=>({id:e.value,label:e.label,icon:"icon"in e?e.icon:void 0,onClick:()=>{const n=e.value||"";s&&p&&p("category",n,{shouldDirty:!1}),localStorage.setItem(Hm.LAST_PROMPT_CATEGORY,n),null==t||t(n),o(!1)}}))):[]),[c,s,p,t]),v=l.jsxs(se,{className:Qf("focus:ring-offset-ring-offset relative inline-flex items-center justify-between rounded-xl border border-input bg-background px-3 py-2 text-sm text-text-primary transition-all duration-200 ease-in-out hover:bg-accent hover:text-accent-foreground focus:ring-ring-primary","w-fit gap-2",n),onClick:()=>o(!r),"aria-label":"Prompt's category selector","aria-labelledby":"category-selector-label",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:["icon"in x&&null!=x.icon&&l.jsx("span",{children:x.icon}),l.jsx("span",{children:x.value?x.label:a("com_ui_category")})]}),l.jsx(Ut,{})]});return s?l.jsx(Li,{name:"category",control:u,render:()=>l.jsx(cr,{trigger:v,items:f,isOpen:r,setIsOpen:o,menuId:"category-selector-menu",className:"mt-2",portal:!0})}):l.jsx(cr,{trigger:v,items:f,isOpen:r,setIsOpen:o,menuId:"category-selector-menu",className:"mt-2",portal:!0})};function qO(){const e=E(),t=qN();return l.jsx("div",{className:"relative min-h-full w-full px-4",children:l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsxs("div",{className:"text-center font-bold dark:text-gray-200",children:[l.jsx("h1",{className:"text-lg font-bold dark:text-gray-200 md:text-2xl",children:t("com_ui_prompt_preview_not_shared")}),l.jsx(Ys,{className:"mt-4",onClick:()=>{e("/d/prompts")},"aria-label":t("com_ui_back_to_prompts"),children:t("com_ui_back_to_prompts")})]})})})}const QO=({description:e})=>l.jsx(pr,{description:e,"aria-label":e,render:l.jsx("div",{className:"flex items-center justify-center",children:l.jsx($t,{className:"h-4 w-4 text-amber-500"})})}),YO=({tags:e})=>{const t=qN();return e.includes("latest")&&e.includes("production")?l.jsx("span",{className:"absolute bottom-3 right-3",children:l.jsx(QO,{description:t("com_ui_latest_production_version")})}):l.jsx("span",{className:"flex gap-1 text-sm",children:e.map(((e,n)=>l.jsx(pr,{description:t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),"aria-label":t("production"===e?"com_ui_currently_production":"com_ui_latest_version"),render:l.jsx(Kr,{label:e,className:Qf("w-24 justify-center border border-transparent","production"===e?"bg-green-100 text-green-700 dark:border-green-400 dark:bg-transparent dark:text-green-400":"bg-blue-100 text-blue-700 dark:border-blue-400 dark:bg-transparent dark:text-blue-400"),labelClassName:"flex items-center m-0 justify-center gap-1",LabelNode:"production"===e?l.jsx("div",{className:"flex items-center",children:l.jsx("span",{className:"slow-pulse size-2 rounded-full bg-green-400"})}):"latest"===e?l.jsx("div",{className:"flex items-center",children:l.jsx(Vt,{className:"size-4"})}):null})},`${e}-${n}`)))})},XO=({prompt:e,index:t,isSelected:n,totalVersions:a,onClick:s,authorName:r,tags:o})=>{const i=qN();return l.jsx("button",{type:"button",className:Qf("group relative w-full rounded-lg border border-border-light p-4 transition-all duration-300",n?"bg-surface-secondary shadow-xl ring-2 ring-gray-400":"bg-surface-primary shadow-sm hover:bg-surface-secondary"),onClick:s,"aria-selected":n,role:"tab","aria-label":i("com_ui_version_var",{0:""+(a-t)}),children:l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs("div",{className:"flex items-start justify-between lg:flex-col xl:flex-row",children:[l.jsx("h3",{className:"font-bold text-text-primary",children:i("com_ui_version_var",{0:""+(a-t)})}),l.jsx("time",{className:"text-xs text-text-secondary",dateTime:e.createdAt,children:Ti(new Date(e.createdAt),"yyyy-MM-dd HH:mm")})]}),l.jsxs("div",{className:"flex items-center gap-1 lg:flex-col xl:flex-row",children:[r&&l.jsx(er,{className:"text-left text-xs text-text-secondary",children:i("com_ui_by_author",{0:r})}),o.length>0&&l.jsx(YO,{tags:o})]})]})})},JO=({prompts:e,group:t,selectionIndex:n,setSelectionIndex:a})=>{const s=qN();return l.jsxs("section",{className:"my-6","aria-label":"Prompt Versions",children:[l.jsx("header",{className:"mb-6",children:l.jsxs("h2",{className:"flex items-center gap-2 text-base font-semibold text-text-primary",children:[l.jsx(zt,{className:"h-5 w-5 text-green-500"}),s("com_ui_versions")]})}),l.jsx("div",{className:"flex flex-col gap-3",role:"tablist","aria-label":"Version history",children:e.map(((s,r)=>{const o=[];return 0===r&&o.push("latest"),s._id===(null==t?void 0:t.productionId)&&o.push("production"),l.jsx(XO,{prompt:s,index:r,isSelected:r===n,totalVersions:e.length,onClick:()=>a(r),authorName:null==t?void 0:t.authorName,tags:o},s._id)}))})]})},ZO=({name:e,disabled:t,selectHandler:n})=>{const a=qN();return l.jsxs(rr,{children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{variant:"destructive",size:"sm","aria-label":"Delete version",className:"h-10 w-10 p-0.5",disabled:t,onClick:e=>{e.stopPropagation()},children:l.jsx(Te,{className:"size-5 cursor-pointer text-white","aria-hidden":"true"})})}),l.jsx(hr,{showCloseButton:!1,title:a("com_ui_delete_prompt"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(er,{htmlFor:"dialog-delete-confirm-prompt",className:"text-left text-sm font-medium",children:a("com_ui_delete_confirm_prompt_version_var",{0:e})})})})}),selection:{selectHandler:n,selectClasses:"bg-surface-destructive hover:bg-surface-destructive-hover transition-colors duration-200 text-white",selectText:a("com_ui_delete")}})]})},eL=_a.memo((({promptId:e,groupId:t,promptName:n,disabled:a})=>{const s=(e=>{const t=xs(),{onSuccess:n,...a}={},s=j(N_.promptsName),r=j(N_.promptsPageSize),o=j(N_.promptsCategory);return fs({mutationFn:e=>Jh.deletePrompt(e),...a,onSuccess:(e,a,i)=>{if(e.promptGroup){const n=e.promptGroup.id;t.setQueryData([Fh.promptGroups,s,o,r],(e=>e?Df(e,n):e)),Vf(t,n)}else t.setQueryData([Fh.prompts,a.groupId],(e=>{const n=e?e.filter((e=>e._id!==a._id)):[];return t.setQueryData([Fh.promptGroup,a.groupId],(e=>{if(!e)return e;e.productionId===a._id&&(e.productionId=n[0]._id,e.productionPrompt=n[0])})),n}));n&&n(e,a,i)}})})(),r=ka((()=>{e?s.mutate({_id:e,groupId:t}):console.warn("No prompt ID provided for deletion")}),[e,t,s]);return e?l.jsx(ZO,{name:n,disabled:a||!e,selectHandler:r}):null}));function tL(){return l.jsxs("div",{children:[l.jsx("div",{className:"flex flex-col items-center justify-between px-4 dark:text-gray-200 sm:flex-row",children:l.jsx(Ms,{className:"mb-1 flex h-10 w-32 flex-row items-center font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"})}),l.jsx("div",{className:"flex h-full w-full flex-col md:flex-row",children:l.jsx("div",{className:"flex-1 overflow-y-auto border-border-medium-alt p-4 md:max-h-[calc(100vh-150px)] md:border-r",children:l.jsx(Ms,{className:"h-96"})})})]})}eL.displayName="DeletePrompt";const nL=_a.memo((({group:e,disabled:t})=>{const{user:n}=nk(),a=ak({permissionType:Pp.PROMPTS,permission:Op.SHARED_GLOBAL}),s=(null==e?void 0:e._id)||"",{hasPermission:r,isLoading:o}=eT(Ph.PROMPTGROUP,s);if(!e||!s)return null;const i=r(Oh.SHARE);return(e.author===(null==n?void 0:n.id)||(null==n?void 0:n.role)===gh.ADMIN||i)&&a&&!o?l.jsx(JT,{resourceDbId:s,resourceName:e.name,resourceType:Ph.PROMPTGROUP,disabled:t,children:l.jsx(Ys,{variant:"default",size:"sm","aria-label":"Share prompt",className:"h-10 w-10 border border-transparent bg-blue-500/90 p-0.5 transition-all hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-800",disabled:t,children:l.jsx(Ne,{className:"size-5 cursor-pointer text-white","aria-hidden":"true"})})}):null}));nL.displayName="SharePrompt";const aL=_a.memo((({group:e,prompts:t,selectedPrompt:n,selectedPromptId:a,isLoadingPrompts:s,canEdit:r,selectionIndex:o,setSelectionIndex:i})=>{const c=qN(),{showToast:d}=Ds(),u=j(N_.promptsEditorMode),m=ak({permissionType:Pp.PROMPTS,permission:Op.SHARED_GLOBAL}),p=Fb({onError:()=>{d({status:"error",message:c("com_ui_prompt_update_error")})}}),h=zb(),g=(null==e?void 0:e._id)||"",x=(null==e?void 0:e.name)||"",f=(null==e?void 0:e.category)||"",v=!e;return l.jsxs("div",{className:"h-full w-full overflow-y-auto bg-surface-primary px-4",style:{maxHeight:"calc(100vh - 100px)"},children:[l.jsxs("div",{className:"mb-2 flex flex-col lg:flex-row lg:items-center lg:justify-center lg:gap-x-2 xl:flex-row xl:space-y-0",children:[l.jsx(WO,{currentCategory:f,onValueChange:r?e=>p.mutate({id:g,payload:{name:x,category:e}}):void 0}),l.jsxs("div",{className:"mt-2 flex flex-row items-center justify-center gap-x-2 lg:mt-0",children:[m&&l.jsx(nL,{group:e,disabled:v}),u===ex.ADVANCED&&r&&l.jsx(Ys,{variant:"submit",size:"sm","aria-label":"Make prompt production",className:"h-10 w-10 border border-transparent p-0.5 transition-all",onClick:()=>{if(!n)return void console.warn("No prompt is selected");const{_id:e="",prompt:t}=n;h.mutate({id:e,groupId:g,productionPrompt:{prompt:t}})},disabled:v||!n||n._id===(null==e?void 0:e.productionId)||h.isLoading||!r,children:l.jsx(Bt,{className:"size-5 cursor-pointer text-white","aria-hidden":"true"})}),l.jsx(eL,{promptId:a,groupId:g,promptName:x,disabled:v})]})]}),u===ex.ADVANCED&&(s?Array.from({length:6}).map(((e,t)=>l.jsx("div",{className:"my-2",children:l.jsx(Ms,{className:"h-[72px] w-full"})},t))):t.length>0&&l.jsx(JO,{group:e,prompts:t,selectionIndex:o,setSelectionIndex:i}))]})}));aL.displayName="RightPanel";const sL=()=>{const e=W(),t=qN(),{showToast:n}=Ds(),{hasAccess:a}=aC(),s=j(N_.alwaysMakeProd),r=e.promptId||"",o=j(N_.promptsEditorMode),[i,c]=ja(0),d=ba(!1),[u,m]=ja(!1),[p,h]=ja(!0),[g,x]=ja(!1),f="320px",{data:v,isLoading:_}=(b=r,y={enabled:a&&!!r},gs([Fh.promptGroup,b],(()=>Jh.getPromptGroup(b)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...y,enabled:void 0===(null==y?void 0:y.enabled)||y.enabled}));var b,y;const{data:w=[],isLoading:N}=((e,t)=>gs([Fh.prompts,e.groupId??""],(()=>Jh.getPrompts(e)),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1,...t,enabled:void 0===(null==t?void 0:t.enabled)||t.enabled}))({groupId:r},{enabled:a&&!!r}),{hasPermission:k,isLoading:C}=eT(Ph.PROMPTGROUP,(null==v?void 0:v._id)||""),S=k(Oh.EDIT),T=k(Oh.VIEW),E=Oi({defaultValues:{prompt:"",promptName:v?v.name:"",category:v?v.category:""}}),{handleSubmit:I,setValue:R,reset:A,watch:P}=E,O=P("prompt"),L=Ca((()=>w.length>0?w[i]:void 0),[w,i]),M=Ca((()=>null==L?void 0:L._id),[null==L?void 0:L._id]),{groupsQuery:D}=aC(),F=Fb({onError:()=>{n({status:"error",message:t("com_ui_prompt_update_error")})}}),U=zb(),z=(e=>{const t=xs(),{onSuccess:n,...a}=e||{};return fs({mutationFn:({groupId:e,...t})=>Jh.addPromptToGroup(e,t),...a,onSuccess:(e,a,s)=>{const{prompt:r}=e;t.setQueryData([Fh.prompts,a.prompt.groupId],(e=>[r,...e??[]])),n&&n(e,a,s)}})})({onMutate:e=>{A({prompt:e.prompt.prompt,category:(null==v?void 0:v.category)||""},{keepDirtyValues:!0})},onSuccess(e){s&&null!=e.prompt._id&&e.prompt._id&&e.prompt.groupId&&U.mutate({id:e.prompt._id,groupId:e.prompt.groupId,productionPrompt:{prompt:e.prompt.prompt}}),A({prompt:e.prompt.prompt,promptName:(null==v?void 0:v.name)||"",category:(null==v?void 0:v.category)||""})}}),V=ka((e=>{if(!S)return;if(!e)return;if(!L)return;const t=L.groupId||(null==v?void 0:v._id);if(!t)return void console.error("No groupId available");const n={prompt:{type:L.type??"text",groupId:t,prompt:e}};e!==L.prompt&&z.mutate({...n,groupId:t})}),[L,v,z,S]),$=ka((()=>{_||N||h(!1)}),[_,N]);ya((()=>{d.current&&!u&&S&&I((e=>V(e.prompt)))(),d.current=u}),[u,V,I,S]),ya((()=>{$()}),[e.promptId,o,null==v?void 0:v.productionId,w,$]),ya((()=>{R("prompt",L?L.prompt:"",{shouldDirty:!1}),R("category",v?v.category:"",{shouldDirty:!1})}),[L,v,R]),ya((()=>{const e=()=>{window.matchMedia("(min-width: 1022px)").matches&&x(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]);const B=Ca((()=>xi(((e,t,n)=>{n({id:e,payload:{oneliner:t}})}),950)),[]),H=Ca((()=>xi(((e,t,n)=>{n({id:e,payload:{command:t}})}),950)),[]),G=ka((e=>{if(!v||!v._id)return console.warn("Group not found");B(v._id,e,F.mutate)}),[v,F.mutate,B]),K=ka((e=>{if(!v||!v._id)return console.warn("Group not found");H(v._id,e,F.mutate)}),[v,F.mutate,H]);if(p)return l.jsx(tL,{});if(!S&&!C&&D.data){const t=Uf(D.data,(t=>t._id===e.promptId));if(!t&&!T)return l.jsx(qO,{});if(t||v)return l.jsx(CP,{group:t||v})}if(!v||null==v._id)return null;const q=v.name;return l.jsx(Mi,{...E,children:l.jsxs("form",{className:"mt-4 flex w-full",onSubmit:I((e=>V(e.prompt))),children:[l.jsx("h1",{className:"sr-only",children:t("com_ui_edit_prompt_page")}),l.jsxs("div",{className:"relative w-full",children:[l.jsx("div",{className:"h-full w-full",style:{transform:`translateX(${g?`-${f}`:"0"})`,transition:"transform 0.3s ease-in-out"},children:l.jsxs("div",{className:"flex h-full",children:[l.jsxs("div",{className:"flex-1 overflow-hidden px-4",children:[l.jsx("div",{className:"mb-4 flex items-center gap-2 text-text-primary",children:_?l.jsx(Ms,{className:"mb-1 flex h-10 w-32 font-bold sm:text-xl md:mb-0 md:h-12 md:text-2xl"}):l.jsxs(l.Fragment,{children:[l.jsx(AO,{name:q,onSave:e=>{S&&v._id&&F.mutate({id:v._id,payload:{name:e}})}}),l.jsx("div",{className:"flex-1"}),l.jsx(Ys,{type:"button",variant:"ghost",className:"h-10 w-10 border border-border-light p-0 lg:hidden",onClick:()=>x(!0),"aria-label":t("com_endpoint_open_menu"),children:l.jsx(bt,{className:"size-5","aria-hidden":"true"})}),l.jsx("div",{className:"hidden lg:block",children:o===ex.SIMPLE&&l.jsx(aL,{group:v,prompts:w,selectedPrompt:L,selectionIndex:i,selectedPromptId:M,isLoadingPrompts:N,canEdit:S,setSelectionIndex:c})})]})}),N?l.jsx(Ms,{className:"h-96","aria-live":"polite"}):l.jsxs("div",{className:"mb-2 flex h-full flex-col gap-4",children:[l.jsx(KO,{name:"prompt",isEditing:u,setIsEditing:e=>S&&m(e)}),l.jsx(wP,{promptText:O}),l.jsx(NP,{initialValue:v.oneliner??"",onValueChange:S?G:void 0,disabled:!S}),l.jsx(kP,{initialValue:v.command??"",onValueChange:S?K:void 0,disabled:!S})]})]}),o===ex.ADVANCED&&l.jsx("div",{className:"hidden w-1/4 border-l border-border-light lg:block",children:l.jsx(aL,{group:v,prompts:w,selectionIndex:i,selectedPrompt:L,selectedPromptId:M,isLoadingPrompts:N,canEdit:S,setSelectionIndex:c})})]})}),l.jsx("button",{type:"button",className:Qf("absolute inset-0 z-40 cursor-default",g?"opacity-100":"pointer-events-none opacity-0"),style:{transition:"opacity 0.3s ease-in-out"},onClick:()=>x(!1),"aria-hidden":!g,tabIndex:g?0:-1,"aria-label":t("com_ui_close_menu")}),l.jsx("div",{className:"absolute inset-y-0 right-0 z-50 lg:hidden",style:{width:f,transform:`translateX(${g?"0":"100%"})`,transition:"transform 0.3s ease-in-out"},role:"dialog","aria-modal":"true","aria-label":"Mobile navigation panel",children:l.jsx("div",{className:"h-full",children:l.jsx("div",{className:"h-full overflow-auto",children:l.jsx(aL,{group:v,prompts:w,selectionIndex:i,selectedPrompt:L,selectedPromptId:M,isLoadingPrompts:N,canEdit:S,setSelectionIndex:c})})})})]})]})})};function rL(){const e=qN();return l.jsx("div",{className:"h-full w-full content-center text-center font-bold text-text-secondary",children:e("com_ui_select_or_create_prompt")})}const oL={name:"",prompt:"",type:"text",category:"",oneliner:void 0,command:void 0},iL=({defaultValues:e=oL})=>{const t=qN(),n=E(),{hasAccess:a}=aC(),s=ak({permissionType:Pp.PROMPTS,permission:Op.CREATE}),r=a&&s;ya((()=>{let e;return r||(e=setTimeout((()=>{n("/c/new")}),1e3)),()=>{clearTimeout(e)}}),[r,n]);const o=Oi({defaultValues:{...e,category:localStorage.getItem(Hm.LAST_PROMPT_CATEGORY)??""}}),{watch:i,control:c,handleSubmit:d,formState:{isDirty:u,isSubmitting:m,errors:p,isValid:h}}=o,g=Ub({onSuccess:e=>{n(`/d/prompts/${e.prompt.groupId}`,{replace:!0})}}),x=i("prompt");return r?l.jsx(Mi,{...o,children:l.jsxs("form",{onSubmit:d((e=>{const{name:t,category:n,oneliner:a,command:s,...r}=e,o={name:t,category:n};((null==a?void 0:a.length)??0)>0&&(o.oneliner=a),((null==s?void 0:s.length)??0)>0&&(o.command=s),g.mutate({prompt:r,group:o})})),className:"w-full px-4 py-2",children:[l.jsx("h1",{className:"sr-only",children:t("com_ui_create_prompt_page")}),l.jsx("div",{className:"mb-1 flex flex-col items-center justify-between font-bold sm:text-xl md:mb-0 md:text-2xl",children:l.jsxs("div",{className:"flex w-full flex-col items-center justify-between sm:flex-row",children:[l.jsx(Li,{name:"name",control:c,rules:{required:t("com_ui_prompt_name_required")},render:({field:e})=>l.jsxs("div",{className:"relative mb-1 flex flex-col md:mb-0",children:[l.jsx(kr,{...e,id:"prompt-name",type:"text",className:"peer mr-2 w-full border border-border-medium p-2 text-2xl text-text-primary",placeholder:" ",tabIndex:0,"aria-label":t("com_ui_prompt_name")}),l.jsxs("label",{htmlFor:"prompt-name",className:"pointer-events-none absolute -top-1 left-3 origin-[0] translate-y-3 scale-100 rounded bg-white px-1 text-base text-text-secondary transition-transform duration-200 peer-placeholder-shown:translate-y-3 peer-placeholder-shown:scale-100 peer-focus:-translate-y-2 peer-focus:scale-75 peer-focus:text-text-primary peer-[:not(:placeholder-shown)]:-translate-y-2 peer-[:not(:placeholder-shown)]:scale-75 dark:bg-gray-850",children:[t("com_ui_prompt_name"),"*"]}),l.jsx("div",{className:Qf("mt-1 w-56 text-sm text-red-500",p.name?"visible h-auto":"invisible h-0"),children:p.name?p.name.message:" "})]})}),l.jsx(WO,{})]})}),l.jsxs("div",{className:"flex w-full flex-col gap-4 md:mt-[1.075rem]",children:[l.jsxs("div",{children:[l.jsxs("h2",{className:"flex items-center justify-between rounded-t-lg border border-border-medium py-2 pl-4 pr-1 text-base font-semibold dark:text-gray-200",children:[l.jsxs("span",{children:[t("com_ui_prompt_text"),"*"]}),l.jsx(HO,{fieldName:"prompt",className:"mr-2"})]}),l.jsx("div",{className:"min-h-32 rounded-b-lg border border-border-medium p-4 transition-all duration-150",children:l.jsx(Li,{name:"prompt",control:c,rules:{required:t("com_ui_prompt_text_required")},render:({field:e})=>l.jsxs("div",{children:[l.jsx(Br,{...e,className:"w-full rounded border border-border-medium px-2 py-1 focus:outline-none dark:bg-transparent dark:text-gray-200",minRows:6,tabIndex:0,"aria-label":t("com_ui_prompt_input_field")}),l.jsx("div",{className:"mt-1 text-sm text-red-500 "+(p.prompt?"visible h-auto":"invisible h-0"),children:p.prompt?p.prompt.message:" "})]})})})]}),l.jsx(wP,{promptText:x}),l.jsx(NP,{onValueChange:e=>o.setValue("oneliner",e),tabIndex:0}),l.jsx(kP,{onValueChange:e=>o.setValue("command",e),tabIndex:0}),l.jsx("div",{className:"mt-4 flex justify-end",children:l.jsx(Ys,{"aria-label":t("com_ui_create_prompt"),tabIndex:0,type:"submit",disabled:!u||m||!h,children:t("com_ui_create_prompt")})})]})]})}):null};function lL(){const e=xs(),{isAuthenticated:t}=nk(),n=(()=>{const e=T(),t=ba();return ya((()=>{var n;t.current=null==(n=e.state)?void 0:n.prevLocation}),[e]),t})(),a=N_.useClearConvoState(),[s,r]=ja("");return ya((()=>{var e;r((null==(e=n.current)?void 0:e.pathname)||"")}),[n]),ya((()=>{e.removeQueries([Fh.messages,"new"]),a()}),[e,a]),t?l.jsx(Sk.Provider,{value:{prevLocationPath:s},children:l.jsx("div",{className:"h-screen w-full",children:l.jsx(Dt,{})})}):null}const cL={path:"d/*",element:l.jsx(lL,{}),children:[{path:"prompts/*",element:l.jsx(VO,{}),children:[{index:!0,element:l.jsx(rL,{})},{path:"new",element:l.jsx(iL,{})},{path:":promptId",element:l.jsx(sL,{})}]},{path:"*",element:l.jsx(Ht,{to:"/d/files",replace:!0})}]},dL={isArchived:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function uL({onOpenChange:e}){const t=qN(),n=vr("(max-width: 768px)"),{showToast:a}=Ds(),s=j(N_.search),[r,o]=ja(!1),[i,c]=ja(dL),[d,u]=ja(null),{data:m,fetchNextPage:p,hasNextPage:h,isFetchingNextPage:g,refetch:x,isLoading:f}=hb(i,{staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),v=ka((e=>{const t=encodeURIComponent(e.trim());c((e=>({...e,search:t})))}),[]),_=Ca((()=>xi(v,300)),[v]);ya((()=>()=>{_.cancel()}),[_]);const b=Ca((()=>(null==m?void 0:m.pages)?m.pages.flatMap((e=>{var t;return(null==(t=null==e?void 0:e.conversations)?void 0:t.filter(Boolean))??[]})):[]),[null==m?void 0:m.pages]),y=Tb({onSuccess:async()=>{o(!1),await x(),a({message:t("com_ui_convo_delete_success"),severity:lx.SUCCESS,showIcon:!0})},onError:e=>{cx.error("Error deleting archived conversation:",e),a({message:t("com_ui_archive_delete_error"),severity:lx.ERROR})}}),w=jb({onSuccess:async()=>{await x()},onError:e=>{cx.error("Error unarchiving conversation",e),a({message:t("com_ui_unarchive_error"),severity:lx.ERROR})}}),N=ka((async()=>{h&&!g&&await p()}),[p,h,g]),k=Ca((()=>[{accessorKey:"title",header:({column:e})=>{const n=e.getIsSorted();let a=Nt,s="none";return"desc"===n?(a=Ct,s="descending"):"asc"===n&&(a=St,s="ascending"),l.jsxs(Ys,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm","aria-sort":s,"aria-label":t("com_nav_archive_name_sort"),"aria-current":n?"true":"false",children:[t("com_nav_archive_name"),l.jsx(a,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{conversationId:t,title:n}=e.original;return l.jsxs("button",{type:"button",className:"flex items-center gap-2 truncate rounded-sm",onClick:()=>window.open(`/c/${t}`,"_blank"),children:[l.jsx(aI,{endpoint:e.original.endpoint,size:28,isCreatedByUser:!1,iconClassName:"size-4"}),l.jsx("span",{className:"underline",children:n})]})},meta:{size:n?"70%":"50%",mobileSize:"70%"}},{accessorKey:"createdAt",header:({column:e})=>{const n=e.getIsSorted();let a=Nt,s="none";return"desc"===n?(a=Ct,s="descending"):"asc"===n&&(a=St,s="ascending"),l.jsxs(Ys,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm","aria-sort":s,"aria-label":t("com_nav_archive_created_at_sort"),"aria-current":n?"true":"false",children:[t("com_nav_archive_created_at"),l.jsx(a,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return bx((null==(t=e.original.createdAt)?void 0:t.toString())??"",n)},meta:{size:n?"30%":"35%",mobileSize:"30%"}},{accessorKey:"actions",header:()=>l.jsx(er,{className:"px-2 py-0 text-xs sm:px-2 sm:py-2 sm:text-sm",children:t("com_assistants_actions")}),cell:({row:e})=>{const n=e.original;return l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(pr,{description:t("com_ui_unarchive"),render:l.jsx(Ys,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>w.mutate({conversationId:n.conversationId,isArchived:!1}),title:t("com_ui_unarchive"),"aria-label":t("com_ui_unarchive"),disabled:w.isLoading,children:w.isLoading?l.jsx(Xs,{}):l.jsx(Gt,{className:"size-4"})})}),l.jsx(pr,{description:t("com_ui_delete"),render:l.jsx(Ys,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{u(e.original),o(!0)},title:t("com_ui_delete"),"aria-label":t("com_ui_delete"),children:l.jsx(Kt,{className:"size-4"})})})]})},meta:{size:"15%",mobileSize:"25%"}}]),[n,t,w]);return l.jsxs(l.Fragment,{children:[l.jsx(Bo,{columns:k,data:b,filterColumn:"title",onFilterChange:_,filterValue:i.search,fetchNextPage:N,hasNextPage:h,isFetchingNextPage:g,isLoading:f,showCheckboxes:!1,enableSearch:!0===s.enabled}),l.jsx(rr,{open:r,onOpenChange:e,children:l.jsxs(ir,{title:t("com_ui_delete_confirm",{title:(null==d?void 0:d.title)??t("com_ui_untitled")}),className:"w-11/12 max-w-md",children:[l.jsx(br,{children:l.jsx(lr,{children:l.jsx(Ai,{i18nKey:"com_ui_delete_confirm_strong",values:{title:null==d?void 0:d.title},components:{strong:l.jsx("strong",{})}})})}),l.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[l.jsx(Ys,{"aria-label":"cancel",variant:"outline",onClick:()=>o(!1),children:t("com_ui_cancel")}),l.jsx(Ys,{variant:"destructive",onClick:()=>y.mutate({conversationId:(null==d?void 0:d.conversationId)??""}),disabled:y.isLoading,children:y.isLoading?l.jsx(Xs,{}):t("com_ui_delete")})]})]})})]})}function mL(){const e=qN(),[t,n]=ja(!1);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{children:e("com_nav_archived_chats")}),l.jsxs(rr,{open:t,onOpenChange:n,children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{variant:"outline","aria-label":"Archived chats",children:e("com_ui_manage")})}),l.jsx(hr,{title:e("com_nav_archived_chats"),className:"max-w-[1000px]",showCancelButton:!1,main:l.jsx(uL,{isOpen:t,onOpenChange:n})})]})]})}const pL=({stateAtom:e,localizationKey:t,hoverCardText:n,switchId:a,onCheckedChange:s,disabled:r=!1,strongLabel:o=!1})=>{const[i,c]=b(e),d=qN(),u=`${a}-label`;return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{id:u,children:o?l.jsx("strong",{children:d(t)}):d(t)}),n&&l.jsx(xr,{side:fr.Bottom,text:d(n)})]}),l.jsx(dr,{id:a,checked:i,onCheckedChange:e=>{c(e),null==s||s(e)},disabled:r,className:"ml-4","data-testid":a,"aria-labelledby":u})]})},hL=({stateAtom:e,localizationKey:t,hoverCardText:n,switchId:a,onCheckedChange:s,disabled:r=!1,strongLabel:o=!1})=>{const[i,c]=X(e),d=qN(),u=`${a}-label`;return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{id:u,children:o?l.jsx("strong",{children:d(t)}):d(t)}),n&&l.jsx(xr,{side:fr.Bottom,text:d(n)})]}),l.jsx(dr,{id:a,checked:i,onCheckedChange:e=>{c(e),null==s||s(e)},disabled:r,className:"ml-4","data-testid":a,"aria-labelledby":u})]})},gL=e=>{const{stateAtom:t,showSwitch:n=!0}=e;if(!n)return null;var a;return null!=(a=t)&&"object"==typeof a&&"key"in a?l.jsx(pL,{...e,stateAtom:t}):l.jsx(hL,{...e,stateAtom:t})},xL=[{stateAtom:N_.enableUserMsgMarkdown,localizationKey:"com_nav_user_msg_markdown",switchId:"enableUserMsgMarkdown",hoverCardText:void 0,key:"enableUserMsgMarkdown"},{stateAtom:N_.autoScroll,localizationKey:"com_nav_auto_scroll",switchId:"autoScroll",hoverCardText:void 0,key:"autoScroll"},{stateAtom:N_.hideSidePanel,localizationKey:"com_nav_hide_panel",switchId:"hideSidePanel",hoverCardText:void 0,key:"hideSidePanel"},{stateAtom:N_.keepScreenAwake,localizationKey:"com_nav_keep_screen_awake",switchId:"keepScreenAwake",hoverCardText:void 0,key:"keepScreenAwake"}],fL=({theme:e,onChange:t,portal:n=!0})=>{const a=qN(),s=[{value:"system",label:a("com_nav_theme_system")},{value:"dark",label:a("com_nav_theme_dark")},{value:"light",label:a("com_nav_theme_light")}],r="theme-selector-label";return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:r,children:a("com_nav_theme")}),l.jsx(yo,{value:e,onChange:t,options:s,sizeClasses:"w-[180px]",testId:"theme-selector",className:"z-50","aria-labelledby":r,portal:n})]})},vL=({langcode:e,onChange:t,portal:n=!0})=>{const a=qN(),s=[{value:"auto",label:a("com_nav_lang_auto")},{value:"en-US",label:a("com_nav_lang_english")},{value:"zh-Hans",label:a("com_nav_lang_chinese")},{value:"zh-Hant",label:a("com_nav_lang_traditional_chinese")},{value:"ar-EG",label:a("com_nav_lang_arabic")},{value:"bs",label:a("com_nav_lang_bosnian")},{value:"da-DK",label:a("com_nav_lang_danish")},{value:"de-DE",label:a("com_nav_lang_german")},{value:"es-ES",label:a("com_nav_lang_spanish")},{value:"ca-ES",label:a("com_nav_lang_catalan")},{value:"et-EE",label:a("com_nav_lang_estonian")},{value:"fa-IR",label:a("com_nav_lang_persian")},{value:"fr-FR",label:a("com_nav_lang_french")},{value:"he-HE",label:a("com_nav_lang_hebrew")},{value:"hu-HU",label:a("com_nav_lang_hungarian")},{value:"hy-AM",label:a("com_nav_lang_armenian")},{value:"it-IT",label:a("com_nav_lang_italian")},{value:"nb",label:a("com_nav_lang_norwegian_bokmal")},{value:"pl-PL",label:a("com_nav_lang_polish")},{value:"pt-BR",label:a("com_nav_lang_brazilian_portuguese")},{value:"pt-PT",label:a("com_nav_lang_portuguese")},{value:"ru-RU",label:a("com_nav_lang_russian")},{value:"ja-JP",label:a("com_nav_lang_japanese")},{value:"ka-GE",label:a("com_nav_lang_georgian")},{value:"cs-CZ",label:a("com_nav_lang_czech")},{value:"sv-SE",label:a("com_nav_lang_swedish")},{value:"ko-KR",label:a("com_nav_lang_korean")},{value:"lv-LV",label:a("com_nav_lang_latvian")},{value:"vi-VN",label:a("com_nav_lang_vietnamese")},{value:"th-TH",label:a("com_nav_lang_thai")},{value:"tr-TR",label:a("com_nav_lang_turkish")},{value:"ug",label:a("com_nav_lang_uyghur")},{value:"nl-NL",label:a("com_nav_lang_dutch")},{value:"id-ID",label:a("com_nav_lang_indonesia")},{value:"fi-FI",label:a("com_nav_lang_finnish")},{value:"sl",label:a("com_nav_lang_slovenian")},{value:"bo",label:a("com_nav_lang_tibetan")},{value:"uk-UA",label:a("com_nav_lang_ukrainian")}],r="language-selector-label";return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:r,children:a("com_nav_language")}),l.jsx(yo,{value:e,onChange:t,sizeClasses:"[--anchor-max-height:256px] max-h-[60vh]",options:s,className:"z-50","aria-labelledby":r,portal:n})]})};const _L=_a.memo((function(){const{theme:e,setTheme:t}=Na(Fs),[n,a]=b(N_.lang),s=ka((e=>{t(e)}),[t]),r=ka((e=>{let t=e;"auto"===e&&(t=navigator.language||navigator.languages[0]),requestAnimationFrame((()=>{document.documentElement.lang=t})),a(t),w.set("lang",t,{expires:365})}),[a]);return l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(fL,{theme:e,onChange:s})}),l.jsx("div",{className:"pb-3",children:l.jsx(vL,{langcode:n,onChange:r})}),xL.map((e=>l.jsx("div",{className:"pb-3",children:l.jsx(gL,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key))),l.jsx("div",{className:"pb-3",children:l.jsx(mL,{})})]})}));var bL,yL=Object.freeze,jL=Object.defineProperty;const wL={"application/vnd.react":"App.tsx","text/html":"index.html","application/vnd.code-html":"index.html",default:"index.html"},NL={"text/html":"static","application/vnd.react":"react-ts","application/vnd.mermaid":"react-ts","application/vnd.code-html":"static","text/markdown":"react-ts","text/md":"react-ts","text/plain":"react-ts",default:"static"};function kL(e,t){return`${e}${((null==t?void 0:t.length)??0)>0?`-${t}`:""}`}const CL={three:"^0.167.1","lucide-react":"^0.394.0","react-router-dom":"^6.11.2","class-variance-authority":"^0.6.0",clsx:"^1.2.1","date-fns":"^3.3.1","tailwind-merge":"^1.9.1","tailwindcss-animate":"^1.0.5",recharts:"2.12.7","@radix-ui/react-accordion":"^1.1.2","@radix-ui/react-alert-dialog":"^1.0.2","@radix-ui/react-aspect-ratio":"^1.1.0","@radix-ui/react-avatar":"^1.1.0","@radix-ui/react-checkbox":"^1.0.3","@radix-ui/react-collapsible":"^1.0.3","@radix-ui/react-dialog":"^1.0.2","@radix-ui/react-dropdown-menu":"^2.1.1","@radix-ui/react-hover-card":"^1.0.5","@radix-ui/react-label":"^2.0.0","@radix-ui/react-menubar":"^1.1.1","@radix-ui/react-navigation-menu":"^1.2.0","@radix-ui/react-popover":"^1.0.7","@radix-ui/react-progress":"^1.1.0","@radix-ui/react-radio-group":"^1.1.3","@radix-ui/react-select":"^2.0.0","@radix-ui/react-separator":"^1.0.3","@radix-ui/react-slider":"^1.1.1","@radix-ui/react-switch":"^1.0.3","@radix-ui/react-tabs":"^1.0.3","@radix-ui/react-toast":"^1.1.5","@radix-ui/react-slot":"^1.1.0","@radix-ui/react-toggle":"^1.1.0","@radix-ui/react-toggle-group":"^1.1.0","@radix-ui/react-tooltip":"^1.2.8","embla-carousel-react":"^8.2.0","react-day-picker":"^9.0.8","dat.gui":"^0.7.9",vaul:"^0.9.1"},SL={"marked-react":"^2.0.0"},TL={"application/vnd.mermaid":{mermaid:"^11.4.1","react-zoom-pan-pinch":"^3.6.1","class-variance-authority":"^0.6.0",clsx:"^1.2.1","tailwind-merge":"^1.9.1","@radix-ui/react-slot":"^1.1.0"},"application/vnd.react":CL,"text/html":CL,"application/vnd.code-html":CL,"text/markdown":SL,"text/md":SL,"text/plain":SL,default:CL};function EL(e){return TL[e]??CL}const IL={externalResources:["https://cdn.tailwindcss.com/3.4.17"]},RL={"/lib/utils.ts":Lp.utils,"/components/ui/accordion.tsx":Lp.accordian,"/components/ui/alert-dialog.tsx":Lp.alertDialog,"/components/ui/alert.tsx":Lp.alert,"/components/ui/avatar.tsx":Lp.avatar,"/components/ui/badge.tsx":Lp.badge,"/components/ui/breadcrumb.tsx":Lp.breadcrumb,"/components/ui/button.tsx":Lp.button,"/components/ui/calendar.tsx":Lp.calendar,"/components/ui/card.tsx":Lp.card,"/components/ui/carousel.tsx":Lp.carousel,"/components/ui/checkbox.tsx":Lp.checkbox,"/components/ui/collapsible.tsx":Lp.collapsible,"/components/ui/dialog.tsx":Lp.dialog,"/components/ui/drawer.tsx":Lp.drawer,"/components/ui/dropdown-menu.tsx":Lp.dropdownMenu,"/components/ui/input.tsx":Lp.input,"/components/ui/label.tsx":Lp.label,"/components/ui/menubar.tsx":Lp.menuBar,"/components/ui/navigation-menu.tsx":Lp.navigationMenu,"/components/ui/pagination.tsx":Lp.pagination,"/components/ui/popover.tsx":Lp.popover,"/components/ui/progress.tsx":Lp.progress,"/components/ui/radio-group.tsx":Lp.radioGroup,"/components/ui/select.tsx":Lp.select,"/components/ui/separator.tsx":Lp.separator,"/components/ui/skeleton.tsx":Lp.skeleton,"/components/ui/slider.tsx":Lp.slider,"/components/ui/switch.tsx":Lp.switchComponent,"/components/ui/table.tsx":Lp.table,"/components/ui/tabs.tsx":Lp.tabs,"/components/ui/textarea.tsx":Lp.textarea,"/components/ui/toast.tsx":Lp.toast,"/components/ui/toaster.tsx":Lp.toaster,"/components/ui/toggle-group.tsx":Lp.toggleGroup,"/components/ui/toggle.tsx":Lp.toggle,"/components/ui/tooltip.tsx":Lp.tooltip,"/components/ui/use-toast.tsx":Lp.useToast,"/public/index.html":Wt(bL||(AL=['\n    <!DOCTYPE html>\n    <html lang="en">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Document</title>\n        <script src="https://cdn.tailwindcss.com/3.4.17"><\/script>\n      </head>\n      <body>\n        <div id="root"></div>\n      </body>\n    </html>\n  '],bL=yL(jL(AL,"raw",{value:yL(AL.slice())}))))};var AL;const PL=Wt('import React, { useEffect, useRef, useState } from "react";\nimport {\n  TransformWrapper,\n  TransformComponent,\n  ReactZoomPanPinchRef,\n} from "react-zoom-pan-pinch";\nimport mermaid from "mermaid";\nimport { Button } from "/components/ui/button";\n\nconst ZoomIn = () => (\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">\n    <circle cx="11" cy="11" r="8"/>\n    <line x1="21" x2="16.65" y1="21" y2="16.65"/>\n    <line x1="11" x2="11" y1="8" y2="14"/>\n    <line x1="8" x2="14" y1="11" y2="11"/>\n  </svg>\n);\n\nconst ZoomOut = () => (\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">\n    <circle cx="11" cy="11" r="8"/>\n    <line x1="21" x2="16.65" y1="21" y2="16.65"/>\n    <line x1="8" x2="14" y1="11" y2="11"/>\n  </svg>\n);\n\nconst RefreshCw = () => (\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">\n    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>\n    <path d="M21 3v5h-5"/>\n    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>\n    <path d="M8 16H3v5"/>\n  </svg>\n);\n\ninterface MermaidDiagramProps {\n  content: string;\n}\n\nconst MermaidDiagram: React.FC<MermaidDiagramProps> = ({ content }) => {\n  const mermaidRef = useRef<HTMLDivElement>(null);\n  const transformRef = useRef<ReactZoomPanPinchRef>(null);\n  const [isRendered, setIsRendered] = useState(false);\n\n  useEffect(() => {\n    mermaid.initialize({\n      startOnLoad: false,\n      theme: "base",\n      themeVariables: {\n        background: "#282C34",\n        primaryColor: "#333842",\n        secondaryColor: "#333842",\n        tertiaryColor: "#333842",\n        primaryTextColor: "#ABB2BF",\n        secondaryTextColor: "#ABB2BF",\n        lineColor: "#636D83",\n        fontSize: "16px",\n        nodeBorder: "#636D83",\n        mainBkg: \'#282C34\',\n        altBackground: \'#282C34\',\n        textColor: \'#ABB2BF\',\n        edgeLabelBackground: \'#282C34\',\n        clusterBkg: \'#282C34\',\n        clusterBorder: "#636D83",\n        labelBoxBkgColor: "#333842",\n        labelBoxBorderColor: "#636D83",\n        labelTextColor: "#ABB2BF",\n      },\n      flowchart: {\n        curve: "basis",\n        nodeSpacing: 50,\n        rankSpacing: 50,\n        diagramPadding: 8,\n        htmlLabels: true,\n        useMaxWidth: true,\n        padding: 15,\n        wrappingWidth: 200,\n      },\n    });\n\n    const renderDiagram = async () => {\n      if (mermaidRef.current) {\n        try {\n          const { svg } = await mermaid.render("mermaid-diagram", content);\n          mermaidRef.current.innerHTML = svg;\n\n          const svgElement = mermaidRef.current.querySelector("svg");\n          if (svgElement) {\n            svgElement.style.width = "100%";\n            svgElement.style.height = "100%";\n\n            const pathElements = svgElement.querySelectorAll("path");\n            pathElements.forEach((path) => {\n              path.style.strokeWidth = "1.5px";\n            });\n\n            const rectElements = svgElement.querySelectorAll("rect");\n            rectElements.forEach((rect) => {\n              const parent = rect.parentElement;\n              if (parent && parent.classList.contains("node")) {\n                rect.style.stroke = "#636D83";\n                rect.style.strokeWidth = "1px";\n              } else {\n                rect.style.stroke = "none";\n              }\n            });\n          }\n          setIsRendered(true);\n        } catch (error) {\n          console.error("Mermaid rendering error:", error);\n          mermaidRef.current.innerHTML = "Error rendering diagram";\n        }\n      }\n    };\n\n    renderDiagram();\n  }, [content]);\n\n  const centerAndFitDiagram = () => {\n    if (transformRef.current && mermaidRef.current) {\n      const { centerView, zoomToElement } = transformRef.current;\n      zoomToElement(mermaidRef.current as HTMLElement);\n      centerView(1, 0);\n    }\n  };\n\n  useEffect(() => {\n    if (isRendered) {\n      centerAndFitDiagram();\n    }\n  }, [isRendered]);\n\n  const handlePanning = () => {\n    if (transformRef.current) {\n      const { state, instance } = transformRef.current;\n      if (!state) {\n        return;\n      }\n      const { scale, positionX, positionY } = state;\n      const { wrapperComponent, contentComponent } = instance;\n\n      if (wrapperComponent && contentComponent) {\n        const wrapperRect = wrapperComponent.getBoundingClientRect();\n        const contentRect = contentComponent.getBoundingClientRect();\n        const maxX = wrapperRect.width - contentRect.width * scale;\n        const maxY = wrapperRect.height - contentRect.height * scale;\n\n        let newX = positionX;\n        let newY = positionY;\n\n        if (newX > 0) {\n          newX = 0;\n        }\n        if (newY > 0) {\n          newY = 0;\n        }\n        if (newX < maxX) {\n          newX = maxX;\n        }\n        if (newY < maxY) {\n          newY = maxY;\n        }\n\n        if (newX !== positionX || newY !== positionY) {\n          instance.setTransformState(scale, newX, newY);\n        }\n      }\n    }\n  };\n\n  return (\n    <div className="relative h-screen w-screen cursor-move bg-[#282C34] p-5">\n      <TransformWrapper\n        ref={transformRef}\n        initialScale={1}\n        minScale={0.1}\n        maxScale={10}\n        limitToBounds={false}\n        centerOnInit={true}\n        initialPositionY={0}\n        wheel={{ step: 0.1 }}\n        panning={{ velocityDisabled: true }}\n        alignmentAnimation={{ disabled: true }}\n        onPanning={handlePanning}\n      >\n        {({ zoomIn, zoomOut }) => (\n          <>\n            <TransformComponent\n              wrapperStyle={{\n                width: "100%",\n                height: "100%",\n                overflow: "hidden",\n              }}\n            >\n              <div\n                ref={mermaidRef}\n                style={{\n                  width: "auto",\n                  height: "auto",\n                  minWidth: "100%",\n                  minHeight: "100%",\n                }}\n              />\n            </TransformComponent>\n            <div className="absolute bottom-2 right-2 flex space-x-2">\n              <Button onClick={() => zoomIn(0.1)} variant="outline" size="icon">\n                <ZoomIn />\n              </Button>\n              <Button\n                onClick={() => zoomOut(0.1)}\n                variant="outline"\n                size="icon"\n              >\n                <ZoomOut />\n              </Button>\n              <Button\n                onClick={centerAndFitDiagram}\n                variant="outline"\n                size="icon"\n              >\n                <RefreshCw />\n              </Button>\n            </div>\n          </>\n        )}\n      </TransformWrapper>\n    </div>\n  );\n};\n\nexport default MermaidDiagram;'),OL=e=>Wt(`import React from 'react';\nimport MermaidDiagram from '/components/ui/MermaidDiagram';\n\nexport default App = () => (\n  <MermaidDiagram content={\`${e}\`} />\n);\n`),LL=e=>({"diagram.mmd":e||"# No mermaid diagram content provided","App.tsx":OL(e),"index.tsx":Wt('import React, { StrictMode } from "react";\nimport { createRoot } from "react-dom/client";\nimport "./styles.css";\nimport "./mermaid.css";\n\nimport App from "./App";\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(<App />);\n;'),"/components/ui/MermaidDiagram.tsx":PL,"mermaid.css":"\nbody {\n  background-color: #282C34;\n}\n"}),ML=Wt("import React, { useEffect, useState } from 'react';\nimport Markdown from 'marked-react';\n\ninterface MarkdownRendererProps {\n  content: string;\n}\n\nconst MarkdownRenderer: React.FC<MarkdownRendererProps> = ({ content }) => {\n  return (\n    <div\n      className=\"markdown-body\"\n      style={{\n        padding: '2rem',        \n        margin: '1rem',\n        minHeight: '100vh'\n      }}\n    >\n      <Markdown gfm={true} breaks={true}>{content}</Markdown>\n    </div>\n  );\n};\n\nexport default MarkdownRenderer;"),DL=e=>{const t=e.replace(/^( {2})(-|\d+\.)/gm,"    $2").replace(/\\/g,"\\\\").replace(/`/g,"\\`").replace(/\$/g,"\\$");return Wt(`import React from 'react';\nimport MarkdownRenderer from '/components/ui/MarkdownRenderer';\n\nconst App = () => {\n  return <MarkdownRenderer content={\`${t}\`} />;\n};\n\nexport default App;\n`)},FL=e=>({"content.md":e||"# No content provided","App.tsx":DL(e),"index.tsx":Wt('import React, { StrictMode } from "react";\nimport { createRoot } from "react-dom/client";\nimport "./styles.css";\nimport "./markdown.css";\n\nimport App from "./App";\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(<App />);\n;'),"/components/ui/MarkdownRenderer.tsx":ML,"markdown.css":'\n/* GitHub Markdown CSS - Light theme base */\n.markdown-body {\n  -ms-text-size-adjust: 100%;\n  -webkit-text-size-adjust: 100%;\n  line-height: 1.5;\n  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;\n  font-size: 16px;\n  line-height: 1.5;\n  word-wrap: break-word;\n  color: #24292f;\n  background-color: #ffffff;\n}\n\n.markdown-body h1, .markdown-body h2 {\n  border-bottom: 1px solid #d0d7de;\n  margin: 0.6em 0;\n}\n\n.markdown-body h1 { font-size: 2em; margin: 0.67em 0; }\n.markdown-body h2 { font-size: 1.5em; }\n.markdown-body h3 { font-size: 1.25em; }\n.markdown-body h4 { font-size: 1em; }\n.markdown-body h5 { font-size: 0.875em; }\n.markdown-body h6 { font-size: 0.85em; }\n\n.markdown-body ul, .markdown-body ol {\n  list-style: revert !important;\n  padding-left: 2em !important;\n  margin-top: 0;\n  margin-bottom: 16px;\n}\n\n.markdown-body ul { list-style-type: disc !important; }\n.markdown-body ol { list-style-type: decimal !important; }\n.markdown-body ul ul { list-style-type: circle !important; }\n.markdown-body ul ul ul { list-style-type: square !important; }\n\n.markdown-body li { margin-top: 0.25em; }\n\n.markdown-body li:has(> input[type="checkbox"]) {\n  list-style-type: none !important;\n}\n\n.markdown-body li > input[type="checkbox"] {\n  margin-right: 0.75em;\n  margin-left: -1.5em;\n  vertical-align: middle;\n  pointer-events: none;\n  width: 16px;\n  height: 16px;\n}\n\n.markdown-body .task-list-item {\n  list-style-type: none !important;\n}\n\n.markdown-body .task-list-item > input[type="checkbox"] {\n  margin-right: 0.75em;\n  margin-left: -1.5em;\n  vertical-align: middle;\n  pointer-events: none;\n  width: 16px;\n  height: 16px;\n}\n\n.markdown-body code {\n  padding: 0.2em 0.4em;\n  margin: 0;\n  font-size: 85%;\n  border-radius: 6px;\n  background-color: rgba(175, 184, 193, 0.2);\n  color: #24292f;\n  font-family: ui-monospace, monospace;\n  white-space: pre-wrap;\n}\n\n.markdown-body pre {\n  padding: 16px;\n  overflow: auto;\n  font-size: 85%;\n  line-height: 1.45;\n  border-radius: 6px;\n  margin-top: 0;\n  margin-bottom: 16px;\n  background-color: #f6f8fa;\n  color: #24292f;\n}\n\n.markdown-body pre code {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n  overflow: visible;\n  line-height: inherit;\n  word-wrap: normal;\n  background-color: transparent;\n  border: 0;\n}\n\n.markdown-body a {\n  text-decoration: none;\n  color: #0969da;\n}\n\n.markdown-body a:hover {\n  text-decoration: underline;\n}\n\n.markdown-body table {\n  border-spacing: 0;\n  border-collapse: collapse;\n  display: block;\n  width: max-content;\n  max-width: 100%;\n  overflow: auto;\n}\n\n.markdown-body table thead {\n  background-color: #f6f8fa;\n}\n\n.markdown-body table th, .markdown-body table td {\n  padding: 6px 13px;\n  border: 1px solid #d0d7de;\n}\n\n.markdown-body blockquote {\n  padding: 0 1em;\n  border-left: 0.25em solid #d0d7de;\n  margin: 0 0 16px 0;\n  color: #57606a;\n}\n\n.markdown-body hr {\n  height: 0.25em;\n  padding: 0;\n  margin: 24px 0;\n  border: 0;\n  background-color: #d0d7de;\n}\n\n.markdown-body img {\n  max-width: 100%;\n  box-sizing: content-box;\n}\n\n/* Dark theme */\n@media (prefers-color-scheme: dark) {\n  .markdown-body {\n    color: #c9d1d9;\n    background-color: #0d1117;\n  }\n\n  .markdown-body h1, .markdown-body h2 {\n    border-bottom-color: #21262d;\n  }\n\n  .markdown-body code {\n    background-color: rgba(110, 118, 129, 0.4);\n    color: #c9d1d9;\n  }\n\n  .markdown-body pre {\n    background-color: #161b22;\n    color: #c9d1d9;\n  }\n\n  .markdown-body a {\n    color: #58a6ff;\n  }\n\n  .markdown-body table thead {\n    background-color: #161b22;\n  }\n\n  .markdown-body table th, .markdown-body table td {\n    border-color: #30363d;\n  }\n\n  .markdown-body blockquote {\n    border-left-color: #3b434b;\n    color: #8b949e;\n  }\n\n  .markdown-body hr {\n    background-color: #21262d;\n  }\n}\n'});function UL({artifact:e}){const[t,n]=Ca((()=>{const t=kL(e.type??"",e.language),n=e.type??"";if(t.includes("mermaid"))return["diagram.mmd",LL(e.content??"")];if("text/markdown"===n||"text/md"===n||"text/plain"===n)return["content.md",FL(e.content??"")];const a=function(e,t){const n=kL(e,t);return wL[n]??wL.default}(e.type??"",e.language);return[a,$c({[a]:e.content})]}),[e.type,e.content,e.language]);return{files:n,fileKey:t,template:Ca((()=>function(e,t){const n=kL(e,t);return NL[n]??NL.default}(e.type??"",e.language)),[e.type,e.language]),sharedProps:Ca((()=>({customSetup:{dependencies:EL(e.type??"")}})),[e.type])}}const zL=({artifact:e})=>{const t=qN(),{currentCode:n}=bk(),[a,s]=ja(!1),{fileKey:r}=UL({artifact:e});return l.jsx(Ys,{size:"icon",variant:"ghost",onClick:()=>{try{const t=n??e.content??"";if(!t)return;const a=new Blob([t],{type:"text/plain"}),o=window.URL.createObjectURL(a),i=document.createElement("a");i.href=o,i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o),s(!0),setTimeout((()=>s(!1)),3e3)}catch(t){console.error("Download failed:",t)}},"aria-label":t("com_ui_download_artifact"),children:a?l.jsx(qt,{size:16,"aria-hidden":"true"}):l.jsx(Qt,{size:16,"aria-hidden":"true"})})};function VL({currentIndex:e,totalVersions:t,onVersionChange:n}){const a=qN(),[s,r]=ja(!1),o=vr("(max-width: 768px)");if(t<=1)return null;const i=Array.from({length:t},((e,t)=>({value:t.toString(),label:a("com_ui_version_var",{0:String(t+1)})}))).map((t=>{const a=t.value===String(e);return{label:t.label,onClick:()=>(e=>{const t=parseInt(e,10);n(t),r(!1)})(t.value),value:t.value,icon:a?l.jsx(Yt,{size:16,className:"text-text-primary","aria-hidden":"true"}):void 0}}));return l.jsx(cr,{menuId:"version-dropdown-menu",portal:!0,focusLoop:!0,unmountOnHide:!0,isOpen:s,setIsOpen:r,trigger:l.jsx(pr,{description:a("com_ui_change_version"),render:l.jsx(Ys,{size:"icon",variant:"ghost",asChild:!0,"aria-label":a("com_ui_change_version"),children:l.jsx(se,{children:l.jsx(Ye,{size:18,className:"text-text-secondary","aria-hidden":"true",focusable:"false"})})})}),items:i,className:o?"":"absolute right-0 top-0 mt-2"})}const $L=({ref:e,content:t,isSubmitting:n})=>{const[a,s]=ja(!1);return ya((()=>{const t=e.current;if(!t)return;const n=()=>{const{scrollTop:e,scrollHeight:n,clientHeight:a}=t;s(!(n-e-a<50))};return t.addEventListener("scroll",n),()=>{t.removeEventListener("scroll",n)}}),[e]),ya((()=>{const t=e.current;t&&n&&!a&&(t.scrollTop=t.scrollHeight)}),[t,n,a,e]),{userScrolled:a}},BL=Sa((({fileKey:e,readOnly:t,artifact:n,editorRef:a})=>{const{sandpack:s}=ol(),[r,o]=ja(null),{isMutating:i,setIsMutating:c}=_k(),{setCurrentCode:d}=bk(),u=(e=>{const t=xs(),{onSuccess:n,onError:a,onMutate:s,...r}=e??{},o={mutationFn:e=>Jh.editArtifact(e),onMutate:async e=>(s&&await s(e),{previousMessages:{},updatedConversationId:null}),onError:(e,t,n)=>{null==a||a(e,t,n)},onSuccess:(e,a,s)=>{let r=!0;const o=n=>{n&&t.setQueryData([Fh.messages,n],(t=>{if(!t)return t;const n=[...t];let s;for(let e=n.length-1;e>=0;e--)if(n[e].messageId===a.messageId){s=e,r=!1;break}return null==s?t:(n[s]={...n[s],content:e.content,text:e.text},n)}))};o(e.conversationId),r&&(console.warn("Edited Artifact Message not found in cache, trying `new` as `conversationId`"),o(Bm.NEW_CONVO)),null==n||n(e,a,s)},...r};return fs(o)})({onMutate:e=>{c(!0),o(e.updated)},onSuccess:()=>{c(!1),o(null)},onError:()=>{c(!1)}}),m=ba(n),p=ba(i),h=ba(r),g=ba(u),x=ba(d);ya((()=>{m.current=n}),[n]),ya((()=>{p.current=i}),[i]),ya((()=>{h.current=r}),[r]),ya((()=>{g.current=u}),[u]),ya((()=>{x.current=d}),[d]);const f=Ca((()=>xi((e=>{if(t)return;if(p.current)return;if(null==m.current.index)return;const n=m.current,a=n.index,s=e&&null!=n.content&&e.trim()!==n.content.trim(),r=null==h.current||null!=e&&e.trim()!==h.current.trim();n.content&&s&&r&&null!=a&&(x.current(e),g.current.mutate({index:a,messageId:n.messageId??"",original:n.content,updated:e}))}),500)),[t]);return ya((()=>{var t;const n=null==(t=s.files["/"+e])?void 0:t.code;n&&f(n)}),[s.files,e,f]),ya((()=>()=>{f.cancel()}),[n.id,f]),l.jsx(il,{ref:a,showTabs:!1,showRunButton:!1,showLineNumbers:!0,showInlineErrors:!0,readOnly:!0===t,extensions:[sl()],extensionsKeymap:Array.from(rl),className:"hljs language-javascript bg-black"})})),HL=function({files:e,fileKey:t,template:n,artifact:a,editorRef:s,sharedProps:r,readOnly:o}){const{data:i}=K_(),{isSubmitting:c}=Xk(),d=Ca((()=>i?{...IL,activeFile:"/"+t,bundlerURL:"static"===n?i.staticBundlerURL:i.bundlerURL}:IL),[i,n,t]),u=(o??!1)||(c??!1),[m,p]=ja(u);return ya((()=>{p((o??!1)||(c??!1))}),[c,o]),0===Object.keys(e).length?null:l.jsx(ll,{theme:"dark",files:{...e,...RL},options:d,...r,template:n,children:l.jsx(BL,{fileKey:t,artifact:a,editorRef:s,readOnly:m})})},GL=Sa((function({files:e,fileKey:t,template:n,sharedProps:a,previewRef:s,currentCode:r,startupConfig:o}){const i=Ca((()=>{if(0===Object.keys(e).length)return e;const n=r??"";return n?{...e,[t]:{code:n}}:e}),[r,e,t]),c=Ca((()=>o?{...IL,bundlerURL:"static"===n?o.staticBundlerURL:o.bundlerURL}:IL),[o,n]);return 0===Object.keys(i).length?null:l.jsx(cl,{files:{...i,...RL},options:c,...a,template:n,children:l.jsx(dl,{showOpenInCodeSandbox:!1,showRefreshButton:!1,tabIndex:0,ref:s})})}));function KL({artifact:e,editorRef:t,previewRef:n,isSharedConvo:a}){const{isSubmitting:s}=Xk(),{currentCode:r,setCurrentCode:o}=bk(),{data:i}=K_(),c=ba(null);ya((()=>{e.id!==c.current&&o(void 0),c.current=e.id}),[o,e.id]);const d=e.content??"",u=ba(null);$L({ref:u,content:d,isSubmitting:s});const{files:m,fileKey:p,template:h,sharedProps:g}=UL({artifact:e});return l.jsxs("div",{className:"flex h-full w-full flex-col",children:[l.jsx(es,{ref:u,value:"code",id:"artifacts-code",className:"h-full w-full flex-grow overflow-auto",tabIndex:-1,children:l.jsx(HL,{files:m,fileKey:p,template:h,artifact:e,editorRef:t,sharedProps:g,readOnly:a})}),l.jsx(es,{value:"preview",className:"h-full w-full flex-grow overflow-auto",tabIndex:-1,children:l.jsx(GL,{files:m,fileKey:p,template:h,previewRef:n,sharedProps:g,currentCode:r,startupConfig:i})})]})}const WL=Sa((({inline:e,className:t,children:n})=>{const a=/language-(\w+)/.exec(t??""),s=a&&a[1];return e?l.jsx("code",{onDoubleClick:lv,className:t,children:n}):l.jsx("code",{className:`hljs language-${s} !whitespace-pre`,children:n})}));Sa((({content:e="",isSubmitting:t})=>{const n=ba(null),[a,s]=ja(!1),r=e,o=[[tl],[Ji,{detect:!0,ignoreMissing:!0,subset:hf}]];return ya((()=>{const e=n.current;if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:n,clientHeight:a}=e;s(!(n-t-a<50))};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}}),[]),ya((()=>{const e=n.current;e&&t&&!a&&(e.scrollTop=e.scrollHeight)}),[e,t,a]),l.jsx("div",{ref:n,className:"max-h-full overflow-y-auto",children:l.jsx(Xi,{rehypePlugins:o,components:{code:WL},children:r})})}));const qL=({content:e})=>{const t=qN(),[n,a]=ja(!1);return l.jsx(Ys,{size:"icon",variant:"ghost",onClick:()=>{J(e,{format:"text/plain"}),a(!0),setTimeout((()=>a(!1)),3e3)},"aria-label":t(n?"com_ui_copied":"com_ui_copy_code"),children:n?l.jsx(qt,{size:16,"aria-hidden":"true"}):l.jsx(ue,{size:16,"aria-hidden":"true"})})},QL=32,YL=.3;function XL(){const e=qN(),{isMutating:t}=_k(),{isSharedConvo:n}=uk(),a=vr("(max-width: 868px)"),s=ba(),r=ba(),[o,i]=ja(!1),[c,d]=ja(!1),[u,m]=ja(!1),[p,h]=ja(!1),[g,x]=ja(90),[f,v]=ja(!1),[_,w]=ja(0),N=ba(0),k=ba(90),C=y(N_.artifactsVisibility),T=S(N_.currentArtifactId),E=[{value:"code",label:e("com_ui_code"),icon:l.jsx(Xt,{className:"size-4"})},{value:"preview",label:e("com_ui_preview"),icon:l.jsx(Jt,{className:"size-4"})}];ya((()=>{h(!0);const e=setTimeout((()=>i(!0)),a?50:30);return()=>{clearTimeout(e),h(!1)}}),[a]),ya((()=>{if(!a)return void w(0);if(g<=50)w(0);else if(g>=100)w(QL);else{const e=(g-50)/50;w(Math.round(e*QL))}}),[g,a]);const{activeTab:I,setActiveTab:R,currentIndex:A,currentArtifact:P,orderedArtifactIds:O,setCurrentArtifactId:L}=function(){const[e,t]=ja("preview"),{isSubmitting:n,latestMessageId:a,latestMessageText:s,conversationId:r}=Xk(),o=j(N_.artifactsState),i=S(N_.artifactsState),l=S(N_.currentArtifactId),[c,d]=b(N_.currentArtifactId),u=Ca((()=>Object.keys(o??{}).sort(((e,t)=>{var n,a;return((null==(n=null==o?void 0:o[e])?void 0:n.lastUpdateTime)??0)-((null==(a=null==o?void 0:o[t])?void 0:a.lastUpdateTime)??0)}))),[o]),m=ba(!1),p=ba(null),h=ba(!1),g=ba(!1),x=ba(null),f=ba(null);ya((()=>{const e=()=>{i(),l(),f.current=r,x.current=null,p.current=null,h.current=!1,g.current=!1};return(r!==f.current&&null!=f.current||r===Bm.NEW_CONVO)&&e(),f.current=r,()=>{cx.log("artifacts_visibility","Unmounting artifacts"),e()}}),[r,i,l]),ya((()=>{if(u.length>0){const e=u[u.length-1];d(e)}}),[d,u]),ya((()=>{var e;const r=m.current&&!n;if(m.current=n,!n&&!r)return;if(0===u.length)return;if(null==a)return;const i=u[u.length-1],l=null==o?void 0:o[i];if(((null==l?void 0:l.content)!==p.current||r)&&(d(i),p.current=(null==l?void 0:l.content)??null,!h.current&&!g.current)){const n=(null==(e=null==l?void 0:l.content)?void 0:e.slice(0,50))??"";n.length>0&&s.includes(n)&&(t("code"),g.current=!0)}}),[o,n,a,s,u,d]),ya((()=>{n&&!h.current&&/:::artifact(?:\{[^}]*\})?(?:\s|\n)*(?:```[\s\S]*?```(?:\s|\n)*)?:::/m.test(s.trim())&&(cx.log("artifacts","Enclosed artifact detected during generation, switching to preview"),t("preview"),h.current=!0,g.current=!1)}),[n,s]),ya((()=>{a!==x.current&&(x.current=a,h.current=!1,g.current=!1)}),[a]);const v=null!=c?null==o?void 0:o[c]:null,_=u.indexOf(c??"");return{activeTab:e,setActiveTab:t,currentIndex:_,currentArtifact:v,orderedArtifactIds:u,setCurrentArtifactId:d}}(),M=e=>{f&&(v(!1),e.target.releasePointerCapture(e.pointerId),g<30?D():x(g>95?100:g<60?50:90))};if(!P||!p)return null;const D=()=>{a?(d(!0),i(!1),setTimeout((()=>{C(!1),d(!1),x(90)}),250)):(T(),C(!1))},F=_>0?Math.min(_,QL)/QL*YL:0;return l.jsx(ts,{value:I,onValueChange:R,asChild:!0,children:l.jsxs("div",{className:"flex h-full w-full flex-col",children:[a&&l.jsx("div",{className:Qf("fixed inset-0 z-[99] bg-black will-change-[opacity,backdrop-filter]",o&&!c?"transition-all duration-300":"pointer-events-none opacity-0 backdrop-blur-none transition-opacity duration-150",_<8&&o&&!c?"pointer-events-none":""),style:{opacity:o&&!c?F:0,backdropFilter:o&&!c?`blur(${_}px)`:"none",WebkitBackdropFilter:o&&!c?`blur(${_}px)`:"none"},onClick:_>=8?D:void 0,"aria-hidden":"true"}),l.jsxs("div",{className:Qf("flex w-full flex-col bg-surface-primary text-xl text-text-primary",a?Qf("fixed inset-x-0 bottom-0 z-[100] rounded-t-[20px] shadow-[0_-10px_60px_rgba(0,0,0,0.35)]",o&&!c?"translate-y-0 opacity-100":"duration-250 translate-y-full opacity-0 transition-all",f?"":"transition-all duration-300"):Qf("h-full shadow-2xl",o&&!c?"duration-350 translate-x-0 opacity-100 transition-all":"translate-x-5 opacity-0 transition-all duration-300")),style:a?{height:`${g}vh`}:{overflow:"hidden"},children:[a&&l.jsx("div",{className:"flex flex-shrink-0 cursor-grab items-center justify-center bg-surface-primary-alt pb-1.5 pt-2.5 active:cursor-grabbing",onPointerDown:e=>{v(!0),N.current=e.clientY,k.current=g,e.target.setPointerCapture(e.pointerId)},onPointerMove:e=>{if(!f)return;const t=(N.current-e.clientY)/window.innerHeight*100,n=Math.max(10,Math.min(100,k.current+t));x(n)},onPointerUp:M,onPointerCancel:M,children:l.jsx("div",{className:"h-1 w-12 rounded-full bg-border-xheavy opacity-40 transition-all duration-200 active:opacity-60"})}),l.jsxs("div",{className:Qf("flex flex-shrink-0 items-center justify-between gap-2 border-b border-border-light bg-surface-primary-alt px-3 py-2 transition-all duration-300",a?"justify-center":"overflow-hidden"),children:[!a&&l.jsx("div",{className:Qf("flex items-center transition-all duration-500",o&&!c?"translate-x-0 opacity-100":"-translate-x-2 opacity-0"),children:l.jsx(Ho,{options:E,value:I,onChange:R,disabled:t&&"code"!==I})}),l.jsxs("div",{className:Qf("flex items-center gap-2 transition-all duration-500",a?"min-w-max":"",o&&!c?"translate-x-0 opacity-100":"translate-x-2 opacity-0"),children:["preview"===I&&l.jsx(Ys,{size:"icon",variant:"ghost",onClick:()=>{var e;m(!0);const t=null==(e=r.current)?void 0:e.getClient();t&&t.dispatch({type:"refresh"}),setTimeout((()=>m(!1)),750)},disabled:u,"aria-label":e("com_ui_refresh"),children:u?l.jsx(Xs,{size:16}):l.jsx(Ee,{size:16,className:"transition-transform duration-200","aria-hidden":"true"})}),"preview"!==I&&t&&l.jsx(Ee,{size:16,className:"animate-spin text-text-secondary"}),O.length>1&&l.jsx(VL,{currentIndex:A,totalVersions:O.length,onVersionChange:e=>{const t=O[e];t&&L(t)}}),l.jsx(qL,{content:P.content??""}),l.jsx(zL,{artifact:P}),l.jsx(Ys,{size:"icon",variant:"ghost",onClick:D,"aria-label":e("com_ui_close"),children:l.jsx(re,{size:16,"aria-hidden":"true"})})]})]}),l.jsxs("div",{className:"relative flex min-h-0 flex-1 flex-col overflow-hidden bg-surface-primary",children:[l.jsx("div",{className:"absolute inset-0 flex flex-col",children:l.jsx(KL,{artifact:P,editorRef:s,previewRef:r,isSharedConvo:n})}),l.jsx("div",{className:Qf("absolute inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm transition-opacity duration-300 ease-in-out",u?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!u,role:"status",children:l.jsx("div",{className:Qf("transition-transform duration-300 ease-in-out",u?"scale-100":"scale-95"),children:l.jsx(Xs,{size:24})})})]}),a&&l.jsx("div",{className:"flex-shrink-0 border-t border-border-light bg-surface-primary-alt p-2",children:l.jsx(Ho,{fullWidth:!0,options:E,value:I,onChange:R,disabled:t&&"code"!==I})})]})]})})}const JL="share:artifacts-panel-size",ZL="share:artifacts-panel-size-default",eM=()=>{if("undefined"==typeof window)return 40;const e=String(40);if(window.localStorage.getItem(ZL)!==e)return window.localStorage.setItem(ZL,e),window.localStorage.removeItem(JL),40;const t=window.localStorage.getItem(JL),n=Number(t);return Number.isFinite(n)?n:40};function tM({messages:e,conversationId:t,mainContent:n}){const a=j(N_.artifactsState),s=j(N_.artifactsVisibility),r=vr("(max-width: 1023px)"),[o,i]=ja(eM),c=Ca((()=>{const n=Array.isArray(e)&&e.length>0?e[e.length-1]:null;if(!n)return null;const a=lf(n);return{isSubmitting:!1,latestMessageId:n.messageId??null,latestMessageText:a,conversationId:t??null}}),[e,t]),d=!0===s&&null!=c&&Object.keys(a??{}).length>0,u=Math.min(60,Math.max(20,o));return d&&c?r?l.jsxs(l.Fragment,{children:[n,l.jsx(aM,{contextValue:c})]}):l.jsxs(No,{direction:"horizontal",className:"flex h-full w-full",onLayout:e=>{if(e.length<2)return;const t=e[1];Number.isFinite(t)&&(i(t),"undefined"!=typeof window&&window.localStorage.setItem(JL,t.toString()))},children:[l.jsx(mr,{defaultSize:100-u,minSize:35,order:1,id:"share-content",children:n}),l.jsx(ur,{withHandle:!0,className:"bg-border-medium text-text-primary"}),l.jsx(mr,{defaultSize:u,minSize:20,maxSize:60,order:2,id:"share-artifacts",children:l.jsx(nM,{contextValue:c})})]}):l.jsx(l.Fragment,{children:n})}function nM({contextValue:e}){return l.jsx(Yk,{value:e,children:l.jsx(vk,{children:l.jsx("div",{className:"flex h-full w-full border-l border-border-light bg-surface-primary shadow-2xl",children:l.jsx(XL,{})})})})}function aM({contextValue:e}){return l.jsx("div",{className:"fixed inset-y-0 right-0 z-40 flex w-full max-w-full sm:max-w-[420px]",role:"complementary","aria-label":"Artifacts panel",children:l.jsx(nM,{contextValue:e})})}function sM({messages:e,children:t}){const n=Ca((()=>({conversation:null,conversationId:void 0,ask:()=>Promise.resolve(),regenerate:()=>{},handleContinue:()=>{},latestMessage:e[e.length-1]??null,isSubmitting:!1,isSubmittingFamily:!1,abortScroll:!1,setAbortScroll:()=>{},index:0,setLatestMessage:()=>{},getMessages:()=>e,setMessages:()=>{}})),[e]);return l.jsx(sC.Provider,{value:n,children:t})}function rM({message:e,searchResults:t}){const n=qN(),[a,s]=ja(!1),r=gS({text:e.text,content:e.content,searchResults:t});return l.jsx("div",{className:"visible mt-1 flex justify-center gap-1 self-end text-gray-400 lg:justify-start",children:l.jsx("button",{className:"ml-0 flex items-center gap-1.5 rounded-lg p-1.5 text-xs text-text-secondary-alt transition-colors duration-200 hover:bg-surface-hover hover:text-text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white md:opacity-0 md:group-focus-within:opacity-100 md:group-hover:opacity-100",onClick:()=>r(s),type:"button",title:n(a?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),children:a?l.jsx(uo,{className:"h-[19px] w-[19px]"}):l.jsx(mo,{className:"h-[19px] w-[19px]"})})})}const oM={[Dm.MODERATION]:"com_error_moderation",[Dm.NO_USER_KEY]:"com_error_no_user_key",[Dm.INVALID_USER_KEY]:"com_error_invalid_user_key",[Dm.NO_BASE_URL]:"com_error_no_base_url",[Dm.INVALID_ACTION]:`com_error_${Dm.INVALID_ACTION}`,[Dm.INVALID_REQUEST]:`com_error_${Dm.INVALID_REQUEST}`,[Dm.REFUSAL]:"com_error_refusal",[Dm.MISSING_MODEL]:(e,t)=>{const{info:n}=e;return t("com_error_missing_model",{0:Sm[n??""]??n??"unknown"})},[Dm.MODELS_NOT_LOADED]:"com_error_models_not_loaded",[Dm.ENDPOINT_MODELS_NOT_LOADED]:(e,t)=>{const{info:n}=e;return t("com_error_endpoint_models_not_loaded",{0:Sm[n??""]??n??"unknown"})},[Dm.NO_SYSTEM_MESSAGES]:`com_error_${Dm.NO_SYSTEM_MESSAGES}`,[Dm.EXPIRED_USER_KEY]:(e,t)=>{const{expiredAt:n,endpoint:a}=e;return t("com_error_expired_user_key",{0:a,1:n})},[Dm.INPUT_LENGTH]:(e,t)=>{const{info:n}=e;return t("com_error_input_length",{0:n})},[Dm.INVALID_AGENT_PROVIDER]:(e,t)=>{const{info:n}=e;return t("com_error_invalid_agent_provider",{0:Sm[n]??n})},[Dm.GOOGLE_ERROR]:e=>{const{info:t}=e;return t},[Dm.GOOGLE_TOOL_CONFLICT]:"com_error_google_tool_conflict",[Mm.BAN]:"Your account has been temporarily banned due to violations of our service.",[Mm.ILLEGAL_MODEL_REQUEST]:(e,t)=>{const{info:n}=e,[a,s="unknown"]=(null==n?void 0:n.split("|"))??[];return t("com_error_illegal_model_request",{0:s,1:Sm[a??""]??a??"unknown"})},invalid_api_key:'Invalid API key. Please check your API key and try again. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',insufficient_quota:'We apologize for any inconvenience caused. The default API key has reached its limit. To continue using this service, please set up your own API key. You can do this by clicking on the model logo in the left corner of the textbox and selecting "Set Token" for the current selected endpoint. Thank you for your understanding.',concurrent:e=>{const{limit:t}=e;return`Only ${t} message${t>1?"s":""} at a time. Please allow any other responses to complete before sending another message, or wait one minute.`},message_limit:e=>{const{max:t,windowInMinutes:n}=e;return`You hit the message limit. You have a cap of ${t} message${t>1?"s":""} per ${n>1?`${n} minutes`:"minute"}.`},token_balance:e=>{const{balance:t,tokenCost:n,promptTokens:a,generations:s}=e,r=`Insufficient Funds! Balance: ${t}. Prompt tokens: ${a}. Cost: ${n}.`;return l.jsxs(l.Fragment,{children:[r,s&&l.jsxs(l.Fragment,{children:[l.jsx("br",{}),l.jsx("br",{})]}),s&&l.jsx(uP,{lang:"Generations",error:!0,codeChildren:hx(JSON.stringify(s))})]})}},iM=({text:e})=>{const t=qN(),n=function(e){let t=0,n=-1;for(let a=0;a<e.length;a++)if("{"===e[a])0===t&&(n=a),t++;else if("}"===e[a]&&(t--,0===t&&-1!==n))return e.slice(n,a+1);return""}(e),a=`Something went wrong. Here's the specific error message we encountered: ${e.length>512&&!n?e.slice(0,512)+"...":e}`;if(!px(n))return a;const s=JSON.parse(n),r=s.code||s.type,o=r&&oM[r];return o&&"function"==typeof oM[r]?oM[r](s,t):o&&o.startsWith("com_error")?t(oM[r]):o?oM[r]:a},lM=({text:e,message:t,isSubmitting:n,ask:a,enterEdit:s,siblingIdx:r,setSiblingIdx:o})=>{const{addedIndex:i}=gk(),c=ba(null),d=ba(null),{conversation:u}=iC(),{getMessages:m,setMessages:p}=lC(),[h,g]=b(N_.latestMessageFamily(i)),x=ba(null),{conversationId:f,parentMessageId:v,messageId:_}=t,y=function(e){var t=xs();return fs((function(e){return function(e){var t=e.conversationId,n=e.messageId,a=e.text;if(!t)throw new Error("conversationId is required");return sN.put(vj({conversationId:t,messageId:n}),{text:a})}(e)}),{onSuccess:function(){t.invalidateQueries([rN.messages,e])}})}(f??""),w=qN(),N="rtl"===j(N_.chatDirection).toLowerCase(),{register:k,handleSubmit:C,setValue:S}=Oi({defaultValues:{text:e??""}});ya((()=>{const e=x.current;if(e){const t=e.value.length;e.focus(),e.setSelectionRange(t,t)}}),[]);const T=ka((e=>{var t,n;"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(t=d.current)||t.click()),"s"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),null==(n=c.current)||n.click()),"Escape"===e.key&&(e.preventDefault(),s(!0))}),[s]),{ref:E,...I}=k("text",{required:!0,onChange:e=>{S("text",e.target.value,{shouldValidate:!0})}});return l.jsxs(iP,{message:t,children:[l.jsx("div",{className:"bg-token-main-surface-primary relative mt-2 flex w-full flex-grow flex-col overflow-hidden rounded-2xl border border-border-medium text-text-primary [&:has(textarea:focus)]:border-border-heavy [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",children:l.jsx(Br,{...I,ref:e=>{E(e),x.current=e},onKeyDown:T,"data-testid":"message-text-editor",className:Qf("markdown prose dark:prose-invert light whitespace-pre-wrap break-words pl-3 md:pl-4","m-0 w-full resize-none border-0 bg-transparent py-[10px]","placeholder-text-secondary focus:ring-0 focus-visible:ring-0 md:py-3.5",N?"text-right":"text-left","max-h-[65vh] pr-3 md:max-h-[75vh] md:pr-4",sv),"aria-label":w("com_ui_message_input"),dir:N?"rtl":"ltr"})}),l.jsxs("div",{className:"mt-2 flex w-full justify-center text-center",children:[l.jsx(pr,{description:"Ctrl + Enter /  + Enter",render:l.jsx("button",{ref:d,className:"btn btn-primary relative mr-2",disabled:n,onClick:C((e=>{if(t.isCreatedByUser)a({text:e.text,parentMessageId:v,conversationId:f},{overrideFiles:t.files}),o((r??0)-1);else{const t=m(),n=null==t?void 0:t.find((e=>e.messageId===v));if(!n)return;a({...n},{editedText:e.text,editedMessageId:_,isRegenerate:!0,isEdited:!0}),o((r??0)-1)}s(!0)})),children:w("com_ui_save_submit")})}),l.jsx(pr,{description:"Shift + Enter",render:l.jsx("button",{ref:c,className:"btn btn-secondary relative mr-2",disabled:n,onClick:C((e=>{const n=m();if(!n)return;y.mutate({conversationId:f??"",model:(null==u?void 0:u.model)??"gpt-3.5-turbo",text:e.text,messageId:_}),t.messageId===(null==h?void 0:h.messageId)&&g({...h,text:e.text});n.some((e=>e.messageId===_))?p(n.map((t=>t.messageId===_?{...t,text:e.text}:t))):t.text=e.text,s(!0)})),children:w("com_ui_save")})}),l.jsx(pr,{description:"Esc",render:l.jsx("button",{className:"btn btn-neutral relative",onClick:()=>s(!0),children:w("com_ui_cancel")})})]})]})},cM=()=>l.jsx("div",{className:"text-message mb-[0.625rem] flex min-h-[20px] flex-col items-start gap-3 overflow-visible",children:l.jsx("div",{className:"markdown prose dark:prose-invert light w-full break-words dark:text-gray-100",children:l.jsx("div",{className:"absolute",children:l.jsx("p",{className:"submitting relative",children:l.jsx("span",{className:"result-thinking"})})})})}),dM=({children:e,className:t=""})=>l.jsx("div",{role:"alert","aria-live":"assertive",className:Qf("rounded-xl border border-red-500/20 bg-red-500/5 px-3 py-2 text-sm text-gray-600 dark:text-gray-200",t),children:e}),uM=({message:e})=>{const t=qN();return l.jsx(Ia,{fallback:l.jsx(cM,{}),children:l.jsx(Go,{delay:5500,children:l.jsx(iP,{message:e,children:l.jsx("div",{className:"mt-2 rounded-xl border border-red-500/20 bg-red-50/50 px-4 py-3 text-sm text-red-700 shadow-sm transition-all dark:bg-red-950/30 dark:text-red-100",children:t("com_ui_error_connection")})})})})},mM=({text:e,message:t,className:n=""})=>"Error connecting to server, try refreshing the page."===e?l.jsx(uM,{message:t}):l.jsx(iP,{message:t,children:l.jsx(dM,{className:n,children:l.jsx(iM,{text:e})})}),pM=({text:e,isCreatedByUser:t,message:n,showCursor:a})=>{const{isSubmitting:s=!1,isLatestMessage:r=!1}=Ck(),o=j(N_.enableUserMsgMarkdown),i=Ca((()=>!0===a&&s),[a,s]),c=Ca((()=>t?o?l.jsx(fA,{content:e}):l.jsx(l.Fragment,{children:e}):l.jsx($A,{content:e,isLatestMessage:r})),[t,o,e,r]);return l.jsx(iP,{message:n,children:l.jsx("div",{className:Qf("markdown prose message-content dark:prose-invert light w-full break-words",s&&"submitting",i&&e.length>0&&"result-streaming",t&&!o&&"whitespace-pre-wrap",t?"dark:text-gray-20":"dark:text-gray-100"),children:c})})},hM=({message:e})=>l.jsx(mM,{message:e,text:"The response is incomplete; it's either still processing, was cancelled, or censored. Refresh or try a different prompt."}),gM=Sa((({text:e,edit:t,error:n,unfinished:a,isSubmitting:s,isLast:r,...o})=>{const{message:i}=o,{messageId:c}=i,{thinkingContent:d,regularContent:u}=Ca((()=>(e=>{const t=e.match(/:::thinking([\s\S]*?):::/);return{thinkingContent:t?t[1].trim():"",regularContent:t?e.replace(/:::thinking[\s\S]*?:::/,"").trim():e}})(e)),[e]),m=Ca((()=>r&&s),[r,s]),p=Ca((()=>!s&&a?l.jsx(Ia,{children:l.jsx(Go,{delay:250,children:l.jsx(hM,{message:i})})}):null),[s,a,i]);return n?l.jsx(mM,{message:i,text:e}):t?l.jsx(lM,{text:e,isSubmitting:s,...o}):l.jsxs(l.Fragment,{children:[d.length>0&&l.jsx(qA,{children:d},`thinking-${c}`),l.jsx(pM,{showCursor:m,text:u,...o},`display-${c}`),p]})}));class xM extends Ra{constructor(){super(...arguments),t(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){var n,a;console.error("Sources error:",e),null==(a=(n=this.props).onError)||a.call(n,e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:l.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-border-medium bg-surface-secondary p-4 text-center",role:"alert","aria-live":"polite",children:[l.jsx("div",{className:"mb-2 text-sm text-text-secondary",children:"Sources temporarily unavailable"}),l.jsx("button",{onClick:()=>window.location.reload(),className:"hover:bg-surface-primary-hover rounded-md bg-surface-primary px-3 py-1 text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":"Reload the page",children:"Refresh"})]}):this.props.children}}function fM({source:e,expanded:t=!1}){const n=qN(),a=_A(e.link);return t?l.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(bA,{domain:a}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),l.jsxs("div",{className:"mt-1",children:[l.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link}),"snippet"in e&&e.snippet&&l.jsx("span",{className:"mt-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet})]})]}):l.jsx("span",{className:"not-prose relative inline-block h-full w-full",children:l.jsx(ot,{showTimeout:150,hideTimeout:150,children:l.jsxs("div",{className:"flex h-full items-center",children:[l.jsx(it,{render:l.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex h-full w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(bA,{domain:a}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:a})]}),l.jsx("div",{className:"mt-1",children:l.jsx("span",{className:"line-clamp-2 text-sm font-medium text-text-primary md:line-clamp-3",children:e.title||e.link})})]})}),l.jsxs(lt,{className:"absolute right-2 rounded-full text-text-primary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(ct,{children:n("com_citation_more_details",{label:a})}),l.jsx(he,{className:"icon-sm","aria-hidden":"true"})]}),l.jsx(dt,{gutter:16,className:"dark:shadow-lg-dark z-[999] w-[300px] max-w-[calc(100vw-2rem)] rounded-xl border border-border-medium bg-surface-secondary p-3 text-text-primary shadow-lg",portal:!0,unmountOnHide:!0,children:l.jsxs("div",{className:"flex gap-3",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"mb-2 flex items-center",children:[l.jsx(bA,{domain:a,className:"mr-2"}),l.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"line-clamp-2 cursor-pointer overflow-hidden text-sm font-bold text-[#0066cc] hover:underline dark:text-blue-400 md:line-clamp-3",children:e.attribution||a})]}),l.jsx("h4",{className:"mb-1.5 mt-0 text-xs text-text-primary md:text-sm",children:e.title||e.link}),"snippet"in e&&e.snippet&&l.jsx("span",{className:"my-2 text-ellipsis break-all text-xs text-text-secondary md:text-sm",children:e.snippet})]}),"imageUrl"in e&&e.imageUrl&&l.jsx("div",{className:"h-24 w-24 flex-shrink-0 overflow-hidden rounded-md",children:l.jsx("img",{src:e.imageUrl,alt:e.title||n("com_sources_image_alt"),className:"h-full w-full object-cover"})})]})})]})})})}function vM({image:e}){const t=qN();return l.jsx("a",{href:e.imageUrl,target:"_blank",rel:"noopener noreferrer",className:"group overflow-hidden rounded-lg bg-surface-secondary transition-all duration-300 hover:bg-surface-tertiary",children:e.imageUrl&&l.jsxs("div",{className:"relative aspect-square w-full overflow-hidden",children:[l.jsx("img",{src:e.imageUrl,alt:e.title||t("com_sources_image_alt"),className:"size-full object-cover"}),e.title&&l.jsx("div",{className:"absolute bottom-0 left-0 right-0 w-full border-none bg-gray-900/80 p-1 text-xs font-medium text-white backdrop-blur-sm",children:l.jsx("span",{className:"truncate",children:e.title})})]})})}function _M(e,t){return t&&0!==Object.keys(t).length?[...e].sort(((e,n)=>{const a=t[e]||0;return(t[n]||0)-a})):e}const bM=_a.memo((function({file:e,messageId:t,conversationId:n,expanded:a=!1}){var s;const r=qN(),o=j(N_.user),{showToast:i}=Ds(),{refetch:c}=X_((null==o?void 0:o.id)??"",e.file_id);ka((e=>{var t,n,a,s,o;const i=JSON.stringify(e),l=e,c=(null==(t=null==e?void 0:e.message)?void 0:t.includes("local files"))||(null==(s=null==(a=null==(n=null==l?void 0:l.response)?void 0:n.data)?void 0:a.error)?void 0:s.includes("local files"))||403===(null==(o=null==l?void 0:l.response)?void 0:o.status)||i.includes("local files")||i.includes("403");return r(c?"com_sources_download_local_unavailable":"com_sources_download_failed")}),[r]);const d="local"===(null==(s=e.metadata)?void 0:s.storageType),u=ka((async t=>{if(t.preventDefault(),t.stopPropagation(),!d)try{const t=await c();if(null==t.data||""===t.data)return console.error("Error downloading file: No data found"),void i({status:"error",message:r("com_ui_download_error")});const n=document.createElement("a");n.href=t.data,n.setAttribute("download",e.filename),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t.data)}catch(n){console.error("Error downloading file:",n)}}),[c,e.filename,d,r,i]),m=Ca((()=>{var t;const n=(null==(t=e.type)?void 0:t.toLowerCase())||"";return n.includes("pdf")?"":n.includes("image")?"":n.includes("text")?"":n.includes("word")||n.includes("doc")?"":n.includes("excel")||n.includes("sheet")?"":n.includes("powerpoint")||n.includes("presentation")?"":""}),[e.type]),p=r("com_sources_download_aria_label",{filename:e.filename,status:""});return a?l.jsxs("button",{onClick:d?void 0:u,disabled:false,className:"flex w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 disabled:opacity-50 "+(d?"cursor-default":"hover:bg-surface-tertiary"),"aria-label":d?r("com_sources_download_local_unavailable"):p,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-base",children:m}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:r("com_sources_agent_file")}),!d&&l.jsx(Qt,{className:"ml-auto h-3 w-3","aria-hidden":"true"})]}),l.jsxs("div",{className:"mt-1 min-w-0",children:[l.jsx("span",{className:"line-clamp-2 break-all text-left text-sm font-medium text-text-primary md:line-clamp-3",children:e.filename}),e.pages&&e.pages.length>0&&l.jsxs("span",{className:"mt-1 line-clamp-1 text-left text-xs text-text-secondary",children:[r("com_sources_pages"),":"," ",_M(e.pages,e.pageRelevance).join(", ")]}),e.bytes&&l.jsxs("span",{className:"mt-1 line-clamp-1 text-xs text-text-secondary",children:[(e.bytes/1024).toFixed(1)," KB"]})]}),null]}):l.jsxs("button",{onClick:d?void 0:u,disabled:false,className:"flex h-full w-full flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 disabled:opacity-50 "+(d?"cursor-default":"hover:bg-surface-tertiary"),"aria-label":d?r("com_sources_download_local_unavailable"):p,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-base",children:m}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:r("com_sources_agent_file")}),!d&&l.jsx(Qt,{className:"ml-auto h-3 w-3","aria-hidden":"true"})]}),l.jsxs("div",{className:"mt-1 min-w-0",children:[l.jsx("span",{className:"line-clamp-2 break-all text-left text-sm font-medium text-text-primary md:line-clamp-3",children:e.filename}),e.pages&&e.pages.length>0&&l.jsxs("span",{className:"mt-1 line-clamp-1 text-left text-xs text-text-secondary",children:[r("com_sources_pages"),":"," ",_M(e.pages,e.pageRelevance).join(", ")]})]}),null]})}));function yM({sources:e,start:t=0,end:n=3}){let a=[t,n];return t<0&&(a=[t]),l.jsx("div",{className:"relative flex",children:e.slice(...a).map(((e,t)=>l.jsx(bA,{domain:_A(e.link),className:t>0?"ml-[-6px]":""},`icon-${t}`)))})}const jM=_a.memo((function({sources:e,limit:t=3}){const n=qN(),{visibleSources:a,remainingSources:s,hasMoreSources:r}=Ca((()=>{const n=e.slice(0,t),a=e.slice(t);return{visibleSources:n,remainingSources:a,hasMoreSources:a.length>0}}),[e,t]);return l.jsx("div",{className:"scrollbar-none grid w-full grid-cols-4 gap-2 overflow-x-auto",children:l.jsxs(rr,{children:[a.map(((e,t)=>l.jsx("div",{className:"w-full min-w-[120px]",children:l.jsx(fM,{source:e})},`source-${t}`))),r&&l.jsx(or,{className:"flex flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(yM,{sources:s}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:n("com_sources_more_sources",{count:s.length})})]})}),l.jsxs(ir,{className:"flex max-h-[80vh] max-w-full flex-col overflow-hidden rounded-lg bg-surface-primary p-0 md:max-w-[600px]",children:[l.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border-light bg-surface-primary px-3 py-2",children:[l.jsx(lr,{className:"text-base font-medium",children:n("com_sources_title")}),l.jsx(_r,{className:"rounded-full p-1 text-text-secondary hover:bg-surface-tertiary hover:text-text-primary","aria-label":n("com_ui_close"),children:l.jsx(re,{className:"h-4 w-4","aria-hidden":"true"})})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2",children:l.jsx("div",{className:"flex flex-col gap-2",children:[...a,...s].map(((e,t)=>l.jsxs("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"flex gap-2 rounded-lg px-2 py-2 transition-colors hover:bg-surface-tertiary",children:[l.jsx(bA,{domain:_A(e.link),className:"h-5 w-5 flex-shrink-0"}),l.jsxs("div",{className:"min-w-0 flex-1",children:[l.jsx("h3",{className:"mb-0.5 truncate text-sm font-medium text-text-primary",children:e.title||e.link}),"snippet"in e&&e.snippet&&l.jsx("p",{className:"mb-1 line-clamp-2 text-xs text-text-secondary md:line-clamp-3",children:e.snippet}),l.jsx("span",{className:"text-xs text-text-secondary-alt",children:_A(e.link)})]}),"imageUrl"in e&&e.imageUrl&&l.jsx("div",{className:"hidden h-12 w-12 flex-shrink-0 overflow-hidden rounded-md sm:block",children:l.jsx("img",{src:e.imageUrl,alt:e.title||n("com_sources_image_alt"),className:"h-full w-full object-cover"})})]},`more-source-${t}`)))})})]})]})})}));function wM({files:e,messageId:t,conversationId:n,limit:a=3}){const s=qN(),r=e.length<=a+1?e.length:a,o=e.slice(0,r),i=e.slice(r),c=i.length>0;return l.jsx("div",{className:"scrollbar-none grid w-full grid-cols-4 gap-2 overflow-x-auto",children:l.jsxs(rr,{children:[o.map(((e,a)=>l.jsx("div",{className:"w-full min-w-[120px]",children:l.jsx(bM,{file:e,messageId:t,conversationId:n})},`file-${a}`))),c&&l.jsx(or,{className:"flex flex-col rounded-lg bg-surface-primary-contrast px-3 py-2 text-sm transition-all duration-300 hover:bg-surface-tertiary",children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"relative flex",children:i.slice(0,3).map(((e,t)=>l.jsx(tn,{className:"h-4 w-4 "+(t>0?"ml-[-6px]":"")},`file-icon-${t}`)))}),l.jsx("span",{className:"truncate text-xs font-medium text-text-secondary",children:s("com_sources_more_files",{count:i.length})})]})}),l.jsxs(ir,{className:"flex max-h-[80vh] max-w-full flex-col overflow-hidden rounded-lg bg-surface-primary p-0 md:max-w-[600px]",children:[l.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-border-light bg-surface-primary px-3 py-2",children:[l.jsx(lr,{className:"text-base font-medium",children:s("com_sources_agent_files")}),l.jsx(_r,{className:"rounded-full p-1 text-text-secondary hover:bg-surface-tertiary hover:text-text-primary","aria-label":s("com_ui_close"),children:l.jsx(re,{className:"h-4 w-4","aria-hidden":"true"})})]}),l.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2",children:l.jsx("div",{className:"flex flex-col gap-2",children:[...o,...i].map(((e,a)=>l.jsx(bM,{file:e,messageId:t,conversationId:n,expanded:!0},`more-file-${a}`)))})})]})]})})}function NM({label:e,icon:t}){return l.jsxs("div",{className:"flex items-center gap-2 rounded-md px-3 py-1 text-sm transition-colors hover:bg-surface-tertiary hover:text-text-primary",children:[_a.cloneElement(t,{size:14,"aria-hidden":!0}),l.jsx("span",{children:e})]})}function kM({messageId:e,conversationId:t}={}){const n=qN(),{searchResults:a}=Vk(),{organicSources:s,topStories:r,images:o,hasAnswerBox:i,agentFiles:c}=Ca((()=>{var t,n,s,r;const o=new Map,i=new Map,l=new Map,c=new Map;let d=!1;if(!a)return{organicSources:[],topStories:[],images:[],hasAnswerBox:!1,agentFiles:[]};for(const u of Object.values(a))u&&(null==(t=u.organic)||t.forEach((e=>{e.link&&o.set(e.link,e)})),null==(n=u.references)||n.forEach((t=>{if("image"===t.type)l.set(t.link,{...t,imageUrl:t.link});else if("file"===t.type){const n=t.fileId||"unknown",a=t.title||"Unknown File",s=`${n}_${a}`;if(c.has(s)){const e=c.get(s),n=e.pages||[],a=t.pages||[],r=[...new Set([...n,...a])].sort(((e,t)=>e-t));e.pages=r,e.relevance=Math.max(e.relevance||0,t.relevance||0),e.pageRelevance={...e.pageRelevance,...t.pageRelevance}}else{const r={type:Nl.file_search,file_id:n,filename:a,bytes:void 0,metadata:t.metadata,pages:t.pages,relevance:t.relevance,pageRelevance:t.pageRelevance,messageId:e||"",toolCallId:"file_search_results"};c.set(s,r)}}else t.link&&o.set(t.link,t)})),null==(s=u.topStories)||s.forEach((e=>{e.link&&i.set(e.link,e)})),null==(r=u.images)||r.forEach((e=>{e.imageUrl&&l.set(e.imageUrl,e)})),u.answerBox&&(d=!0));return{organicSources:Array.from(o.values()),topStories:Array.from(i.values()),images:Array.from(l.values()),hasAnswerBox:d,agentFiles:Array.from(c.values())}}),[a,e]),d=Ca((()=>{const a=[];return(s.length||r.length||i)&&a.push({label:l.jsx(NM,{label:n("com_sources_tab_all"),icon:l.jsx(ge,{})}),content:l.jsx(jM,{sources:[...s,...r]})}),r.length&&a.push({label:l.jsx(NM,{label:n("com_sources_tab_news"),icon:l.jsx(Zt,{})}),content:l.jsx(jM,{sources:r,limit:3})}),o.length&&a.push({label:l.jsx(NM,{label:n("com_sources_tab_images"),icon:l.jsx(en,{})}),content:l.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:o.map(((e,t)=>l.jsx(vM,{image:e},`image-${t}`)))})}),c.length&&e&&t&&a.push({label:l.jsx(NM,{label:n("com_sources_tab_files"),icon:l.jsx(tn,{})}),content:l.jsx(wM,{files:c,messageId:e,conversationId:t,limit:3})}),a}),[s,r,o,i,c,e,t,n]);return d.length?l.jsx("div",{role:"region","aria-label":n("com_sources_region_label"),children:l.jsx(Ko,{tabs:d,containerClassName:"flex min-w-full mb-4",tabListClassName:"flex items-center mb-2 border-b border-border-light overflow-x-auto",tabPanelClassName:"w-full overflow-x-auto scrollbar-none md:mx-0 md:px-0",tabClassName:"flex items-center whitespace-nowrap text-xs font-medium text-token-text-secondary px-1 pt-2 pb-1 border-b-2 border-transparent data-[state=active]:text-text-primary outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"})}):null}function CM(e){const t=qN(),n=l.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-border-medium bg-surface-secondary p-4 text-center",role:"alert","aria-live":"polite",children:[l.jsx("div",{className:"mb-2 text-sm text-text-secondary",children:t("com_sources_error_fallback")}),l.jsx("button",{onClick:()=>window.location.reload(),className:"hover:bg-surface-primary-hover rounded-md bg-surface-primary px-3 py-1 text-sm text-text-primary focus:outline-none focus:ring-2 focus:ring-ring","aria-label":t("com_sources_reload_page"),children:t("com_ui_refresh")})]});return l.jsx(xM,{onError:(e,t)=>{console.error("Sources component error:",{error:e,errorInfo:t})},fallback:n,showDetails:!1,children:l.jsx(kM,{...e})})}function SM({radius:e,circumference:t,offset:n}){return l.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",children:[l.jsx("circle",{className:"stroke-brand-purple/25 dark:stroke-brand-purple/50 origin-[50%_50%] -rotate-90",strokeWidth:"7.826086956521739",fill:"transparent",r:e,cx:"60",cy:"60"}),l.jsx("circle",{className:"origin-[50%_50%] -rotate-90 transition-[stroke-dashoffset]",stroke:"currentColor",strokeWidth:"7.826086956521739",strokeDasharray:`${t} ${t}`,strokeDashoffset:n,fill:"transparent",r:e,cx:"60",cy:"60"})]})}function TM({error:e,isSubmitting:t,progress:n,children:a}){return!t&&n<1||!0===e?l.jsx(JA,{}):l.jsx(l.Fragment,{children:a})}function EM(){return l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[l.jsxs("defs",{children:[l.jsx("clipPath",{id:"__lottie_element_258",children:l.jsx("rect",{width:"20",height:"20",x:"0",y:"0"})}),l.jsx("clipPath",{id:"__lottie_element_263",children:l.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})}),l.jsx("clipPath",{id:"__lottie_element_270",children:l.jsx("path",{d:"M0,0 L20000,0 L20000,20000 L0,20000z"})})]}),l.jsx("g",{clipPath:"url(#__lottie_element_258)",children:l.jsxs("g",{clipPath:"url(#__lottie_element_263)",style:{display:"block"},transform:"matrix(0.9999999403953552,0,0,0.9999999403953552,-10000,-10000)",opacity:"1",children:[l.jsxs("g",{clipPath:"url(#__lottie_element_270)",style:{display:"block"},transform:"matrix(0.9999988675117493,0,0,0.9999988675117493,10.01171875,10.01171875)",opacity:"1",children:[l.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,-2.125)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357900083065033 0.3357900083065033,8.881784197001252e-16 0.75,8.881784197001252e-16 C2.4166667461395264,8.881784197001252e-16 4.083333492279053,8.881784197001252e-16 5.75,8.881784197001252e-16 C6.1641998291015625,8.881784197001252e-16 6.5,0.3357900083065033 6.5,0.75 C6.5,1.1642099618911743 6.1641998291015625,1.5 5.75,1.5 C4.083333492279053,1.5 2.4166667461395264,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.1642099618911743 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})}),l.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-3.25,0.625)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M0,0.75 C0,0.3357999920845032 0.3357900083065033,0 0.75,0 C1.9166666269302368,0 3.0833332538604736,0 4.25,0 C4.6641998291015625,0 5,0.3357999920845032 5,0.75 C5,1.164199948310852 4.6641998291015625,1.5 4.25,1.5 C3.0833332538604736,1.5 1.9166666269302368,1.5 0.75,1.5 C0.3357900083065033,1.5 0,1.164199948310852 0,0.75 C0,0.75 0,0.75 0,0.75 C0,0.75 0,0.75 0,0.75"})})})]}),l.jsx("g",{style:{display:"block"},transform:"matrix(1,0,0,1,10000,10000)",opacity:"1",children:l.jsxs("g",{opacity:"1",transform:"matrix(1,0,0,1,10,10)",children:[l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:" M-3.13,-5.25 C-3.09,-5.25 -3.04,-5.25 -3,-5.25 C-2.59,-5.25 -2.25,-4.91 -2.25,-4.5 C-2.25,-4.09 -2.59,-3.75 -3,-3.75 C-3.03,-3.75 -3.07,-3.75 -3.1,-3.75 C-3.53,-3.75 -3.81,-3.75 -4.02,-3.73 C-4.23,-3.72 -4.3,-3.69 -4.34,-3.67 C-4.48,-3.6 -4.6,-3.48 -4.67,-3.34 C-4.69,-3.3 -4.72,-3.23 -4.73,-3.02 C-4.75,-2.81 -4.75,-2.53 -4.75,-2.1 C-4.75,-2.07 -4.75,-2.03 -4.75,-2 C-4.75,-1.59 -5.09,-1.25 -5.5,-1.25 C-5.91,-1.25 -6.25,-1.59 -6.25,-2 C-6.25,-2.04 -6.25,-2.09 -6.25,-2.13 C-6.25,-2.52 -6.25,-2.87 -6.23,-3.15 C-6.2,-3.44 -6.15,-3.74 -6,-4.02 C-5.79,-4.44 -5.44,-4.79 -5.02,-5 C-4.74,-5.15 -4.44,-5.2 -4.15,-5.23 C-3.87,-5.25 -3.52,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 C-3.13,-5.25 -3.13,-5.25 -3.13,-5.25 M6.25,-2.13 C6.25,-2.09 6.25,-2.04 6.25,-2 C6.25,-1.59 5.91,-1.25 5.5,-1.25 C5.09,-1.25 4.75,-1.59 4.75,-2 C4.75,-2.03 4.75,-2.07 4.75,-2.1 C4.75,-2.53 4.75,-2.81 4.73,-3.02 C4.72,-3.23 4.69,-3.3 4.67,-3.34 C4.6,-3.48 4.48,-3.6 4.34,-3.67 C4.3,-3.69 4.23,-3.72 4.02,-3.73 C3.81,-3.75 3.53,-3.75 3.1,-3.75 C3.07,-3.75 3.03,-3.75 3,-3.75 C2.59,-3.75 2.25,-4.09 2.25,-4.5 C2.25,-4.91 2.59,-5.25 3,-5.25 C3.04,-5.25 3.09,-5.25 3.13,-5.25 C3.52,-5.25 3.87,-5.25 4.15,-5.23 C4.44,-5.2 4.74,-5.15 5.02,-5 C5.44,-4.79 5.79,-4.44 6,-4.02 C6.15,-3.74 6.2,-3.44 6.23,-3.15 C6.25,-2.87 6.25,-2.52 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 C6.25,-2.13 6.25,-2.13 6.25,-2.13 M-3.13,5.25 C-3.09,5.25 -3.04,5.25 -3,5.25 C-2.59,5.25 -2.25,4.91 -2.25,4.5 C-2.25,4.09 -2.59,3.75 -3,3.75 C-3.03,3.75 -3.07,3.75 -3.1,3.75 C-3.53,3.75 -3.81,3.75 -4.02,3.73 C-4.23,3.72 -4.3,3.69 -4.34,3.67 C-4.48,3.6 -4.6,3.48 -4.67,3.34 C-4.69,3.3 -4.72,3.23 -4.73,3.02 C-4.75,2.81 -4.75,2.53 -4.75,2.1 C-4.75,2.07 -4.75,2.03 -4.75,2 C-4.75,1.59 -5.09,1.25 -5.5,1.25 C-5.91,1.25 -6.25,1.59 -6.25,2 C-6.25,2.04 -6.25,2.09 -6.25,2.13 C-6.25,2.52 -6.25,2.87 -6.23,3.15 C-6.2,3.44 -6.15,3.74 -6,4.02 C-5.79,4.44 -5.44,4.79 -5.02,5 C-4.74,5.15 -4.44,5.2 -4.15,5.23 C-3.87,5.25 -3.52,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 C-3.13,5.25 -3.13,5.25 -3.13,5.25 M6.25,2.13 C6.25,2.09 6.25,2.04 6.25,2 C6.25,1.59 5.91,1.25 5.5,1.25 C5.09,1.25 4.75,1.59 4.75,2 C4.75,2.03 4.75,2.07 4.75,2.1 C4.75,2.53 4.75,2.81 4.73,3.02 C4.72,3.23 4.69,3.3 4.67,3.34 C4.6,3.48 4.48,3.6 4.34,3.67 C4.3,3.69 4.23,3.72 4.02,3.73 C3.81,3.75 3.53,3.75 3.1,3.75 C3.07,3.75 3.03,3.75 3,3.75 C2.59,3.75 2.25,4.09 2.25,4.5 C2.25,4.91 2.59,5.25 3,5.25 C3.04,5.25 3.09,5.25 3.13,5.25 C3.52,5.25 3.87,5.25 4.15,5.23 C4.44,5.2 4.74,5.15 5.02,5 C5.44,4.79 5.79,4.44 6,4.02 C6.15,3.74 6.2,3.44 6.23,3.15 C6.25,2.87 6.25,2.52 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13 C6.25,2.13 6.25,2.13 6.25,2.13"}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,-5.250000476837158)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,-5.250000476837158)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,-6.250000476837158,1.25)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})}),l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,2.25,1.25)",children:l.jsx("path",{fill:"rgb(177,97,253)",fillOpacity:"1",d:"M0 0"})})]})})]})})]})}function IM({initialProgress:e=.1,isSubmitting:t}){const n=rS(e),a=56.08695652173913,s=2*Math.PI*a,r=s-n*s,o=n>=2;return l.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[l.jsx("div",{className:"relative h-5 w-5 shrink-0",children:n<1?l.jsx(TM,{progress:n,isSubmitting:t,error:o,children:l.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},children:[l.jsx("div",{children:l.jsx(EM,{})}),l.jsx(SM,{radius:a,circumference:s,offset:r})]})}):o?l.jsx(JA,{}):l.jsx(ZA,{})}),l.jsx(nP,{progress:n,onClick:()=>({}),inProgressText:"Searching my knowledge",finishedText:"Used Retrieval",hasInput:!1,popover:!1})]})}const RM=({name:e,args:t=""})=>{const n=qN(),a=WN(),[s,r]=ja(!1),o=Ca((()=>"string"==typeof e&&e.startsWith(Bm.LC_TRANSFER_TO_)?e.replace(Bm.LC_TRANSFER_TO_,""):null),[e]),i=Ca((()=>o&&a?a[o]:null),[a,o]),c=Ca((()=>{if("string"==typeof t)return t;try{return JSON.stringify(t,null,2)}catch{return""}}),[t]),d=Ca((()=>{var e;return((null==(e=null==c?void 0:c.trim())?void 0:e.length)??0)>2}),[c]);return l.jsxs("div",{className:"my-3",children:[l.jsxs("div",{className:Qf("flex items-center gap-2.5 text-sm text-text-secondary",d&&"cursor-pointer transition-colors hover:text-text-primary"),onClick:()=>d&&r(!s),children:[l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(OE,{message:{endpoint:Yl.agents,isCreatedByUser:!1},agent:i||void 0})}),l.jsx("span",{className:"select-none",children:n("com_ui_transferred_to")}),l.jsx("span",{className:"select-none font-medium text-text-primary",children:(null==i?void 0:i.name)||n("com_ui_agent")}),d&&l.jsx(he,{className:Qf("ml-1 h-3 w-3 transition-transform",s&&"rotate-180"),"aria-hidden":"true"})]}),d&&s&&l.jsxs("div",{className:"ml-8 mt-2 rounded-md bg-surface-secondary p-3 text-xs",children:[l.jsxs("div",{className:"mb-1 font-medium text-text-secondary",children:[n("com_ui_handoff_instructions"),":"]}),l.jsx("pre",{className:"overflow-x-auto whitespace-pre-wrap text-text-primary",children:c})]})]})};function AM({initialProgress:e=.1,code:t,outputs:n=[]}){const a=qN(),s=rS(e),r=j(N_.showCode),[o,i]=ja(r),c=n.reduce(((e,t)=>t.logs?e+t.logs+"\n":e),"");return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"my-2.5 flex items-center gap-2.5",children:l.jsx(nP,{progress:s,onClick:()=>i((e=>!e)),inProgressText:a("com_ui_analyzing"),finishedText:a("com_ui_analyzing_finished"),hasInput:!!t.length,isExpanded:o})}),o&&l.jsxs("div",{className:"code-analyze-block mb-3 mt-0.5 overflow-hidden rounded-xl bg-black",children:[l.jsx(fA,{content:t?`\`\`\`python\n${t}\n\`\`\``:""}),c&&l.jsxs("div",{className:"bg-gray-700 p-4 text-xs",children:[l.jsx("div",{className:"mb-1 text-gray-400",children:a("com_ui_result")}),l.jsx("div",{className:"prose flex flex-col-reverse text-white",style:{color:"white"},children:l.jsx("pre",{className:"shrink-0",children:c})})]})]})]})}function PM({initialProgress:e=.1,isSubmitting:t,isLast:n,output:a}){const s=qN(),{searchResults:r}=Vk(),o="string"==typeof a&&a.toLowerCase().includes("error processing"),i=!t&&e<1||!0===o,c=!n&&1===e,d=t&&n&&1===e,u=Ca((()=>{if(c&&!d)return[];if(!r)return[];const e=Object.values(r),t=e[e.length-1];return t?d?[...t.organic||[],...t.topStories||[]]:[...t.organic||[],...t.topStories||[]].filter((e=>!0===e.processed)):[]}),[r,c,d]),m=Ca((()=>r?Object.values(r).length:0),[r]),p=Ca((()=>Math.min(e,.99)),[e]),h=u.length>0,g=Ca((()=>{let e=m>1?"com_ui_web_searching_again":"com_ui_web_searching";return h&&(e="com_ui_web_search_processing"),d&&(e="com_ui_web_search_reading"),s(e)}),[m,s,h,d]);return c||i?null:l.jsx(l.Fragment,{children:l.jsxs("div",{className:"relative my-2.5 flex size-5 shrink-0 items-center gap-2.5",children:[h&&l.jsx("div",{className:"mr-2",children:l.jsx(yM,{sources:u,start:-5})}),l.jsx(nP,{finishedText:"",hasInput:!1,error:i,isExpanded:!1,progress:p,inProgressText:g})]})})}function OM({text:e,maxHeight:t=320}){return l.jsx("div",{className:"rounded-lg bg-surface-tertiary p-2 text-xs text-text-primary",style:{position:"relative",maxHeight:t,overflow:"auto"},children:l.jsx("pre",{className:"m-0 whitespace-pre-wrap break-words",style:{overflowWrap:"break-word"},children:l.jsx("code",{children:e})})})}function LM({input:e,output:t,domain:n,function_name:a,pendingAuth:s,attachments:r}){const o=qN(),i=e=>{try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}};let c=null!=n&&n?o("com_assistants_domain_info",{0:n}):o("com_assistants_function_use",{0:a});!0===s&&(c=null!=n&&n?o("com_assistants_action_attempt",{0:n}):o("com_assistants_attempt_info"));const d=(null==r?void 0:r.filter((e=>e.type===Nl.ui_resources)).flatMap((e=>e[Nl.ui_resources])))??[];return l.jsx("div",{className:"w-full p-2",children:l.jsxs("div",{style:{opacity:1},children:[l.jsx("div",{className:"mb-2 text-sm font-medium text-text-primary",children:c}),l.jsx("div",{children:l.jsx(OM,{text:i(e),maxHeight:250})}),t&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"my-2 text-sm font-medium text-text-primary",children:o("com_ui_result")}),l.jsx("div",{children:l.jsx(OM,{text:i(t),maxHeight:250})}),d.length>0&&l.jsx("div",{className:"my-2 text-sm font-medium text-text-primary",children:o("com_ui_ui_resources")}),l.jsxs("div",{children:[d.length>1&&l.jsx(RA,{uiResources:d}),1===d.length&&l.jsx(pt,{resource:d[0],onUIAction:async e=>{console.log("Action:",e)},htmlProps:{autoResizeIframe:{width:!0,height:!0}}})]})]})]})})}function MM({initialProgress:e=.1,isLast:t=!1,isSubmitting:n,name:a,args:s="",output:r,attachments:o,auth:i}){const c=qN(),[d,u]=ja(!1),m=ba(null),[p,h]=ja(0),[g,x]=ja(!1),f=ba(d),{function_name:v,domain:_,isMCPToolCall:b}=Ca((()=>{if("string"!=typeof a)return{function_name:"",domain:null,isMCPToolCall:!1};if(a.includes(Bm.mcp_delimiter)){const[e,t]=a.split(Bm.mcp_delimiter);return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!0}}const[e,t]=a.includes(Ll)?a.split(Ll):[a,""];return{function_name:e||"",domain:t&&(t.replaceAll("---",".")||null),isMCPToolCall:!1}}),[a]),y="string"==typeof r&&r.toLowerCase().includes("error processing tool"),j=Ca((()=>{if("string"==typeof s)return s;try{return JSON.stringify(s,null,2)}catch(e){return cx.error("client/src/components/Chat/Messages/Content/ToolCall.tsx - Failed to stringify args",e),""}}),[s]),w=Ca((()=>((null==j?void 0:j.length)??0)>0||((null==r?void 0:r.length)??0)>0),[j,r]),N=Ca((()=>{const e=i??"";if(!e)return"";try{return new URL(e).hostname}catch(t){return cx.error("client/src/components/Chat/Messages/Content/ToolCall.tsx - Failed to parse auth URL",t),""}}),[i]),k=rS(e),C=!n&&k<1||!0===y;return Aa((()=>{if(d!==f.current){f.current=d,x(!0),d&&m.current?requestAnimationFrame((()=>{if(m.current){const e=m.current.scrollHeight;h(e+4)}})):h(0);const e=setTimeout((()=>{x(!1)}),400);return()=>clearTimeout(e)}}),[d]),ya((()=>{if(!m.current)return;const e=new ResizeObserver((e=>{if(d&&!g)for(const t of e)t.target===m.current&&h(t.contentRect.height+4)}));return e.observe(m.current),()=>{e.disconnect()}}),[d,g]),t||v&&0!==v.length||r?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"relative my-2.5 flex h-5 shrink-0 items-center gap-2.5",children:l.jsx(nP,{progress:k,onClick:()=>u((e=>!e)),inProgressText:v?c("com_assistants_running_var",{0:v}):c("com_assistants_running_action"),authText:!C&&N.length>0?c("com_ui_requires_auth"):void 0,finishedText:C?c("com_ui_cancelled"):!0===b?c("com_assistants_completed_function",{0:v}):null!=_&&_&&_.length!==Bm.ENCODED_DOMAIN_LENGTH?c("com_assistants_completed_action",{0:_}):c("com_assistants_completed_function",{0:v}),hasInput:w,isExpanded:d,error:C})}),l.jsx("div",{className:"relative",style:{height:d?p:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:d?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx("div",{className:Qf("overflow-hidden rounded-xl border border-border-light bg-surface-secondary shadow-md",d&&"shadow-lg"),style:{transform:d?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:d?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:l.jsx("div",{ref:m,children:d&&w&&l.jsx(LM,{input:j??"",output:r,domain:N||(_??""),function_name:v,pendingAuth:N.length>0&&!C&&k<1,attachments:o},"tool-call-info")})})}),null!=i&&i&&k<1&&!C&&l.jsxs("div",{className:"flex w-full flex-col gap-2.5",children:[l.jsx("div",{className:"mb-1 mt-2",children:l.jsx(Ys,{className:"font-mediu inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm",variant:"default",rel:"noopener noreferrer",onClick:()=>window.open(i,"_blank","noopener,noreferrer"),children:c("com_ui_sign_in_to_domain",{0:N})})}),l.jsxs("p",{className:"flex items-center text-xs text-text-warning",children:[l.jsx(le,{className:"mr-1.5 inline-block h-4 w-4","aria-hidden":"true"}),c("com_assistants_allow_sites_you_trust")]})]}),o&&o.length>0&&l.jsx(pA,{attachments:o})]}):null}function DM({initialProgress:e=.1,args:t=""}){const n=rS(e),a=56.08695652173913,s=2*Math.PI*a,r=s-n*s,[o,i]=ja(!1);return l.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[l.jsx("div",{className:"relative h-5 w-5 shrink-0",children:l.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full bg-transparent text-white",style:{opacity:1,transform:"none"},"data-projection-id":"106",children:[l.jsx("div",{children:l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20",width:"20",height:"20",style:{width:"100%",height:"100%",transform:"translate3d(0px, 0px, 0px)"},preserveAspectRatio:"xMidYMid meet",children:[l.jsx("g",{className:"move-up",children:l.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:"M11.812616,5.914505C11.535567,5.360465,10.744857,5.360465,10.467807,5.914505C9.369731,8.110632,8.271654,10.306758,7.173676,12.502885C6.923041,13.002725,7.286122,13.590845,7.844972,13.590845C10.041112,13.590845,12.237252,13.590845,14.433392,13.590845C14.992292,13.590845,15.355792,13.002725,15.105892,12.502885C14.007888,10.306758,12.909805,8.110632,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505C11.812616,5.914505,11.812616,5.914505,11.812616,5.914505M7.216073,8.914505C6.939024,8.360465,6.148304,8.360465,5.871264,8.914505C5.274365,10.10828,4.677499,11.302055,4.080601,12.495835C3.83003,12.99568,4.193122,13.58379,4.751975,13.58379C5.946767,13.58379,7.14156,13.58379,8.336353,13.58379C8.895213,13.58379,9.258683,12.99568,9.008763,12.495835C8.411867,11.302055,7.81497,10.10828,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505C7.216073,8.914505,7.216073,8.914505,7.216073,8.914505"})}),l.jsx("g",{style:{display:"block"},transform:"matrix(-1,0,0,-1,10,10)",opacity:"1",className:"moon-rise",children:l.jsx("g",{opacity:"1",transform:"matrix(1,0,0,1,3.75,5.5)",children:l.jsx("path",{fill:"rgb(177,98,253)",fillOpacity:"1",d:" M2.660290002822876,2.2502501010894775 C2.7567598819732666,2.2502501010894775 2.850860118865967,2.241950035095215 2.9425699710845947,2.225330114364624 C3.034290075302124,2.208709955215454 3.1081299781799316,2.1867599487304688 3.164109945297241,2.1594600677490234 C3.239150047302246,2.120300054550171 3.305850028991699,2.100709915161133 3.364219903945923,2.100709915161133 C3.405900001525879,2.100709915161133 3.438659906387329,2.113770008087158 3.462480068206787,2.1398799419403076 C3.487489938735962,2.165990114212036 3.5,2.2009999752044678 3.5,2.2449100017547607 C3.5,2.2698400020599365 3.4958300590515137,2.2983200550079346 3.487489938735962,2.3303699493408203 C3.4803500175476074,2.362410068511963 3.468440055847168,2.3968300819396973 3.4517600536346436,2.433619976043701 C3.3803000450134277,2.5950300693511963 3.287990093231201,2.7410099506378174 3.1748299598693848,2.871570110321045 C3.0628700256347656,3.002120018005371 2.9348299503326416,3.1142799854278564 2.790709972381592,3.2080399990081787 C2.646589994430542,3.3029799461364746 2.4905600547790527,3.375380039215088 2.3226099014282227,3.425230026245117 C2.15585994720459,3.4750800132751465 1.9825600385665894,3.5 1.8027100563049316,3.5 C1.5430500507354736,3.5 1.3036400079727173,3.4554901123046875 1.0844800472259521,3.3664801120758057 C0.8653200268745422,3.2786500453948975 0.6741499900817871,3.1540400981903076 0.5109699964523315,2.9926199913024902 C0.34898999333381653,2.831209897994995 0.22333000600337982,2.641319990158081 0.1340000033378601,2.4229400157928467 C0.04467000067234039,2.2045600414276123 0,1.9660099744796753 0,1.7072700262069702 C0,1.4639699459075928 0.04645000025629997,1.2325400114059448 0.1393599957227707,1.012969970703125 C0.23226000368595123,0.7922199964523315 0.3626900017261505,0.5975800156593323 0.5306299924850464,0.4290440082550049 C0.6997600197792053,0.2593249976634979 0.8968899846076965,0.12877200543880463 1.121999979019165,0.03738600015640259 C1.1541600227355957,0.024329999461770058 1.1833399534225464,0.01483600027859211 1.2095500230789185,0.008901000022888184 C1.2369400262832642,0.0029670000076293945 1.2631399631500244,2.220446049250313e-16 1.288159966468811,2.220446049250313e-16 C1.335800051689148,2.220446049250313e-16 1.3733199834823608,0.014241999946534634 1.4007099866867065,0.042725998908281326 C1.4292999505996704,0.07121100276708603 1.4435900449752808,0.10681600123643875 1.4435900449752808,0.14954200387001038 C1.4435900449752808,0.1780260056257248 1.438230037689209,0.2076980024576187 1.4275100231170654,0.23855499923229218 C1.41798996925354,0.2682270109653473 1.404289960861206,0.2996779978275299 1.3864200115203857,0.3329089879989624 C1.3625999689102173,0.3768230080604553 1.3423500061035156,0.4302310049533844 1.3256800174713135,0.493133008480072 C1.309000015258789,0.5548499822616577 1.296489953994751,0.6225000023841858 1.288159966468811,0.6960800290107727 C1.2798199653625488,0.7684800028800964 1.2756500244140625,0.8414700031280518 1.2756500244140625,0.9150599837303162 C1.2756500244140625,1.1215699911117554 1.3072099685668945,1.3073099851608276 1.3703399896621704,1.4722800254821777 C1.4346599578857422,1.6372499465942383 1.5269700288772583,1.7778899669647217 1.6472699642181396,1.8941999673843384 C1.7675700187683105,2.0093300342559814 1.9128799438476562,2.097749948501587 2.083209991455078,2.1594600677490234 C2.2547199726104736,2.2199900150299072 2.44707989692688,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 C2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775 2.660290002822876,2.2502501010894775"})})})]})}),l.jsx(SM,{radius:a,circumference:s,offset:r})]})}),l.jsx(nP,{progress:n,onClick:()=>i((e=>!e)),inProgressText:"Creating Image",finishedText:"Finished.",hasInput:!1})]})}const FM=Sa((({part:e,isSubmitting:t,attachments:n,isLast:a,showCursor:s,isCreatedByUser:r})=>{var o,i,c,d,u;if(!e)return null;if(e.type===qm.ERROR)return l.jsx(mM,{text:e[qm.ERROR]??("string"==typeof e[qm.TEXT]?e[qm.TEXT]:null==(o=e.text)?void 0:o.value)??"",className:"my-2"});if(e.type===qm.AGENT_UPDATE)return l.jsxs(l.Fragment,{children:[l.jsx(rP,{currentAgentId:null==(i=e[qm.AGENT_UPDATE])?void 0:i.agentId}),a&&s&&l.jsx(iP,{children:l.jsx(YA,{})})]});if(e.type===qm.TEXT){const t="string"==typeof e.text?e.text:null==(c=e.text)?void 0:c.value;return"string"!=typeof t?null:null==e.tool_call_ids||t?!a&&t.length>0&&/^\s*$/.test(t)?null:l.jsx(iP,{children:l.jsx(BA,{text:t,isCreatedByUser:r,showCursor:s})}):null}if(e.type===qm.THINK){const t="string"==typeof e.think?e.think:null==(d=e.think)?void 0:d.value;return"string"!=typeof t?null:l.jsx(QA,{reasoning:t,isLast:a??!1})}if(e.type===qm.TOOL_CALL){const o=e[qm.TOOL_CALL];if(!o)return null;const i="args"in o&&(!o.type||o.type===Ym.TOOL_CALL);if(i&&o.name===Nl.execute_code)return l.jsx(sP,{attachments:n,isSubmitting:t,output:o.output??"",initialProgress:o.progress??.1,args:"string"==typeof o.args?o.args:""});if(i&&("image_gen_oai"===o.name||"image_edit_oai"===o.name))return l.jsx(gA,{initialProgress:o.progress??.1,isSubmitting:t,toolName:o.name,args:"string"==typeof o.args?o.args:"",output:o.output??"",attachments:n});if(i&&o.name===Nl.web_search)return l.jsx(PM,{output:o.output??"",initialProgress:o.progress??.1,isSubmitting:t,attachments:n,isLast:a});if(i&&(null==(u=o.name)?void 0:u.startsWith(Bm.LC_TRANSFER_TO_)))return l.jsx(RM,{args:o.args??"",name:o.name||"",output:o.output??""});if(i)return l.jsx(MM,{args:o.args??"",name:o.name||"",output:o.output??"",initialProgress:o.progress??.1,isSubmitting:t,attachments:n,auth:o.auth,expires_at:o.expires_at,isLast:a});if(o.type===Ym.CODE_INTERPRETER){const e=o[Ym.CODE_INTERPRETER];return l.jsx(AM,{initialProgress:o.progress??.1,code:e.input,outputs:e.outputs??[]})}if(o.type===Ym.RETRIEVAL||o.type===Ym.FILE_SEARCH)return l.jsx(IM,{initialProgress:o.progress??.1,isSubmitting:t});if(o.type===Ym.FUNCTION&&Ym.FUNCTION in o&&Xm.has(o.function.name))return l.jsx(DM,{initialProgress:o.progress??.1,args:o.function.arguments});if(o.type===Ym.FUNCTION&&Ym.FUNCTION in o)return vc(o)?t&&s?l.jsx(iP,{children:l.jsx(BA,{text:"",isCreatedByUser:r,showCursor:s})}):null:l.jsx(MM,{initialProgress:o.progress??.1,isSubmitting:t,args:o.function.arguments,name:o.function.name,output:o.function.output,isLast:a})}else if(e.type===qm.IMAGE_FILE){const t=e[qm.IMAGE_FILE],n=t.height??1920,a=t.width??1080;return l.jsx(lA,{imagePath:t.filepath,height:n,width:a,altText:t.filename??"Uploaded Image",placeholderDimensions:{height:n+"px",width:a+"px"}})}return null})),UM=({message:e,attachments:t,searchResults:n})=>{const a=j(N_.enableUserMsgMarkdown),{messageId:s}=e,r=Ca((()=>dx(t??[])),[t]);return Array.isArray(e.content)&&e.content.length>0?l.jsxs(zk.Provider,{value:{searchResults:n},children:[l.jsx(CM,{}),e.content.filter((e=>e)).map(((t,n)=>{var a;if(!t)return null;const o=(null==(a=null==t?void 0:t[qm.TOOL_CALL])?void 0:a.id)??"",i=r[o];return l.jsx(FM,{showCursor:!1,isSubmitting:!1,isCreatedByUser:e.isCreatedByUser,attachments:i,part:t},`display-${s}-${n}`)})),!0===e.unfinished&&l.jsx(Ia,{children:l.jsx(Go,{delay:250,children:l.jsx(hM,{message:e},`unfinished-${s}`)})})]}):l.jsx("div",{className:Qf("markdown prose dark:prose-invert light w-full break-words",e.isCreatedByUser&&!a&&"whitespace-pre-wrap",e.isCreatedByUser?"dark:text-gray-20":"dark:text-gray-70"),dir:"auto",children:l.jsx(fA,{content:e.text||""})})};function zM({siblingIdx:e,siblingCount:t,setSiblingIdx:n}){if(void 0===e)return null;if(void 0===t)return null;const a=Qf("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none");return t>1?l.jsxs("nav",{className:"visible flex items-center justify-center gap-2 self-center pt-0 text-xs","aria-label":"Sibling message navigation",children:[l.jsx("button",{className:a,type:"button",onClick:()=>{n&&n(e-1)},disabled:0==e,"aria-label":"Previous sibling message","aria-disabled":0==e,children:l.jsx(Ae,{size:"19","aria-hidden":"true"})}),l.jsxs("span",{className:"flex-shrink-0 flex-grow tabular-nums","aria-live":"polite","aria-atomic":"true",role:"status",children:[e+1," / ",t]}),l.jsx("button",{className:a,type:"button",onClick:()=>{n&&n(e+1)},disabled:e==t-1,"aria-label":"Next sibling message","aria-disabled":e==t-1,children:l.jsx(nn,{size:"19","aria-hidden":"true"})})]}):null}function VM({children:e,classes:t="",onClick:n}){return l.jsx("div",{className:Qf("mt-1 flex justify-start gap-3 empty:hidden lg:flex",t),onClick:n,children:e})}function $M(e){const t=ht(oT),{message:n,siblingIdx:a,siblingCount:s,conversation:r,setSiblingIdx:o,currentEditId:i,setCurrentEditId:c}=e,{attachments:d,searchResults:u}=oS({messageId:null==n?void 0:n.messageId,attachments:null==n?void 0:n.attachments});if(!n)return null;const{text:m="",children:p,error:h=!1,messageId:g="",unfinished:x=!1,isCreatedByUser:f=!0}=n;let v="";return v=f?"anonymous":n.sender??"",l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",children:l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-[47rem] md:px-5 lg:px-1 xl:max-w-[55rem] xl:px-5",children:[l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:l.jsx("div",{children:l.jsx("div",{className:"pt-0.5",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(OE,{message:n,conversation:r})})})})}),l.jsxs("div",{className:Qf("relative flex w-11/12 flex-col",f?"":"agent-turn"),children:[l.jsx("div",{className:Qf("select-none font-semibold",t),children:v}),l.jsx("div",{className:"flex-col gap-1 md:gap-3",children:l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsx(kk.Provider,{value:{messageId:g,isExpanded:!1,conversationId:null==r?void 0:r.conversationId,isSubmitting:!1,isLatestMessage:!1},children:n.content?l.jsx(UM,{message:n,attachments:d,searchResults:u}):l.jsx(gM,{edit:!1,error:h,isLast:!1,ask:()=>({}),text:m||"",message:n,isSubmitting:!1,enterEdit:()=>({}),unfinished:x,siblingIdx:a??0,isCreatedByUser:f,setSiblingIdx:o??(()=>({}))})})})}),l.jsxs(VM,{classes:"text-xs",children:[l.jsx(zM,{siblingIdx:a,siblingCount:s,setSiblingIdx:o}),l.jsx(rM,{message:n,searchResults:u})]})]})]})})}),l.jsx(BM,{messageId:g,messagesTree:p??[],currentEditId:i,setCurrentEditId:c},g)]})}function BM({messageId:e,messagesTree:t,currentEditId:n,setCurrentEditId:a}){const[s,r]=b(N_.messagesSiblingIdxFamily(e));if(ya((()=>{r(0)}),[null==t?void 0:t.length]),ya((()=>{null!=(null==t?void 0:t.length)&&s>=t.length&&r(0)}),[s,null==t?void 0:t.length,r]),!t||!t.length)return null;const o=t[t.length-s-1];return o?l.jsx($M,{message:o,currentEditId:n,setCurrentEditId:a,siblingIdx:t.length-s-1,siblingCount:t.length,setSiblingIdx:e=>{r(((null==t?void 0:t.length)??0)-e-1)}},o.messageId):null}function HM({messagesTree:e,conversationId:t}){const n=qN(),[a,s]=ja(-1);return l.jsx("div",{className:"flex-1 pb-[50px]",children:l.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:l.jsx("div",{style:{height:"100%",overflowY:"auto",width:"100%"},children:l.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e&&0==e.length||null===e?l.jsx("div",{className:"flex w-full items-center justify-center gap-1 bg-gray-50 p-3 text-sm text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:n("com_ui_nothing_found")}):l.jsx(l.Fragment,{children:l.jsx("div",{children:l.jsx(BM,{messagesTree:e,messageId:t??null,setCurrentEditId:s,currentEditId:a??null},t)})}),l.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})}function GM({className:e}){var t,n;const{data:a}=K_(),s=qN(),r=null==(t=null==a?void 0:a.interface)?void 0:t.privacyPolicy,o=null==(n=null==a?void 0:a.interface)?void 0:n.termsOfService,i=null!=(null==r?void 0:r.externalUrl)&&l.jsxs("a",{className:"text-text-secondary underline",href:r.externalUrl,target:!0===r.openNewTab?"_blank":void 0,rel:"noreferrer",children:[s("com_ui_privacy_policy"),!0===r.openNewTab&&l.jsx("span",{className:"sr-only",children:" "+s("com_ui_opens_new_tab")})]}),c=null!=(null==o?void 0:o.externalUrl)&&l.jsxs("a",{className:"text-text-secondary underline",href:o.externalUrl,target:!0===o.openNewTab?"_blank":void 0,rel:"noreferrer",children:[s("com_ui_terms_of_service"),!0===o.openNewTab&&l.jsx("span",{className:"sr-only",children:" "+s("com_ui_opens_new_tab")})]}),d=("string"==typeof(null==a?void 0:a.customFooter)?a.customFooter:"[LibreChat "+Bm.VERSION+"](https://librechat.ai) - "+s("com_ui_latest_footer")).split("|");ya((()=>{if(null!=(null==a?void 0:a.analyticsGtmId)&&void 0===window.google_tag_manager){const e={gtmId:a.analyticsGtmId};B.initialize(e)}}),[null==a?void 0:a.analyticsGtmId]);const u=[...d.map(((e,t)=>l.jsx(_a.Fragment,{children:l.jsx(Xi,{components:{a:({node:e,href:t,children:n,...a})=>l.jsxs("a",{className:"text-text-secondary underline",href:t,target:"_blank",rel:"noreferrer",...a,children:[n,l.jsx("span",{className:"sr-only",children:" "+s("com_ui_opens_new_tab")})]}),p:({node:e,...t})=>l.jsx("span",{...t})},children:e.trim()})},`main-content-part-${t}`))),i,c].filter(Boolean);return l.jsx("div",{className:"relative w-full",children:l.jsx("div",{className:e??"absolute bottom-0 left-0 right-0 hidden items-center justify-center gap-2 px-2 py-2 text-center text-xs text-text-primary sm:flex md:px-[60px]",role:"contentinfo",children:u.map(((e,t)=>{const n=t===u.length-1;return l.jsxs(_a.Fragment,{children:[e,!n&&l.jsx("div",{className:"h-2 border-r-[1px] border-border-medium"},`separator-${t}`)]},`footer-element-${t}`)}))})})}function KM({title:e,formattedDate:t,theme:n,langcode:a,settingsLabel:s,onThemeChange:r,onLangChange:o}){const[i,c]=ja(!1),d=vr("(max-width: 767px)"),u=ka((e=>{const t=e.target;(null==t?void 0:t.closest('[data-dialog-ignore="true"]'))&&e.preventDefault()}),[]);return l.jsx("section",{className:"mx-auto w-full px-3 pb-4 pt-6 md:px-5",children:l.jsx("div",{className:"bg-surface-primary/80 relative mx-auto flex w-full max-w-[60rem] flex-col gap-4 rounded-3xl border border-border-light px-6 py-5 shadow-xl backdrop-blur",children:l.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("h1",{className:"text-4xl font-semibold text-text-primary",children:e}),t&&l.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-secondary",children:[l.jsx(an,{className:"size-4","aria-hidden":"true"}),l.jsx("span",{children:t})]})]}),l.jsxs(rr,{open:i,onOpenChange:c,children:[l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{size:d?"icon":"default",type:"button",variant:"outline","aria-label":s,className:Qf("rounded-full border-border-medium text-sm text-text-primary transition-colors",d?"absolute bottom-4 right-4 justify-center p-0 shadow-lg":"gap-2 self-start px-4 py-2"),children:[l.jsx(I,{className:"size-4","aria-hidden":"true"}),l.jsx("span",{className:"hidden md:inline",children:s})]})}),l.jsxs(ir,{className:"w-11/12 max-w-lg",showCloseButton:!0,onPointerDownOutside:u,onInteractOutside:u,children:[l.jsx(br,{className:"text-left",children:l.jsx(lr,{children:s})}),l.jsxs("div",{className:"flex flex-col gap-4 pt-2 text-sm",children:[l.jsx("div",{className:"relative focus-within:z-[100]",children:l.jsx(fL,{theme:n,onChange:r,portal:!1})}),l.jsx("div",{className:"bg-border-medium/60 h-px w-full"}),l.jsx("div",{className:"relative focus-within:z-[100]",children:l.jsx(vL,{langcode:a,onChange:o,portal:!1})})]})]})]})]})})})}const WM=Sa((function(){var e;const t=qN(),{data:n}=K_(),{theme:a,setTheme:s}=Na(Fs),{shareId:r}=W(),{data:o,isLoading:i}=xN(r??""),c=o&&gp({messages:o.messages}),d=0===(null==c?void 0:c.length)?null:c??null,[u,m]=b(N_.lang);let p="";p=null!=(null==n?void 0:n.appTitle)&&null!=(null==o?void 0:o.title)?`${o.title} | ${n.appTitle}`:(null==o?void 0:o.title)??(null==n?void 0:n.appTitle)??document.title,ZS(p);const h=u||"undefined"!=typeof navigator&&(navigator.language||(null==(e=navigator.languages)?void 0:e[0]))||"en-US",g=null!=(null==o?void 0:o.createdAt)?new Date(o.createdAt).toLocaleDateString(h,{month:"long",day:"numeric",year:"numeric"}):null,x=ka((e=>{s(e)}),[s]),f=ka((e=>{var t;let n=e;"auto"===e&&(n=("undefined"!=typeof navigator?navigator.language||(null==(t=navigator.languages)?void 0:t[0]):null)??"en-US"),requestAnimationFrame((()=>{document.documentElement.lang=n})),m(n),w.set("lang",n,{expires:365})}),[m]);let v;v=i?l.jsx("div",{className:"flex h-screen items-center justify-center",children:l.jsx(Xs,{className:""})}):o&&d&&0!==d.length?l.jsxs(l.Fragment,{children:[l.jsx(KM,{title:o.title,formattedDate:g,theme:a,langcode:u,onThemeChange:x,onLangChange:f,settingsLabel:t("com_nav_settings")}),l.jsx(sM,{messages:o.messages,children:l.jsx(HM,{messagesTree:d,conversationId:"shared-conversation"})})]}):l.jsx("div",{className:"flex h-screen items-center justify-center",children:t("com_ui_shared_link_not_found")});const _=l.jsx("div",{className:"w-full border-t-0 pl-0 pt-2 md:w-[calc(100%-.5rem)] md:border-t-0 md:border-transparent md:pl-0 md:pt-0 md:dark:border-transparent",children:l.jsx(GM,{className:"relative mx-auto mt-4 flex max-w-[55rem] flex-wrap items-center justify-center gap-2 px-3 pb-4 pt-2 text-center text-xs text-text-secondary"})}),y=l.jsx("div",{className:"transition-width relative flex h-full w-full flex-1 flex-col items-stretch overflow-hidden pt-0 dark:bg-surface-secondary",children:l.jsxs("div",{className:"flex h-full flex-col text-text-primary",role:"presentation",children:[v,_]})}),j=o&&o.messages?l.jsx(tM,{messages:o.messages,conversationId:o.conversationId,mainContent:y}):y;return l.jsx(dk.Provider,{value:{isSharedConvo:!0},children:l.jsx("div",{className:"relative flex min-h-screen w-full dark:bg-surface-secondary",children:l.jsx("main",{className:"relative flex w-full grow overflow-hidden dark:bg-surface-secondary",children:j})})})}));function qM(){return l.jsx(WM,{})}const QM=()=>{const{conversation:e}=$N(),t=WN(),n=Ik(),{data:a}=G_(),s=Ca((()=>{let t=(null==e?void 0:e.endpoint)??"";return t===Yl.azureOpenAI&&(t=Yl.openAI),Cf({endpointsConfig:a,iconURL:null==e?void 0:e.iconURL,endpoint:t})}),[null==e?void 0:e.endpoint,null==e?void 0:e.iconURL,a]),{data:r=new Map}=bb(s,{select:e=>new Map(e.map((e=>[e.assistant_id,e])))}),{entity:o,isAgent:i}=Tf({endpoint:s,agentsMap:t,assistantMap:n,agent_id:null==e?void 0:e.agent_id,assistant_id:null==e?void 0:e.assistant_id}),c=Ca((()=>{var e,t;return(null==(e=null==o?void 0:o.conversation_starters)?void 0:e.length)?o.conversation_starters:i?[]:(null==(t=r.get((null==o?void 0:o.id)??""))?void 0:t.conversation_starters)??[]}),[r,i,o]),{submitMessage:d}=lS(),u=ka((e=>d({text:e})),[d]);return c.length?l.jsx("div",{className:"mt-8 flex flex-wrap justify-center gap-3 px-4",children:c.slice(0,Bm.MAX_CONVO_STARTERS).map(((e,t)=>l.jsx("button",{onClick:()=>u(e),className:"relative flex w-40 cursor-pointer flex-col gap-2 rounded-2xl border border-border-medium px-3 pb-4 pt-3 text-start align-top text-[15px] shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] transition-colors duration-300 ease-in-out fade-in hover:bg-surface-tertiary",children:l.jsx("p",{className:"break-word line-clamp-3 overflow-hidden text-balance break-all text-text-secondary",children:e})},t)))}):null},YM=Ta((({scrollHandler:e},t)=>l.jsx("button",{ref:t,onClick:e,className:"premium-scroll-button absolute bottom-5 right-1/2 cursor-pointer border border-border-light bg-surface-secondary","aria-label":"Scroll to bottom",children:l.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",className:"text-text-secondary",children:l.jsx("path",{d:"M17 13L12 18L7 13M12 6L12 17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})));function XM({memoryArtifacts:e}){const t=qN(),{updatedMemories:n,deletedMemories:a,errorMessages:s}=Ca((()=>({updatedMemories:e.filter((e=>"update"===e.type)),deletedMemories:e.filter((e=>"delete"===e.type)),errorMessages:e.filter((e=>"error"===e.type)).map((e=>{try{const n=JSON.parse(e.value);return"already_exceeded"===n.errorType?t("com_ui_memory_already_exceeded",{tokens:n.tokenCount}):"would_exceed"===n.errorType?t("com_ui_memory_would_exceed",{tokens:n.tokenCount}):t("com_ui_memory_error")}catch{return t("com_ui_memory_error")}}))})),[e,t]);return 0===e.length||0===n.length&&0===a.length&&0===s.length?null:l.jsxs("div",{className:"space-y-4 p-4",children:[n.length>0&&l.jsxs("div",{children:[l.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_updated_items")}),l.jsx("div",{className:"space-y-2",children:n.map((e=>l.jsxs("div",{className:"rounded-lg p-3",children:[l.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),l.jsx("div",{className:"whitespace-pre-wrap text-sm text-text-primary",children:e.value})]},`update-${e.key}`)))})]}),a.length>0&&l.jsxs("div",{children:[l.jsx("h4",{className:"mb-2 text-sm font-semibold text-text-primary",children:t("com_ui_memory_deleted_items")}),l.jsx("div",{className:"space-y-2",children:a.map((e=>l.jsxs("div",{className:"rounded-lg p-3 opacity-60",children:[l.jsx("div",{className:"mb-1 text-xs font-medium uppercase tracking-wide text-text-secondary",children:e.key}),l.jsx("div",{className:"text-sm italic text-text-secondary",children:t("com_ui_memory_deleted")})]},`delete-${e.key}`)))})]}),s.length>0&&l.jsxs("div",{children:[l.jsx("h4",{className:"mb-2 text-sm font-semibold text-red-500",children:t("com_ui_memory_storage_full")}),l.jsx("div",{className:"space-y-2",children:s.map((e=>l.jsx("div",{className:"rounded-md bg-red-50 p-3 text-sm text-red-800 dark:bg-red-900/20 dark:text-red-400",children:e},e)))})]})]})}function JM({attachments:e}){const t=qN(),[n,a]=ja(!1),s=ba(null),[r,o]=ja(0),[i,c]=ja(!1),d=ba(n),{hasErrors:u,memoryArtifacts:m}=Ca((()=>{let t=!1;const n=[];if(!e||0===e.length)return{hasErrors:t,memoryArtifacts:n};for(const a of e)null!=(null==a?void 0:a[Nl.memory])&&(n.push(a[Nl.memory]),t||"error"!==a[Nl.memory].type||(t=!0));return{hasErrors:t,memoryArtifacts:n}}),[e]);return Aa((()=>{if(n!==d.current){d.current=n,c(!0),n&&s.current?requestAnimationFrame((()=>{if(s.current){const e=s.current.scrollHeight;o(e+4)}})):o(0);const e=setTimeout((()=>{c(!1)}),400);return()=>clearTimeout(e)}}),[n]),ya((()=>{if(!s.current)return;const e=new ResizeObserver((e=>{if(n&&!i)for(const t of e)t.target===s.current&&o(t.contentRect.height+4)}));return e.observe(s.current),()=>{e.disconnect()}}),[n,i]),m&&0!==m.length?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex items-center",children:l.jsx("div",{className:"inline-block",children:l.jsxs("button",{className:Qf("outline-hidden my-1 flex items-center gap-1 text-sm font-semibold transition-colors",u?"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-500":"text-text-secondary-alt hover:text-text-primary"),type:"button",onClick:()=>a((e=>!e)),"aria-expanded":n,"aria-label":t("com_ui_memory_updated"),children:[l.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"mb-[-1px]",children:[l.jsx("path",{d:"M6 3C4.89543 3 4 3.89543 4 5V13C4 14.1046 4.89543 15 6 15L6 3Z",fill:"currentColor"}),l.jsx("path",{d:"M7 3V15H8.18037L8.4899 13.4523C8.54798 13.1619 8.69071 12.8952 8.90012 12.6858L12.2931 9.29289C12.7644 8.82153 13.3822 8.58583 14 8.58578V3.5C14 3.22386 13.7761 3 13.5 3H7Z",fill:"currentColor"}),l.jsx("path",{d:"M11.3512 15.5297L9.73505 15.8529C9.38519 15.9229 9.07673 15.6144 9.14671 15.2646L9.46993 13.6484C9.48929 13.5517 9.53687 13.4628 9.60667 13.393L12.9996 10C13.5519 9.44771 14.4473 9.44771 14.9996 10C15.5519 10.5523 15.5519 11.4477 14.9996 12L11.6067 15.393C11.5369 15.4628 11.448 15.5103 11.3512 15.5297Z",fill:"currentColor"})]}),t(u?"com_ui_memory_error":"com_ui_memory_updated")]})})}),l.jsx("div",{className:"relative",style:{height:n?r:0,overflow:"hidden",transition:"height 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)",opacity:n?1:0,transformOrigin:"top",willChange:"height, opacity",perspective:"1000px",backfaceVisibility:"hidden",WebkitFontSmoothing:"subpixel-antialiased"},children:l.jsx("div",{className:Qf("overflow-hidden rounded-xl border border-border-light bg-surface-primary-alt shadow-md",n&&"shadow-lg"),style:{transform:n?"translateY(0) scale(1)":"translateY(-8px) scale(0.98)",opacity:n?1:0,transition:"transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1)"},children:l.jsx("div",{ref:s,children:n&&l.jsx(XM,{memoryArtifacts:m},"memory-info")})})})]}):null}YM.displayName="ScrollToBottom";const ZM=Sa((({content:e,messageId:t,conversationId:n,attachments:a,searchResults:s,isCreatedByUser:r,isLast:o,isSubmitting:i,isLatestMessage:c,edit:d,enterEdit:u,siblingIdx:m,setSiblingIdx:p})=>{const h=Ca((()=>dx(a??[])),[a]),g=!!c&&i;return e?!0===d&&u&&p?l.jsx(l.Fragment,{children:e.map(((e,n)=>{if(!e)return null;const a=(null==e?void 0:e.type)===qm.TEXT||"string"!=typeof(null==e?void 0:e.text),s=(null==e?void 0:e.type)===qm.THINK||"string"!=typeof(null==e?void 0:e.think);if(!a&&!s)return null;return e.type===qm.TOOL_CALL||null!=e.tool_call_ids?null:l.jsx(lP,{index:n,part:e,messageId:t,isSubmitting:i,enterEdit:u,siblingIdx:m??null,setSiblingIdx:p},`edit-${t}-${n}`)}))}):l.jsx(l.Fragment,{children:l.jsxs(zk.Provider,{value:{searchResults:s},children:[l.jsx(JM,{attachments:a}),l.jsx(CM,{messageId:t,conversationId:n||void 0}),e.map(((a,s)=>{var i,d;if(!a)return null;const u=(null==(i=null==a?void 0:a[qm.TOOL_CALL])?void 0:i.id)??"",m=h[u];return l.jsx(kk.Provider,{value:{messageId:t,isExpanded:!0,conversationId:n,partIndex:s,nextType:null==(d=e[s+1])?void 0:d.type,isSubmitting:g,isLatestMessage:c},children:l.jsx(FM,{part:a,attachments:m,isSubmitting:g,isCreatedByUser:r,isLast:s===e.length-1,showCursor:s===e.length-1&&o},`part-${t}-${s}`)},`provider-${t}-${s}`)}))]})}):null})),eD=Sa((({isCard:e})=>e?l.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):null)),tD={[Gm.DIRECT_PATH]:"com_ui_fork_visible",[Gm.INCLUDE_BRANCHES]:"com_ui_fork_branches",[Gm.TARGET_LEVEL]:"com_ui_fork_all_target",[Gm.DEFAULT]:"com_ui_fork_from_message"},nD=l.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 20 20",fill:"currentColor",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"})}),aD=({children:e,setting:t,onClick:n,setActiveSetting:a,timeoutRef:s,hoverInfo:r,hoverTitle:o,hoverDescription:i,label:c})=>{const d=qN();return l.jsx(ot,{placement:"right-start",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx(it,{render:l.jsxs(mn,{onClick:()=>n(t),onMouseEnter:()=>{s.current&&(clearTimeout(s.current),s.current=null),a(tD[t])},onMouseLeave:()=>{s.current&&clearTimeout(s.current),s.current=setTimeout((()=>{a(tD[Gm.DEFAULT])}),175)},onFocus:()=>{s.current&&(clearTimeout(s.current),s.current=null),a(tD[t])},onBlur:()=>{s.current&&clearTimeout(s.current),s.current=setTimeout((()=>{a(tD[Gm.DEFAULT])}),175)},className:"mx-0.5 w-14 flex-1 rounded-xl border-2 border-border-medium bg-surface-secondary text-text-secondary transition duration-200 ease-in-out hover:bg-surface-hover hover:text-text-primary","aria-label":c,children:[e,l.jsx(ct,{children:c})]})}),l.jsxs(lt,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(ct,{children:d("com_ui_fork_more_details_about",{0:c})}),nD]}),(null!=r&&""!==r||null!=o&&""!==o||null!=i&&""!==i)&&l.jsx(dt,{gutter:16,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:l.jsx("div",{className:"space-y-2",children:l.jsxs("p",{className:"flex flex-col gap-2 text-sm text-text-secondary",children:[r&&r,o&&l.jsx("span",{className:"flex flex-wrap gap-1 font-bold",children:o}),i&&i]})})})]})})},sD=({id:e,checked:t,onToggle:n,labelKey:a,infoKey:s,showToastOnCheck:r=!1})=>{const o=qN(),{showToast:i}=Ds();return l.jsxs(ot,{placement:"right-start",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(it,{render:l.jsxs("div",{className:"flex items-center",children:[l.jsx(pn,{id:e,checked:t,onChange:e=>{const t=e.target.checked;t&&r&&i({message:o("com_ui_fork_remember_checked"),status:"info"}),n(t)},className:"h-4 w-4 rounded-sm border border-primary ring-offset-background transition duration-300 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground","aria-label":o(a)}),l.jsx("label",{htmlFor:e,className:"ml-2 cursor-pointer select-none text-sm text-text-secondary hover:text-text-primary",children:o(a)})]})}),l.jsxs(lt,{className:"ml-1 rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(ct,{children:o(s)}),nD]})]}),l.jsx(dt,{gutter:14,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:l.jsx("div",{className:"space-y-2",children:l.jsx("p",{className:"text-sm text-text-secondary",children:o(s)})})})]})};function rD({messageId:e,conversationId:t,forkingSupported:n=!1,latestMessageId:a,isLast:s=!1}){const r=qN(),{showToast:o}=Ds(),[i,c]=ja(!1),{navigateToConvo:d}=CC(),[u,m]=ja(!1),p=ba(null),[h,g]=b(N_.forkSetting),[x,f]=ja(tD.default),[v,_]=b(N_.splitAtTarget),[y,j]=b(N_.rememberDefaultFork),w=sn({placement:"bottom"}),N=Qf("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!s&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",u&&"active text-text-primary bg-surface-hover"),k=(e=>{const t=xs(),{onSuccess:n,...a}=e||{};return fs((e=>Jh.forkConversation(e)),{onSuccess:(e,a,s)=>{if(!a.conversationId)return;const r=e.conversation,o=r.conversationId;o&&(t.setQueryData([Fh.conversation,o],r),Wx(t,r),t.setQueryData([Fh.messages,o],e.messages),t.invalidateQueries({queryKey:[Fh.allConversations],refetchPage:(e,t)=>0===t}),r.tags&&r.tags.length>0&&t.setQueryData([Fh.conversationTags],(e=>e?e.map((e=>{var t;return(null==(t=r.tags)?void 0:t.includes(e.tag))?{...e,count:e.count+1}:e})):e)),null==n||n(e,a,s))},...a})})({onSuccess:e=>{d(e.conversation),o({message:r("com_ui_fork_success"),status:"success"})},onMutate:()=>{o({message:r("com_ui_fork_processing"),status:"info"})},onError:e=>{var t;const n=429===(null==(t=null==e?void 0:e.response)?void 0:t.status)||429===(null==e?void 0:e.status)||429===(null==e?void 0:e.statusCode);o({message:r(n?"com_ui_fork_error_rate_limit":"com_ui_fork_error"),status:"error"})}}),C=t??"";if(!n||!C||!e)return null;const S=t=>{i&&(j(!0),g(t)),k.mutate({messageId:e,conversationId:C,option:t,splitAtTarget:v,latestMessageId:a})},T=[{setting:Gm.DIRECT_PATH,label:r(tD[Gm.DIRECT_PATH]),icon:l.jsx(rn,{className:"h-full w-full rotate-90 p-2","aria-hidden":"true"}),hoverTitle:l.jsxs(l.Fragment,{children:[l.jsx(rn,{className:"h-5 w-5 rotate-90","aria-hidden":"true"}),r(tD[Gm.DIRECT_PATH])]}),hoverDescription:r("com_ui_fork_info_visible")},{setting:Gm.INCLUDE_BRANCHES,label:r(tD[Gm.INCLUDE_BRANCHES]),icon:l.jsx(on,{className:"h-full w-full rotate-180 p-2","aria-hidden":"true"}),hoverTitle:l.jsxs(l.Fragment,{children:[l.jsx(on,{className:"h-4 w-4 rotate-180","aria-hidden":"true"}),r(tD[Gm.INCLUDE_BRANCHES])]}),hoverDescription:r("com_ui_fork_info_branches")},{setting:Gm.TARGET_LEVEL,label:r(tD[Gm.TARGET_LEVEL]),icon:l.jsx(ln,{className:"h-full w-full p-2","aria-hidden":"true"}),hoverTitle:l.jsxs(l.Fragment,{children:[l.jsx(ln,{className:"h-5 w-5","aria-hidden":"true"}),`${r(tD[Gm.TARGET_LEVEL])} (${r("com_endpoint_default")})`]}),hoverDescription:r("com_ui_fork_info_target")}];return l.jsxs(l.Fragment,{children:[l.jsx(cn,{store:w,render:l.jsx("button",{className:N,onClick:t=>{y?(t.preventDefault(),k.mutate({messageId:e,splitAtTarget:v,conversationId:C,option:h,latestMessageId:a})):(w.toggle(),m(w.getState().open))},type:"button","aria-label":r("com_ui_fork_open_menu"),children:l.jsx(dn,{size:"19","aria-hidden":"true"})})}),l.jsxs(un,{store:w,gutter:10,className:`popover-animate ${u?"open":""} flex w-60 flex-col gap-3 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-2 px-4 shadow-lg`,style:{outline:"none",pointerEvents:"auto",zIndex:50},portal:!0,unmountOnHide:!0,onClose:()=>m(!1),children:[l.jsxs("div",{className:"flex h-8 w-full items-center justify-center text-sm text-text-primary",children:[r(x),l.jsxs(ot,{placement:"right-start",children:[l.jsxs("div",{className:"ml-auto flex h-6 w-6 items-center justify-center gap-1",children:[l.jsx(it,{render:l.jsx("button",{className:"flex h-5 w-5 cursor-help items-center rounded-full text-text-secondary","aria-label":r("com_ui_fork_info_button_label"),children:l.jsx(ft,{"aria-hidden":"true"})})}),l.jsxs(lt,{className:"rounded-full text-text-secondary focus:outline-none focus:ring-2 focus:ring-ring",children:[l.jsx(ct,{children:r("com_ui_fork_more_info_options")}),nD]})]}),l.jsx(dt,{gutter:19,shift:40,flip:!1,className:"z-[999] w-80 rounded-2xl border border-border-medium bg-surface-secondary p-4 text-text-primary shadow-md",portal:!0,unmountOnHide:!0,children:l.jsxs("div",{className:"flex flex-col gap-2 space-y-2 text-sm text-text-secondary",children:[l.jsx("span",{children:r("com_ui_fork_info_1")}),l.jsx("span",{children:r("com_ui_fork_info_2")}),l.jsx("span",{children:r("com_ui_fork_info_3",{0:r("com_ui_fork_split_target")})})]})})]})]}),l.jsx("div",{className:"flex h-full w-full items-center justify-center gap-1",children:T.map((e=>l.jsx(aD,{setActiveSetting:f,timeoutRef:p,onClick:S,setting:e.setting,label:e.label,hoverTitle:e.hoverTitle,hoverDescription:e.hoverDescription,children:e.icon},e.setting)))}),l.jsx(sD,{id:"split-target-checkbox",checked:v,onToggle:_,labelKey:"com_ui_fork_split_target",infoKey:"com_ui_fork_info_start"}),l.jsx(sD,{id:"remember-checkbox",checked:i,onToggle:e=>{e&&o({message:r("com_ui_fork_remember_checked"),status:"info"}),c(e)},labelKey:"com_ui_fork_remember",infoKey:"com_ui_fork_info_remember",showToastOnCheck:!0})]})]})}function oD({presets:e,modelSpecs:t,conversation:n,assistantsMap:a,returnHandlers:s,endpointsConfig:r,newConversation:o}){const i=zN(),l=j(N_.modularChat),c=j(N_.availableTools),d=ka((e=>{var t,s;if(!e)return;const{preset:c}=e;c.iconURL=kf(e),c.spec=e.name;const{endpoint:d}=c,u=d??"";if(!u)return;const{template:m,shouldSwitch:p,isNewModular:h,newEndpointType:g,isCurrentModular:x,isExistingConversation:f}=yf({newEndpoint:u,modularChat:l,conversation:n,endpointsConfig:r});g&&(c.endpointType=g),lc(u)&&null!=c.assistant_id&&!c.model&&(c.model=null==(s=null==(t=null==a?void 0:a[u])?void 0:t[c.assistant_id])?void 0:s.model);const v=x&&h&&p;if(f&&v){m.endpointType=g;const e=i({conversation:{...n??{},endpointType:m.endpointType},preset:m,cleanOutput:!0});return cx.info("conversation","Switching conversation to new spec (modular)",n),void o({template:e,preset:c,keepLatestMessage:!0,keepAddedConvos:!0})}cx.info("conversation","Switching conversation to new spec",n),o({template:{...m},preset:c,keepAddedConvos:v})}),[n,i,l,o,r,a]),u=ka(((e,t={})=>{const a=e??"";if(!a)return;const{shouldSwitch:s,isNewModular:c,isCurrentModular:d,isExistingConversation:u,newEndpointType:m,template:p}=yf({newEndpoint:a,modularChat:l,conversation:n,endpointsConfig:r}),h=t.model??"";h&&(p.model=h);const g=t.assistant_id??"";g&&(p.assistant_id=g);const x=t.agent_id??"";if(x&&(p.agent_id=x),xf(p),p.spec=null,p.iconURL=null,p.modelLabel=null,u&&d&&c&&s){p.endpointType=m;const e=i({conversation:{...n??{},spec:null,iconURL:null,modelLabel:null,endpointType:p.endpointType},preset:p});return cx.info("conversation","Switching conversation to new endpoint/model (modular)",e),void o({template:e,preset:e,keepLatestMessage:!0,keepAddedConvos:!0})}cx.info("conversation","Switching conversation to new endpoint/model",p),o({template:{...p},preset:{...t,spec:null,iconURL:null,modelLabel:null,endpoint:a},keepAddedConvos:c})}),[n,i,l,o,r]),m=ka((e=>{if(!e)return;const t=Zx(e,c),a=t.endpoint??"",{template:s,shouldSwitch:d,isNewModular:u,newEndpointType:m,isCurrentModular:p,isExistingConversation:h}=yf({newEndpoint:a,modularChat:l,conversation:n,endpointsConfig:r});t.spec=null,t.iconURL=t.iconURL??null,t.modelLabel=t.modelLabel??null;const g=p&&u&&d,x=!0===t.defaultPreset;if(h&&g){s.endpointType=m,s.spec=null,s.iconURL=null,s.modelLabel=null;const e=i({conversation:{...n??{},endpointType:s.endpointType},preset:s,cleanInput:!0});return cx.info("conversation","Switching conversation to new preset (modular)",e),void o({template:e,preset:t,keepLatestMessage:!0,keepAddedConvos:!0,disableParams:x})}cx.info("conversation","Switching conversation to new preset",s),o({preset:t,keepAddedConvos:g,disableParams:x})}),[l,n,c,o,r,i]),p=ka((n=>{var s,r;const o=n.value;if("preset"===n.type){const t=null==e?void 0:e.find((e=>e.presetId===o));m(t)}else if("modelSpec"===n.type){const e=t.find((e=>e.name===o));d(e)}else"model"===n.type?u(o,{model:n.label}):"endpoint"===n.type?u(o):lc(n.type)?u(n.type,{assistant_id:o,model:(null==(r=null==(s=null==a?void 0:a[n.type])?void 0:s[o])?void 0:r.model)??""}):cc(n.type)&&u(n.type,{agent_id:o})}),[t,u,m,d,e,a]);return s?{onSelectSpec:d,onSelectEndpoint:u}:{onSelectMention:p}}function iD({item:e,type:t,onSelectEndpoint:n,onRemoveFocus:a}){const s=qN(),{removeFavoriteAgent:r,removeFavoriteModel:o}=XS(),[i,c]=ja(!1),d=()=>{if("agent"===t){const t=e;null==n||n(Yl.agents,{agent_id:t.id})}else{const t=e;null==n||n(t.endpoint,{model:t.model})}},u="agent"===t?e.name??"":e.model,m=`${u} (${s("agent"===t?"com_ui_agent":"com_ui_model")})`,p=_a.useId(),h=[{label:s("com_ui_unpin"),onClick:n=>{if(n.stopPropagation(),"agent"===t)r(e.id);else{const t=e;o(t.model,t.endpoint)}c(!1),requestAnimationFrame((()=>{null==a||a()}))},icon:l.jsx(Ot,{className:"h-4 w-4 text-text-secondary"})}];return l.jsxs("div",{role:"button",tabIndex:0,"aria-label":m,className:Qf("group relative flex w-full cursor-pointer items-center justify-between rounded-lg px-3 py-2 text-sm text-text-primary hover:bg-surface-active-alt",i?"bg-surface-active-alt":""),onClick:e=>{e.target.closest('[data-testid="favorite-options-button"]')||d()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),d())},"data-testid":"favorite-item",children:[l.jsxs("div",{className:"flex flex-1 items-center truncate pr-6",children:[(()=>{if("agent"===t)return Dx(e,{size:"icon",className:"mr-2"});const n=e;return l.jsx("div",{className:"mr-2 h-5 w-5",children:l.jsx(aI,{endpoint:n.endpoint,size:20,isCreatedByUser:!1})})})(),l.jsx("span",{className:"truncate",children:u})]}),l.jsx("div",{className:Qf("absolute right-2 flex items-center",i?"opacity-100":"opacity-0 group-focus-within:opacity-100 group-hover:opacity-100"),onClick:e=>e.stopPropagation(),children:l.jsx(cr,{portal:!0,mountByState:!0,isOpen:i,setIsOpen:c,trigger:l.jsx(se,{className:Qf("inline-flex h-7 w-7 items-center justify-center rounded-md border-none p-0 text-sm font-medium ring-ring-primary transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50",i?"opacity-100":"opacity-0 focus:opacity-100 group-focus-within:opacity-100 group-hover:opacity-100 data-[open]:opacity-100"),"aria-label":s("com_nav_convo_menu_options"),"data-testid":"favorite-options-button",onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},children:l.jsx(hn,{className:"icon-md text-text-secondary","aria-hidden":!0})}),items:h,menuId:p})})]})}const lD=()=>l.jsxs("div",{className:"flex w-full items-center rounded-lg px-3 py-2",children:[l.jsx(Ms,{className:"mr-2 h-5 w-5 rounded-full"}),l.jsx(Ms,{className:"h-4 w-24"})]}),cD=()=>l.jsxs("div",{className:"flex w-full items-center rounded-lg px-3 py-2",children:[l.jsx(Ms,{className:"mr-2 h-5 w-5"}),l.jsx(Ms,{className:"h-4 w-28"})]}),dD=({id:e,index:t,moveItem:n,onDrop:a,children:s})=>{const r=ba(null),[{handlerId:o},i]=ls({accept:"favorite-item",collect:e=>({handlerId:e.getHandlerId()}),hover(e,a){var s;if(!r.current)return;const o=e.index,i=t;if(o===i)return;const l=null==(s=r.current)?void 0:s.getBoundingClientRect(),c=(l.bottom-l.top)/2,d=a.getClientOffset();if(!d)return;const u=d.y-l.top;o<i&&u<c||o>i&&u>c||(n(o,i),e.index=i)}}),[{isDragging:c},d]=ds({type:"favorite-item",item:()=>({id:e,index:t}),collect:e=>({isDragging:e.isDragging()}),end:()=>{a()}}),u=c?0:1;return d(i(r)),l.jsx("div",{ref:r,style:{opacity:u},"data-handler-id":o,children:s})};function uD({isSmallScreen:e,toggleNav:t,onHeightChange:n}){const a=E(),s=qN(),r=j(N_.search),{favorites:o,reorderFavorites:i,isLoading:c}=XS(),d=OC(),{newConversation:u}=_C(),m=Ik(),p=WN(),h=j(N_.conversationByIndex(0)),{data:g={}}=G_(),{onSelectEndpoint:x}=oD({modelSpecs:[],conversation:h,assistantsMap:m,endpointsConfig:g,newConversation:u,returnHandlers:!0}),f=ba(null),v=ba(null),_=ka((()=>{a("/agents"),e&&t&&t()}),[a,e,t]),b=ka((()=>{var e;if(f.current)return void f.current.focus();const t=null==(e=v.current)?void 0:e.querySelector('[data-testid="favorite-item"]');if(t)return void t.focus();const n=document.querySelector('[data-testid="nav-new-chat-button"]');null==n||n.focus()}),[]),y=Ca((()=>Array.isArray(o)?o:[]),[o]),w=Ca((()=>y.map((e=>e.agentId)).filter(Boolean)),[y]),N=Ca((()=>void 0===p?[]:w.filter((e=>!p[e]))),[w,p]),k=ks({queries:N.map((e=>({queryKey:[Fh.agent,e],queryFn:()=>Jh.getAgentById({agent_id:e}),staleTime:3e5,enabled:N.length>0})))}),C=Ca((()=>{if(void 0===p)return;const e={};for(const[t,n]of Object.entries(p))n&&(e[t]=n);return k.forEach((t=>{t.data&&(e[t.data.id]=t.data)})),e}),[p,k]),S=w.length>0&&void 0===p||N.length>0&&k.some((e=>e.isLoading));ya((()=>{!S&&n&&n()}),[S,n]);const T=ba(y),I=ka(((e,t)=>{const n=[...T.current],[a]=n.splice(e,1);n.splice(t,0,a),T.current=n,i(n,!1)}),[i]),R=ka((()=>{i(T.current,!0)}),[i]);return ya((()=>{T.current=y}),[y]),r.query?null:c||0!==y.length||d?c?l.jsx("div",{className:"mb-2 flex flex-col pb-2",children:l.jsxs("div",{className:"mt-1 flex flex-col gap-1",children:[d&&l.jsx(cD,{}),l.jsx(lD,{})]})}):l.jsx("div",{className:"mb-2 flex flex-col",children:l.jsx("div",{ref:v,className:"mt-1 flex flex-col gap-1",children:S?l.jsxs(l.Fragment,{children:[d&&l.jsx(cD,{}),y.map(((e,t)=>l.jsx(lD,{},`skeleton-${t}`)))]}):l.jsxs(l.Fragment,{children:[d&&l.jsx("div",{ref:f,role:"button",tabIndex:0,"aria-label":s("com_agents_marketplace"),className:"group relative flex w-full cursor-pointer items-center justify-between rounded-lg px-3 py-2 text-sm text-text-primary hover:bg-surface-active-alt",onClick:_,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),_())},"data-testid":"nav-agents-marketplace-button",children:l.jsxs("div",{className:"flex flex-1 items-center truncate pr-6",children:[l.jsx("div",{className:"mr-2 h-5 w-5",children:l.jsx(gn,{className:"h-5 w-5 text-text-primary"})}),l.jsx("span",{className:"truncate",children:s("com_agents_marketplace")})]})}),y.map(((e,t)=>{if(e.agentId){const n=null==C?void 0:C[e.agentId];return n?l.jsx(dD,{id:e.agentId,index:t,moveItem:I,onDrop:R,children:l.jsx(iD,{item:n,type:"agent",onSelectEndpoint:x,onRemoveFocus:b})},e.agentId):null}return e.model&&e.endpoint?l.jsx(dD,{id:`${e.endpoint}-${e.model}`,index:t,moveItem:I,onDrop:R,children:l.jsx(iD,{item:{model:e.model,endpoint:e.endpoint},type:"model",onSelectEndpoint:x,onRemoveFocus:b})},`${e.endpoint}-${e.model}`):null}))]})})}):null}function mD({setShowDeleteDialog:e,conversationId:t,setMenuOpen:n,retainView:a,title:s}){const r=qN(),o=E(),i=xs(),{showToast:c}=Ds(),{newConversation:d}=_C(),{conversationId:u}=W(),m=Tb({onSuccess:()=>{e(!1),u!==t&&"new"!==u||(d(),o("/c/new",{replace:!0})),null==n||n(!1),a(),c({message:r("com_ui_convo_delete_success"),severity:lx.SUCCESS,showIcon:!0})},onError:()=>{c({message:r("com_ui_convo_delete_error"),severity:lx.ERROR,showIcon:!0})}}),p=ka((()=>{var e,n;const a=i.getQueryData([Fh.messages,t]),s=null==(e=null==a?void 0:a[a.length-1])?void 0:e.thread_id,r=null==(n=null==a?void 0:a[a.length-1])?void 0:n.endpoint;m.mutate({conversationId:t,thread_id:s,endpoint:r,source:"button"})}),[t,m,i]);return l.jsxs(ir,{className:"w-11/12 max-w-md",showCloseButton:!1,"aria-describedby":"delete-conversation-description",children:[l.jsx(br,{children:l.jsx(lr,{children:r("com_ui_delete_conversation")})}),l.jsx("div",{id:"delete-conversation-description",className:"w-full truncate",children:l.jsx(Ai,{i18nKey:"com_ui_delete_confirm_strong",values:{title:s},components:{strong:l.jsx("strong",{})}})}),l.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[l.jsx(_r,{asChild:!0,children:l.jsx(Ys,{"aria-label":"cancel",variant:"outline",children:r("com_ui_cancel")})}),l.jsx(Ys,{variant:"destructive",onClick:p,disabled:m.isLoading,children:m.isLoading?l.jsx(Xs,{}):r("com_ui_delete")})]})]})}function pD({conversationId:e,retainView:t,title:n,setMenuOpen:a,showDeleteDialog:s,setShowDeleteDialog:r,triggerRef:o}){return void 0===s||void 0===r?null:e?l.jsx(rr,{open:s,onOpenChange:r,triggerRef:o,children:l.jsx(mD,{setShowDeleteDialog:r,conversationId:e,setMenuOpen:a,retainView:t,title:n})}):null}function hD({share:e,conversationId:t,targetMessageId:n,showQR:a,setShowQR:s,setSharedLink:r}){const o=qN(),{showToast:i}=Ds(),c=ba(null),[d,u]=ja(!1),[m,p]=ja(""),h=(null==e?void 0:e.shareId)??"",{mutateAsync:g,isLoading:x}=wb({onError:()=>{i({message:o("com_ui_share_error"),severity:lx.ERROR,showIcon:!0})}}),{mutateAsync:f,isLoading:v}=Nb({onError:()=>{i({message:o("com_ui_share_error"),severity:lx.ERROR,showIcon:!0})}}),_=kb({onSuccess:()=>{u(!1),setTimeout((()=>{var e;const t=null==(e=document.getElementById("share-conversation-dialog"))?void 0:e.closest('[role="dialog"]');t instanceof HTMLElement&&t.focus()}),0)}}),b=ka((e=>`${window.location.protocol}//${window.location.host}/share/${e}`),[]),y=o(a?"com_ui_hide_qr":"com_ui_show_qr");return l.jsx(l.Fragment,{children:l.jsxs("div",{className:"flex gap-2",children:[!h&&l.jsxs(Ys,{disabled:x,variant:"submit",onClick:async()=>{const e=await g({conversationId:t,targetMessageId:n}),a=b(e.shareId);r(a)},children:[!x&&o("com_ui_create_link"),x&&l.jsx(Xs,{className:"size-4"})]}),h&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(pr,{description:o("com_ui_refresh_link"),render:e=>l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:m}),l.jsx(Ys,{...e,onClick:()=>(async()=>{if(!h)return;const e=await f({shareId:h}),t=b(e.shareId);r(t),p(o("com_ui_link_refreshed")),setTimeout((()=>{p("")}),1e3)})(),variant:"outline",disabled:v,"aria-label":o("com_ui_refresh_link"),children:v?l.jsx(Xs,{className:"size-4"}):l.jsx(xn,{className:"size-4","aria-hidden":"true"})})]})}),l.jsx(pr,{description:y,render:e=>l.jsx(Ys,{...e,onClick:()=>s(!a),variant:"outline","aria-label":y,children:l.jsx(fn,{className:"size-4","aria-hidden":"true"})})}),l.jsx(pr,{description:o("com_ui_delete"),render:e=>l.jsx(Ys,{...e,ref:c,onClick:()=>u(!0),variant:"destructive","aria-label":o("com_ui_delete"),children:l.jsx(Te,{className:"size-4","aria-hidden":"true"})})})]}),l.jsx(rr,{open:d,triggerRef:c,onOpenChange:u,children:l.jsxs(ir,{className:"max-w-[450px]",showCloseButton:!1,children:[l.jsx(br,{children:l.jsx(lr,{children:o("com_ui_delete_shared_link_heading")})}),l.jsx("div",{className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(er,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:l.jsx(Ai,{i18nKey:"com_ui_delete_confirm_strong",values:{title:h},components:{strong:l.jsx("strong",{})}})})})}),l.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[l.jsx(_r,{asChild:!0,children:l.jsx(Ys,{variant:"outline",children:o("com_ui_cancel")})}),l.jsx(Ys,{variant:"destructive",onClick:async()=>{if(h)try{await _.mutateAsync({shareId:h}),i({message:o("com_ui_shared_link_delete_success"),severity:lx.SUCCESS})}catch(e){console.error("Failed to delete shared link:",e),i({message:o("com_ui_share_delete_error"),severity:lx.ERROR})}},disabled:_.isLoading,children:_.isLoading?l.jsx(Xs,{className:"size-4"}):o("com_ui_delete")})]})]})})]})})}function gD({conversationId:e,open:t,onOpenChange:n,triggerRef:a,children:s}){const r=qN(),[o,i]=ja(!1),[c,d]=ja(""),[u,m]=ja(!1),[p,h]=ja(""),g=gS({text:c}),x=j(N_.latestMessageFamily(0)),{data:f,isLoading:v}=fN(e);ya((()=>{if(void 0!==(null==f?void 0:f.shareId)){const e=`${window.location.protocol}//${window.location.host}/share/${f.shareId}`;d(e)}}),[f]);const _=!0===v?null:l.jsx(hD,{share:f,conversationId:e,targetMessageId:null==x?void 0:x.messageId,showQR:o,setShowQR:i,setSharedLink:d}),b=(null==f?void 0:f.shareId)??"";return l.jsxs(rr,{open:t,onOpenChange:n,triggerRef:a,children:[s,l.jsx(hr,{buttons:_,showCloseButton:!0,showCancelButton:!1,title:r("com_ui_share_link_to_chat"),className:"max-h-[90vh] max-w-[550px] overflow-y-auto",main:l.jsxs("div",{id:"share-conversation-dialog",children:[l.jsx("div",{className:"h-full py-2 text-text-primary",children:!0===v?l.jsx(Xs,{className:"m-auto h-14 animate-spin"}):!0===(null==f?void 0:f.success)?r("com_ui_share_update_message"):r("com_ui_share_create_message")}),l.jsxs("div",{className:"relative items-center overflow-auto rounded-lg p-2",children:[o&&l.jsx("div",{className:"mb-4 flex flex-col items-center",children:l.jsx(Vi,{value:c,size:200,marginSize:2,className:"rounded-2xl",title:r("com_ui_share_qr_code_description")})}),b&&l.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-surface-secondary p-2",children:[l.jsx("div",{className:"flex-1 break-all text-sm text-text-secondary",children:c}),l.jsx("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:p}),l.jsx(Ys,{size:"sm",variant:"outline","aria-label":r("com_ui_copy_link"),onClick:()=>{var e;u||(e=m,h(r("com_ui_link_copied")),g(e),setTimeout((()=>{h("")}),1e3))},className:Qf("shrink-0",u?"cursor-default":""),children:u?l.jsx(de,{className:"size-4","aria-hidden":"true"}):l.jsx(ue,{className:"size-4","aria-hidden":"true"})})]})]})]})})]})}const xD=Sa((function({conversationId:e,title:t,retainView:n,renameHandler:a,isPopoverActive:s,setIsPopoverActive:r,isActiveConvo:o}){const i=qN(),{index:c}=$N(),{data:d}=K_(),{navigateToConvo:u}=CC(c),{showToast:m}=Ds(),p=E(),{conversationId:h}=W(),{newConversation:g}=_C(),x=Ea(),f=ba(null),v=ba(null),[_,b]=ja(!1),[y,j]=ja(!1),[w,N]=ja(""),k=jb(),C=(e=>{const t=xs(),{onSuccess:n,...a}=e??{};return fs((e=>Jh.duplicateConversation(e)),{onSuccess:(e,a,s)=>{const r=e.conversation;(null==r?void 0:r.conversationId)&&(t.setQueryData([Fh.conversation,r.conversationId],r),Wx(t,r),t.setQueryData([Fh.messages,r.conversationId],e.messages),t.invalidateQueries({queryKey:[Fh.allConversations],refetchPage:(e,t)=>0===t}),r.tags&&r.tags.length>0&&t.setQueryData([Fh.conversationTags],(e=>e?e.map((e=>{var t;return(null==(t=r.tags)?void 0:t.includes(e.tag))?{...e,count:e.count+1}:e})):e)),null==n||n(e,a,s))},...a})})({onSuccess:e=>{u(e.conversation),m({message:i("com_ui_duplication_success"),status:"success"}),r(!1)},onMutate:()=>{m({message:i("com_ui_duplication_processing"),status:"info"})},onError:()=>{m({message:i("com_ui_duplication_error"),status:"error"})}}),S=C.isLoading,T=k.isLoading,I=ka((()=>{b(!0)}),[]),R=ka((()=>{j(!0)}),[]),A=ka((async()=>{const t=e??"";t&&k.mutate({conversationId:t,isArchived:!0},{onSuccess:()=>{N(i("com_ui_convo_archived")),setTimeout((()=>{N("")}),1e4),h!==t&&"new"!==h||(g(),p("/c/new",{replace:!0})),n(),r(!1)},onError:()=>{m({message:i("com_ui_archive_error"),severity:lx.ERROR,showIcon:!0})}})}),[e,h,k,p,g,n,r,m,i]),P=ka((()=>{C.mutate({conversationId:e??""})}),[e,C]),O=Ca((()=>[{label:i("com_ui_share"),onClick:I,icon:l.jsx(Ne,{className:"icon-sm mr-2 text-text-primary","aria-hidden":"true"}),show:d&&d.sharedLinksEnabled,ariaHasPopup:"dialog",ariaControls:"share-conversation-dialog",hideOnClick:!1,ref:f,render:e=>l.jsx("button",{...e})},{label:i("com_ui_rename"),onClick:a,icon:l.jsx(tt,{className:"icon-sm mr-2 text-text-primary","aria-hidden":"true"})},{label:i("com_ui_duplicate"),onClick:P,hideOnClick:!1,icon:S?l.jsx(Xs,{className:"size-4"}):l.jsx(Xe,{className:"icon-sm mr-2 text-text-primary","aria-hidden":"true"})},{label:i("com_ui_archive"),onClick:A,hideOnClick:!1,icon:T?l.jsx(Xs,{className:"size-4"}):l.jsx(vn,{className:"icon-sm mr-2 text-text-primary","aria-hidden":"true"})},{label:i("com_ui_delete"),onClick:R,icon:l.jsx(Kt,{className:"icon-sm mr-2 text-text-primary","aria-hidden":"true"}),ariaHasPopup:"dialog",ariaControls:"delete-conversation-dialog",hideOnClick:!1,ref:v,render:e=>l.jsx("button",{...e})}]),[i,I,d,a,R,T,S,A,P]);return l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:w}),l.jsx(cr,{portal:!0,menuId:x,focusLoop:!0,unmountOnHide:!0,isOpen:s,setIsOpen:r,trigger:l.jsx(se,{id:`conversation-menu-${e}`,"aria-label":i("com_nav_convo_menu_options"),"aria-readonly":void 0,className:Qf("inline-flex h-7 w-7 items-center justify-center gap-2 rounded-md border-none p-0 text-sm font-medium ring-ring-primary transition-all duration-200 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50",!0===o||s?"opacity-100":"opacity-0 focus:opacity-100 group-focus-within:opacity-100 group-hover:opacity-100 data-[open]:opacity-100"),onClick:e=>{e.stopPropagation()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.stopPropagation()},children:l.jsx(hn,{className:"icon-md text-text-secondary","aria-hidden":!0})}),items:O,className:"z-30"}),_&&l.jsx(gD,{conversationId:e??"",open:_,onOpenChange:b,triggerRef:f}),y&&l.jsx(pD,{title:t??"",retainView:n,triggerRef:v,setMenuOpen:r,showDeleteDialog:y,conversationId:e??"",setShowDeleteDialog:j})]})}),((e,t)=>e.conversationId===t.conversationId&&e.title===t.title&&e.isPopoverActive===t.isPopoverActive&&e.isActiveConvo===t.isActiveConvo)),fD=({titleInput:e,setTitleInput:t,onSubmit:n,onCancel:a,localize:s})=>{const r=ba(null);ya((()=>{r.current&&(r.current.focus(),r.current.select())}),[]);return l.jsxs("div",{className:"absolute inset-0 z-20 flex w-full items-center rounded-lg bg-surface-active-alt p-1.5",role:"form","aria-label":s("com_ui_rename_conversation"),children:[l.jsx("input",{ref:r,type:"text",className:"w-full rounded bg-transparent p-0.5 text-sm leading-tight focus-visible:outline-none",value:e,onChange:e=>t(e.target.value),onKeyDown:t=>{switch(t.key){case"Escape":a();break;case"Enter":n(e)}},maxLength:100,"aria-label":s("com_ui_new_conversation_title")}),l.jsxs("div",{className:"flex gap-1",role:"toolbar",children:[l.jsx("button",{onClick:()=>a(),className:"rounded-md p-1 hover:opacity-70 focus:outline-none focus:ring-2 focus:ring-ring","aria-label":s("com_ui_cancel"),type:"button",children:l.jsx(re,{className:"h-4 w-4","aria-hidden":"true"})}),l.jsx("button",{onClick:()=>n(e),className:"rounded-md p-1 hover:opacity-70 focus:outline-none focus:ring-2 focus:ring-ring","aria-label":s("com_ui_save"),type:"button",children:l.jsx(Yt,{className:"h-4 w-4","aria-hidden":"true"})})]})]})},vD=({isActiveConvo:e,isPopoverActive:t,title:n,onRename:a,isSmallScreen:s,localize:r,children:o})=>l.jsxs("div",{className:Qf("flex grow items-center gap-2 overflow-hidden rounded-lg px-2",e||t?"bg-surface-active-alt":""),title:n??void 0,"aria-current":e?"page":void 0,style:{width:"100%"},children:[o,l.jsx("div",{className:"relative flex-1 grow overflow-hidden whitespace-nowrap",style:{textOverflow:"clip"},onDoubleClick:e=>{s||(e.preventDefault(),e.stopPropagation(),a())},"aria-label":n||r("com_ui_untitled"),children:n||r("com_ui_untitled")}),l.jsx("div",{className:Qf("absolute bottom-0 right-0 top-0 w-20 rounded-r-lg bg-gradient-to-l",e||t?"from-surface-active-alt":"from-surface-primary-alt from-0% to-transparent group-hover:from-surface-active-alt group-hover:from-40%"),"aria-hidden":"true"})]});function _D({conversation:e,retainView:t,toggleNav:n}){const a=W(),s=qN(),{showToast:r}=Ds(),{navigateToConvo:o}=CC(),{data:i}=G_(),c=Ca((()=>a.conversationId),[a.conversationId]),d=(e=>{const t=xs();return fs((e=>Jh.updateConversation(e)),{onSuccess:(n,a)=>{const s=a.conversationId||e;t.setQueryData([Fh.conversation,s],n),qx(t,s,(()=>n))}})})(c??""),u=j(N_.allConversationsSelector),m=vr("(max-width: 768px)"),{conversationId:p,title:h=""}=e,[g,x]=ja(h||""),[f,v]=ja(!1),[_,b]=ja(!1),y=ba(h);ya((()=>{h!==y.current&&(x(h),y.current=h)}),[h]);const w=Ca((()=>{if(p===Bm.NEW_CONVO)return c===Bm.NEW_CONVO;if(c!==Bm.NEW_CONVO)return c===p;return(null==u?void 0:u[0])===p}),[c,p,u]),N=()=>{b(!1),x(h),v(!0)},k=t=>{if(t){n();const e=window.location.origin,t=`/c/${p}`;window.open(e+t,"_blank")}else c===p||_||(n(),"string"==typeof h&&h.length>0&&(document.title=h),o(e,{currentConvoId:c,resetLatestMessage:!p||p===Bm.NEW_CONVO}))},C={title:h,retainView:t,renameHandler:N,isActiveConvo:w,conversationId:p,isPopoverActive:_,setIsPopoverActive:b};return l.jsxs("div",{className:Qf("group relative flex h-12 w-full items-center rounded-lg md:h-9",w||_?"bg-surface-active-alt before:absolute before:bottom-1 before:left-0 before:top-1 before:w-0.5 before:rounded-full before:bg-black dark:before:bg-white":"hover:bg-surface-active-alt"),role:"button",tabIndex:f?-1:0,"aria-label":s("com_ui_conversation_label",{title:h||s("com_ui_untitled")}),onClick:e=>{f||0===e.button&&k(e.ctrlKey||e.metaKey)},onKeyDown:e=>{f||e.target===e.currentTarget&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),k(!1)))},style:{cursor:f?"default":"pointer"},"data-testid":"convo-item",children:[f?l.jsx(fD,{titleInput:g,setTitleInput:x,onSubmit:async e=>{if(p&&e!==h)try{await d.mutateAsync({conversationId:p,title:e.trim()||s("com_ui_untitled")}),v(!1)}catch(t){cx.error("Error renaming conversation",t),x(h),r({message:s("com_ui_rename_failed"),severity:lx.ERROR,showIcon:!0}),v(!1)}else v(!1)},onCancel:()=>{x(h),v(!1)},localize:s}):l.jsx(vD,{isActiveConvo:w,isPopoverActive:_,title:h,onRename:N,isSmallScreen:m,localize:s,children:l.jsx(rI,{conversation:e,endpointsConfig:i,size:20,context:"menu-item"})}),l.jsx("div",{className:Qf("mr-2 flex origin-left",_||w?"pointer-events-auto max-w-[28px] scale-x-100 opacity-100":"pointer-events-none max-w-0 scale-x-0 opacity-0 group-focus-within:pointer-events-auto group-focus-within:max-w-[28px] group-focus-within:scale-x-100 group-focus-within:opacity-100 group-hover:pointer-events-auto group-hover:max-w-[28px] group-hover:scale-x-100 group-hover:opacity-100"),children:!f&&l.jsx(xD,{...C})})]})}const bD=Sa((({cache:e,rowKey:t,parent:n,index:a,style:s,children:r})=>l.jsx(ml,{cache:e,columnIndex:0,parent:n,rowIndex:a,children:({registerChild:e})=>l.jsx("div",{ref:e,style:s,children:r})},t)));bD.displayName="MeasuredRow";const yD=Sa((()=>{const e=qN();return l.jsxs("div",{className:"mx-auto mt-2 flex items-center justify-center gap-2",children:[l.jsx(Xs,{className:"text-text-primary"}),l.jsx("span",{className:"animate-pulse text-text-primary",children:e("com_ui_loading")})]})}));yD.displayName="LoadingSpinner";const jD=Sa((({isExpanded:e,onToggle:t})=>{const n=qN();return l.jsxs("button",{onClick:t,className:"group flex w-full items-center justify-between px-1 py-2 text-xs font-bold text-text-secondary",type:"button",children:[l.jsx("span",{className:"select-none",children:n("com_ui_chats")}),l.jsx(he,{className:Qf("h-3 w-3 transition-transform duration-200",e?"rotate-180":"")})]})}));jD.displayName="ChatsHeader";const wD=Sa((({groupName:e,isFirst:t})=>{const n=qN();return l.jsx("h2",{className:Qf("pl-1 pt-1 text-text-secondary",!0===t?"mt-0":"mt-2"),style:{fontSize:"0.7rem"},children:n(e)||e})}));wD.displayName="DateLabel";const ND=Sa((({conversation:e,retainView:t,toggleNav:n})=>l.jsx(_D,{conversation:e,retainView:t,toggleNav:n})),((e,t)=>e.conversation.conversationId===t.conversation.conversationId&&e.conversation.title===t.conversation.title&&e.conversation.endpoint===t.conversation.endpoint)),kD=Sa((({conversations:e,moveToTop:t,toggleNav:n,containerRef:a,loadMoreConversations:s,isLoading:r,isSearchLoading:o,isChatsExpanded:i,setIsChatsExpanded:c})=>{const d=qN(),u=j(N_.search),{favorites:m,isLoading:p}=XS(),h=vr("(max-width: 768px)"),g=h?44:34,x=OC(),f=!u.query&&(p||m.length>0||x),v=Ca((()=>e.filter(Boolean)),[e]),_=Ca((()=>Gx(v)),[v]),b=Ca((()=>{const e=[];return f&&e.push({type:"favorites"}),e.push({type:"chats-header"}),i&&(_.forEach((([t,n])=>{e.push({type:"header",groupName:t}),e.push(...n.map((e=>({type:"convo",convo:e}))))})),r&&e.push({type:"loading"})),e}),[_,r,i,f]),y=ba(b);y.current=b;const w=Ca((()=>new pl({fixedWidth:!0,defaultHeight:g,keyMapper:e=>{const t=y.current[e];return t?"favorites"===t.type?"favorites":"chats-header"===t.type?"chats-header":"header"===t.type?`header-${t.groupName}`:"convo"===t.type?`convo-${t.convo.conversationId}`:"loading"===t.type?"loading":`unknown-${e}`:`unknown-${e}`}})),[g]),N=ka((()=>{w&&(w.clear(0,0),a.current&&"recomputeRowHeights"in a.current&&a.current.recomputeRowHeights(0))}),[w,a]);ya((()=>{const e=requestAnimationFrame((()=>{N()}));return()=>cancelAnimationFrame(e)}),[m.length,p,N]);const k=ka((({index:e,key:a,parent:s,style:r})=>{const o=b[e],d={cache:w,rowKey:a,parent:s,index:e,style:r};if("loading"===o.type)return l.jsx(bD,{...d,children:l.jsx(yD,{})},a);if("favorites"===o.type)return l.jsx(bD,{...d,children:l.jsx(uD,{isSmallScreen:h,toggleNav:n,onHeightChange:N})},a);if("chats-header"===o.type)return l.jsx(bD,{...d,children:l.jsx(jD,{isExpanded:i,onToggle:()=>c(!i)})},a);if("header"===o.type){const t=f?2:1;return l.jsx(bD,{...d,children:l.jsx(wD,{groupName:o.groupName,isFirst:e===t})},a)}return"convo"===o.type?l.jsx(bD,{...d,children:l.jsx(ND,{conversation:o.convo,retainView:t,toggleNav:n})},a):null}),[w,b,t,n,N,h,i,c,f]),C=ka((({index:e})=>w.getHeight(e,0)),[w]),S=Ca((()=>_i(s,300)),[s]),T=ka((({stopIndex:e})=>{e>=b.length-8&&S()}),[b.length,S]);return l.jsx("div",{className:"relative flex h-full min-h-0 flex-col pb-2 text-sm text-text-primary",children:o?l.jsxs("div",{className:"flex flex-1 items-center justify-center",children:[l.jsx(Xs,{className:"text-text-primary"}),l.jsx("span",{className:"ml-2 text-text-primary",children:d("com_ui_loading")})]}):l.jsx("div",{className:"flex-1",children:l.jsx(hl,{children:({width:e,height:t})=>l.jsx(gl,{ref:a,width:e,height:t,deferredMeasurementCache:w,rowCount:b.length,rowHeight:C,rowRenderer:k,overscanRowCount:10,"aria-readonly":!1,className:"outline-none","aria-label":"Conversations",onRowsRendered:T,tabIndex:-1,style:{outline:"none",scrollbarGutter:"stable"}})})})})}));function CD({isLast:e,index:t,messageId:n,content:a,className:s,renderButton:r}){var o,i;const c=qN(),d=j(N_.playbackRate),{toggleSpeech:u,isSpeaking:m,audioRef:p}=Yb({isLast:e,index:t,content:a}),h=()=>!0===m?l.jsx(Wo,{className:"icon-md-heavy h-[18px] w-[18px]"}):l.jsx(qo,{className:"icon-md-heavy h-[18px] w-[18px]"});ya((()=>{const e=document.getElementById(`audio-${n}`);e&&null!=d&&d>0&&e.playbackRate!==d&&(e.playbackRate=d)}),[p,m,d,n]),cx.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(o=p.current)?void 0:o.src,p.current);const g=()=>{p.current&&(p.current.muted=!1),u()},x=c(!0===m?"com_ui_stop":"com_ui_read_aloud");return l.jsxs(l.Fragment,{children:[r?r({onClick:g,title:x,icon:h(),isActive:m,className:s}):l.jsx("button",{className:s,onClickCapture:g,type:"button",title:x,children:h()}),l.jsx("audio",{ref:p,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(i=p.current)?void 0:i.src,onError:e=>{cx.error("Error fetching audio:",e)},id:`audio-${n}`,autoPlay:!0})]})}function SD({isLast:e,index:t,messageId:n,content:a,className:s,renderButton:r}){var o,i;const c=qN(),d=j(N_.playbackRate),{toggleSpeech:u,isSpeaking:m,isLoading:p,audioRef:h}=Qb({isLast:e,index:t,messageId:n,content:a}),g=()=>!0===p?l.jsx(Xs,{className:"icon-md-heavy h-[18px] w-[18px]"}):!0===m?l.jsx(Wo,{className:"icon-md-heavy h-[18px] w-[18px]"}):l.jsx(qo,{className:"icon-md-heavy h-[18px] w-[18px]"});return ya((()=>{const e=document.getElementById(`audio-${n}`);e&&null!=d&&d>0&&e.playbackRate!==d&&(e.playbackRate=d)}),[h,m,d,n]),cx.log("MessageAudio: audioRef.current?.src, audioRef.current",null==(o=h.current)?void 0:o.src,h.current),l.jsxs(l.Fragment,{children:[r?r({onClick:()=>{h.current&&(h.current.muted=!1),u()},title:c(!0===m?"com_ui_stop":"com_ui_read_aloud"),icon:g(),isActive:m,className:s}):l.jsx("button",{onClickCapture:()=>{h.current&&(h.current.muted=!1),u()},type:"button",title:c(!0===m?"com_ui_stop":"com_ui_read_aloud"),children:g()}),l.jsx("audio",{ref:h,controls:!0,preload:"none",controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:null==(i=h.current)?void 0:i.src,onError:e=>{cx.error("Error fetching audio:",e)},id:`audio-${n}`,autoPlay:!0})]})}const TD=Sa((function(e){const t=j(N_.engineTTS),n={[tx.browser]:CD,[tx.external]:SD}[t];return n?l.jsx(n,{...e}):null})),ED={AlertCircle:Pe,PenTool:jn,ImageOff:yn,Ban:bn,HelpCircle:_n,CheckCircle:qt,Lightbulb:U,Search:_e,ThumbsUp:Qo,ThumbsDown:Yo};function ID({tag:e,active:t,onClick:n}){const a=qN(),s=ED[e.icon]||Pe,r=a(e.label);return l.jsxs("button",{className:Qf("flex w-full items-center gap-3 rounded-xl p-2 text-text-secondary transition-colors duration-200 hover:bg-surface-hover hover:text-text-primary",t&&"bg-surface-hover font-semibold text-text-primary"),onClick:n,type:"button","aria-label":r,"aria-pressed":t,children:[l.jsx(s,{size:"19",bold:t,"aria-hidden":"true"}),l.jsx("span",{children:r})]})}function RD({isLast:e,feedback:t,onFeedback:n,onOther:a}){var s,r;const o=qN(),i=sn({placement:"bottom"}),c=sn({placement:"bottom"}),d=Ca((()=>Ul("thumbsUp")),[]),u=Ca((()=>Ul("thumbsDown")),[]),m="thumbsUp"===(null==t?void 0:t.rating)?null==(s=t.tag)?void 0:s.key:void 0,p="thumbsDown"===(null==t?void 0:t.rating)?null==(r=t.tag)?void 0:r.key:void 0,h=ka((e=>{e.preventDefault(),"thumbsUp"===(null==t?void 0:t.rating)?n(void 0):i.toggle()}),[t,n,i]),g=ka((e=>t=>{t.preventDefault(),i.hide(),n({rating:"thumbsUp",tag:e}),"other"===e.key&&(null==a||a())}),[n,a,i]),x=ka((e=>{e.preventDefault(),"thumbsDown"===(null==t?void 0:t.rating)?null==a||a():c.toggle()}),[t,a,c]),f=ka((e=>t=>{t.preventDefault(),c.hide(),n({rating:"thumbsDown",tag:e}),"other"===e.key&&(null==a||a())}),[n,a,c]);return l.jsxs(l.Fragment,{children:[l.jsx(cn,{store:i,render:l.jsx("button",{className:AD("thumbsUp"===(null==t?void 0:t.rating),e),onClick:h,type:"button",title:o("com_ui_feedback_positive"),"aria-pressed":"thumbsUp"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:l.jsx(Qo,{size:"19",bold:"thumbsUp"===(null==t?void 0:t.rating)})})}),l.jsx(un,{store:i,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:l.jsx("div",{className:"flex flex-col items-stretch justify-center",children:d.map((e=>l.jsx(ID,{tag:e,active:m===e.key,onClick:g(e)},e.key)))})}),l.jsx(cn,{store:c,render:l.jsx("button",{className:AD("thumbsDown"===(null==t?void 0:t.rating),e),onClick:x,type:"button",title:o("com_ui_feedback_negative"),"aria-pressed":"thumbsDown"===(null==t?void 0:t.rating),"aria-haspopup":"menu",children:l.jsx(Yo,{size:"19",bold:"thumbsDown"===(null==t?void 0:t.rating)})})}),l.jsx(un,{store:c,gutter:8,portal:!0,unmountOnHide:!0,className:"popover-animate flex w-auto flex-col gap-1.5 overflow-hidden rounded-2xl border border-border-medium bg-surface-secondary p-1.5 shadow-lg",children:l.jsx("div",{className:"flex flex-col items-stretch justify-center",children:u.map((e=>l.jsx(ID,{tag:e,active:p===e.key,onClick:f(e)},e.key)))})})]})}function AD(e,t){return Qf("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!t&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",e&&"active text-text-primary bg-surface-hover")}function PD({isLast:e=!1,handleFeedback:t,feedback:n}){var a;const s=qN(),[r,o]=ja(!1),[i,c]=ja(n);ya((()=>{c(n)}),[n]);const d=ka((e=>{c(e),t({feedback:e})}),[t]),u=ka((e=>{var t;"other"===(null==(t=null==e?void 0:e.tag)?void 0:t.key)?o(!0):o(!1),d(e)}),[d]),m=ka((()=>o(!0)),[]),p=ka((()=>{var e,t;("other"!==(null==(e=null==i?void 0:i.tag)?void 0:e.key)||(null==(t=null==i?void 0:i.text)?void 0:t.trim()))&&(d(i),o(!1))}),[i,d]),h=ka((()=>{c(void 0),t({feedback:void 0}),o(!1)}),[t]);return l.jsxs(l.Fragment,{children:[i?(()=>{if(!i)return null;const t="thumbsUp"===i.rating,n=t?Qo:Yo,a=s(t?"com_ui_feedback_positive":"com_ui_feedback_negative");return l.jsx("button",{className:AD(!0,e),onClick:()=>{t?u(void 0):o(!0)},type:"button",title:a,"aria-pressed":"true",children:l.jsx(n,{size:"19",bold:!0})})})():l.jsx(RD,{isLast:e,feedback:i,onFeedback:u,onOther:m}),l.jsx(rr,{open:r,onOpenChange:o,children:l.jsxs(ir,{className:"w-11/12 max-w-lg",children:[l.jsx(lr,{className:"text-token-text-primary text-lg font-semibold leading-6",children:s("com_ui_feedback_more_information")}),l.jsx("textarea",{className:"w-full rounded-xl border border-border-light bg-transparent p-2 text-text-primary",value:(null==i?void 0:i.text)||"",onChange:e=>{c((t=>t?{...t,text:e.target.value}:void 0))},rows:4,placeholder:s("com_ui_feedback_placeholder"),maxLength:500}),l.jsxs("div",{className:"mt-4 flex items-end justify-end gap-2",children:[l.jsx(Ys,{variant:"destructive",onClick:h,children:s("com_ui_delete")}),l.jsx(Ys,{variant:"submit",onClick:p,disabled:!(null==(a=null==i?void 0:i.text)?void 0:a.trim()),children:s("com_ui_save")})]})]})})]})}const OD=e=>"string"==typeof e.content?e.content:Array.isArray(e.content)?e.content.map((e=>{if(null==e)return"";if("string"==typeof e)return e;if("text"in e)return e.text||"";if("think"in e){const t=e.think;return"string"==typeof t?t:t&&"text"in t&&t.text||""}return""})).join(""):e.text||"",LD=Sa((({id:e,onClick:t,title:n,icon:a,isActive:s=!1,isVisible:r=!0,isDisabled:o=!1,isLast:i=!1,className:c=""})=>{const d=Qf("hover-button rounded-lg p-1.5 text-text-secondary-alt transition-colors duration-200","hover:text-text-primary hover:bg-surface-hover","md:group-hover:visible md:group-focus-within:visible md:group-[.final-completion]:visible",!i&&"md:opacity-0 md:group-hover:opacity-100 md:group-focus-within:opacity-100",!r&&"opacity-0","focus-visible:ring-2 focus-visible:ring-black dark:focus-visible:ring-white focus-visible:outline-none",s&&r&&"active text-text-primary bg-surface-hover",c);return l.jsx("button",{id:e,className:d,onClick:t,type:"button",title:n,disabled:o,children:a})}));LD.displayName="HoverButton";const MD=Sa((({index:e,isEditing:t,enterEdit:n,copyToClipboard:a,conversation:s,isSubmitting:r,message:o,regenerate:i,handleContinue:c,latestMessage:d,isLast:u,handleFeedback:m})=>{const p=qN(),[h,g]=ja(!1),[x]=b(N_.textToSpeech),f=Ca((()=>s?s.endpointType??s.endpoint:""),[s]),v=function({error:e=!1,endpoint:t,messageId:n,isEditing:a=!1,isSubmitting:s,searchResult:r=!1,finish_reason:o="",latestMessageId:i,isCreatedByUser:l=!1}){const c=Boolean([Yl.openAI,Yl.custom,Yl.google,Yl.agents,Yl.bedrock,Yl.anthropic,Yl.azureOpenAI].find((e=>e===t))),d=i===n&&o&&"stop"!==o&&!a&&!r&&c,u=Boolean([Yl.azureOpenAI,Yl.openAI,Yl.custom,Yl.agents,Yl.bedrock,Yl.google,Yl.anthropic].find((e=>e===t))),m=!l&&!r&&!a&&!s&&u,p=s||e||r||!u||!c&&!l;return{forkingSupported:!lc(t)&&!r,continueSupported:d,regenerateEnabled:m,isEditableEndpoint:c,hideEditButton:p}}({isEditing:t,isSubmitting:r,error:o.error,endpoint:f??"",messageId:o.messageId,searchResult:o.searchResult,finish_reason:o.finish_reason,isCreatedByUser:o.isCreatedByUser,latestMessageId:null==d?void 0:d.messageId}),{hideEditButton:_,regenerateEnabled:y,continueSupported:j,forkingSupported:w,isEditableEndpoint:N}=v;if(!s)return null;const{isCreatedByUser:k,error:C}=o;if(!0===C)return l.jsx("div",{className:"visible flex justify-center self-end lg:justify-start",children:y&&l.jsx(LD,{onClick:i,title:p("com_ui_regenerate"),icon:l.jsx(Xo,{size:"19"}),isLast:u})});return l.jsxs("div",{className:"group visible flex justify-center gap-0.5 self-end focus-within:outline-none lg:justify-start",children:[x&&l.jsx(TD,{index:e,isLast:u,messageId:o.messageId,content:OD(o),renderButton:e=>l.jsx(LD,{onClick:e.onClick,title:e.title,icon:e.icon,isActive:e.isActive,isLast:u})}),l.jsx(LD,{onClick:()=>a(g),title:p(h?"com_ui_copied_to_clipboard":"com_ui_copy_to_clipboard"),icon:h?l.jsx(uo,{className:"h-[18px] w-[18px]"}):l.jsx(mo,{size:"19"}),isLast:u,className:"ml-0 flex items-center gap-1.5 text-xs "+(r&&k?"md:opacity-0 md:group-hover:opacity-100":"")}),N&&l.jsx(LD,{id:`edit-${o.messageId}`,onClick:()=>{if(t)return n(!0);n()},title:p("com_ui_edit"),icon:l.jsx(Zr,{size:"19"}),isActive:t,isVisible:!_,isDisabled:_,isLast:u,className:k?"":"active"}),l.jsx(rD,{messageId:o.messageId,conversationId:s.conversationId,forkingSupported:w,latestMessageId:null==d?void 0:d.messageId,isLast:u}),!k&&null!=m&&l.jsx(PD,{handleFeedback:m,feedback:o.feedback,isLast:u}),y&&l.jsx(LD,{onClick:i,title:p("com_ui_regenerate"),icon:l.jsx(Xo,{size:"19"}),isLast:u,className:"active"}),j&&l.jsx(LD,{onClick:e=>e&&c(e),title:p("com_ui_continue"),icon:l.jsx(Jo,{className:"w-19 h-19 -rotate-180"}),isLast:u,className:"active"})]})})),DD=Sa((({iconData:e,assistant:t,agent:n})=>{cx.log("icon_data",e,t,n);const{data:a}=G_(),s=Ca((()=>(null==n?void 0:n.name)??""),[n]),r=Ca((()=>{var e;return(null==(e=null==n?void 0:n.avatar)?void 0:e.filepath)??""}),[n]),o=Ca((()=>(null==t?void 0:t.name)??""),[t]),i=Ca((()=>{var e;return(null==(e=null==t?void 0:t.metadata)?void 0:e.avatar)??""}),[t]),c=Ca((()=>{let e="";return t?e=i:n&&(e=r),e}),[t,n,i,r]),d=null==e?void 0:e.iconURL,u=Ca((()=>Cf({endpointsConfig:a,iconURL:d,endpoint:null==e?void 0:e.endpoint})),[a,d,null==e?void 0:e.endpoint]),m=Ca((()=>Zm(a,u,"iconURL")),[a,u]);return!0!==(null==e?void 0:e.isCreatedByUser)&&null!=d&&d.includes("http")?l.jsx(PE,{iconURL:d,modelLabel:null==e?void 0:e.modelLabel,context:"message",assistantAvatar:i,agentAvatar:r,endpointIconURL:m,assistantName:o,agentName:s}):l.jsx(nI,{isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1,endpoint:u,iconURL:c||m,model:null==e?void 0:e.model,assistantName:o,agentName:s,size:28.8})}));DD.displayName="MessageIcon";const FD=Sa((({message:e,isCard:t=!1,siblingIdx:n,siblingCount:a,setSiblingIdx:s,currentEditId:r,isMultiMessage:o=!1,setCurrentEditId:i,isSubmittingFamily:c=!1})=>{var d;const u=qN(),{attachments:m,searchResults:p}=oS({messageId:null==e?void 0:e.messageId,attachments:null==e?void 0:e.attachments}),{edit:h,index:g,agent:x,assistant:f,enterEdit:v,conversation:_,messageLabel:b,isSubmitting:y,latestMessage:w,handleContinue:N,copyToClipboard:k,setLatestMessage:C,regenerateMessage:S,handleFeedback:T}=xS({message:e,searchResults:p,currentEditId:r,isMultiMessage:o,setCurrentEditId:i}),E=ht(oT),I=j(N_.maximizeChatSpace),R=ka((()=>S()),[S]),A=Ca((()=>{var t;return!(null==(t=null==e?void 0:e.children)?void 0:t.length)&&((null==e?void 0:e.depth)===(null==w?void 0:w.depth)||-1===(null==e?void 0:e.depth))}),[null==e?void 0:e.children,null==e?void 0:e.depth,null==w?void 0:w.depth]),P=(null==e?void 0:e.messageId)===(null==w?void 0:w.messageId),O=A&&!c&&t,L=t&&!c&&P,M=Ca((()=>({endpoint:(null==e?void 0:e.endpoint)??(null==_?void 0:_.endpoint),model:(null==e?void 0:e.model)??(null==_?void 0:_.model),iconURL:null==e?void 0:e.iconURL,modelLabel:b,isCreatedByUser:null==e?void 0:e.isCreatedByUser})),[b,null==_?void 0:_.endpoint,null==_?void 0:_.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),D=Ca((()=>O&&!P?()=>{cx.log("latest_message",`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),cx.dir(e),C(e)}:void 0),[O,P,e,C]);if(!e)return null;const F={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:I?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},U={latestCard:L?"bg-surface-secondary":"",cardRender:O?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return l.jsxs("div",{id:e.messageId,"aria-label":pf(e,u),className:Qf(F.common,t?F.card:F.chat,U.latestCard,U.cardRender,U.focus,"message-render"),onClick:D,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!D||D()},role:O?"button":void 0,tabIndex:O?0:void 0,children:[L&&l.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(DD,{iconData:M,assistant:f,agent:x})})}),l.jsxs("div",{className:Qf("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[l.jsx("h2",{className:Qf("select-none font-semibold",E),children:b}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsx(ZM,{edit:h,isLast:A,enterEdit:v,siblingIdx:n,messageId:e.messageId,attachments:m,isSubmitting:y,searchResults:p,setSiblingIdx:s,isLatestMessage:P,isCreatedByUser:e.isCreatedByUser,conversationId:null==_?void 0:_.conversationId,content:e.content})}),!c&&!y||(null==(d=e.children)?void 0:d.length)?l.jsxs(VM,{classes:"text-xs",children:[l.jsx(zM,{siblingIdx:n,siblingCount:a,setSiblingIdx:s}),l.jsx(MD,{index:g,isEditing:h,message:e,enterEdit:v,isSubmitting:y,conversation:_??null,regenerate:R,copyToClipboard:k,handleContinue:N,latestMessage:w,handleFeedback:T,isLast:A})]}):l.jsx(eD,{isCard:t})]})]})]})})),UD=_a.memo((({handleScroll:e,children:t})=>l.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t})));function zD(e){const{showSibling:t,conversation:n,handleScroll:a,siblingMessage:s,latestMultiMessage:r,isSubmittingFamily:o}=fS({message:e.message}),{message:i,currentEditId:c,setCurrentEditId:d}=e;if(!i||"object"!=typeof i)return null;const{children:u,messageId:m=null}=i;return l.jsxs(l.Fragment,{children:[l.jsx(UD,{handleScroll:a,children:t?l.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{className:"flex w-full flex-row flex-wrap justify-between gap-1 md:max-w-5xl md:flex-nowrap md:gap-2 lg:max-w-5xl xl:max-w-6xl",children:[l.jsx(FD,{...e,message:i,isSubmittingFamily:o,isCard:!0}),l.jsx(FD,{...e,isMultiMessage:!0,isCard:!0,message:s??r??void 0,isSubmittingFamily:o})]})}):l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:l.jsx(FD,{...e})})}),l.jsx(GD,{messageId:m,conversation:n,messagesTree:u??[],currentEditId:c,setCurrentEditId:d},m)]})}function VD(e){const t=qN(),{message:n,siblingIdx:a,siblingCount:s,setSiblingIdx:r,currentEditId:o,setCurrentEditId:i}=e,{attachments:c,searchResults:d}=oS({messageId:null==n?void 0:n.messageId,attachments:null==n?void 0:n.attachments}),{edit:u,index:m,agent:p,isLast:h,enterEdit:g,assistant:x,handleScroll:f,conversation:v,isSubmitting:_,latestMessage:b,handleContinue:y,copyToClipboard:w,regenerateMessage:N}=function(e){const t=ba(""),{message:n,currentEditId:a,setCurrentEditId:s}=e,{ask:r,index:o,regenerate:i,isSubmitting:l,conversation:c,latestMessage:d,setAbortScroll:u,handleContinue:m,setLatestMessage:p}=oC(),h=WN(),g=Ik(),{text:x,content:f,children:v,messageId:_=null,isCreatedByUser:b}=n??{},y=_===a,j=0===(null==v?void 0:v.length)||void 0===(null==v?void 0:v.length);ya((()=>{const e=null==c?void 0:c.conversationId;if(e===Bm.NEW_CONVO)return;if(!n)return;if(!j)return;const a=df(n,e),s={textKey:a,"latestText.current":t.current,messageId:n.messageId,convoId:e};let r=null;if(t.current&&"string"==typeof t.current&&t.current.length>0){const e=t.current.split(of);r=e[e.length-1]||null}a!==t.current||null!=e&&null!=r&&e!==r?(cx.log("latest_message","[useMessageHelpers] Setting latest message: ",s),t.current=a,p({...n})):cx.log("latest_message","No change in latest message",s)}),[j,n,p,null==c?void 0:c.conversationId]);const w=ka((e=>s&&s(!0===e?-1:_)),[_,s]),N=ka((e=>{_i((()=>{cx.log("message_scrolling",`useMessageHelpers: setting abort scroll to ${l}, handleScroll event`,e),u(!!l)}),500)()}),[l,u]),k=Ca((()=>{if(!lc(null==c?void 0:c.endpoint))return;const e=(null==c?void 0:c.endpoint)??"",t=(null==n?void 0:n.model)??"";return(null==g?void 0:g[e])?g[e][t]:void 0}),[null==c?void 0:c.endpoint,null==n?void 0:n.model,g]),C=Ca((()=>{if(!cc(null==c?void 0:c.endpoint))return;const e=(null==n?void 0:n.model)??"";return h?h[e]:void 0}),[h,null==c?void 0:c.endpoint,null==n?void 0:n.model]),S=gS({text:x,content:f});return{ask:r,edit:y,agent:C,index:o,isLast:j,assistant:k,enterEdit:w,conversation:c,isSubmitting:l,handleScroll:N,latestMessage:d,handleContinue:m,copyToClipboard:S,regenerateMessage:()=>{l&&!0===b||!n||i(n)}}}(e),k=ht(oT),C=j(N_.maximizeChatSpace),{children:S,messageId:T=null,isCreatedByUser:E}=n??{},I=Ca((()=>{let e="";return!0===E?e=t("com_user_message"):x?e=x.name??t("com_ui_assistant"):p&&(e=p.name??t("com_ui_agent")),e}),[x,p,E,t]),R=Ca((()=>({endpoint:(null==n?void 0:n.endpoint)??(null==v?void 0:v.endpoint),model:(null==n?void 0:n.model)??(null==v?void 0:v.model),iconURL:(null==n?void 0:n.iconURL)??(null==v?void 0:v.iconURL),modelLabel:I,isCreatedByUser:null==n?void 0:n.isCreatedByUser})),[I,null==v?void 0:v.endpoint,null==v?void 0:v.iconURL,null==v?void 0:v.model,null==n?void 0:n.model,null==n?void 0:n.iconURL,null==n?void 0:n.endpoint,null==n?void 0:n.isCreatedByUser]);if(!n)return null;const A={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu",chat:C?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"};return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:f,onTouchMove:f,children:l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{id:T??"","aria-label":pf(n,t),className:Qf(A.common,A.chat,"message-render"),children:[l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full pt-0.5",children:l.jsx(DD,{iconData:R,assistant:x,agent:p})})}),l.jsxs("div",{className:Qf("relative flex w-11/12 flex-col",E?"user-turn":"agent-turn"),children:[l.jsx("h2",{className:Qf("select-none font-semibold text-text-primary",k),children:I}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsx(ZM,{edit:u,isLast:h,enterEdit:g,siblingIdx:a,attachments:c,isSubmitting:_,searchResults:d,messageId:n.messageId,setSiblingIdx:r,isCreatedByUser:n.isCreatedByUser,conversationId:null==v?void 0:v.conversationId,isLatestMessage:T===(null==b?void 0:b.messageId),content:n.content})}),h&&_?l.jsx("div",{className:"mt-1 h-[27px] bg-transparent"}):l.jsxs(VM,{classes:"text-xs",children:[l.jsx(zM,{siblingIdx:a,siblingCount:s,setSiblingIdx:r}),l.jsx(MD,{index:m,isEditing:u,message:n,enterEdit:g,isSubmitting:_,conversation:v??null,regenerate:()=>N(),copyToClipboard:w,handleContinue:y,latestMessage:b,isLast:h})]})]})]})]})})}),l.jsx(GD,{messageId:T,conversation:v,messagesTree:S??[],currentEditId:o,setCurrentEditId:i},T)]})}const $D=Sa((({message:e,isCard:t=!1,siblingIdx:n,siblingCount:a,setSiblingIdx:s,currentEditId:r,isMultiMessage:o=!1,setCurrentEditId:i,isSubmittingFamily:c=!1})=>{var d;const u=qN(),{ask:m,edit:p,index:h,agent:g,assistant:x,enterEdit:f,conversation:v,messageLabel:_,isSubmitting:b,latestMessage:y,handleContinue:w,copyToClipboard:N,setLatestMessage:k,regenerateMessage:C,handleFeedback:S}=xS({message:e,currentEditId:r,isMultiMessage:o,setCurrentEditId:i}),T=ht(oT),E=j(N_.maximizeChatSpace),I=ka((()=>C()),[C]),R=!(null==(d=null==e?void 0:e.children)?void 0:d.length),A=Ca((()=>R&&((null==e?void 0:e.depth)===(null==y?void 0:y.depth)||-1===(null==e?void 0:e.depth))),[R,null==e?void 0:e.depth,null==y?void 0:y.depth]),P=(null==e?void 0:e.messageId)===(null==y?void 0:y.messageId),O=A&&!c&&t,L=t&&!c&&P,M=!!P&&b,D=Ca((()=>({endpoint:(null==e?void 0:e.endpoint)??(null==v?void 0:v.endpoint),model:(null==e?void 0:e.model)??(null==v?void 0:v.model),iconURL:null==e?void 0:e.iconURL,modelLabel:_,isCreatedByUser:null==e?void 0:e.isCreatedByUser})),[_,null==v?void 0:v.endpoint,null==v?void 0:v.model,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.endpoint,null==e?void 0:e.isCreatedByUser]),F=Ca((()=>O&&!P?()=>{cx.log("latest_message",`Message Card click: Setting ${null==e?void 0:e.messageId} as latest message`),cx.dir(e),k(e)}:void 0),[O,P,e,k]);if(!e)return null;const U={common:"group mx-auto flex flex-1 gap-3 transition-all duration-300 transform-gpu ",card:"relative w-full gap-1 rounded-lg border border-border-medium bg-surface-primary-alt p-2 md:w-1/2 md:gap-3 md:p-4",chat:E?"w-full max-w-full md:px-5 lg:px-1 xl:px-5":"md:max-w-[47rem] xl:max-w-[55rem]"},z={latestCard:L?"bg-surface-secondary":"",cardRender:O?"cursor-pointer transition-colors duration-300":"",focus:"focus:outline-none focus:ring-2 focus:ring-border-xheavy"};return l.jsxs("div",{id:e.messageId,"aria-label":pf(e,u),className:Qf(U.common,t?U.card:U.chat,z.latestCard,z.cardRender,z.focus,"message-render"),onClick:F,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!F||F()},role:O?"button":void 0,tabIndex:O?0:void 0,children:[L&&l.jsx("div",{className:"absolute right-0 top-0 m-2 h-3 w-3 rounded-full bg-text-primary"}),l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-center",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(DD,{iconData:D,assistant:x,agent:g})})}),l.jsxs("div",{className:Qf("relative flex w-11/12 flex-col",e.isCreatedByUser?"user-turn":"agent-turn"),children:[l.jsx("h2",{className:Qf("select-none font-semibold",T),children:_}),l.jsxs("div",{className:"flex flex-col gap-1",children:[l.jsx("div",{className:"flex max-w-full flex-grow flex-col gap-0",children:l.jsx(kk.Provider,{value:{messageId:e.messageId,conversationId:null==v?void 0:v.conversationId,isExpanded:!1,isSubmitting:M,isLatestMessage:P},children:l.jsx(gM,{ask:m,edit:p,isLast:A,text:e.text||"",message:e,enterEdit:f,error:!!e.error,isSubmitting:M,unfinished:e.unfinished??!1,isCreatedByUser:e.isCreatedByUser??!0,siblingIdx:n??0,setSiblingIdx:s??(()=>({}))})})}),R&&(!0===c||M)?l.jsx(eD,{isCard:t}):l.jsxs(VM,{classes:"text-xs",children:[l.jsx(zM,{siblingIdx:n,siblingCount:a,setSiblingIdx:s}),l.jsx(MD,{index:h,isEditing:p,message:e,enterEdit:f,isSubmitting:b,conversation:v??null,regenerate:I,copyToClipboard:N,handleContinue:w,latestMessage:y,handleFeedback:S,isLast:A})]})]})]})]})})),BD=_a.memo((({handleScroll:e,children:t})=>l.jsx("div",{className:"text-token-text-primary w-full border-0 bg-transparent dark:border-0 dark:bg-transparent",onWheel:e,onTouchMove:e,children:t})));function HD(e){const{showSibling:t,conversation:n,handleScroll:a,siblingMessage:s,latestMultiMessage:r,isSubmittingFamily:o}=fS({message:e.message}),{message:i,currentEditId:c,setCurrentEditId:d}=e,u=j(N_.maximizeChatSpace);if(!i||"object"!=typeof i)return null;const{children:m,messageId:p=null}=i;return l.jsxs(l.Fragment,{children:[l.jsx(BD,{handleScroll:a,children:t?l.jsx("div",{className:"m-auto my-2 flex justify-center p-4 py-2 md:gap-6",children:l.jsxs("div",{className:Qf("flex w-full flex-row flex-wrap justify-between gap-1 md:flex-nowrap md:gap-2",u?"w-full max-w-full":"md:max-w-5xl xl:max-w-6xl"),children:[l.jsx($D,{...e,message:i,isSubmittingFamily:o,isCard:!0}),l.jsx($D,{...e,isMultiMessage:!0,isCard:!0,message:s??r??void 0,isSubmittingFamily:o})]})}):l.jsx("div",{className:"m-auto justify-center p-4 py-2 md:gap-6",children:l.jsx($D,{...e})})}),l.jsx(GD,{messageId:p,conversation:n,messagesTree:m??[],currentEditId:c,setCurrentEditId:d},p)]})}function GD({messageId:e,messagesTree:t,currentEditId:n,setCurrentEditId:a}){const[s,r]=b(N_.messagesSiblingIdxFamily(e)),o=ka((e=>{r(((null==t?void 0:t.length)??0)-e-1)}),[null==t?void 0:t.length,r]);if(ya((()=>{r(0)}),[null==t?void 0:t.length,r]),ya((()=>{(null==t?void 0:t.length)&&s>=t.length&&r(0)}),[s,null==t?void 0:t.length,r]),!t||!t.length)return null;const i=t[t.length-s-1];return i?lc(i.endpoint)&&i.content?l.jsx(VD,{message:i,currentEditId:n,setCurrentEditId:a,siblingIdx:t.length-s-1,siblingCount:t.length,setSiblingIdx:o},i.messageId):i.content?l.jsx(zD,{message:i,currentEditId:n,setCurrentEditId:a,siblingIdx:t.length-s-1,siblingCount:t.length,setSiblingIdx:o},i.messageId):l.jsx(HD,{message:i,currentEditId:n,setCurrentEditId:a,siblingIdx:t.length-s-1,siblingCount:t.length,setSiblingIdx:o},i.messageId):null}function KD({messagesTree:e}){const t=qN(),n=ht(oT),{screenshotTargetRef:a}=IC(),s=j(N_.showScrollButton),[r,o]=ja(-1),i=ba(null),{conversation:c,scrollableRef:d,messagesEndRef:u,showScrollButton:m,handleSmoothToRef:p,debouncedHandleScroll:h}=bS(e),{conversationId:g}=c??{};return l.jsx(l.Fragment,{children:l.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:l.jsxs("div",{className:"relative h-full",children:[l.jsx("div",{className:"scrollbar-gutter-stable",onScroll:h,ref:d,style:{height:"100%",overflowY:"auto",width:"100%"},children:l.jsxs("div",{className:"flex flex-col pb-9 dark:bg-transparent",children:[e&&0==e.length||null===e?l.jsx("div",{className:Qf("flex w-full items-center justify-center p-3 text-text-secondary",n),children:t("com_ui_nothing_found")}):l.jsx(l.Fragment,{children:l.jsx("div",{ref:a,children:l.jsx(GD,{messagesTree:e,messageId:g??null,setCurrentEditId:o,currentEditId:r??null},g)})}),l.jsx("div",{id:"messages-end",className:"group h-0 w-full flex-shrink-0",ref:u})]})}),l.jsx(Qi,{in:m&&s,timeout:{enter:550,exit:700},classNames:"scroll-animation",unmountOnExit:!0,appear:!0,nodeRef:i,children:l.jsx(YM,{ref:i,scrollHandler:p})})]})})})}function WD({messagesTree:e}){return l.jsx(rC,{children:l.jsx(KD,{messagesTree:e})})}const qD=Sa((({isActive:e})=>{const t=qN();return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:`fixed inset-0 z-[9998] transition-opacity duration-200 ease-in-out ${e?"pointer-events-auto visible opacity-100":"pointer-events-none invisible opacity-0"} `,style:{backgroundColor:"rgba(0, 0, 0, 0.4)",willChange:"opacity"}}),l.jsx("div",{className:`fixed inset-0 z-[9999] flex flex-col items-center justify-center gap-2 text-text-primary transition-all duration-200 ease-in-out ${e?"pointer-events-auto visible opacity-100":"pointer-events-none invisible opacity-0"} `,style:{transform:e?"scale(1)":"scale(0.95)",willChange:"opacity, transform"},children:l.jsxs("div",{className:"bg-surface-primary/95 flex flex-col items-center rounded-lg p-8 shadow-xl",children:[l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 132 108",fill:"none",width:"132",height:"108",style:{transform:e?"translateY(0)":"translateY(-10px)",transition:"transform 0.2s ease-in-out"},children:[l.jsx("g",{clipPath:"url(#clip0_3605_64419)",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.2025 29.3514C10.778 33.2165 8.51524 37.1357 11.8281 49.4995L13.4846 55.6814C16.7975 68.0453 20.7166 70.308 35.1411 66.443L43.3837 64.2344C57.8082 60.3694 60.0709 56.4502 56.758 44.0864L55.1016 37.9044C51.7887 25.5406 47.8695 23.2778 33.445 27.1428L29.3237 28.2471L25.2025 29.3514ZM18.1944 42.7244C18.8572 41.5764 20.325 41.1831 21.4729 41.8459L27.3517 45.24C28.4996 45.9027 28.8929 47.3706 28.2301 48.5185L24.836 54.3972C24.1733 55.5451 22.7054 55.9384 21.5575 55.2757C20.4096 54.613 20.0163 53.1451 20.6791 51.9972L22.8732 48.1969L19.0729 46.0028C17.925 45.3401 17.5317 43.8723 18.1944 42.7244ZM29.4091 56.3843C29.066 55.104 29.8258 53.7879 31.1062 53.4449L40.3791 50.9602C41.6594 50.6172 42.9754 51.377 43.3184 52.6573C43.6615 53.9376 42.9017 55.2536 41.6214 55.5967L32.3485 58.0813C31.0682 58.4244 29.7522 57.6646 29.4091 56.3843Z",fill:"#AFC1FF"})}),l.jsx("g",{clipPath:"url(#clip1_3605_64419)",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M86.8124 13.4036C81.0973 11.8722 78.5673 13.2649 77.0144 19.0603L68.7322 49.97C67.1793 55.7656 68.5935 58.2151 74.4696 59.7895L97.4908 65.958C103.367 67.5326 105.816 66.1184 107.406 60.1848L115.393 30.379C115.536 29.8456 115.217 29.2959 114.681 29.16C113.478 28.8544 112.435 28.6195 111.542 28.4183C106.243 27.2253 106.22 27.2201 109.449 20.7159C109.73 20.1507 109.426 19.4638 108.816 19.3004L86.8124 13.4036ZM87.2582 28.4311C86.234 28.1567 85.1812 28.7645 84.9067 29.7888C84.6323 30.813 85.2401 31.8658 86.2644 32.1403L101.101 36.1158C102.125 36.3902 103.178 35.7824 103.453 34.7581C103.727 33.7339 103.119 32.681 102.095 32.4066L87.2582 28.4311ZM82.9189 37.2074C83.1934 36.1831 84.2462 35.5753 85.2704 35.8497L100.107 39.8252C101.131 40.0996 101.739 41.1524 101.465 42.1767C101.19 43.201 100.137 43.8088 99.1132 43.5343L84.2766 39.5589C83.2523 39.2844 82.6445 38.2316 82.9189 37.2074ZM83.2826 43.2683C82.2584 42.9939 81.2056 43.6017 80.9311 44.626C80.6567 45.6502 81.2645 46.703 82.2888 46.9775L89.7071 48.9652C90.7313 49.2396 91.7841 48.6318 92.0586 47.6076C92.333 46.5833 91.7252 45.5305 90.7009 45.256L83.2826 43.2683Z",fill:"#7989FF"})}),l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M40.4004 71.8426C40.4004 57.2141 44.0575 53.5569 61.1242 53.5569H66.0004H70.8766C87.9432 53.5569 91.6004 57.2141 91.6004 71.8426V79.1569C91.6004 93.7855 87.9432 97.4426 70.8766 97.4426H61.1242C44.0575 97.4426 40.4004 93.7855 40.4004 79.1569V71.8426ZM78.8002 67.4995C78.8002 70.1504 76.6512 72.2995 74.0002 72.2995C71.3492 72.2995 69.2002 70.1504 69.2002 67.4995C69.2002 64.8485 71.3492 62.6995 74.0002 62.6995C76.6512 62.6995 78.8002 64.8485 78.8002 67.4995ZM60.7204 70.8597C60.2672 70.2553 59.5559 69.8997 58.8004 69.8997C58.045 69.8997 57.3337 70.2553 56.8804 70.8597L47.2804 83.6597C46.4851 84.72 46.7 86.2244 47.7604 87.0197C48.8208 87.8149 50.3251 87.6 51.1204 86.5397L58.8004 76.2997L66.4804 86.5397C66.8979 87.0962 67.5363 87.4443 68.2303 87.4936C68.9243 87.5429 69.6055 87.2887 70.0975 86.7967L74.8004 82.0938L79.5034 86.7967C80.4406 87.734 81.9602 87.734 82.8975 86.7967C83.8347 85.8595 83.8347 84.3399 82.8975 83.4026L76.4975 77.0026C75.5602 76.0653 74.0406 76.0653 73.1034 77.0026L68.6601 81.4459L60.7204 70.8597Z",fill:"#3C46FF"}),l.jsxs("defs",{children:[l.jsx("clipPath",{id:"clip0_3605_64419",children:l.jsx("rect",{width:"56",height:"56",fill:"white",transform:"translate(0 26.9939) rotate(-15)"})}),l.jsx("clipPath",{id:"clip1_3605_64419",children:l.jsx("rect",{width:"64",height:"64",fill:"white",transform:"translate(69.5645 0.5) rotate(15)"})})]})]}),l.jsx("h3",{className:"mt-4 text-lg font-semibold",children:t("com_ui_upload_files")}),l.jsx("h4",{className:"text-sm text-text-secondary",children:t("com_ui_drag_drop")})]})})]})}));qD.displayName="DragDropOverlay";const QD=({onOptionSelect:e,setShowModal:t,files:n,isVisible:a})=>{const s=qN(),{agentsConfig:r}=ZN(),o=JN((null==r?void 0:r.capabilities)??$u),{conversationId:i,agentId:c,endpoint:d,endpointType:u}=function(){const e=Na(Wk);if(!e)throw new Error("useDragDropContext must be used within DragDropProvider");return e}(),m=j(__(i??"")),{fileSearchAllowedByAgent:p,codeAllowedByAgent:h,provider:g}=cC(c,m),x=Ca((()=>{const e=[],t=g||d,a=e=>dd(e.name,e.type);if(tc(u)||tc(t)){const r=t===Yl.google?n.every((e=>{const t=a(e);return(null==t?void 0:t.startsWith("image/"))||(null==t?void 0:t.startsWith("video/"))||(null==t?void 0:t.startsWith("audio/"))||"application/pdf"===t})):n.every((e=>{const t=a(e);return(null==t?void 0:t.startsWith("image/"))||"application/pdf"===t}));e.push({label:s("com_ui_upload_provider"),value:void 0,icon:l.jsx(wn,{className:"icon-md"}),condition:r})}else e.push({label:s("com_ui_upload_image_input"),value:void 0,icon:l.jsx(Nn,{className:"icon-md"}),condition:n.every((e=>{var t;return null==(t=a(e))?void 0:t.startsWith("image/")}))});return o.fileSearchEnabled&&p&&e.push({label:s("com_ui_upload_file_search"),value:kl.file_search,icon:l.jsx(kn,{className:"icon-md"})}),o.codeEnabled&&h&&e.push({label:s("com_ui_upload_code_files"),value:kl.execute_code,icon:l.jsx(A,{className:"icon-md"})}),o.contextEnabled&&e.push({label:s("com_ui_upload_ocr_text"),value:kl.context,icon:l.jsx(Cn,{className:"icon-md"})}),e}),[n,s,g,d,u,o,h,p]);return a?l.jsx(rr,{open:a,onOpenChange:t,children:l.jsx(hr,{title:s("com_ui_upload_type"),className:"w-11/12 sm:w-[440px] md:w-[400px] lg:w-[360px]",main:l.jsx("div",{className:"flex flex-col gap-2",children:x.map(((t,n)=>!1!==t.condition&&l.jsxs("button",{onClick:()=>e(t.value),className:"flex items-center gap-2 rounded-lg p-2 hover:bg-surface-active-alt",children:[t.icon,l.jsx("span",{children:t.label})]},n)))})})}):null};function YD({children:e,className:t}){const{isOver:n,canDrop:a,drop:s,showModal:r,setShowModal:o,draggedFiles:i,handleOptionSelect:c}=function(){const e=xs(),{showToast:t}=Ds(),n=qN(),[a,s]=ja(!1),[r,o]=ja([]),i=j(N_.conversationByIndex(0))||void 0,l=y(__((null==i?void 0:i.conversationId)??Bm.NEW_CONVO)),c=Ca((()=>lc(null==i?void 0:i.endpoint)),[null==i?void 0:i.endpoint]),{handleFiles:d}=BC(),u=ka((e=>{e&&e!==kl.file_search&&l((t=>({...t,[e]:!0}))),d(r,e),s(!1),o([])}),[r,d,l]),m=ba(d),p=ba(i);m.current=d,p.current=i;const h=ka((a=>{var r,i,l;const d=(null==(r=p.current)?void 0:r.endpoint)??"default",u=(null==(i=p.current)?void 0:i.endpointType)??void 0,h=e.getQueryData([Fh.fileConfig]);if(h){const e=jd({fileConfig:wd(h),endpoint:d,endpointType:u});if(!0===(null==e?void 0:e.disabled))return void t({message:n("com_ui_attach_error_disabled"),status:"error"})}if(c)return void m.current(a.files);const g=e.getQueryData([Fh.endpoints]),x=null==g?void 0:g[Yl.agents],f=(null==x?void 0:x.capabilities)??$u,v=!0===f.includes(Au.file_search),_=!0===f.includes(Au.execute_code),b=!0===f.includes(Au.context),y=null==(l=p.current)?void 0:l.agent_id;let j=!0,w=!0;if(y&&!Zg(y)){const t=e.getQueryData([Fh.agent,y]);if(t){const e=t.tools;j=(null==e?void 0:e.includes(Nl.file_search))??!1,w=(null==e?void 0:e.includes(Nl.execute_code))??!1}else j=!1,w=!1}a.files.every((e=>{var t;return null==(t=e.type)?void 0:t.startsWith("image/")}))||v&&j||_&&w||b?(o(a.files),s(!0)):m.current(a.files)}),[c,e,t,n]),[{canDrop:g,isOver:x},f]=ls((()=>({accept:[cs],drop:h,canDrop:()=>!0,collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})})),[h]);return{canDrop:g,isOver:x,drop:f,showModal:a,setShowModal:s,draggedFiles:r,handleOptionSelect:u}}(),d=a&&n;return l.jsxs("div",{ref:s,className:Qf("relative flex h-full w-full",t),children:[e,l.jsx(qD,{isActive:d}),l.jsx(qk,{children:l.jsx(QD,{files:i,isVisible:r,setShowModal:o,onOptionSelect:c})})]})}function XD({children:e}){const t=j(N_.artifactsState),n=j(N_.artifactsVisibility),a=mC(),{mutateAsync:s}=W_({onSuccess:()=>{console.log("Temporary Files deleted"),a({})},onError:e=>{console.log("Error deleting temporary files:",e)}});ya((()=>{const e=localStorage.getItem(Hm.FILES_TO_DELETE),t=JSON.parse(e??"{}"),n=Object.values(t).filter((e=>null!=e.filepath&&e.source&&!e.embedded&&e.temp_file_id)).map((e=>({file_id:e.file_id,filepath:e.filepath,source:e.source,embedded:!!e.embedded})));0!==n.length&&s({files:n})}),[s]);const r=Ca((()=>{const e=localStorage.getItem("react-resizable-panels:layout");return"string"==typeof e?JSON.parse(e):void 0}),[]),o=Ca((()=>{const e=localStorage.getItem("react-resizable-panels:collapsed");return"string"!=typeof e||JSON.parse(e)}),[]),i=Ca((()=>"true"===localStorage.getItem("fullPanelCollapse")),[]),c=Ca((()=>!0===n&&Object.keys(t??{}).length>0?l.jsx(Yk,{children:l.jsx(vk,{children:l.jsx(XL,{})})}):null),[n,t]);return l.jsx(YD,{className:"relative flex w-full grow overflow-hidden bg-presentation",children:l.jsx(Kk,{children:l.jsx(ZP,{defaultLayout:r,fullPanelCollapse:i,defaultCollapsed:o,artifacts:c,children:l.jsx("main",{className:"flex h-full flex-col overflow-y-auto",role:"main",children:e})})})})}const JD=_a.memo((({agentId:e,endpoint:t,disabled:n,endpointType:a,conversationId:s,endpointFileConfig:r})=>{const o=qN(),i=n??!1,c=ba(null),[d,u]=ja(!1),[m,p]=b(__(s)),[h,g]=ja(),{handleFileChange:x}=BC(),{handleSharePointFiles:f,isProcessing:v,downloadProgress:_}=GC({toolResource:h}),{agentsConfig:y}=ZN(),{data:j}=K_(),w=null==j?void 0:j.sharePointFilePickerEnabled,[N,k]=ja(!1),C=JN((null==y?void 0:y.capabilities)??$u),{fileSearchAllowedByAgent:S,codeAllowedByAgent:T,provider:E}=cC(e,m),I=e=>{c.current&&(c.current.value="",c.current.accept="image"===e?"image/*":"document"===e?".pdf,application/pdf":"multimodal"===e?"image/*,.pdf,application/pdf":"google_multimodal"===e?"image/*,.pdf,application/pdf,video/*,audio/*":"",c.current.click(),c.current.accept="")},R=Ca((()=>{const e=e=>{const n=[],s=E||t;return tc(a)||tc(s)?n.push({label:o("com_ui_upload_provider"),onClick:()=>{g(void 0),e((E||t)===Yl.google?"google_multimodal":"multimodal")},icon:l.jsx(wn,{className:"icon-md"})}):n.push({label:o("com_ui_upload_image_input"),onClick:()=>{g(void 0),e("image")},icon:l.jsx(Nn,{className:"icon-md"})}),C.contextEnabled&&n.push({label:o("com_ui_upload_ocr_text"),onClick:()=>{g(kl.context),e()},icon:l.jsx(Cn,{className:"icon-md"})}),C.fileSearchEnabled&&S&&n.push({label:o("com_ui_upload_file_search"),onClick:()=>{g(kl.file_search),p((e=>({...e,[kl.file_search]:!0}))),e()},icon:l.jsx(kn,{className:"icon-md"})}),C.codeEnabled&&T&&n.push({label:o("com_ui_upload_code_files"),onClick:()=>{g(kl.execute_code),p((e=>({...e,[kl.execute_code]:!0}))),e()},icon:l.jsx(A,{className:"icon-md"})}),n},n=e(I);if(w){const t=e((()=>{k(!0)}));return n.push({label:o("com_files_upload_sharepoint"),onClick:()=>{},icon:l.jsx(qr,{className:"icon-md"}),subItems:t}),n}return n}),[o,t,E,a,C,g,p,w,T,S,k]),P=l.jsx(pr,{render:l.jsx(se,{disabled:i,id:"attach-file-menu-button","aria-label":"Attach File Options",className:Qf("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50",d&&"bg-surface-hover"),children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(Qr,{})})}),id:"attach-file-menu-button",description:o("com_sidepanel_attach_files"),disabled:i});return l.jsxs(l.Fragment,{children:[l.jsx(Zo,{ref:c,handleFileChange:e=>{x(e,h)},children:l.jsx(cr,{menuId:"attach-file-menu",className:"overflow-visible",isOpen:d,setIsOpen:u,modal:!0,unmountOnHide:!0,trigger:P,items:R,iconClassName:"mr-0"})}),l.jsx(eI,{isOpen:N,onOpenChange:k,onFilesSelected:async e=>{try{await f(e),k(!1)}catch(t){console.error("SharePoint file processing error:",t)}},isDownloading:v,downloadProgress:_,maxSelectionCount:null==r?void 0:r.fileLimit})]})})),ZD=_a.memo((({disabled:e})=>{const t=qN(),n=ba(null),a=e??!1,{handleFileChange:s}=BC();return l.jsx(Zo,{ref:n,handleFileChange:s,children:l.jsx(pr,{description:t("com_sidepanel_attach_files"),id:"attach-file",disabled:a,render:l.jsx("button",{type:"button","aria-label":t("com_sidepanel_attach_files"),disabled:a,className:Qf("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50"),onKeyDownCapture:e=>{n.current&&("Enter"!==e.key&&" "!==e.key||(n.current.value="",n.current.click()))},onClick:()=>{n.current&&(n.current.value="",n.current.click())},children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(Qr,{})})})})})}));const eF=Sa((function({disableInputs:e,conversation:t}){const n=(null==t?void 0:t.conversationId)??Bm.NEW_CONVO,{endpoint:a}=t??{endpoint:null},s=Ca((()=>cc(a)),[a]),r=Ca((()=>lc(a)),[a]),{data:o=null}=Y_({select:e=>wd(e)}),{data:i}=G_(),c=Ca((()=>Zm(i,a,"type")||a),[a,i]),d=Ca((()=>jd({endpoint:a,fileConfig:o,endpointType:c})),[a,o,c]),u=Ca((()=>Zc[c??a??""]??!1),[c,a]),m=Ca((()=>(e||(null==d?void 0:d.disabled))??!1),[e,null==d?void 0:d.disabled]);return r&&u&&!m?l.jsx(ZD,{disabled:e}):s||u&&!m?l.jsx(JD,{endpoint:a,disabled:e,endpointType:c,conversationId:n,agentId:null==t?void 0:t.agent_id,endpointFileConfig:d}):null}));const tF=Sa((function({conversation:e}){const{files:t,setFiles:n,setFilesLoading:a}=$N(),s=j(N_.chatDirection).toLowerCase(),{endpoint:r}=e??{endpoint:null},{abortUpload:o}=BC(),i="rtl"===s;return l.jsx(l.Fragment,{children:l.jsx(TI,{files:t,setFiles:n,abortUpload:o,setFilesLoading:a,isRTL:i,Wrapper:({children:e})=>l.jsx("div",{className:"mx-2 mt-2 flex flex-wrap gap-2",children:e})})})}));function nF({addedConvo:e,setAddedConvo:t}){const n=pC(),{data:a}=G_(),s=Ca((()=>`+ ${n(e)}: ${Jx(e)}`),[e,n]);return e?l.jsxs("div",{className:"flex items-start gap-4 py-2.5 pl-3 pr-1.5 text-sm",children:[l.jsx("span",{className:"mt-0 flex h-6 w-6 flex-shrink-0 items-center justify-center",children:l.jsx("div",{className:"icon-md",children:l.jsx(rI,{conversation:e,endpointsConfig:a,containerClassName:"shadow-stroke overflow-hidden rounded-full",context:"menu-item",size:20})})}),l.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:s}),l.jsx("button",{className:"text-token-text-secondary flex-shrink-0",type:"button","aria-label":"Close added conversation",onClick:()=>t(null),children:l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",className:"icon-lg","aria-hidden":"true",children:l.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M7.293 7.293a1 1 0 0 1 1.414 0L12 10.586l3.293-3.293a1 1 0 1 1 1.414 1.414L13.414 12l3.293 3.293a1 1 0 0 1-1.414 1.414L12 13.414l-3.293 3.293a1 1 0 0 1-1.414-1.414L10.586 12 7.293 8.707a1 1 0 0 1 0-1.414",clipRule:"evenodd"})})})]}):null}function aF({addedConvo:e,setAddedConvo:t}){return e?l.jsx("div",{className:"m-1.5 flex flex-col divide-y overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:l.jsx(nF,{addedConvo:e,setAddedConvo:t})}):null}function sF({name:e,onClick:t,index:n,icon:a,isActive:s,description:r,style:o,type:i="mention"}){return l.jsx("button",{tabIndex:n,onClick:t,id:`${i}-item-${n}`,className:"w-full",style:o,children:l.jsxs("div",{className:Qf("text-token-text-primary bg-token-main-surface-secondary group flex h-10 items-center gap-2 rounded-lg px-2 text-sm font-medium hover:bg-surface-secondary",!0===s?"bg-surface-active":"bg-transparent"),children:[l.jsx("div",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center",children:a}),l.jsxs("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[l.jsxs("div",{className:"truncate",children:[l.jsx("span",{className:"font-medium",children:e}),null!=r&&r?l.jsx("span",{className:"text-token-text-tertiary ml-2 text-sm font-light",children:r}):null]}),l.jsx(Sn,{size:16,className:"ml-2 flex-shrink-0"})]})]})})}const rF=Sa((({index:e,children:t,isVariableDialogOpen:n,variableGroup:a,setVariableDialogOpen:s,textAreaRef:r})=>{const o=j(N_.showPromptsPopoverFamily(e));return l.jsxs(l.Fragment,{children:[o?t:null,l.jsx(yP,{open:n,onClose:()=>{s(!1),requestAnimationFrame((()=>{var e;null==(e=r.current)||e.focus()}))},group:a})]})}));const oF=Sa((function({index:e,textAreaRef:t,submitPrompt:n}){const a=qN(),{allPromptGroups:s,hasAccess:r}=aC(),{data:o,isLoading:i}=s,[c,d]=ja(0),u=ba(null),m=ba(null),[p,h]=ja(!1),[g,x]=ja(null),f=y(N_.showPromptsPopoverFamily(e)),v=Ca((()=>null==o?void 0:o.promptGroups),[o]),_=Ca((()=>null==o?void 0:o.promptsMap),[o]),{open:b,setOpen:j,searchValue:w,setSearchValue:N,matches:k}=ei({value:"",options:v??[]}),C=ka(((e,a)=>{var s,r;if(!e)return;N(""),j(!1),f(!1),t.current&&sf(t.current,"/");const o=null==_?void 0:_[e.id];if(!o)return;if(ef((null==(s=o.productionPrompt)?void 0:s.prompt)??""))return a&&"Tab"===a.key&&a.preventDefault(),x(o),void h(!0);n((null==(r=o.productionPrompt)?void 0:r.prompt)??"")}),[N,j,f,t,_,n]);if(ya((()=>{b?x(null):d(0)}),[b]),ya((()=>()=>{u.current&&clearTimeout(u.current)}),[]),ya((()=>{const e=document.getElementById(`prompt-item-${c}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})}),[c]),!r)return null;const S=({index:e,key:t,style:n})=>{const a=k[e];return l.jsx(sF,{index:e,type:"prompt",style:n,onClick:()=>{u.current&&clearTimeout(u.current),u.current=null,C(a)},name:a.label??"",icon:a.icon,description:a.description,isActive:e===c},t)};return l.jsx(rF,{index:e,isVariableDialogOpen:p,variableGroup:g,setVariableDialogOpen:h,textAreaRef:t,children:l.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:l.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-surface-tertiary-alt p-2 shadow-lg",children:[l.jsx("input",{autoFocus:!0,ref:m,placeholder:a("com_ui_command_usage_placeholder"),className:"mb-1 w-full border-0 bg-surface-tertiary-alt p-2 text-sm focus:outline-none dark:text-gray-200",autoComplete:"off",value:w,onKeyDown:e=>{var n,a;"Escape"===e.key&&(j(!1),f(!1),null==(n=t.current)||n.focus()),"ArrowDown"===e.key?d((e=>(e+1)%k.length)):"ArrowUp"===e.key?d((e=>(e-1+k.length)%k.length)):"Enter"===e.key||"Tab"===e.key?("Enter"===e.key&&e.preventDefault(),C(k[c],e)):"Backspace"===e.key&&""===w&&(j(!1),f(!1),null==(a=t.current)||a.focus())},onChange:e=>N(e.target.value),onFocus:()=>j(!0),onBlur:()=>{u.current=setTimeout((()=>{j(!1),f(!1)}),150)}}),l.jsx("div",{className:"max-h-40 overflow-y-auto",children:i&&b?l.jsx("div",{className:"flex h-32 items-center justify-center text-text-primary",children:l.jsx(Xs,{})}):!i&&b?l.jsx("div",{className:"max-h-40",children:l.jsx(hl,{disableHeight:!0,children:({width:e})=>l.jsx(gl,{width:e,overscanRowCount:5,rowHeight:40,rowCount:k.length,rowRenderer:S,scrollToIndex:c,height:Math.min(40*k.length,160)})})}):null})]})})})})),iF=e=>"external"===e;function lF({disabled:e,ask:t,methods:n,textAreaRef:a,isSubmitting:s}){const{setValue:r,reset:o,getValues:i}=n,c=qN(),{showToast:d}=Ds(),{speechToTextEndpoint:u}=ZC(),m=ba(""),p=ka((e=>{if(s)d({message:c("com_ui_speech_while_submitting"),status:"error"});else if(e){const n=document.getElementById(ax);n&&(console.log("Unmuting global audio"),n.muted=!1);const a=iF(u)&&m.current?`${m.current} ${e}`:e;t({text:a}),o({text:""}),m.current=""}}),[t,o,d,c,s,u]),h=ka((e=>{let t=e;t=(iF(u),m.current?`${m.current} ${e}`:e),r("text",t,{shouldValidate:!0})}),[r,u]),{isListening:g,isLoading:x,startRecording:f,stopRecording:v}=tS(h,p);if(!a.current)return null;return l.jsx(pr,{description:c("com_ui_use_micrphone"),render:l.jsx("button",{id:"audio-recorder",type:"button","aria-label":c("com_ui_use_micrphone"),onClick:!0===g?async()=>{v(),iF(u)||(m.current="")}:async()=>{m.current=i("text")||"",f()},disabled:e,className:Qf("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover"),title:c("com_ui_use_micrphone"),"aria-pressed":g,children:!0===g?l.jsx(Tn,{className:"stroke-red-500"}):!0===x?l.jsx(Xs,{className:"stroke-text-secondary"}):l.jsx(ti,{className:"stroke-text-secondary"})})})}const cF=({isScrollable:e,isCollapsed:t,setIsCollapsed:n})=>{const a=qN();if(!e)return null;const s=a(t?"com_ui_expand_chat":"com_ui_collapse_chat");return l.jsx("div",{className:"relative ml-auto items-end justify-end",children:l.jsx(pr,{description:s,render:l.jsx("button",{"aria-label":s,onClick:e=>{e.preventDefault(),e.stopPropagation(),n((e=>!e))},className:Qf("z-10 size-5 rounded-full transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-opacity-50"),children:t?l.jsx(gt,{className:"h-full w-full","aria-hidden":"true"}):l.jsx(he,{className:"h-full w-full","aria-hidden":"true"})})})})};function dF(e,t){return new Promise(((n,a)=>setTimeout((()=>a(new Error(t))),e)))}const uF="Reader promise timed out";function mF({index:e=0}){const{token:t}=nk(),n=j(N_.cacheTTS),a=j(N_.playbackRate),s=j(N_.voice),r=j(N_.activeRunFamily(e)),o=j(N_.automaticPlayback),i=j(N_.isSubmittingFamily(e)),c=j(N_.latestMessageFamily(e)),d=y(N_.globalAudioPlayingFamily(e)),[u,m]=b(N_.audioRunFamily(e)),[p,h]=b(N_.globalAudioFetchingFamily(e)),[g,x]=b(N_.globalAudioURLFamily(e)),{audioRef:f}=function({setIsPlaying:e}){const t=ba(null);return ya((()=>{let n=null,a=0;const s=()=>{e(!1),console.log("global audio ended"),t.current&&(t.current.customEnded=!0,URL.revokeObjectURL(t.current.src))},r=()=>{e(!0),console.log("global audio started"),t.current&&(t.current.customStarted=!0)},o=()=>{console.log("global audio paused"),t.current&&(t.current.customPaused=!0)},i=()=>{if(t.current){const e=t.current.currentTime;e===n?a+=1:a=0,n=e,a>=1&&(console.log("Detected end of audio based on time update"),t.current.pause(),s())}},l=t.current;return t.current&&(t.current.addEventListener("ended",s),t.current.addEventListener("play",r),t.current.addEventListener("pause",o),t.current.addEventListener("timeupdate",i),t.current.customProps={customStarted:!1,customEnded:!1,customPaused:!1}),()=>{l&&(l.removeEventListener("ended",s),l.removeEventListener("play",r),l.removeEventListener("pause",o),l.removeEventListener("timeupdate",i),URL.revokeObjectURL(l.src))}}),[e]),{audioRef:t}}({setIsPlaying:d}),{pauseGlobalAudio:v}=k_(),{conversationId:_}=W(),w="new"===_?_:(null==c?void 0:c.conversationId)??_??"",N=xs(),k=ka((()=>N.getQueryData([Fh.messages,w])),[w,N]);return ya((()=>{const e=lf(c);!(null==t||!o||i||!c||c.isCreatedByUser||!e||!c.messageId||c.messageId.includes("_")||p||null==r||r===u)&&async function(){h(!0);try{f.current&&(f.current.pause(),URL.revokeObjectURL(f.current.src),x(null));let e=(null==c?void 0:c.text)??"";const a=await caches.open("tts-responses"),o=await a.match(e);if(m(r),o){cx.log("Audio found in cache");const e=await o.blob(),t=URL.createObjectURL(e);return x(t),void h(!1)}cx.log("Fetching audio...",navigator.userAgent);const i=await fetch("/api/files/speech/tts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({messageId:null==c?void 0:c.messageId,runId:r,voice:s})});if(!i.ok)throw new Error("Failed to fetch audio");if(!i.body)throw new Error("Null Response body");const l=i.body.getReader(),d="audio/mpeg",u="undefined"!=typeof MediaSource&&MediaSource.isTypeSupported(d);let p;u&&(p=new Xg(d),x(p.mediaSourceUrl));let g=!1;const v=[];for(;!g;){const e=l.read(),{value:t,done:a}=await Promise.race([e,dF(15e3,uF)]);n&&t&&v.push(t),t&&p&&p.addData(t),g=a}if(v.length){cx.log("Adding audio to cache");const t=(k()??[]).find((e=>e.messageId===(null==c?void 0:c.messageId)));if(e=(null==t?void 0:t.text)??"",!e)throw new Error("Cache key not found");const n=new Blob(v,{type:d}),s=new Response(n);if(await a.put(e,s),!u){const t=await a.match(e);if(!t)throw new Error("Failed to fetch audio from cache");const n=await t.blob(),s=URL.createObjectURL(n);x(s)}h(!1)}cx.log("Audio stream reading ended")}catch(e){if((null==e?void 0:e.message)!==uF)return void cx.log(uF);cx.error("Error fetching audio:",e),h(!1),x(null)}finally{h(!1)}}()}),[o,x,m,h,c,i,r,k,p,u,n,f,s,t]),ya((()=>{null!=a&&null!=g&&a>0&&f.current&&f.current.playbackRate!==a&&(f.current.playbackRate=a)}),[f,g,a]),ya((()=>{v()}),[_]),cx.log("StreamAudio.tsx - globalAudioURL:",g),l.jsx("audio",{ref:f,controls:!0,controlsList:"nodownload nofullscreen noremoteplayback",style:{position:"absolute",overflow:"hidden",display:"none",height:"0px",width:"0px"},src:g??void 0,id:ax,autoPlay:!0})}function pF({stop:e,setShowStopButton:t}){const n=qN();return l.jsx(pr,{description:n("com_nav_stop_generating"),render:l.jsx("button",{type:"button",className:Qf("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"aria-label":n("com_nav_stop_generating"),onClick:n=>{t(!1),e(n)},children:l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-lg text-surface-primary",children:l.jsx("rect",{x:"7",y:"7",width:"10",height:"10",rx:"1.25",fill:"currentColor"})})})})}const hF=_a.memo(Ta(((e,t)=>{const n=qN();return l.jsx(pr,{description:n("com_nav_send_message"),render:l.jsx("button",{ref:t,"aria-label":n("com_nav_send_message"),id:"send-button",disabled:e.disabled,className:Qf("rounded-full bg-text-primary p-1.5 text-text-primary outline-offset-4 transition-all duration-200 disabled:cursor-not-allowed disabled:text-text-secondary disabled:opacity-10"),"data-testid":"send-button",type:"submit",children:l.jsx("span",{className:"","data-state":"closed",children:l.jsx(ni,{size:24})})})})}))),gF=_a.memo(Ta(((e,t)=>{const n=Di({control:e.control});return l.jsx(hF,{ref:t,disabled:e.disabled||!n.text})}))),xF=_a.memo((({isEditingChatBadges:e,handleCancelBadges:t,handleSaveBadges:n,setBadges:a})=>{const s=qN(),r=(vC()||[]).filter((e=>!e.isAvailable)),o=ka((e=>{a((t=>[...t,{id:e}]))}),[a]);return e?l.jsxs("div",{className:"m-1.5 flex flex-col overflow-hidden rounded-b-lg rounded-t-2xl bg-surface-secondary-alt",children:[l.jsxs("div",{className:"flex items-center gap-4 py-2 pl-3 pr-1.5 text-sm",children:[l.jsx("span",{className:"mt-0 flex size-6 flex-shrink-0 items-center justify-center",children:l.jsx("div",{className:"icon-md",children:l.jsx(z,{className:"icon-md","aria-hidden":"true"})})}),l.jsx("span",{className:"text-token-text-secondary line-clamp-3 flex-1 py-0.5 font-semibold",children:s("com_ui_save_badge_changes")}),l.jsxs("div",{className:"flex h-8 gap-2",children:[l.jsx(Ys,{size:"sm",variant:"destructive","aria-label":"Cancel",onClick:t,className:"h-8",children:l.jsx(re,{className:"icon-md","aria-hidden":"true"})}),l.jsx(Ys,{size:"sm",variant:"submit","aria-label":"Save changes",onClick:n,className:"h-8 rounded-b-lg rounded-tr-xl",children:l.jsx(Yt,{className:"icon-md","aria-hidden":"true"})})]})]}),r&&r.length>0&&l.jsx("div",{className:"flex flex-wrap items-center gap-2 p-2",children:r.map((e=>l.jsx("div",{className:"badge-icon",children:l.jsx(ai,{icon:e.icon,label:e.label,isAvailable:!1,isEditing:!0,onBadgeAction:()=>o(e.id)})},e.id)))})]}):null}));const fF=Sa((function(){const e=qN(),{codeInterpreter:t,codeApiKeyForm:n}=Bk(),{toggleState:a,debouncedChange:s,isPinned:r}=t,{badgeTriggerRef:o}=n;return ak({permissionType:Pp.RUN_CODE,permission:Op.USE})?(a||r)&&l.jsx(si,{ref:o,className:"max-w-fit",checked:a,setValue:s,label:e("com_assistants_code_interpreter"),isCheckedClassName:"border-purple-600/40 bg-purple-500/10 hover:bg-purple-700/10",icon:l.jsx(A,{className:"icon-md","aria-hidden":"true"})}):null})),vF=_a.forwardRef((({isArtifactsPinned:e,setIsArtifactsPinned:t,artifactsMode:n,handleArtifactsToggle:a,handleShadcnToggle:s,handleCustomToggle:r,...o},i)=>{const c=qN(),d=En({focusLoop:!0,showTimeout:100,placement:"right"}),u=""!==n&&void 0!==n,m=n===op.SHADCNUI,p=n===op.CUSTOM;return l.jsx("div",{ref:i,children:l.jsxs(In,{store:d,children:[l.jsxs(Rn,{...o,hideOnClick:!1,render:l.jsx(se,{onClick:e=>{e.stopPropagation(),a()},onMouseEnter:()=>{u&&d.show()},className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-surface-hover"}),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(An,{className:"icon-md","aria-hidden":"true"}),l.jsx("span",{children:c("com_ui_artifacts")}),u&&l.jsx(nn,{className:"ml-auto h-3 w-3","aria-hidden":"true"})]}),l.jsx("button",{type:"button",onClick:n=>{n.stopPropagation(),t(!e)},className:Qf("rounded p-1 transition-all duration-200","hover:bg-surface-tertiary hover:shadow-sm",!e&&"text-text-secondary hover:text-text-primary"),"aria-label":e?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(So,{unpin:e})})})]}),u&&l.jsx(Pn,{portal:!0,unmountOnHide:!0,className:Qf("animate-popover-left z-50 ml-3 mt-6 flex min-w-[250px] flex-col rounded-xl","border border-border-light bg-surface-secondary shadow-lg"),children:l.jsxs("div",{className:"px-2 py-1.5",children:[l.jsx("div",{className:"mb-2 text-xs font-medium text-text-secondary",children:c("com_ui_artifacts_options")}),l.jsxs(Rn,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),s()},className:Qf("mb-1 flex items-center justify-between gap-2 rounded-lg px-2 py-2","cursor-pointer bg-surface-secondary text-text-primary outline-none transition-colors","hover:bg-surface-hover data-[active-item]:bg-surface-hover",m&&"bg-surface-active"),children:[l.jsx("span",{className:"text-sm",children:c("com_ui_include_shadcnui")}),l.jsx("div",{className:"ml-auto flex items-center",children:l.jsx(On,{checked:m})})]}),l.jsxs(Rn,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},className:Qf("mb-1 flex items-center justify-between gap-2 rounded-lg px-2 py-2","cursor-pointer bg-surface-secondary text-text-primary outline-none transition-colors","hover:bg-surface-hover data-[active-item]:bg-surface-hover",p&&"bg-surface-active"),children:[l.jsx("span",{className:"text-sm",children:c("com_ui_custom_prompt_mode")}),l.jsx("div",{className:"ml-auto flex items-center",children:l.jsx(On,{checked:p})})]})]})})]})})}));vF.displayName="ArtifactsSubMenu";const _F=_a.memo(vF),bF=_a.forwardRef((({placeholder:e,...t},n)=>{const{mcpServerManager:a}=Bk(),{isPinned:s,mcpValues:r,setIsPinned:o,isInitializing:i,placeholderText:c,availableMCPServers:d,getConfigDialogProps:u,toggleServerSelection:m,getServerStatusIconProps:p}=a,h=En({focusLoop:!0,showTimeout:100,placement:"right"});if(!d||0===d.length)return null;const g=u();return l.jsxs("div",{ref:n,children:[l.jsxs(In,{store:h,children:[l.jsxs(Rn,{...t,render:l.jsx(se,{onClick:e=>{e.stopPropagation(),h.toggle()},className:"flex w-full cursor-pointer items-center justify-between rounded-lg p-2 hover:bg-surface-hover"}),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(wr,{className:"icon-md"}),l.jsx("span",{children:e||c}),l.jsx(nn,{className:"ml-auto h-3 w-3"})]}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),o(!s)},className:Qf("rounded p-1 transition-all duration-200","hover:bg-surface-tertiary hover:shadow-sm",!s&&"text-text-secondary hover:text-text-primary"),"aria-label":s?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(So,{unpin:s})})})]}),l.jsx(Pn,{portal:!0,unmountOnHide:!0,className:Qf("animate-popover-left z-50 ml-3 flex min-w-[200px] flex-col rounded-xl","border border-border-light bg-surface-secondary p-1 shadow-lg"),children:d.map((e=>{const t=p(e.serverName),n=(null==r?void 0:r.includes(e.serverName))??!1,a=i(e.serverName),s=t&&l.jsx(ST,{...t});return l.jsxs(Rn,{onClick:t=>{t.preventDefault(),m(e.serverName)},disabled:a,className:Qf("flex items-center gap-2 rounded-lg px-2 py-1.5 text-text-primary hover:cursor-pointer","scroll-m-1 outline-none transition-colors","hover:bg-black/[0.075] dark:hover:bg-white/10","data-[active-item]:bg-black/[0.075] dark:data-[active-item]:bg-white/10","w-full min-w-0 justify-between text-sm",a&&"opacity-50 hover:bg-transparent dark:hover:bg-transparent",n&&"bg-surface-active"),children:[l.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[l.jsx(On,{checked:n}),l.jsx("span",{children:e.config.title||e.serverName})]}),s&&l.jsx("div",{className:"ml-2 flex items-center",children:s})]},e.serverName)}))})]}),g&&l.jsx(rE,{...g})]})}));bF.displayName="MCPSubMenu";const yF=_a.memo(bF),jF=_a.memo((({disabled:e})=>{var t,n;const a=qN(),s=e??!1,[r,o]=ja(!1),{webSearch:i,artifacts:c,fileSearch:d,agentsConfig:u,mcpServerManager:m,codeApiKeyForm:p,codeInterpreter:h,searchApiKeyForm:g}=Bk(),{data:x}=K_(),{codeEnabled:f,webSearchEnabled:v,artifactsEnabled:_,fileSearchEnabled:b}=JN((null==u?void 0:u.capabilities)??$u),{setIsDialogOpen:y,menuTriggerRef:j}=p,{setIsDialogOpen:w,menuTriggerRef:N}=g,{isPinned:k,setIsPinned:C,authData:S}=i,{isPinned:T,setIsPinned:E,authData:R}=h,{isPinned:P,setIsPinned:O}=d,{isPinned:L,setIsPinned:M}=c,D=ak({permissionType:Pp.WEB_SEARCH,permission:Op.USE}),F=ak({permissionType:Pp.RUN_CODE,permission:Op.USE}),U=ak({permissionType:Pp.FILE_SEARCH,permission:Op.USE}),z=ak({permissionType:Pp.MCP_SERVERS,permission:Op.USE}),V=Ca((()=>{const e=(null==S?void 0:S.authTypes)??[];return 0===e.length||!e.every((([,e])=>e===Hl.SYSTEM_DEFINED))}),[null==S?void 0:S.authTypes]),$=Ca((()=>(null==R?void 0:R.message)!==Hl.SYSTEM_DEFINED),[null==R?void 0:R.message]),B=ka((()=>{const e=!i.toggleState;i.debouncedChange({value:e})}),[i]),H=ka((()=>{const e=!h.toggleState;h.debouncedChange({value:e})}),[h]),G=ka((()=>{const e=!d.toggleState;d.debouncedChange({value:e})}),[d]),K=ka((()=>{const e=c.toggleState;e&&""!==e?c.debouncedChange({value:""}):c.debouncedChange({value:op.DEFAULT})}),[c]),W=ka((()=>{c.toggleState===op.SHADCNUI?c.debouncedChange({value:op.DEFAULT}):c.debouncedChange({value:op.SHADCNUI})}),[c]),q=ka((()=>{c.toggleState===op.CUSTOM?c.debouncedChange({value:op.DEFAULT}):c.debouncedChange({value:op.CUSTOM})}),[c]),Q=null==(n=null==(t=null==x?void 0:x.interface)?void 0:t.mcpServers)?void 0:n.placeholder,Y=[];b&&U&&Y.push({onClick:G,hideOnClick:!1,render:e=>l.jsxs("div",{...e,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ri,{className:"icon-md"}),l.jsx("span",{children:a("com_assistants_file_search")})]}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),O(!P)},className:Qf("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!P&&"text-text-secondary hover:text-text-primary"),"aria-label":P?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(So,{unpin:P})})})]})}),D&&v&&Y.push({onClick:B,hideOnClick:!1,render:e=>l.jsxs("div",{...e,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ge,{className:"icon-md","aria-hidden":"true"}),l.jsx("span",{children:a("com_ui_web_search")})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[V&&l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),w(!0)},className:Qf("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure web search",ref:N,children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(I,{className:"h-4 w-4","aria-hidden":"true"})})}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),C(!k)},className:Qf("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!k&&"text-text-secondary hover:text-text-primary"),"aria-label":k?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(So,{unpin:k})})})]})]})}),F&&f&&Y.push({onClick:H,hideOnClick:!1,render:e=>l.jsxs("div",{...e,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(A,{className:"icon-md","aria-hidden":"true"}),l.jsx("span",{children:a("com_assistants_code_interpreter")})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[$&&l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),y(!0)},ref:j,className:Qf("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm","text-text-secondary hover:text-text-primary"),"aria-label":"Configure code interpreter",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(I,{className:"h-4 w-4","aria-hidden":"true"})})}),l.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),E(!T)},className:Qf("rounded p-1 transition-all duration-200","hover:bg-surface-secondary hover:shadow-sm",!T&&"text-text-primary hover:text-text-primary"),"aria-label":T?"Unpin":"Pin",children:l.jsx("div",{className:"h-4 w-4",children:l.jsx(So,{unpin:T})})})]})]})}),_&&Y.push({hideOnClick:!1,render:e=>l.jsx(_F,{...e,isArtifactsPinned:L,setIsArtifactsPinned:M,artifactsMode:c.toggleState,handleArtifactsToggle:K,handleShadcnToggle:W,handleCustomToggle:q})});const{availableMCPServers:X}=m;if(z&&X&&X.length>0&&Y.push({hideOnClick:!1,render:e=>l.jsx(yF,{...e,placeholder:Q})}),0===Y.length)return null;const J=l.jsx(pr,{render:l.jsx(se,{disabled:s,id:"tools-dropdown-button","aria-label":"Tools Options",className:Qf("flex size-9 items-center justify-center rounded-full p-1 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50",r&&"bg-surface-hover"),children:l.jsx("div",{className:"flex w-full items-center justify-center gap-2",children:l.jsx(Qe,{className:"size-5","aria-hidden":"true"})})}),id:"tools-dropdown-button",description:a("com_ui_tools"),disabled:s});return l.jsx(cr,{itemClassName:"flex w-full cursor-pointer rounded-lg items-center justify-between hover:bg-surface-hover gap-5",menuId:"tools-dropdown-menu",isOpen:r,setIsOpen:o,modal:!0,unmountOnHide:!0,trigger:J,items:Y,iconClassName:"mr-0"})}));function wF(){const{webSearch:e,codeInterpreter:t,searchApiKeyForm:n,codeApiKeyForm:a}=Bk(),{authData:s}=e,{authData:r}=t,{methods:o,onSubmit:i,isDialogOpen:c,setIsDialogOpen:d,handleRevokeApiKey:u,badgeTriggerRef:m,menuTriggerRef:p}=n,{methods:h,onSubmit:g,isDialogOpen:x,setIsDialogOpen:f,handleRevokeApiKey:v,badgeTriggerRef:_,menuTriggerRef:b}=a,y=Ca((()=>(null==s?void 0:s.authTypes)??[]),[null==s?void 0:s.authTypes]),j=Ca((()=>(null==r?void 0:r.message)??!1),[null==r?void 0:r.message]);return l.jsxs(l.Fragment,{children:[l.jsx(RI,{onSubmit:i,authTypes:y,isOpen:c,onRevoke:u,register:o.register,onOpenChange:d,handleSubmit:o.handleSubmit,triggerRefs:[p,m],isToolAuthenticated:(null==s?void 0:s.authenticated)??!1}),l.jsx(UI,{onSubmit:g,isOpen:x,onRevoke:v,register:h.register,onOpenChange:f,handleSubmit:h.handleSubmit,triggerRefs:[b,_],isUserProvided:j===Hl.USER_PROVIDED,isToolAuthenticated:(null==r?void 0:r.authenticated)??!1})]})}const NF=Sa((function(){const e=qN(),{fileSearch:t}=Bk(),{toggleState:n,debouncedChange:a,isPinned:s}=t;return ak({permissionType:Pp.FILE_SEARCH,permission:Op.USE})?l.jsx(l.Fragment,{children:(n||s)&&l.jsx(si,{className:"max-w-fit",checked:n,setValue:a,label:e("com_assistants_file_search"),isCheckedClassName:"border-green-600/40 bg-green-500/10 hover:bg-green-700/10",icon:l.jsx(ri,{className:"icon-md"})})}):null}));const kF=Sa((function(){const e=qN(),{artifacts:t}=Bk(),{toggleState:n,debouncedChange:a,isPinned:s}=t,[r,o]=ja(!1),[i,c]=ja(!1),d=Ca((()=>"string"==typeof n&&n?{enabled:!0,mode:n}:{enabled:!1,mode:""}),[n]),u=d.enabled,m=d.mode===op.SHADCNUI,p=d.mode===op.CUSTOM,h=ka((()=>{u?(a({value:""}),c(!1)):a({value:op.DEFAULT})}),[u,a]),g=ka((e=>{e.stopPropagation(),c(!i)}),[i]);ya((()=>{r||c(!1)}),[r]);const x=ka((()=>{a(m?{value:op.DEFAULT}:{value:op.SHADCNUI})}),[m,a]),f=ka((()=>{a(p?{value:op.DEFAULT}:{value:op.CUSTOM})}),[p,a]);return u||s?l.jsxs("div",{className:"flex",children:[l.jsx(si,{className:Qf("max-w-fit",u&&"rounded-r-none border-r-0"),checked:u,setValue:h,label:e("com_ui_artifacts"),isCheckedClassName:"border-amber-600/40 bg-amber-500/10 hover:bg-amber-700/10",icon:l.jsx(An,{className:"icon-md","aria-hidden":"true"})}),u&&l.jsxs(In,{open:r,setOpen:o,children:[l.jsx(se,{className:Qf("w-7 rounded-l-none rounded-r-full border-b border-l-0 border-r border-t border-border-light md:w-6","border-amber-600/40 bg-amber-500/10 hover:bg-amber-700/10","transition-colors"),onClick:g,children:l.jsx(he,{className:Qf("ml-1 h-4 w-4 text-text-secondary transition-transform duration-300 md:ml-0.5",i&&"rotate-180"),"aria-hidden":"true"})}),l.jsx(Pn,{gutter:4,className:Qf("animate-popover-top-left z-50 flex min-w-[250px] flex-col rounded-xl","border border-border-light bg-surface-secondary shadow-lg"),portal:!0,unmountOnHide:!0,children:l.jsxs("div",{className:"px-2 py-1.5",children:[l.jsx("div",{className:"mb-2 text-xs font-medium text-text-secondary",children:e("com_ui_artifacts_options")}),l.jsxs(Rn,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),x()},className:Qf("mb-1 flex items-center justify-between gap-2 rounded-lg px-2 py-2","cursor-pointer bg-surface-secondary text-text-primary outline-none transition-colors","hover:bg-surface-hover data-[active-item]:bg-surface-hover",m&&"bg-surface-active"),children:[l.jsx("span",{className:"text-sm",children:e("com_ui_include_shadcnui")}),l.jsx("div",{className:"ml-auto flex items-center",children:l.jsx(On,{checked:m})})]}),l.jsxs(Rn,{hideOnClick:!1,onClick:e=>{e.preventDefault(),e.stopPropagation(),f()},className:Qf("mb-1 flex items-center justify-between gap-2 rounded-lg px-2 py-2","cursor-pointer bg-surface-secondary text-text-primary outline-none transition-colors","hover:bg-surface-hover data-[active-item]:bg-surface-hover",p&&"bg-surface-active"),children:[l.jsx("span",{className:"text-sm",children:e("com_ui_custom_prompt_mode")}),l.jsx("div",{className:"ml-auto flex items-center",children:l.jsx(On,{checked:p})})]})]})})]})]}):null}));function CF(){const{conversationId:e,mcpServerManager:t}=Bk(),{localize:n,isPinned:a,mcpValues:s,isInitializing:r,placeholderText:o,batchToggleServers:i,getConfigDialogProps:c,getServerStatusIconProps:d,selectableServers:u}=t,m=ka(((e,t,a)=>{if(0===e.length)return t||n("com_ui_select_placeholder");if(1===e.length){const t=null==a?void 0:a.find((t=>"string"!=typeof t&&t.value==e[0]));return t&&"string"!=typeof t?t.label:e[0]}return n("com_ui_x_selected",{0:e.length})}),[n]),p=ka(((e,t)=>{const n=d(e),a=r(e),s=l.jsx("button",{type:"button",className:"flex flex-grow items-center rounded bg-transparent p-0 text-left transition-colors focus:outline-none "+(a?"opacity-50":""),tabIndex:0,disabled:a,children:t}),o=n&&l.jsx(ST,{...n});return o?l.jsxs("div",{className:"flex w-full items-center justify-between",children:[s,l.jsx("div",{className:"ml-2 flex items-center",children:o})]}):s}),[d,r]);if(!a&&0===(null==s?void 0:s.length))return null;const h=c();return l.jsxs(l.Fragment,{children:[l.jsx(oi,{items:u.map((e=>({label:e.config.title||e.serverName,value:e.serverName}))),selectedValues:s??[],setSelectedValues:i,renderSelectedValues:m,renderItemContent:p,placeholder:o,popoverClassName:"min-w-fit",className:"badge-icon min-w-fit",selectIcon:l.jsx(wr,{className:"icon-md text-text-primary"}),selectItemsClassName:"border border-blue-600/50 bg-blue-500/10 hover:bg-blue-700/10",selectClassName:Qf("group relative inline-flex items-center justify-center md:justify-start gap-1.5 rounded-full border border-border-medium text-sm font-medium transition-all","md:w-full size-9 p-2 md:p-3 bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md active:shadow-inner")}),h&&l.jsx(rE,{...h,conversationId:e})]})}const SF=Sa((function(){const{mcpServerManager:e}=Bk(),{selectableServers:t}=e;return ak({permissionType:Pp.MCP_SERVERS,permission:Op.USE})&&t&&0!==t.length?l.jsx(CF,{}):null}));const TF=Sa((function(){const e=qN(),{webSearch:t,searchApiKeyForm:n}=Bk(),{toggleState:a,debouncedChange:s,isPinned:r,authData:o}=t,{badgeTriggerRef:i}=n;return ak({permissionType:Pp.WEB_SEARCH,permission:Op.USE})?(r||a&&(null==o?void 0:o.authenticated))&&l.jsx(si,{ref:i,className:"max-w-fit",checked:a,setValue:s,label:e("com_ui_search"),isCheckedClassName:"border-blue-600/40 bg-blue-500/10 hover:bg-blue-700/10",icon:l.jsx(ge,{className:"icon-md","aria-hidden":"true"})}):null})),EF=_a.memo(Ta((({badge:e,isEditing:t,isInChat:n,onToggle:a,onDelete:s,onMouseDown:r,badgeRefs:o},i)=>{const c=j(e.atom),d=!!e.atom&&c;return l.jsx("div",{ref:t=>{t&&(o.current[e.id]=t),"function"==typeof i?i(t):i&&(i.current=t)},onMouseDown:t=>r(t,e,d),className:t?"ios-wiggle badge-icon h-full":"badge-icon h-full",children:l.jsx(ai,{id:e.id,icon:e.icon,label:e.label,isActive:d,isEditing:t,isAvailable:e.isAvailable,isInChat:n,onToggle:()=>a(e),onBadgeAction:()=>s(e.id)})})})),((e,t)=>e.badge.id===t.badge.id&&e.isEditing===t.isEditing&&e.isInChat===t.isInChat&&e.onToggle===t.onToggle&&e.onDelete===t.onDelete&&e.onMouseDown===t.onMouseDown&&e.badgeRefs===t.badgeRefs));EF.displayName="BadgeWrapper";const IF=(e,t)=>{switch(t.type){case"START_DRAG":return{draggedBadge:t.badge,mouseX:t.mouseX,offsetX:t.offsetX,insertIndex:t.insertIndex,draggedBadgeActive:t.isActive};case"UPDATE_POSITION":return{...e,mouseX:t.mouseX,insertIndex:t.insertIndex};case"END_DRAG":return{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1};default:return e}};const RF=Sa((function({showEphemeralBadges:e,conversationId:t,isSubmitting:n,onChange:a,onToggle:s,isInChat:r}){var o;const[i,c]=ja([]),[d,u]=Pa(IF,{draggedBadge:null,mouseX:0,offsetX:0,insertIndex:null,draggedBadgeActive:!1}),m=ba({}),p=ba(null),h=ba(null),g=ba(null),x=vC(),f=j(N_.isEditingBadges),v=Ca((()=>x.filter((e=>!1!==e.isAvailable))),[x]),b=_((({snapshot:e,set:t})=>async n=>{const a=await e.getPromise(n);t(n,!a)}),[]);ya((()=>{c((e=>{const t=new Set(e.map((e=>e.id))),n=v.filter((e=>!t.has(e.id)));return n.length>0?[...e,...n]:e}))}),[v]);const y=d.draggedBadge?i.filter((e=>{var t;return e.id!==(null==(t=d.draggedBadge)?void 0:t.id)})):i,w=d.draggedBadge||null,N=ka((e=>{if(!d.draggedBadge||!p.current||!g.current)return 0;const t=e-g.current.left,n=y.map((e=>m.current[e.id])).filter(Boolean);if(0===n.length)return 0;let a=0;for(let s=0;s<n.length;s++){const e=n[s].getBoundingClientRect();if(t<e.left-g.current.left+e.width/2)break;a=s+1}return a}),[d.draggedBadge,y]),k=ka(((e,t,n)=>{if(!f||!p.current)return;const a=m.current[t.id];if(!a)return;const s=a.getBoundingClientRect(),r=e.clientX-s.left,o=e.clientX,l=i.findIndex((e=>e.id===t.id));g.current=p.current.getBoundingClientRect(),u({type:"START_DRAG",badge:t,mouseX:o,offsetX:r,insertIndex:l,isActive:n})}),[f,i]),C=ka((e=>{d.draggedBadge&&(h.current&&cancelAnimationFrame(h.current),h.current=requestAnimationFrame((()=>{const t=e.clientX,n=N(t);n!==d.insertIndex?u({type:"UPDATE_POSITION",mouseX:t,insertIndex:n}):u({type:"UPDATE_POSITION",mouseX:t,insertIndex:d.insertIndex})})))}),[d.draggedBadge,d.insertIndex,N]),S=ka((()=>{if(d.draggedBadge&&null!==d.insertIndex){const e=i.filter((e=>{var t;return e.id!==(null==(t=d.draggedBadge)?void 0:t.id)})),t=[...e.slice(0,d.insertIndex),d.draggedBadge,...e.slice(d.insertIndex)];c(t),a(t.map((e=>({id:e.id}))))}u({type:"END_DRAG"}),g.current=null}),[d.draggedBadge,d.insertIndex,i,a]),T=ka((e=>{const t=i.filter((t=>t.id!==e));c(t),a(t.map((e=>({id:e.id}))))}),[i,a]),E=ka((e=>{e.atom&&b(e.atom),s&&s(e.id,!!e.atom)}),[b,s]);return ya((()=>{if(d.draggedBadge)return document.addEventListener("mousemove",C),document.addEventListener("mouseup",S),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",S),h.current&&(cancelAnimationFrame(h.current),h.current=null)}}),[d.draggedBadge,C,S]),l.jsxs(Hk,{conversationId:t,isSubmitting:n,children:[l.jsxs("div",{ref:p,className:"relative flex flex-wrap items-center gap-2",children:[!0===e&&l.jsx(jF,{}),y.map(((e,t)=>l.jsxs(_a.Fragment,{children:[d.draggedBadge&&d.insertIndex===t&&w&&l.jsx("div",{className:"badge-icon h-full",children:l.jsx(ai,{id:w.id,icon:w.icon,label:w.label,isActive:d.draggedBadgeActive,isEditing:f,isAvailable:w.isAvailable,isInChat:r})}),l.jsx(EF,{badge:e,isEditing:f,isInChat:r,onToggle:E,onDelete:T,onMouseDown:k,badgeRefs:m})]},e.id))),d.draggedBadge&&d.insertIndex===y.length&&w&&l.jsx("div",{className:"badge-icon h-full",children:l.jsx(ai,{id:w.id,icon:w.icon,label:w.label,isActive:d.draggedBadgeActive,isEditing:f,isAvailable:w.isAvailable,isInChat:r})}),!0===e&&l.jsxs(l.Fragment,{children:[l.jsx(TF,{}),l.jsx(fF,{}),l.jsx(NF,{}),l.jsx(kF,{}),l.jsx(SF,{})]}),w&&l.jsx("div",{className:"ghost-badge h-full",style:{position:"absolute",top:0,left:0,transform:`translateX(${d.mouseX-d.offsetX-((null==(o=g.current)?void 0:o.left)||0)}px)`,zIndex:10,pointerEvents:"none"},children:l.jsx(ai,{id:w.id,icon:w.icon,label:w.label,isActive:d.draggedBadgeActive,isAvailable:w.isAvailable,isInChat:r,isEditing:!0,isDragging:!0})})]}),l.jsx(wF,{})]})})),AF=Nm().interface,PF=({endpoint:e,assistantMap:t,endpointsConfig:n})=>({id:a,name:s,description:r})=>({type:e,label:s??"",value:a,description:r??"",icon:rI({conversation:{assistant_id:a,endpoint:e},endpointsConfig:n,context:"menu-item",assistantMap:t})});function OF({conversation:e,setShowMentionPopover:t,newConversation:n,textAreaRef:a,commandChar:s="@",placeholder:r="com_ui_mention",includeAssistants:o=!0}){const i=qN(),c=Ik(),{options:d,presets:u,modelSpecs:m,agentsList:p,modelsConfig:h,endpointsConfig:g,assistantListMap:x}=function({assistantMap:e,includeAssistants:t}){const n=ak({permissionType:Pp.AGENTS,permission:Op.USE}),a=WN(),{data:s}=pb(),{data:r}=jN(),{data:o}=K_(),{data:i}=G_(),{data:l=[]}=G_({select:_f}),c=HN((e=>e.data.map((({id:e,name:t,description:n})=>({id:e,name:t,description:n}))))),d=Ca((()=>(null==o?void 0:o.interface)??AF),[null==o?void 0:o.interface]),{data:u=null}=R_({requiredPermission:Oh.VIEW},{enabled:n&&!0===d.modelSelect,select:e=>{const{data:t}=e;return t.map((({id:e,name:t,avatar:n})=>({value:e,label:t??"",type:Yl.agents,icon:rI({conversation:{endpoint:Yl.agents,iconURL:null==n?void 0:n.filepath},endpointsConfig:i,context:"menu-item"})})))}}),m=Ca((()=>{var t,n;return{[Yl.assistants]:null==(t=c[Yl.assistants])?void 0:t.map(PF({endpoint:Yl.assistants,assistantMap:e,endpointsConfig:i})).filter(Boolean),[Yl.azureAssistants]:null==(n=c[Yl.azureAssistants])?void 0:n.map(PF({endpoint:Yl.azureAssistants,assistantMap:e,endpointsConfig:i})).filter(Boolean)}}),[c,e,i]),p=Ca((()=>{var e;const t=(null==(e=null==o?void 0:o.modelSpecs)?void 0:e.list)??[];return a?t.filter((e=>{var t,n;return(null==(t=e.preset)?void 0:t.endpoint)!==Yl.agents||!(null==(n=e.preset)?void 0:n.agent_id)||e.preset.agent_id in a})):t}),[o,a]);return{options:Ca((()=>{var n;let a=l;t||(a=l.filter((e=>!lc(e))));const o=a.flatMap((e=>lc(e)||cc(e)||!0!==d.modelSelect?[]:((null==r?void 0:r[e])??[]).map((t=>({value:e,label:t,type:"model",icon:rI({conversation:{endpoint:e,model:t},endpointsConfig:i,context:"menu-item"})})))));return[...(p.length>0?p:[]).map((e=>({value:e.name,label:e.label,description:e.description,icon:rI({conversation:{...e.preset,iconURL:e.iconURL},endpointsConfig:i,context:"menu-item"}),type:"modelSpec"}))),...(!0===d.modelSelect?a:[]).map((e=>({value:e,label:Sm[e]??e??"",type:"endpoint",icon:rI({conversation:{endpoint:e},endpointsConfig:i,context:"menu-item"})}))),...!0===d.modelSelect?u??[]:[],...(null==i?void 0:i[Yl.assistants])&&t&&!0===d.modelSelect&&m[Yl.assistants]||[],...(null==i?void 0:i[Yl.azureAssistants])&&t&&!0===d.modelSelect&&m[Yl.azureAssistants]||[],...(null==(n=!0===d.modelSelect&&!0===d.presets?s:[])?void 0:n.map(((t,n)=>({value:t.presetId??`preset-${n}`,label:t.title??t.modelLabel??t.chatGptLabel??"",description:Jx(t,!0),icon:rI({conversation:t,endpointsConfig:i,context:"menu-item",assistantMap:e}),type:"preset"}))))??[],...o]}),[s,l,p,u,e,r,i,m,t,d.presets,d.modelSelect]),presets:s,modelSpecs:p,agentsList:u,modelsConfig:r,endpointsConfig:i,assistantListMap:m}}({assistantMap:c||{},includeAssistants:o}),{onSelectMention:f}=oD({presets:u,modelSpecs:m,conversation:e,assistantsMap:c,endpointsConfig:g,newConversation:n}),[v,_]=ja(0),b=ba(null),y=ba(null),[j,w]=ja(d),{open:N,setOpen:k,searchValue:C,setSearchValue:S,matches:T}=ei({value:"",options:j}),E=e=>{var n,r,o,i;if(!e)return;if("endpoint"===e.type&&e.value===Yl.agents)S(""),w(p??[]),_(0),null==(n=y.current)||n.focus();else if("endpoint"===e.type&&e.value===Yl.assistants)S(""),w(x[Yl.assistants]??[]),_(0),null==(r=y.current)||r.focus();else if("endpoint"===e.type&&e.value===Yl.azureAssistants)S(""),w(x[Yl.azureAssistants]??[]),_(0),null==(o=y.current)||o.focus();else if("endpoint"===e.type){const t=((null==h?void 0:h[e.value||""])??[]).map((t=>({value:e.value,label:t,type:"model"})));_(0),S(""),w(t),null==(i=y.current)||i.focus()}else S(""),k(!1),t(!1),null==f||f(e),a.current&&sf(a.current,s)};ya((()=>{N||(w(d),_(0))}),[N,d]),ya((()=>()=>{b.current&&clearTimeout(b.current)}),[]);const I="@"!==s?"add-convo":"mention";ya((()=>{const e=document.getElementById(`${I}-item-${v}`);null==e||e.scrollIntoView({behavior:"instant",block:"nearest"})}),[I,v]);const R=({index:e,key:t,style:n})=>{const a=T[e];return l.jsx(sF,{type:I,index:e,style:n,onClick:e=>{e.preventDefault(),e.stopPropagation(),b.current&&clearTimeout(b.current),b.current=null,E(a)},name:a.label??"",icon:a.icon,description:a.description,isActive:e===v},t)};return l.jsx("div",{className:"absolute bottom-28 z-10 w-full space-y-2",children:l.jsxs("div",{className:"popover border-token-border-light rounded-2xl border bg-white p-2 shadow-lg dark:bg-gray-700",children:[l.jsx("input",{autoFocus:!0,ref:y,placeholder:i(r),className:"mb-1 w-full border-0 bg-white p-2 text-sm focus:outline-none dark:bg-gray-700 dark:text-gray-200",autoComplete:"off",value:C,onKeyDown:e=>{var n,s;if("Escape"===e.key&&(k(!1),t(!1),null==(n=a.current)||n.focus()),"ArrowDown"===e.key)_((e=>(e+1)%T.length));else if("ArrowUp"===e.key)_((e=>(e-1+T.length)%T.length));else if("Enter"===e.key||"Tab"===e.key){const t=T[v];("endpoint"===(null==t?void 0:t.type)||"Enter"===e.key)&&e.preventDefault(),E(T[v])}else"Backspace"===e.key&&""===C&&(k(!1),t(!1),null==(s=a.current)||s.focus())},onChange:e=>S(e.target.value),onFocus:()=>k(!0),onBlur:()=>{b.current=setTimeout((()=>{k(!1),t(!1)}),150)}}),N&&l.jsx("div",{className:"max-h-40",children:l.jsx(hl,{disableHeight:!0,children:({width:e})=>l.jsx(gl,{width:e,overscanRowCount:5,rowHeight:40,rowCount:T.length,rowRenderer:R,scrollToIndex:v,height:Math.min(40*T.length,160)})})})]})})}const LF=Sa((({index:e=0})=>{var t;const n=ba(null),a=ba(null);!function(e){var t;const n=T(),a=E();ya((()=>{var t,s,r,o;if((null==e?void 0:e.current)&&(null==(t=n.state)?void 0:t.focusChat)){cx.log("conversation",`Focusing textarea on location state change: ${n.pathname}`);const t=null==(s=window.matchMedia)?void 0:s.call(window,"(pointer: coarse)").matches,i=null==(r=window.matchMedia)?void 0:r.call(window,"(hover: hover)").matches,l=`${n.pathname}${window.location.search??""}`;if(t||!i)return void a(l,{replace:!0,state:{}});null==(o=e.current)||o.focus(),a(l,{replace:!0,state:{}})}}),[a,e,n.pathname,null==(t=n.state)?void 0:t.focusChat])}(a);const s=qN(),[r,o]=ja(!1),[,i]=ja(!1),[c,d]=ja(1),[u,m]=ja(!1),[p,h]=ja([]),g=j(N_.speechToText),x=j(N_.textToSpeech),f=j(N_.chatDirection),v=j(N_.automaticPlayback),_=j(N_.maximizeChatSpace),w=j(N_.centerFormOnLanding),N=j(N_.isTemporary),[k,C]=b(N_.chatBadges),[S,I]=b(N_.isEditingBadges),[R,A]=b(N_.showStopButtonByIndex(e)),[P,O]=b(N_.showPlusPopoverFamily(e)),[L,M]=b(N_.showMentionPopoverFamily(e)),{requiresKey:D}=function(){const{conversation:e}=$N(),{data:t}=G_(),{endpoint:n}=e||{},a=Zm(t,n,"userProvide"),{getExpiry:s}=hC(n??"");return{requiresKey:!s()&&a}}(),F=jk(),{files:U,setFiles:z,conversation:V,isSubmitting:$,filesLoading:B,newConversation:H,handleStopGenerating:G}=$N(),{addedIndex:K,generateConversation:W,conversation:q,setConversation:Q,isSubmitting:Y}=gk(),X=Ik(),J=j(N_.showStopButtonByIndex(K)),Z=Ca((()=>(null==V?void 0:V.endpointType)??(null==V?void 0:V.endpoint)),[null==V?void 0:V.endpointType,null==V?void 0:V.endpoint]),ee=Ca((()=>(null==V?void 0:V.conversationId)??Bm.NEW_CONVO),[null==V?void 0:V.conversationId]),te=Ca((()=>null!=f&&"rtl"===(null==f?void 0:f.toLowerCase())),[f]),ne=Ca((()=>{var e;return lc(Z)&&(!(null==V?void 0:V.assistant_id)||!(null==(e=null==X?void 0:X[Z??""])?void 0:e[(null==V?void 0:V.assistant_id)??""]))}),[null==V?void 0:V.assistant_id,Z,X]),ae=Ca((()=>D||ne),[D,ne]),se=ka((()=>{var e,t;(null==(e=window.matchMedia)?void 0:e.call(window,"(pointer: coarse)").matches)||null==(t=a.current)||t.focus()}),[]),re=ka((()=>{r&&o(!1)}),[r]);(({isSubmitting:e,conversationId:t,textAreaRef:n,setFiles:a,files:s})=>{const{setValue:r}=jk(),o=j(N_.saveDrafts),i=e?Bm.PENDING_CONVO:t,[l,c]=ja(null),d=Ca((()=>Array.from(s.keys())),[s]),{data:u}=q_(),m=ka((e=>{const t=JSON.parse((localStorage.getItem(`${Hm.FILES_DRAFT}${e}`)??"")||"[]");0!==t.length?t.forEach((e=>{const t=null==u?void 0:u.find((t=>t.file_id===e)),n=null==u?void 0:u.find((t=>t.temp_file_id===e)),{fileToRecover:s,fileIdToRecover:r}=t?{fileToRecover:t,fileIdToRecover:e}:{fileToRecover:n,fileIdToRecover:((null==n?void 0:n.temp_file_id)??"")||e};s&&a((e=>{const t=new Map(e);return t.set(r,{...s,progress:1,attached:!0,size:s.bytes}),t}))})):a(new Map)}),[u,a]),p=ka((e=>{const t=zx(e);t&&r("text",t)}),[r]),h=ka((e=>{(null==n?void 0:n.current)&&(""===n.current.value||1===n.current.value.length?Fx(e):Ux({id:e,value:n.current.value}))}),[n]);ya((()=>{if(!o||null==i||""===i)return;const e=xi((e=>Ux({id:i,value:e})),65),t=xi((e=>Ux({id:i,value:e})),850),a=n=>{const a=n.target.value;e.cancel(),t.cancel(),""===a?t(a):e(a)},s=null==n?void 0:n.current;return s&&s.addEventListener("input",a),()=>{s&&s.removeEventListener("input",a),e.cancel(),t.cancel()}}),[i,o,n]);const g=ba(null);ya((()=>{var e;if(o&&null!=i&&""!==i&&i!==l){a(new Map);try{if(g.current===Bm.PENDING_CONVO&&i!==Bm.PENDING_CONVO&&i.length>3){const t=localStorage.getItem(`${Hm.TEXT_DRAFT}${Bm.PENDING_CONVO}`);localStorage.removeItem(`${Hm.TEXT_DRAFT}${Bm.PENDING_CONVO}`),t?localStorage.setItem(`${Hm.TEXT_DRAFT}${i}`,t):(null==(e=null==n?void 0:n.current)?void 0:e.value)&&Ux({id:i,value:n.current.value});const a=localStorage.getItem(`${Hm.FILES_DRAFT}${Bm.PENDING_CONVO}`);a&&(localStorage.setItem(`${Hm.FILES_DRAFT}${i}`,a),localStorage.removeItem(`${Hm.FILES_DRAFT}${Bm.PENDING_CONVO}`),JSON.parse(a||"[]").length>0&&m(i))}else null!=l&&l&&h(l);p(i),m(i)}catch(t){console.error(t)}g.current=i,c(i)}}),[l,i,m,n,p,o,h,a]),ya((()=>{o&&null!=i&&""!==i&&l===i&&(0===d.length?localStorage.removeItem(`${Hm.FILES_DRAFT}${i}`):localStorage.setItem(`${Hm.FILES_DRAFT}${i}`,JSON.stringify(d)))}),[s,i,o,l,d])})({files:U,setFiles:z,textAreaRef:a,conversationId:ee,isSubmitting:$||Y});const{submitMessage:oe,submitPrompt:ie}=lS(),le=(({index:e,textAreaRef:t,setShowPlusPopover:n,setShowMentionPopover:a})=>{const s=ak({permissionType:Pp.PROMPTS,permission:Op.USE}),r=ak({permissionType:Pp.MULTI_CONVO,permission:Op.USE}),o=j(N_.latestMessageFamily(e)),i=y(N_.showPromptsPopoverFamily(e)),l=j(N_.atCommand),c=j(N_.plusCommand),d=j(N_.slashCommand),u=ka((()=>{l&&JC(t,"@")&&a(!0)}),[t,a,l]),m=ka((()=>{r&&c&&JC(t,"+")&&n(!0)}),[t,n,c,r]),p=ka((()=>{s&&d&&JC(t,"/")&&i(!0)}),[t,s,i,d]),h=Ca((()=>({"@":u,"+":m,"/":p})),[u,m,p]),g=ka((e=>{if(!o)return;const t=document.getElementById(`edit-${o.parentMessageId}`);t&&(e.preventDefault(),t.click())}),[o]);return ka((e=>{var n;const a=null==(n=t.current)?void 0:n.value;if("ArrowUp"===e.key&&0===(null==a?void 0:a.length))return void g(e);if("string"!=typeof a||0===a.length)return;if(XC[e.key])return;const s=a[0],r=h[s];"function"==typeof r&&r()}),[t,h,g])})({index:e,textAreaRef:a,setShowPlusPopover:O,setShowMentionPopover:M}),{isNotAppendable:ce,handlePaste:de,handleKeyDown:ue,handleCompositionStart:me,handleCompositionEnd:pe}=qC({textAreaRef:a,submitButtonRef:n,setIsScrollable:i,disabled:ae});YC({textAreaRef:a});const{ref:he,...ge}=F.register("text",{required:!0,onChange:ka((e=>F.setValue("text",e.target.value,{shouldValidate:!0})),[F])}),xe=Di({control:F.control,name:"text"});ya((()=>{if(a.current){const e=window.getComputedStyle(a.current),t=parseFloat(e.lineHeight);d(Math.floor(a.current.scrollHeight/t))}}),[xe]),ya((()=>{S&&0===p.length&&h([...k])}),[S,k,p.length]);const fe=ka((()=>{I(!1),h([])}),[I,h]),ve=ka((()=>{p.length>0&&C([...p]),I(!1),h([])}),[p,C,I]),_e=c>3,be=Ca((()=>Qf("md:py-3.5 m-0 w-full resize-none py-[13px] placeholder-black/50 bg-transparent dark:placeholder-white/50 [&:has(textarea:focus)]:shadow-[0_2px_6px_rgba(0,0,0,.05)]",r?"max-h-[52px]":"max-h-[45vh] md:max-h-[55vh]",_e?"pl-5":"px-5")),[r,_e]);return l.jsx("form",{onSubmit:F.handleSubmit(oe),className:Qf("mx-auto flex w-full flex-row gap-3 transition-[max-width] duration-300 sm:px-2",_?"max-w-full":"md:max-w-3xl xl:max-w-4xl",!w||null!=ee&&ee!==Bm.NEW_CONVO||$||0!==(null==(t=null==V?void 0:V.messages)?void 0:t.length)?"sm:mb-10":"transition-all duration-200 sm:mb-28"),children:l.jsx("div",{className:"relative flex h-full flex-1 items-stretch md:flex-col",children:l.jsxs("div",{className:Qf("flex w-full items-center",te&&"flex-row-reverse"),children:[P&&!lc(Z)&&l.jsx(OF,{conversation:V,setShowMentionPopover:O,newConversation:W,textAreaRef:a,commandChar:"+",placeholder:"com_ui_add_model_preset",includeAssistants:!1}),L&&l.jsx(OF,{conversation:V,setShowMentionPopover:M,newConversation:H,textAreaRef:a}),l.jsx(oF,{index:e,textAreaRef:a,submitPrompt:ie}),l.jsxs("div",{onClick:se,className:Qf("relative flex w-full flex-grow flex-col overflow-hidden rounded-t-3xl border pb-4 text-text-primary transition-all duration-200 sm:rounded-3xl sm:pb-0",u?"shadow-lg":"shadow-md",N?"border-violet-800/60 bg-violet-950/10":"border-border-light bg-surface-chat"),children:[l.jsx(aF,{addedConvo:q,setAddedConvo:Q}),l.jsx(xF,{isEditingChatBadges:S,handleCancelBadges:ve,handleSaveBadges:fe,setBadges:C}),l.jsx(tF,{conversation:V}),Z&&l.jsxs("div",{className:Qf("flex",te?"flex-row-reverse":"flex-row"),children:[l.jsxs("div",{className:"relative flex-1",children:[l.jsx(Br,{...ge,ref:e=>{he(e),a.current=e},disabled:ae||ce,onPaste:de,onKeyDown:ue,onKeyUp:le,onCompositionStart:me,onCompositionEnd:pe,id:nx,tabIndex:0,"data-testid":"text-input",rows:1,onFocus:()=>{re(),m(!0)},onBlur:m.bind(null,!1),"aria-label":s("com_ui_message_input"),onClick:re,style:{height:44,overflowY:"auto"},className:Qf(be,sv,"scrollbar-hover transition-[max-height] duration-200 disabled:cursor-not-allowed")}),r&&l.jsx("div",{className:"pointer-events-none absolute bottom-0 left-0 right-0 h-10 transition-all duration-200",style:{backdropFilter:"blur(2px)",WebkitMaskImage:"linear-gradient(to top, black 15%, transparent 75%)",maskImage:"linear-gradient(to top, black 15%, transparent 75%)"}})]}),l.jsx("div",{className:"flex flex-col items-start justify-start pr-2.5 pt-1.5",children:l.jsx(cF,{isCollapsed:r,isScrollable:_e,setIsCollapsed:o})})]}),l.jsxs("div",{className:Qf("@container items-between flex gap-2 pb-2",te?"flex-row-reverse":"flex-row"),children:[l.jsx("div",{className:""+(te?"mr-2":"ml-2"),children:l.jsx(eF,{conversation:V,disableInputs:ae})}),l.jsx(RF,{showEphemeralBadges:!cc(Z)&&!lc(Z),isSubmitting:$||Y,conversationId:ee,onChange:C,isInChat:Array.isArray(null==V?void 0:V.messages)&&V.messages.length>=1}),l.jsx("div",{className:"mx-auto flex"}),g&&l.jsx(lF,{methods:F,ask:oe,textAreaRef:a,disabled:ae||ce,isSubmitting:$}),l.jsx("div",{className:""+(te?"ml-2":"mr-2"),children:($||Y)&&(R||J)?l.jsx(pF,{stop:G,setShowStopButton:A}):Z&&l.jsx(gF,{ref:n,control:F.control,disabled:B||$||ae||ce})})]}),x&&v&&l.jsx(mF,{index:e})]})]})})})})),MF="shadow-stroke relative flex h-full items-center justify-center rounded-full bg-white dark:bg-presentation dark:text-white text-black dark:after:shadow-none ";function DF(e){return e?e.length<40?"text-2xl sm:text-4xl":e.length<70?"text-xl sm:text-2xl":"text-lg sm:text-md":"text-xl sm:text-2xl"}function FF({centerFormOnLanding:e}){var t,n;const{conversation:a}=$N(),s=WN(),r=Ik(),{data:o}=K_(),{data:i}=G_(),{user:c}=nk(),d=qN(),[u,m]=ja(!1),[p,h]=ja(1),[g,x]=ja(0),f=ba(null),v=Ca((()=>{let e=(null==a?void 0:a.endpoint)??"";return e===Yl.azureOpenAI&&(e=Yl.openAI),Cf({endpointsConfig:i,iconURL:null==a?void 0:a.iconURL,endpoint:e})}),[null==a?void 0:a.endpoint,null==a?void 0:a.iconURL,i]),{entity:_,isAgent:b,isAssistant:y}=Tf({endpoint:v,agentsMap:s,assistantMap:r,agent_id:null==a?void 0:a.agent_id,assistant_id:null==a?void 0:a.assistant_id}),j=(null==_?void 0:_.name)??"",w=((null==_?void 0:_.description)||(null==a?void 0:a.greeting))??"",N=ka((()=>{var e;if("string"==typeof(null==(e=null==o?void 0:o.interface)?void 0:e.customWelcome)){const e=o.interface.customWelcome;return(null==c?void 0:c.name)&&e.includes("{{user.name}}")?e.replace(/{{user.name}}/g,c.name):e}const t=new Date,n=t.getHours(),a=t.getDay();return d(n>=0&&n<5?"com_ui_late_night":n<12?0===a||6===a?"com_ui_weekend_morning":"com_ui_good_morning":n<17?"com_ui_good_afternoon":"com_ui_good_evening")}),[d,null==(t=null==o?void 0:o.interface)?void 0:t.customWelcome,null==c?void 0:c.name]),k=ka((e=>{m(e>1),h(e)}),[]);ya((()=>{f.current&&x(f.current.offsetHeight)}),[p,w]);const C=Ca((()=>{let e="mb-0";return p>2||w&&w.length>100?e="mb-10":p>1||w&&w.length>0?e="mb-6":u&&(e="mb-4"),g>200?e="mb-16":g>150&&(e="mb-12"),e}),[p,w,u,g]),S="string"==typeof(null==(n=null==o?void 0:o.interface)?void 0:n.customWelcome)?N():N()+((null==c?void 0:c.name)?", "+c.name:"");return l.jsx("div",{className:`flex h-full transform-gpu flex-col items-center justify-center pb-16 transition-all duration-200 ${e?"max-h-full sm:max-h-0":"max-h-full"} ${C}`,children:l.jsxs("div",{ref:f,className:"flex flex-col items-center gap-0 p-2",children:[l.jsxs("div",{className:`flex ${u?"flex-col":"flex-col md:flex-row"} items-center justify-center gap-2`,children:[l.jsxs("div",{className:"relative size-10 justify-center "+(u?"mb-2":""),children:[l.jsx(sI,{agentsMap:s,assistantMap:r,conversation:a,endpointsConfig:i,containerClassName:MF,context:"landing",className:"h-2/3 w-2/3 text-black dark:text-white",size:41}),(null==o?void 0:o.showBirthdayIcon)&&l.jsx(pr,{className:"absolute bottom-[27px] right-2",description:d("com_ui_happy_birthday"),"aria-label":d("com_ui_happy_birthday"),children:l.jsx(ii,{})})]}),(b||y)&&j||j?l.jsx("div",{className:"flex flex-col items-center gap-0 p-2",children:l.jsx(li,{text:j,className:`${DF(j)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:Yi.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${j}`)}):l.jsx(li,{text:S,className:`${DF(S)} font-medium text-text-primary`,delay:50,textAlign:"center",animationFrom:{opacity:0,transform:"translate3d(0,50px,0)"},animationTo:{opacity:1,transform:"translate3d(0,0,0)"},easing:Yi.easeOutCubic,threshold:0,rootMargin:"0px",onLineCountChange:k},`split-text-${S}${(null==c?void 0:c.name)?"-user":""}`)]}),w&&l.jsx("div",{className:"animate-fadeIn mt-4 max-w-md text-center text-sm font-normal text-text-primary",children:w})]})})}const UF=va.forwardRef((function({label:e,children:t,values:n,onValuesChange:a,searchValue:s,onSearch:r,combobox:o,comboboxLabel:i,trigger:c,defaultOpen:d,...u},m){const p=Ln(),h=null!=s||!!r||!!o,g=En({showTimeout:100,placement:p?"right":"left",defaultOpen:d}),x=l.jsxs(In,{store:g,values:n,setValues:a,children:[l.jsxs(se,{ref:m,...u,className:Qf(!p&&"flex h-10 w-full items-center justify-center gap-2 rounded-xl border border-border-light px-3 py-2 text-sm text-text-primary",g.useState("open")?"bg-surface-tertiary hover:bg-surface-tertiary":"bg-surface-secondary hover:bg-surface-tertiary",u.className),render:p?l.jsx(VF,{render:c}):c,children:[l.jsx("span",{className:"flex-1",children:e}),l.jsx(Ut,{className:"stroke-1 text-base opacity-75"})]}),l.jsx(Pn,{open:g.useState("open"),portal:!0,overlap:!0,unmountOnHide:!0,gutter:p?-4:4,className:Qf((p?"animate-popover-left ml-3":"animate-popover")+" outline-none! z-50 flex max-h-[min(450px,var(--popover-available-height))] w-full","w-[var(--menu-width,auto)] min-w-[300px] flex-col overflow-auto rounded-xl border border-border-light","bg-surface-secondary px-3 py-2 text-sm text-text-primary shadow-lg","max-w-[calc(100vw-4rem)] sm:max-h-[calc(65vh)] sm:max-w-[400px]",h&&"p-0"),children:l.jsx(zF.Provider,{value:h,children:h?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"sticky top-0 z-10 bg-inherit p-1",children:l.jsxs("div",{className:"relative",children:[l.jsx(be,{autoSelect:!0,render:o,className:Qf("peer mt-1 h-10 w-full rounded-lg border-none bg-transparent px-2 text-base","sm:h-8 sm:text-sm","focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white")}),i&&l.jsx("label",{className:"pointer-events-none absolute left-2.5 top-2.5 text-sm text-text-secondary transition-all duration-200 peer-[:not(:placeholder-shown)]:-top-1.5 peer-[:not(:placeholder-shown)]:left-1.5 peer-[:not(:placeholder-shown)]:bg-surface-secondary peer-[:not(:placeholder-shown)]:text-xs",children:i})]})}),l.jsx(Mn,{className:"p-0.5 pt-0",children:t})]}):t})})]});return h?l.jsx(fe,{resetValueOnHide:!0,includesBaseElement:!1,value:s,setValue:r,children:x}):x}));va.forwardRef((function(e,t){return l.jsx(Dn,{ref:t,...e,className:Qf("my-0.5 h-0 w-full border-t border-slate-200 dark:border-slate-700",e.className)})})),va.forwardRef((function({label:e,...t},n){return l.jsxs(Fn,{ref:n,...t,className:Qf("",t.className),children:[e&&l.jsx(Un,{className:"cursor-default p-2 text-sm font-medium opacity-60 sm:py-1 sm:text-xs",children:e}),t.children]})}));const zF=va.createContext(!1),VF=va.forwardRef((function({name:e,value:t,...n},a){const s=Ln(),r=va.useContext(zF),o={ref:a,focusOnHover:!0,blurOnHoverEnd:!1,...n,className:Qf("relative flex cursor-default items-center gap-2 rounded-lg p-2 outline-none! scroll-m-1 scroll-mt-[calc(var(--combobox-height,0px)+var(--label-height,4px))] aria-disabled:opacity-25 data-[active-item]:bg-black/[0.075] data-[active-item]:text-black dark:data-[active-item]:bg-white/10 dark:data-[active-item]:text-white sm:py-1 sm:text-sm min-w-0 w-full before:absolute before:left-0 before:top-1 before:bottom-1 before:w-0.5 before:bg-transparent before:rounded-full data-[active-item]:before:bg-black dark:data-[active-item]:before:bg-white",n.className)},i=zn(s,(n=>!!e&&(null!=t&&null!=(null==n?void 0:n.values[e])))),c=zn(s,(n=>!!e&&(null==n?void 0:n.values[e])===t));if(i&&(o.children=l.jsxs(va.Fragment,{children:[l.jsx("span",{className:"flex-1",children:o.children}),l.jsx(On,{checked:c}),r&&l.jsx(ct,{children:c?"checked":"not checked"})]})),!r){if(null!=e&&null!=t){const n={...o,name:e,value:t,hideOnClick:!0};return l.jsx(Vn,{...n})}return l.jsx(Rn,{...o})}return l.jsx(je,{...o,setValueOnClick:!1,value:i?t:void 0,selectValueOnClick:()=>null!=e&&null!=t&&(null==s||s.setValue(e,t),!0),hideOnClick:e=>!e.currentTarget.hasAttribute("aria-expanded")&&(null==s||s.hideAll(),!0)})})),$F=wa(void 0);function BF({children:e}){const{conversation:t,newConversation:n}=$N(),a=Ca((()=>({endpoint:null==t?void 0:t.endpoint,model:null==t?void 0:t.model,spec:null==t?void 0:t.spec,agent_id:null==t?void 0:t.agent_id,assistant_id:null==t?void 0:t.assistant_id,conversation:t,newConversation:n})),[t,n]);return l.jsx($F.Provider,{value:a,children:e})}const HF=Sa((({currentSpec:e,endpointsConfig:t})=>{const n=kf(e),{endpoint:a}=e.preset,s=Zm(t,a,"iconURL"),r=Sf({endpoint:a,endpointsConfig:t,endpointIconURL:s});let o;if(n.includes("http")){if(n)return l.jsx(EE,{iconURL:n,altName:e.name,containerStyle:{width:20,height:20},className:"icon-md shrink-0 overflow-hidden rounded-full",endpoint:a||void 0});o=WS[a??""]??WS[r]??WS.unknown}else o=WS[n]??WS[r]??WS.unknown;return l.jsx(o,{size:20,endpoint:a,context:"menu-item",iconURL:s,className:"icon-md shrink-0 text-text-primary"})}));const GF=({localize:e,mappedEndpoints:t,selectedValues:n,modelSpecs:a,agentsMap:s})=>{if(n.modelSpec){const t=a.find((e=>e.name===n.modelSpec));return(null==t?void 0:t.label)||(null==t?void 0:t.name)||e("com_ui_select_model")}if(n.model&&n.endpoint){const a=t.find((e=>e.value===n.endpoint));if(!a)return e("com_ui_select_model");if(cc(a.value)&&a.agentNames&&a.agentNames[n.model])return a.agentNames[n.model];if(cc(a.value)&&s){const e=s[n.model];return(null==e?void 0:e.name)||n.model}return lc(a.value)&&a.assistantNames&&a.assistantNames[n.model]?a.assistantNames[n.model]:n.model}if(n.endpoint){const a=t.find((e=>e.value===n.endpoint));return(null==a?void 0:a.label)||e("com_ui_select_model")}return e("com_ui_select_model")},KF=wa(void 0);function WF(){const e=Na(KF);if(void 0===e)throw new Error("useModelSelectorContext must be used within a ModelSelectorProvider");return e}function qF({children:e,startupConfig:t}){const n=WN(),a=Ik(),{data:s}=G_(),{endpoint:r,model:o,spec:i,agent_id:c,assistant_id:d,conversation:u,newConversation:m}=function(){const e=Na($F);if(!e)throw new Error("useModelSelectorChatContext must be used within ModelSelectorChatProvider");return e}(),p=Ca((()=>{var e;const a=(null==(e=null==t?void 0:t.modelSpecs)?void 0:e.list)??[];return n?a.filter((e=>{var t,a;return(null==(t=e.preset)?void 0:t.endpoint)!==Yl.agents||!(null==(a=e.preset)?void 0:a.agent_id)||e.preset.agent_id in n})):a}),[t,n]),h=sk(),{data:g=null}=R_({requiredPermission:h},{select:e=>null==e?void 0:e.data}),{mappedEndpoints:x,endpointRequiresUserKey:f}=qS({agents:g,assistantsMap:a,startupConfig:t,endpointsConfig:s}),{onSelectEndpoint:v,onSelectSpec:_}=oD({modelSpecs:p,conversation:u,assistantsMap:a,endpointsConfig:s,newConversation:m,returnHandlers:!0}),[b,y]=ja((()=>{let e=o||"";return cc(r)&&c?e=c:lc(r)&&d&&(e=d),{endpoint:r||"",model:e,modelSpec:i||""}}));!function({index:e=0,agentsMap:t,conversation:n,assistantsMap:a,setSelectedValues:s}){const{setOption:r}=SC(),o=Ca((()=>Object.values(t??{})),[t]),{agent_id:i=null,assistant_id:l=null,endpoint:c}=n??{},d=Ca((()=>lc(c)?Object.values((null==a?void 0:a[c??""])??{}):[]),[a,c]);ya((()=>{var n;if(cc(c)&&null==i&&o.length>0){let a=localStorage.getItem(`${Hm.AGENT_ID_PREFIX}${e}`);null==a&&(a=null==(n=o[0])?void 0:n.id),void 0!==(null==t?void 0:t[a])&&(r("model")(""),r("agent_id")(a))}}),[e,o,i,t,c,r]),ya((()=>{var t,n;if(lc(c)&&null==l&&d.length>0){let s=localStorage.getItem(`${Hm.ASST_ID_PREFIX}${e}`);null==s&&(s=null==(t=d[0])?void 0:t.id);const o=null==(n=null==a?void 0:a[c??""])?void 0:n[s];void 0!==o&&(r("model")(o.model),r("assistant_id")(s))}}),[e,d,l,a,c,r]);const u=ba(null),m=e=>{u.current&&clearTimeout(u.current),u.current=setTimeout((()=>{s(e)}),150)};ya((()=>{if(null==n?void 0:n.endpoint){if((null==n?void 0:n.assistant_id)||(null==n?void 0:n.agent_id)||(null==n?void 0:n.model)||(null==n?void 0:n.spec)){if(cc(null==n?void 0:n.endpoint))return void m({endpoint:n.endpoint||"",model:n.agent_id??"",modelSpec:n.spec||""});if(lc(null==n?void 0:n.endpoint))return void m({endpoint:n.endpoint||"",model:n.assistant_id||"",modelSpec:n.spec||""});m({endpoint:n.endpoint||"",model:n.model||"",modelSpec:n.spec||""})}return()=>{u.current&&clearTimeout(u.current)}}}),[null==n?void 0:n.spec,null==n?void 0:n.model,null==n?void 0:n.endpoint,null==n?void 0:n.agent_id,null==n?void 0:n.assistant_id])}({agentsMap:n,conversation:r?{endpoint:r??null,model:o??null,spec:i??null,agent_id:c??null,assistant_id:d??null}:null,assistantsMap:a,setSelectedValues:y});const[j,w]=ja(""),[N,k]=ja({}),C=VS(),S=Ca((()=>{if(!j)return null;return function(e,t,n,a){const s=t.trim().toLowerCase();return s?e.filter((e=>!!(e.label.toLowerCase().includes(s)||e.name&&e.name.toLowerCase().includes(s)||e.value&&e.value.toLowerCase().includes(s))||!!(e.models&&e.models.length>0)&&e.models.some((t=>{var r;if(t.name.toLowerCase().includes(s))return!0;if(cc(e.value)&&n&&t.name in n){const e=null==(r=n[t.name])?void 0:r.name;return"string"==typeof e&&e.toLowerCase().includes(s)}if(lc(e.value)&&a){const n=e.value??"",r=a[n][t.name];return!(!r||"string"!=typeof r.name)&&r.name.toLowerCase().includes(s)}return!1})))):null}([...p,...x],j,n,a||{})}),[j,p,x,n,a]),T=Ca((()=>xi((e=>{w(e)}),200)),[]),E={searchValue:j,searchResults:S,selectedValues:b,endpointSearchValues:N,agentsMap:n,modelSpecs:p,assistantsMap:a,mappedEndpoints:x,endpointsConfig:s,handleSelectSpec:e=>{let t=e.preset.model??null;null==_||_(e),cc(e.preset.endpoint)?t=e.preset.agent_id??"":lc(e.preset.endpoint)&&(t=e.preset.assistant_id??""),y({endpoint:e.preset.endpoint,model:t,modelSpec:e.name})},handleSelectModel:(e,t)=>{var s,r,o;cc(e.value)?null==v||v(e.value,{agent_id:t,model:(null==(s=null==n?void 0:n[t])?void 0:s.model)??""}):lc(e.value)?null==v||v(e.value,{assistant_id:t,model:(null==(o=null==(r=null==a?void 0:a[e.value])?void 0:r[t])?void 0:o.model)??""}):e.value&&(null==v||v(e.value,{model:t})),y({endpoint:e.value,model:t,modelSpec:""})},setSelectedValues:y,handleSelectEndpoint:e=>{e.hasModels||(e.value&&(null==v||v(e.value)),y({endpoint:e.value,model:"",modelSpec:""}))},setEndpointSearchValue:(e,t)=>{k((n=>({...n,[e]:t})))},endpointRequiresUserKey:f,setSearchValue:T,...C};return l.jsx(KF.Provider,{value:E,children:e})}function QF({spec:e,isSelected:t}){const{handleSelectSpec:n,endpointsConfig:a}=WF(),{showIconInMenu:s=!0}=e;return l.jsxs(VF,{onClick:()=>n(e),className:Qf("flex w-full cursor-pointer items-center justify-between rounded-lg px-2 text-sm"),children:[l.jsxs("div",{className:Qf("flex w-full min-w-0 gap-2 px-1 py-1",e.description?"items-start":"items-center"),children:[s&&l.jsx("div",{className:"flex-shrink-0",children:l.jsx(HF,{currentSpec:e,endpointsConfig:a})}),l.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[l.jsx("span",{className:"truncate text-left",children:e.label}),e.description&&l.jsx("span",{className:"break-words text-xs font-normal",children:e.description})]})]}),t&&l.jsx("div",{className:"flex-shrink-0 self-center",children:l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},e.name)}function YF({modelId:e,endpoint:t,isSelected:n}){var a,s,r,o;const i=qN(),{handleSelectModel:d}=WF(),{isFavoriteModel:u,toggleFavoriteModel:m,isFavoriteAgent:p,toggleFavoriteAgent:h}=XS(),g=ba(null),[x,f]=ja(!1);ya((()=>{const e=g.current;if(!e)return;const t=new MutationObserver((()=>{f(e.hasAttribute("data-active-item"))}));return t.observe(e,{attributes:!0,attributeFilter:["data-active-item"]}),f(e.hasAttribute("data-active-item")),()=>t.disconnect()}),[]);let v=!1,_=e;const b=(null==(a=null==t?void 0:t.modelIcons)?void 0:a[e??""])||null;if(t&&e&&cc(t.value)&&(null==(s=t.agentNames)?void 0:s[e])){_=t.agentNames[e];const n=null==(r=null==t?void 0:t.models)?void 0:r.find((t=>t.name===e));v=(null==n?void 0:n.isGlobal)??!1}else t&&e&&lc(t.value)&&(null==(o=t.assistantNames)?void 0:o[e])&&(_=t.assistantNames[e]);const y=cc(t.value),j=y?p(e??""):u(e??"",t.value);return l.jsxs(VF,{ref:g,onClick:()=>d(t,e??""),className:"group flex w-full cursor-pointer items-center justify-between rounded-lg px-2 text-sm",children:[l.jsxs("div",{className:"flex w-full min-w-0 items-center gap-2 px-1 py-1",children:[(()=>{const e=(cc(t.value)||lc(t.value))&&t.icon,n=b?l.jsx("img",{src:b,alt:_??"",className:"h-full w-full object-cover"}):e?t.icon:null;return n?l.jsx("div",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center overflow-hidden rounded-full",children:n}):null})(),l.jsx("span",{className:"truncate",children:_}),v&&l.jsx(c,{className:"ml-1 size-4 text-surface-submit"})]}),l.jsx("button",{tabIndex:x?0:-1,onClick:n=>{n.stopPropagation(),e&&(y?h(e):m({model:e,endpoint:t.value}))},"aria-label":i(j?"com_ui_unpin":"com_ui_pin"),className:Qf("rounded-md p-1 hover:bg-surface-hover",j?"visible":"invisible group-hover:visible group-data-[active-item]:visible"),children:j?l.jsx(Ot,{className:"h-4 w-4 text-text-secondary"}):l.jsx(Lt,{className:"h-4 w-4 text-text-secondary","aria-hidden":"true"})}),n&&l.jsx("div",{className:"flex-shrink-0 self-center",children:l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]})}function XF(e,t,n,a,s){const r=a||t.map((e=>e.name)),o=null!=s?`-${s}`:"";return r.map(((t,a)=>e&&l.jsx(YF,{modelId:t,endpoint:e,isSelected:n===t},`${e.value}${o}-${t}-${a}`)))}const JF=({endpoint:e,className:t,handleOpenKeyDialog:n})=>{const a=qN()("com_endpoint_config_key");return l.jsx("button",{id:`endpoint-${e.value}-settings`,onClick:t=>{e.value&&(t.stopPropagation(),n(e.value,t))},className:Qf("flex items-center overflow-visible text-text-primary transition-all duration-300 ease-in-out","group/button rounded-md px-1 hover:bg-surface-secondary focus:bg-surface-secondary",t),"aria-label":`${a} ${e.label}`,children:l.jsxs("div",{className:"flex w-[28px] items-center gap-1 whitespace-nowrap transition-all duration-300 ease-in-out group-hover:w-auto group-focus/button:w-auto",children:[l.jsx(I,{className:"h-4 w-4 flex-shrink-0","aria-hidden":"true"}),l.jsx("span",{className:"max-w-0 overflow-hidden whitespace-nowrap opacity-0 transition-all duration-300 ease-in-out group-hover:max-w-[100px] group-hover:opacity-100 group-focus/button:max-w-[100px] group-focus/button:opacity-100",children:a})]})})};function ZF({endpoint:e,endpointIndex:t}){const n=qN(),{agentsMap:a,assistantsMap:s,modelSpecs:r,selectedValues:o,handleOpenKeyDialog:i,handleSelectEndpoint:c,endpointSearchValues:d,setEndpointSearchValue:u,endpointRequiresUserKey:m}=WF(),{model:p,endpoint:h,modelSpec:g}=o,x=Ca((()=>r&&r.length?r.filter((t=>t.group===e.value)):[]),[r,e.value]),f=d[e.value]||"",v=Ca((()=>m(e.value)),[m,e.value]),_=()=>l.jsxs("div",{className:"flex items-center gap-2",children:[e.icon&&l.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:e.icon}),l.jsx("span",{className:Qf("truncate text-left",v?"group-hover:w-24 group-focus:w-24":""),children:e.label})]});if(e.hasModels){const r=f?function(e,t,n,a,s){const r=n.trim().toLowerCase();return r?t.filter((t=>{var n;let o=t;if(cc(e.value)&&a&&a[t])o=(null==(n=a[t])?void 0:n.name)||t;else if(lc(e.value)&&s&&s[e.value]){const n=s[e.value][t];o="string"==typeof n.name&&n.name?n.name:t}return o.toLowerCase().includes(r)})):t}(e,(e.models||[]).map((e=>e.name)),f,a,s):null,o=cc(e.value)||lc(e.value)?n("com_endpoint_search_var",{0:e.label}):n("com_endpoint_search_endpoint_models",{0:e.label});return l.jsx(UF,{id:`endpoint-${e.value}-menu`,className:"transition-opacity duration-200 ease-in-out",defaultOpen:e.value===h,searchValue:f,onSearch:t=>u(e.value,t),combobox:l.jsx("input",{placeholder:" "}),comboboxLabel:o,label:l.jsxs("div",{onClick:()=>c(e),className:"group flex w-full flex-shrink cursor-pointer items-center justify-between rounded-xl px-1 py-1 text-sm",children:[_(),v&&l.jsx(JF,{endpoint:e,handleOpenKeyDialog:i})]}),children:lc(e.value)&&void 0===e.models?l.jsx("div",{className:"flex items-center justify-center p-2",children:l.jsx(Xs,{})}):l.jsxs(l.Fragment,{children:[x.map((e=>l.jsx(QF,{spec:e,isSelected:g===e.name},e.name))),r?XF(e,e.models||[],p,r,t):e.models&&XF(e,e.models,p,void 0,t)]})},`endpoint-${e.value}-item`)}return l.jsx(VF,{id:`endpoint-${e.value}-menu`,onClick:()=>c(e),className:"flex h-8 w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:l.jsxs("div",{className:"group flex w-full min-w-0 items-center justify-between",children:[_(),l.jsxs("div",{className:"flex items-center gap-2",children:[m(e.value)&&l.jsx(JF,{endpoint:e,handleOpenKeyDialog:i}),h===e.value&&l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]})]})},`endpoint-${e.value}-item`)}function eU(e){return e.map(((e,t)=>l.jsx(ZF,{endpoint:e,endpointIndex:t},`endpoint-${e.value}-${t}`)))}function tU({results:e,localize:t,searchValue:n}){const{selectedValues:a,handleSelectSpec:s,handleSelectModel:r,handleSelectEndpoint:o,endpointsConfig:i}=WF(),{modelSpec:d,endpoint:u,model:m}=a;return e?e.length?l.jsxs(l.Fragment,{children:[l.jsx("div",{role:"alert","aria-live":"polite",className:"sr-only",children:1===e.length?t("com_files_result_found",{count:e.length}):t("com_files_results_found",{count:e.length})}),e.map(((e,t)=>{if("name"in e&&"label"in e){const t=e;return l.jsxs(VF,{onClick:()=>s(t),className:Qf("flex w-full cursor-pointer justify-between rounded-lg px-2 text-sm",t.description?"items-start":"items-center"),children:[l.jsxs("div",{className:Qf("flex w-full min-w-0 gap-2 px-1 py-1",t.description?"items-start":"items-center"),children:[(t.showIconInMenu??!0)&&l.jsx("div",{className:"flex-shrink-0",children:l.jsx(HF,{currentSpec:t,endpointsConfig:i})}),l.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[l.jsx("span",{className:"truncate text-left",children:t.label}),t.description&&l.jsx("span",{className:"break-words text-xs font-normal",children:t.description})]})]}),d===t.name&&l.jsx("div",{className:Qf("flex-shrink-0",t.description?"pt-1":""),children:l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})})]},t.name)}{const a=e;if(a.hasModels&&a.models&&a.models.length>0){const e=n.toLowerCase(),s=a.label.toLowerCase().includes(e)?a.models:a.models.filter((t=>{let n=t.name;return cc(a.value)&&a.agentNames&&a.agentNames[t.name]?n=a.agentNames[t.name]:lc(a.value)&&a.assistantNames&&a.assistantNames[t.name]&&(n=a.assistantNames[t.name]),n.toLowerCase().includes(e)}));return s.length?l.jsxs(Oa,{children:[l.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 text-sm font-medium",children:[a.icon&&l.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full p-1",children:a.icon}),a.label]}),s.map((e=>{var n,s;const o=e.name;let i=!1,d=o;if(cc(a.value)&&a.agentNames&&a.agentNames[o]){d=a.agentNames[o];const e=null==(n=null==a?void 0:a.models)?void 0:n.find((e=>e.name===o));i=(null==e?void 0:e.isGlobal)??!1}else lc(a.value)&&a.assistantNames&&a.assistantNames[o]&&(d=a.assistantNames[o]);return l.jsxs(VF,{onClick:()=>r(a,o),className:"flex w-full cursor-pointer items-center justify-start rounded-lg px-3 py-2 pl-6 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[(null==(s=a.modelIcons)?void 0:s[o])&&l.jsx("div",{className:"flex h-5 w-5 items-center justify-center overflow-hidden rounded-full",children:l.jsx("img",{src:a.modelIcons[o],alt:d,className:"h-full w-full object-cover"})}),l.jsx("span",{children:d})]}),i&&l.jsx(c,{className:"ml-auto size-4 text-green-400","aria-hidden":"true"}),u===a.value&&m===o&&l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`${a.value}-${o}-search-${t}`)}))]},`endpoint-${a.value}-search-${t}`):null}return l.jsxs(VF,{onClick:()=>o(a),className:"flex w-full cursor-pointer items-center justify-between rounded-xl px-3 py-2 text-sm",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[a.icon&&l.jsx("div",{className:"flex items-center justify-center overflow-hidden rounded-full border border-gray-200 p-1 dark:border-gray-700",style:{borderRadius:"50%"},children:a.icon}),l.jsx("span",{children:a.label})]}),u===a.value&&l.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"block",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM16.0755 7.93219C16.5272 8.25003 16.6356 8.87383 16.3178 9.32549L11.5678 16.0755C11.3931 16.3237 11.1152 16.4792 10.8123 16.4981C10.5093 16.517 10.2142 16.3973 10.0101 16.1727L7.51006 13.4227C7.13855 13.014 7.16867 12.3816 7.57733 12.0101C7.98598 11.6386 8.61843 11.6687 8.98994 12.0773L10.6504 13.9039L14.6822 8.17451C15 7.72284 15.6238 7.61436 16.0755 7.93219Z",fill:"currentColor"})})]},`endpoint-${a.value}-search-item`)}}))]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{role:"alert","aria-live":"polite",className:"sr-only",children:t("com_files_no_results")}),l.jsx("div",{className:"cursor-default p-2 sm:py-1 sm:text-sm",children:t("com_files_no_results")})]}):null}function nU(e,t,n){return l.jsx(tU,{results:e,localize:t,searchValue:n},`search-results-${n}`)}function aU({groupName:e,specs:t}){const{selectedValues:n}=WF(),{modelSpec:a}=n;return t&&0!==t.length?l.jsx(UF,{id:`custom-group-${e}-menu`,className:"transition-opacity duration-200 ease-in-out",label:l.jsx("div",{className:"group flex w-full flex-shrink cursor-pointer items-center justify-between rounded-xl px-1 py-1 text-sm",children:l.jsx("div",{className:"flex items-center gap-2",children:l.jsx("span",{className:"truncate text-left",children:e})})}),children:t.map((e=>l.jsx(QF,{spec:e,isSelected:a===e.name},e.name)))},`custom-group-${e}`):null}function sU(e,t){const n=new Set(t.map((e=>e.value))),a=e.reduce(((e,t)=>(!t.group||n.has(t.group)||(e[t.group]||(e[t.group]=[]),e[t.group].push(t)),e)),{});return Object.entries(a).map((([e,t])=>l.jsx(aU,{groupName:e,specs:t},e)))}const rU=Ta(((e,t)=>{const{id:n,value:a,label:s,subLabel:r,onChange:o,labelClassName:i="",inputClassName:c=""}=e,d=qN();return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Qf("mt-4 flex flex-row",i),children:[l.jsx(er,{htmlFor:n,className:"text-left text-sm font-medium",children:s}),er&&l.jsx(er,{className:"mx-1 text-right text-sm text-text-secondary",children:r}),l.jsx("br",{})]}),l.jsx("div",{className:"h-1"}),l.jsx(kr,{id:n,"data-testid":`input-${n}`,value:a??"",onChange:o,ref:t,placeholder:`${d("com_endpoint_config_value")} ${s}`,className:Qf("flex h-10 max-h-10 w-full resize-none px-3 py-2")})]})})),oU=sa({client_email:ra().email().min(3),project_id:ra().min(3),private_key:ra().min(601)}),iU=e=>oU.safeParse(e).success,lU=({endpoint:e,userProvideURL:t})=>{const{control:n}=Pi(),a=e===Yl.azureOpenAI;return l.jsxs("form",{className:"flex-wrap",children:[!a&&l.jsx(Li,{name:"apiKey",control:n,render:({field:e})=>l.jsx(rU,{id:"apiKey",...e,label:(a?"Azure q":"")+"OpenAI API Key",labelClassName:"mb-1",inputClassName:"mb-2"})}),a&&l.jsxs(l.Fragment,{children:[l.jsx(Li,{name:"azureOpenAIApiKey",control:n,render:({field:e})=>l.jsx(rU,{id:"azureOpenAIApiKey",...e,label:"Azure OpenAI API Key",labelClassName:"mb-1"})}),l.jsx("div",{className:"mt-3"}),l.jsx(Li,{name:"azureOpenAIApiInstanceName",control:n,render:({field:e})=>l.jsx(rU,{id:"azureOpenAIApiInstanceName",...e,label:"Azure OpenAI Instance Name",labelClassName:"mb-1"})}),l.jsx("div",{className:"mt-3"}),l.jsx(Li,{name:"azureOpenAIApiDeploymentName",control:n,render:({field:e})=>l.jsx(rU,{id:"azureOpenAIApiDeploymentName",...e,label:"Azure OpenAI Deployment Name",labelClassName:"mb-1"})}),l.jsx("div",{className:"mt-3"}),l.jsx(Li,{name:"azureOpenAIApiVersion",control:n,render:({field:e})=>l.jsx(rU,{id:"azureOpenAIApiVersion",...e,label:"Azure OpenAI API Version",labelClassName:"mb-1"})})]}),t&&l.jsx("div",{className:"mt-3",children:l.jsx(Li,{name:"baseURL",control:n,render:({field:e})=>l.jsx(rU,{id:"baseURL",...e,label:"API Base URL",subLabel:"(Optional)",labelClassName:"mb-1"})})})]})};const cU=Sa((function({endpoint:e}){const t=qN();return{[Yl.google]:l.jsxs(l.Fragment,{children:[l.jsxs("small",{className:"mt-4 break-all text-text-secondary",children:[t("com_endpoint_config_google_service_key"),": ",t("com_endpoint_config_key_google_need_to")," ",l.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/vertex-ai",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_vertex_ai")})," ",t("com_endpoint_config_key_google_vertex_api")," ",l.jsx("a",{target:"_blank",href:"https://console.cloud.google.com/projectselector/iam-admin/serviceaccounts/create?walkthrough_id=iam--create-service-account#step_index=1",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_key_google_service_account")}),". ",t("com_endpoint_config_key_google_vertex_api_role")]}),l.jsxs("small",{className:"break-all text-text-secondary",children:[t("com_endpoint_config_google_api_key"),": ",t("com_endpoint_config_google_api_info")," ",l.jsx("a",{target:"_blank",href:"https://makersuite.google.com/app/apikey",rel:"noreferrer",className:"text-blue-700 underline dark:text-blue-400",children:t("com_endpoint_config_click_here")})," "]})]})}[e]||null})),dU={[Yl.google]:({userKey:e,setUserKey:t})=>{const n=qN(),{getMultiKey:a,setMultiKey:s}=function(e){return{getMultiKey:function(e,t){return px(t)?JSON.parse(t)[e]:""},setMultiKey:function(t,n,a){let s={};px(a)&&(s=JSON.parse(a)),s[t]=n,e(JSON.stringify(s))}}}(t);return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex flex-row",children:[l.jsx(er,{htmlFor:Fm.GOOGLE_SERVICE_KEY,className:"text-left text-sm font-medium",children:n("com_endpoint_config_google_service_key")}),l.jsx(er,{className:"mx-1 text-right text-sm text-text-secondary",children:n("com_endpoint_config_google_cloud_platform")}),l.jsx("br",{})]}),l.jsx(nO,{id:Fm.GOOGLE_SERVICE_KEY,className:"w-full",containerClassName:"dark:bg-gray-700 h-10 max-h-10 w-full resize-none py-2 dark:ring-1 dark:ring-gray-600",text:n("com_endpoint_config_key_import_json_key"),successText:n("com_endpoint_config_key_import_json_key_success"),invalidText:n("com_endpoint_config_key_import_json_key_invalid"),validator:iU,onFileSelected:t=>{s(Fm.GOOGLE_SERVICE_KEY,JSON.stringify(t),e)}}),l.jsx(rU,{id:Fm.GOOGLE_API_KEY,value:a(Fm.GOOGLE_API_KEY,e)??"",onChange:t=>s(Fm.GOOGLE_API_KEY,t.target.value??"",e),label:n("com_endpoint_config_google_api_key"),subLabel:n("com_endpoint_config_google_gemini_api")})]})},[Yl.openAI]:lU,[Yl.custom]:({endpoint:e,userProvideURL:t})=>{const{control:n}=Pi();return l.jsxs("form",{className:"flex-wrap",children:[l.jsx(Li,{name:"apiKey",control:n,render:({field:t})=>l.jsx(rU,{id:"apiKey",...t,label:`${e} API Key`,labelClassName:"mb-1",inputClassName:"mb-2"})}),t&&l.jsx(Li,{name:"baseURL",control:n,render:({field:t})=>l.jsx(rU,{id:"baseURL",...t,label:`${e} API URL`,labelClassName:"mb-1"})})]})},[Yl.azureOpenAI]:lU,[Yl.assistants]:lU,[Yl.azureAssistants]:lU,default:({userKey:e,setUserKey:t,endpoint:n})=>{const a=qN();return l.jsx(rU,{id:n,value:e??"",onChange:e=>t(e.target.value??""),label:a("com_endpoint_config_key_name")})}},uU=new Set([Yl.openAI,Yl.custom,Yl.azureOpenAI,Yl.assistants,Yl.azureAssistants]),mU={THIRTY_MINUTES:{label:"in 30 minutes",value:18e5},TWO_HOURS:{label:"in 2 hours",value:72e5},TWELVE_HOURS:{label:"in 12 hours",value:432e5},ONE_DAY:{label:"in 1 day",value:864e5},ONE_WEEK:{label:"in 7 days",value:6048e5},ONE_MONTH:{label:"in 30 days",value:2592e6},NEVER:{label:"never",value:0}},pU=({endpoint:e,disabled:t,setDialogOpen:n})=>{const a=qN(),[s,r]=ja(!1),{showToast:o}=Ds(),i=bN(e),c=yN(),d=()=>{o({message:a("com_ui_revoke_key_success"),status:lx.SUCCESS}),n&&n(!1)},u=()=>{o({message:a("com_ui_revoke_key_error"),status:lx.ERROR})},m=i.isLoading||c.isLoading;return l.jsx("div",{className:"flex items-center justify-between",children:l.jsxs(rr,{open:s,onOpenChange:r,children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{variant:"destructive",className:"flex items-center justify-center rounded-lg transition-colors duration-200",onClick:()=>r(!0),disabled:t,children:a("com_ui_revoke")})}),l.jsxs(ir,{className:"max-w-[450px]",children:[l.jsx(br,{children:l.jsx(lr,{children:a("com_ui_revoke_key_endpoint",{0:e})})}),l.jsx("div",{className:"py-4",children:l.jsx(er,{className:"text-left text-sm font-medium",children:a("com_ui_revoke_key_confirm")})}),l.jsxs(ci,{children:[l.jsx(Ys,{variant:"outline",onClick:()=>r(!1),children:a("com_ui_cancel")}),l.jsx(Ys,{variant:"destructive",onClick:()=>{i.mutate({},{onSuccess:d,onError:u})},disabled:m,className:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",children:m?l.jsx(Xs,{}):a("com_ui_revoke")})]})]})]})})},hU=({open:e,onOpenChange:t,endpoint:n,endpointType:a,userProvideURL:s})=>{const r=Oi({defaultValues:{apiKey:"",baseURL:"",azureOpenAIApiKey:"",azureOpenAIApiInstanceName:"",azureOpenAIApiDeploymentName:"",azureOpenAIApiVersion:""}}),[o,i]=ja(""),[c,d]=ja(mU.TWELVE_HOURS.label),{getExpiry:u,saveUserKey:m}=hC(n),{showToast:p}=Ds(),h=qN(),g=Object.values(mU),x=dU[a??n]??dU.default,f=u();return l.jsx(rr,{open:e,onOpenChange:t,children:l.jsxs(ir,{className:"w-11/12 max-w-2xl",children:[l.jsx(br,{children:l.jsx(lr,{children:`${h("com_endpoint_config_key_for")} ${Sm[n]??n}`})}),l.jsxs("div",{className:"grid w-full items-center gap-2 py-4",children:[l.jsx("small",{className:"text-red-600",children:"never"===f?h("com_endpoint_config_key_never_expires"):`${h("com_endpoint_config_key_encryption")} ${new Date(f??0).toLocaleString()}`}),l.jsx(yo,{label:"Expires ",value:c,onChange:e=>{d(e)},options:g.map((e=>e.label)),sizeClasses:"w-[185px]",portal:!1}),l.jsx("div",{className:"mt-2"}),l.jsx(Mi,{...r,children:l.jsx(x,{userKey:o,endpoint:n,setUserKey:i,userProvideURL:s})}),l.jsx(cU,{endpoint:n})]}),l.jsxs(ci,{children:[l.jsx(pU,{endpoint:n,disabled:!f,setDialogOpen:t}),l.jsx(Ys,{variant:"submit",onClick:()=>{const e=g.find((e=>e.label===c));let l;l=0===(null==e?void 0:e.value)?null:Date.now()+(e?e.value:0);const d=e=>{try{m(e,l),p({message:h("com_ui_save_key_success"),status:lx.SUCCESS}),t(!1)}catch(n){cx.error("Error saving user key:",n),p({message:h("com_ui_save_key_error"),status:lx.ERROR})}};uU.has(n)||uU.has(a??"")?r.handleSubmit((e=>{const a=n===Yl.azureOpenAI,o=a||n===Yl.openAI||lc(n);a&&(e.apiKey="n/a");const i=Object.keys(e).filter((t=>!(!a&&t.startsWith("azure"))&&((!o||"baseURL"!==t)&&(!("baseURL"===t&&!s)&&""===e[t]))));if(i.length>0)return p({message:"The following fields are required: "+i.join(", "),status:"error"}),void t(!0);const{apiKey:l,baseURL:c,...u}=e,m={apiKey:l,baseURL:c};a&&(m.apiKey=JSON.stringify({azureOpenAIApiKey:u.azureOpenAIApiKey,azureOpenAIApiInstanceName:u.azureOpenAIApiInstanceName,azureOpenAIApiDeploymentName:u.azureOpenAIApiDeploymentName,azureOpenAIApiVersion:u.azureOpenAIApiVersion})),d(JSON.stringify(m)),r.reset()}))():o.trim()?(d(o),i("")):p({message:h("com_ui_key_required"),status:lx.ERROR})},children:h("com_ui_submit")})]})]})})},gU=({keyDialogOpen:e,keyDialogEndpoint:t,onOpenChange:n,endpointsConfig:a})=>l.jsx(l.Fragment,{children:t&&l.jsx(hU,{open:e,endpoint:t,endpointType:Zm(a,t,"type"),onOpenChange:n,userProvideURL:Zm(a,t,"userProvideURL")})});function xU(){const e=qN(),{agentsMap:t,modelSpecs:n,mappedEndpoints:a,endpointsConfig:s,searchValue:r,searchResults:o,selectedValues:i,setSearchValue:c,setSelectedValues:d,keyDialogOpen:u,onOpenChange:m,keyDialogEndpoint:p}=WF(),h=Ca((()=>function({mappedEndpoints:e,selectedValues:t,modelSpecs:n,endpointsConfig:a}){var s;const{endpoint:r,model:o,modelSpec:i}=t;if(i){const e=n.find((e=>e.name===i));if(!e)return null;const{showIconInHeader:t=!0}=e;return t?_a.createElement(HF,{currentSpec:e,endpointsConfig:a}):null}if(r&&o){const t=e.find((e=>e.value===r));if(!t)return null;if(null==(s=t.modelIcons)?void 0:s[o]){const e=t.modelIcons[o];return _a.createElement("div",{className:"h-5 w-5 overflow-hidden rounded-full"},_a.createElement("img",{src:e,alt:o,className:"h-full w-full object-cover"}))}return t.icon||_a.createElement($n,{size:20,className:"icon-md shrink-0 text-text-primary"})}if(r){const t=e.find((e=>e.value===r));return(null==t?void 0:t.icon)||null}return null}({mappedEndpoints:a??[],selectedValues:i,modelSpecs:n,endpointsConfig:s})),[a,i,n,s]),g=Ca((()=>GF({localize:e,agentsMap:t,modelSpecs:n,selectedValues:i,mappedEndpoints:a})),[e,t,n,i,a]),x=l.jsx(pr,{"aria-label":e("com_ui_select_model"),description:e("com_ui_select_model"),render:l.jsxs("button",{className:"my-1 flex h-10 w-full max-w-[70vw] items-center justify-center gap-2 rounded-xl border border-border-light bg-surface-secondary px-3 py-2 text-sm text-text-primary hover:bg-surface-tertiary","aria-label":e("com_ui_select_model"),children:[h&&_a.isValidElement(h)&&l.jsx("div",{className:"flex flex-shrink-0 items-center justify-center overflow-hidden",children:h}),l.jsx("span",{className:"flex-grow truncate text-left",children:g})]})});return l.jsxs("div",{className:"relative flex w-full max-w-md flex-col items-center gap-2",children:[l.jsx(UF,{values:i,onValuesChange:e=>{d({endpoint:e.endpoint||"",model:e.model||"",modelSpec:e.modelSpec||""})},onSearch:e=>c(e),combobox:l.jsx("input",{id:"model-search",placeholder:" "}),comboboxLabel:e("com_endpoint_search_models"),trigger:x,children:o?nU(o,e,r):l.jsxs(l.Fragment,{children:[(f=(null==n?void 0:n.filter((e=>!e.group)))||[],v=i.modelSpec||"",f&&0!==f.length?f.map((e=>l.jsx(QF,{spec:e,isSelected:v===e.name},e.name))):null),eU(a??[]),sU(n||[],a??[])]})}),l.jsx(gU,{keyDialogOpen:u,onOpenChange:m,endpointsConfig:s||{},keyDialogEndpoint:p||void 0})]});var f,v}function fU({startupConfig:e}){var t;const n=(null==e?void 0:e.interface)??Nm().interface,a=(null==(t=null==e?void 0:e.modelSpecs)?void 0:t.list)??[];return!1===n.modelSelect&&0===a.length?null:l.jsx(BF,{children:l.jsx(qF,{startupConfig:e,children:l.jsx(xU,{})})})}const vU=[{value:"screenshot",label:"screenshot (.png)"},{value:"text",label:"text (.txt)"},{value:"markdown",label:"markdown (.md)"},{value:"json",label:"json (.json)"},{value:"csv",label:"csv (.csv)"}];function _U({open:e,onOpenChange:t,conversation:n,triggerRef:a,children:s}){const r=qN(),[o,i]=ja(""),[c,d]=ja("screenshot"),[u,m]=ja(!0),[p,h]=ja(!1),[g,x]=ja(!0);ya((()=>{!e&&a&&a.current&&a.current.focus()}),[e,a]),ya((()=>{i(H(String((null==n?void 0:n.title)??"file"))),d("screenshot"),m(!0),h(!1),x(!0)}),[null==n?void 0:n.title,e]);const f=ka((e=>{const t="csv"!==e&&"screenshot"!==e;h("json"===e||"csv"===e||"webpage"===e),m(t),d(e)}),[]),v=Ca((()=>"json"===c||"csv"===c||"webpage"===c),[c]),_=Ca((()=>"csv"!==c&&"screenshot"!==c),[c]),{exportConversation:b}=AC({conversation:n,filename:H(o),type:c,includeOptions:u,exportBranches:p,recursive:g});return l.jsxs(rr,{open:e,onOpenChange:t,triggerRef:a,children:[s,l.jsx(hr,{title:r("com_nav_export_conversation"),className:"max-w-full sm:max-w-2xl",main:l.jsxs("div",{className:"flex w-full flex-col items-center gap-6",children:[l.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[l.jsxs("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:[l.jsx(er,{htmlFor:"filename",className:"text-left text-sm font-medium",children:r("com_nav_export_filename")}),l.jsx(kr,{id:"filename",value:o,onChange:e=>i(e.target.value||""),placeholder:r("com_nav_export_filename_placeholder")})]}),l.jsxs("div",{className:"col-span-1 flex w-full flex-col items-start justify-start gap-2",children:[l.jsx(er,{htmlFor:"type",className:"text-left text-sm font-medium",children:r("com_nav_export_type")}),l.jsx(yo,{value:c,onChange:f,options:vU,className:"z-50",portal:!1})]})]}),l.jsxs("div",{className:"grid w-full gap-6 sm:grid-cols-2",children:[l.jsx("div",{className:"col-span-1 flex flex-col items-start justify-start gap-2",children:l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(er,{htmlFor:"includeOptions",className:"text-left text-sm font-medium",children:r("com_nav_export_include_endpoint_options")}),l.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[l.jsx(jr,{id:"includeOptions",disabled:!_,checked:u,onCheckedChange:m,"aria-labelledby":"includeOptions-label"}),l.jsx("label",{id:"includeOptions-label",htmlFor:"includeOptions",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:r(_?"com_nav_export_include_endpoint_options":"com_nav_not_supported")})]})]})}),l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(er,{htmlFor:"exportBranches",className:"text-left text-sm font-medium",children:r("com_nav_export_all_message_branches")}),l.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[l.jsx(jr,{id:"exportBranches",disabled:!v,checked:p,onCheckedChange:h,"aria-labelledby":"exportBranches-label"}),l.jsx("label",{id:"exportBranches-label",htmlFor:"exportBranches",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:r(v?"com_nav_export_all_message_branches":"com_nav_not_supported")})]})]}),"json"===c?l.jsxs("div",{className:"grid w-full items-center gap-2",children:[l.jsx(er,{htmlFor:"recursive",className:"text-left text-sm font-medium",children:r("com_nav_export_recursive_or_sequential")}),l.jsxs("div",{className:"flex h-[40px] w-full items-center space-x-3",children:[l.jsx(jr,{id:"recursive",checked:g,onCheckedChange:x,"aria-labelledby":"recursive-label"}),l.jsx("label",{id:"recursive-label",htmlFor:"recursive",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 dark:text-gray-50",children:r("com_nav_export_recursive")})]})]}):null]})]}),buttons:l.jsx(l.Fragment,{children:l.jsx(Ys,{onClick:b,variant:"submit",children:r("com_endpoint_export")})}),selection:void 0})]})}function bU({isSharedButtonEnabled:e}){const t=qN(),[n,a]=ja(!1),[s,r]=ja(!1),[o,i]=ja(!1),c=Ea(),d=ba(null),u=ba(null),m=vr("(max-width: 768px)"),p=j(N_.conversationByIndex(0));if(!1===(p&&null!=p.conversationId&&"new"!==p.conversationId&&"search"!==p.conversationId))return null;const h=[{label:t("com_ui_share"),onClick:()=>{i(!0)},icon:l.jsx(Ne,{className:"icon-md mr-2 text-text-secondary"}),show:e,hideOnClick:!1,ref:d,render:e=>l.jsx("button",{...e})},{label:t("com_endpoint_export"),onClick:()=>{a(!0)},icon:l.jsx(Bn,{className:"icon-md mr-2 text-text-secondary"}),hideOnClick:!1,ref:u,render:e=>l.jsx("button",{...e})}];return l.jsxs(l.Fragment,{children:[l.jsx(cr,{portal:!0,menuId:c,focusLoop:!0,unmountOnHide:!0,isOpen:s,setIsOpen:r,trigger:l.jsx(pr,{description:t("com_endpoint_export_share"),render:l.jsx(se,{id:"export-menu-button","aria-label":"Export options",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:l.jsx(Ne,{className:"icon-md text-text-secondary","aria-hidden":"true",focusable:"false"})})}),items:h,className:m?"":"absolute right-0 top-0 mt-2"}),l.jsx(_U,{open:n,onOpenChange:a,conversation:p,triggerRef:u,"aria-label":t("com_ui_export_convo_modal")}),l.jsx(gD,{triggerRef:d,conversationId:p.conversationId??"",open:o,onOpenChange:i})]})}const yU=()=>{const e=qN(),t=xs(),{showToast:n}=Ds(),a=j(N_.conversationByIndex(0))||void 0,s=(null==a?void 0:a.conversationId)??"",r=(e=>{const t=y(N_.updateConversationSelector(e)),{updateTagsInConversation:n}=mb();return a=>{e&&(n(e,a),t({tags:a}))}})(s),o=null==a?void 0:a.tags,i=null!=(null==a?void 0:a.expiredAt),c=Ea(),[d,u]=ja(!1),[m,p]=ja(!1),h=((e,t)=>{const n=xb(),{updateTagsInConversation:a}=mb();return fs((t=>Jh.addTagToConversation(e,t)),{onSuccess:(s,...r)=>{var o;n.refetch(),a(e,s),null==(o=null==t?void 0:t.onSuccess)||o.call(t,s,...r)},onError:null==t?void 0:t.onError,onMutate:null==t?void 0:t.onMutate})})(s,{onSuccess:(e,t)=>{r(e);const n=document.getElementById(t.tag);console.log("tagElement",n),n&&setTimeout((()=>n.focus()),2)},onError:()=>{n({message:"Error adding bookmark",severity:lx.ERROR})},onMutate:e=>{const t=document.getElementById(e.tag);console.log("tagElement",t),t&&setTimeout((()=>t.focus()),2)}}),{data:g}=xb(),x=Boolean(a&&s&&s!==Bm.NEW_CONVO&&"search"!==s),f=ka((e=>{if(void 0===e||""===e||!s)return void n({message:"Invalid tag or conversationId",severity:lx.ERROR});cx.log("tag_mutation","BookmarkMenu - handleSubmit: tags before setting",o);const a=(t.getQueryData([Fh.conversationTags])??[]).map((e=>e.tag)),r=null==o?void 0:o.filter((e=>a.includes(e)));cx.log("tag_mutation","BookmarkMenu - handleSubmit: tags after filtering",r);const i=!0===(null==r?void 0:r.includes(e))?r.filter((t=>t!==e)):[...r??[],e];cx.log("tag_mutation","BookmarkMenu - handleSubmit: tags after",i),h.mutate({tags:i,tag:e})}),[o,s,h,t,n]),v=ba(null),_=Ca((()=>{const t=[{id:"%___new___bookmark___%",label:e("com_ui_bookmarks_new"),icon:l.jsx(Ze,{className:"size-4"}),hideOnClick:!1,ref:v,render:e=>l.jsx("button",{...e}),onClick:()=>p(!0)}];if(g)for(const e of g){const n=null==o?void 0:o.includes(e.tag);t.push({id:e.tag,label:e.tag,hideOnClick:!1,icon:!0===n?l.jsx(ns,{className:"size-4"}):l.jsx(as,{className:"size-4"}),onClick:()=>f(e.tag),disabled:h.isLoading})}return t}),[o,g,f,h.isLoading,e]);if(!x)return null;if(i)return null;return l.jsxs(wk.Provider,{value:{bookmarks:g||[]},children:[l.jsx(cr,{portal:!0,menuId:c,focusLoop:!0,isOpen:d,unmountOnHide:!0,setIsOpen:u,keyPrefix:`${s}-bookmark-`,trigger:l.jsx(pr,{description:e("com_ui_bookmarks_add"),render:l.jsx(se,{id:"bookmark-menu-button","aria-label":e("com_ui_bookmarks_add"),className:Qf("mt-text-sm flex size-10 flex-shrink-0 items-center justify-center gap-2 rounded-xl border border-border-light text-sm transition-colors duration-200 hover:bg-surface-hover",d?"bg-surface-hover":""),"data-testid":"bookmark-menu",children:h.isLoading?l.jsx(Xs,{"aria-label":"Spinner"}):((null==o?void 0:o.length)??0)>0?l.jsx(ns,{className:"icon-sm","aria-label":"Filled Bookmark"}):l.jsx(as,{className:"icon-sm","aria-label":"Bookmark"})})}),items:_}),l.jsx(fR,{tags:o,open:m,setTags:r,setOpen:p,triggerRef:v,conversationId:s,context:"BookmarkMenu - BookmarkEditDialog"})]})};function jU(){const e=qN(),[t,n]=b(N_.isTemporary),{conversation:a,isSubmitting:s}=$N(),r={icon:Hn,label:"com_ui_temporary",atom:N_.isTemporary},o=_((()=>()=>{n(!t)}),[t]);return Array.isArray(null==a?void 0:a.messages)&&a.messages.length>=1||s?null:l.jsx("div",{className:"relative flex flex-wrap items-center gap-2",children:l.jsx(pr,{description:e(r.label),render:l.jsx("button",{onClick:o,"aria-label":e(r.label),"aria-pressed":t,className:Qf("inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light text-text-primary transition-all ease-in-out hover:bg-surface-tertiary",t?"bg-surface-active shadow-md":"bg-transparent shadow-sm hover:bg-surface-hover hover:shadow-md","active:shadow-inner"),children:r.icon&&l.jsx(r.icon,{className:Qf("relative h-5 w-5 md:h-4 md:w-4",!1),"aria-hidden":"true"})})})})}function wU(){const{conversation:e}=$N(),{setConversation:t}=gk(),n=qN();return e?lc(e.endpoint)?null:l.jsx(pr,{id:"add-multi-conversation-button","aria-label":n("com_ui_add_multi_conversation"),description:n("com_ui_add_multi_conversation"),tabIndex:0,role:"button",onClick:()=>{const{title:n,...a}=e??{};t({...a,title:""});const s=document.getElementById(nx);s&&s.focus()},"data-testid":"parameters-button",className:"inline-flex size-10 flex-shrink-0 items-center justify-center rounded-xl border border-border-light bg-transparent text-text-primary transition-all ease-in-out hover:bg-surface-tertiary disabled:pointer-events-none disabled:opacity-50 radix-state-open:bg-surface-tertiary",children:l.jsx(Le,{size:16,"aria-hidden":"true"})}):null}const NU=Nm().interface;function kU(){const{data:e}=K_(),{navVisible:t,setNavVisible:n}=ee(),a=Ca((()=>(null==e?void 0:e.interface)??NU),[e]),s=ak({permissionType:Pp.BOOKMARKS,permission:Op.USE}),r=ak({permissionType:Pp.MULTI_CONVO,permission:Op.USE}),o=vr("(max-width: 768px)");return l.jsxs("div",{className:"sticky top-0 z-10 flex h-14 w-full items-center justify-between bg-white p-2 font-semibold text-text-primary dark:bg-gray-800",children:[l.jsxs("div",{className:"hide-scrollbar flex w-full items-center justify-between gap-2 overflow-x-auto",children:[l.jsxs("div",{className:"mx-1 flex items-center",children:[l.jsx(xl,{initial:!1,children:!t&&l.jsxs(fl.div,{className:"flex items-center gap-2",initial:{width:0,opacity:0},animate:{width:"auto",opacity:1},exit:{width:0,opacity:0},transition:{duration:.2},children:[l.jsx(cO,{setNavVisible:n,className:"max-md:hidden"}),l.jsx(dO,{})]},"header-buttons")}),!(t&&o)&&l.jsxs("div",{className:Qf("flex items-center gap-2",o?"":"transition-all duration-200 ease-in-out",t||o?"":"pl-2"),children:[l.jsx(fU,{startupConfig:e}),!0===a.presets&&a.modelSelect&&l.jsx(oO,{}),!0===s&&l.jsx(yU,{}),!0===r&&l.jsx(wU,{}),o&&l.jsxs(l.Fragment,{children:[l.jsx(bU,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),l.jsx(jU,{})]})]})]}),!o&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(bU,{isSharedButtonEnabled:(null==e?void 0:e.sharedLinksEnabled)??!1}),l.jsx(jU,{})]})]}),l.jsx("div",{})]})}function CU(){return l.jsx("div",{className:"relative flex-1 overflow-hidden overflow-y-auto",children:l.jsx("div",{className:"relative flex h-full items-center justify-center",children:l.jsx(Xs,{className:"text-text-primary"})})})}const SU=Sa((function({index:e=0}){const{conversationId:t}=W(),n=j(N_.submissionByIndex(e)),a=j(N_.submissionByIndex(e+1)),s=j(N_.centerFormOnLanding),r=pk(),{data:o=null,isLoading:i}=ab(t??"",{select:ka((e=>{const t=gp({messages:e,fileMap:r});return 0===(null==t?void 0:t.length)?null:t??null}),[r]),enabled:!!r}),c=bC(e,t),d=function({rootIndex:e}){const t=Ca((()=>e+1),[e]),{ask:n,regenerate:a,setMessages:s,getMessages:r,conversation:o,isSubmitting:i,setConversation:l,setIsSubmitting:c}=yC({rootIndex:e,currentIndex:t}),{generateConversation:d}=jC({index:t,rootIndex:e,setConversation:l});return{ask:n,regenerate:a,getMessages:r,setMessages:s,conversation:o,isSubmitting:i,setConversation:l,setIsSubmitting:c,generateConversation:d,addedIndex:t}}({rootIndex:e});DS(n,c,!1),DS(a,d,!0);const u=Oi({defaultValues:{text:""}});let m;const p=!(o&&0!==o.length||t!==Bm.NEW_CONVO&&t),h=(!o||0===o.length)&&null!=t;return m=i&&t!==Bm.NEW_CONVO?l.jsx(CU,{}):!i&&!h||p?p?l.jsx(FF,{centerFormOnLanding:s}):l.jsx(WD,{messagesTree:o}):l.jsx(CU,{}),l.jsx(yk,{...u,children:l.jsx(VN.Provider,{value:c,children:l.jsx(hk.Provider,{value:d,children:l.jsx(XD,{children:l.jsxs("div",{className:"flex h-full w-full flex-col",children:[!i&&l.jsx(kU,{}),l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Qf("flex flex-col",p?"flex-1 items-center justify-end sm:justify-center":"h-full overflow-y-auto"),children:[m,l.jsxs("div",{className:Qf("w-full",p&&"max-w-3xl transition-all duration-200 xl:max-w-4xl"),children:[l.jsx(LF,{index:e}),p?l.jsx(QM,{}):l.jsx(GM,{})]})]}),p&&l.jsx(GM,{})]})]})})})})})}));function TU(){const{data:e}=K_(),{isAuthenticated:t,user:n,roles:a}=function(){const{user:e,roles:t,isAuthenticated:n}=nk(),a=E();return ya((()=>{const e=setTimeout((()=>{n||a("/login",{replace:!0})}),300);return()=>{clearTimeout(e)}}),[n,a]),{user:e,roles:t,isAuthenticated:n}}(),s=j(v_.defaultTemporaryChat),r=_((({set:e})=>t=>{e(v_.isTemporary,t)}),[]);wC({startupConfig:e,user:n});const{conversationId:o=""}=W();!function(e){const t=ba(null),n=S(N_.visibleArtifacts);ya((()=>{e!==t.current&&(cx.log("conversation","Conversation ID change"),n()),t.current=e}),[e,n])}(o);const{hasSetConversation:i,conversation:c}=N_.useCreateConversationAtom(0),{newConversation:d}=_C(),u=jN({enabled:t,refetchOnMount:"always"}),m=((e,t)=>{const n=xs();return gs([Fh.conversation,e],(()=>{const t=Kx(n.getQueryData([Fh.allConversations],{exact:!1}),e);return t&&null!=t.messages?t:Jh.getConversationById(e)}),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...t})})(o,{enabled:t&&o!==Bm.NEW_CONVO&&!i.current}),p=G_({enabled:t}),h=HN(),g=!(!c||!c.expiredAt);return ya((()=>{o===Bm.NEW_CONVO?r(s):r(g||!1)}),[o,g,r,s]),ya((()=>{var t;const n=null!=(null==a?void 0:a.USER);if((e&&n&&!i.current&&!(null==(t=u.data)?void 0:t.initial))??!1)if(o===Bm.NEW_CONVO&&p.data&&u.data){const t=wf(e),n=(null==t?void 0:t.default)??(null==t?void 0:t.last);cx.log("conversation","ChatRoute, new convo effect",c),d({modelsData:u.data,template:c||void 0,...n?{preset:Nf(n)}:{}}),i.current=!0}else if(m.data&&p.data&&u.data)cx.log("conversation","ChatRoute initialConvoQuery",m.data),d({template:m.data,preset:m.data,modelsData:u.data,keepLatestMessage:!0}),i.current=!0;else if(o===Bm.NEW_CONVO&&h[Yl.assistants]&&h[Yl.azureAssistants]){const t=wf(e),n=(null==t?void 0:t.default)??(null==t?void 0:t.last);cx.log("conversation","ChatRoute new convo, assistants effect",c),d({modelsData:u.data,template:c||void 0,...n?{preset:Nf(n)}:{}}),i.current=!0}else h[Yl.assistants]&&h[Yl.azureAssistants]&&(cx.log("conversation","ChatRoute convo, assistants effect",m.data),d({template:m.data,preset:m.data,modelsData:u.data,keepLatestMessage:!0}),i.current=!0)}),[a,e,m.data,p.data,u.data,h]),p.isLoading||u.isLoading?l.jsx("div",{className:"flex h-screen items-center justify-center","aria-live":"polite",role:"status",children:l.jsx(Xs,{className:"text-text-primary"})}):t?(null==c?void 0:c.conversationId)===Bm.SEARCH?null:((null==c?void 0:c.conversationId)===o||c)&&o?l.jsx(Uk,{conversationId:c.conversationId??"",children:l.jsx(SU,{index:0})}):null:null}const EU=_a.forwardRef(((e,t)=>l.jsx("div",{className:Qf("relative flex w-full grow overflow-hidden bg-white dark:bg-gray-800",e.className),children:l.jsx("div",{className:"transition-width relative h-full w-full flex-1 overflow-auto bg-white dark:bg-gray-800",children:l.jsx("div",{className:"flex h-full flex-col",role:"presentation",tabIndex:0,children:l.jsx("div",{className:"flex-1 overflow-hidden overflow-y-auto",children:l.jsx("div",{className:"dark:gpt-dark-gray relative h-full",children:l.jsx("div",{ref:t,style:{height:"100%",overflowY:"auto",width:"100%"},children:l.jsxs("div",{className:"flex flex-col pb-9 text-sm dark:bg-transparent",children:[e.children,l.jsx("div",{className:"dark:gpt-dark-gray group h-0 w-full flex-shrink-0 dark:border-gray-800/50"})]})})})})})})})));function IU({message:e}){const t=qN(),n=xs(),a=j(N_.search),{navigateToConvo:s}=CC(),r=e.conversationId??"";return r?l.jsx("div",{className:"visible mt-0 flex items-center justify-center gap-1 self-end text-text-secondary lg:justify-start",children:l.jsxs("button",{type:"button",className:"ml-0 flex cursor-pointer items-center gap-1.5 rounded-md p-1 text-xs hover:text-text-primary hover:underline",onClick:async t=>{if(t.preventDefault(),!r)return;let o=e.title??"",i=n.getQueryData([Fh.conversation,r]);const l=n.getQueryData([Fh.allConversations,{search:a.debouncedQuery}]);!i&&l&&(i=Kx(l,r)),o||(o=(null==i?void 0:i.title)??""),document.title=o,s(i??{conversationId:r,title:o},{resetLatestMessage:!0})},title:t("com_ui_go_to_conversation"),children:[l.jsx(Se,{className:"icon-sm","aria-hidden":"true"}),e.title]})}):null}const RU=({iconData:e})=>l.jsx("div",{className:"relative flex flex-shrink-0 flex-col items-end",children:l.jsx("div",{className:"pt-0.5",children:l.jsx("div",{className:"flex h-6 w-6 items-center justify-center overflow-hidden rounded-full",children:l.jsx(DD,{iconData:e})})})}),AU=({message:e,messageLabel:t,fontSize:n})=>l.jsxs("div",{className:Qf("relative flex w-11/12 flex-col",e.isCreatedByUser?"":"agent-turn"),children:[l.jsx("div",{className:Qf("select-none font-semibold",n),children:t}),l.jsx(UM,{message:e}),l.jsxs(VM,{classes:"text-xs",children:[l.jsx(rM,{message:e}),l.jsx(IU,{message:e})]})]});function PU({message:e}){const t=ht(oT),n=j(N_.UsernameDisplay),{user:a}=nk(),s=qN(),r=Ca((()=>({endpoint:(null==e?void 0:e.endpoint)??"",model:(null==e?void 0:e.model)??"",iconURL:(null==e?void 0:e.iconURL)??"",isCreatedByUser:(null==e?void 0:e.isCreatedByUser)??!1})),[null==e?void 0:e.endpoint,null==e?void 0:e.model,null==e?void 0:e.iconURL,null==e?void 0:e.isCreatedByUser]),o=Ca((()=>(null==e?void 0:e.isCreatedByUser)?n?((null==a?void 0:a.name)??"")||((null==a?void 0:a.username)??""):s("com_user_message"):(null==e?void 0:e.sender)??""),[null==e?void 0:e.isCreatedByUser,null==e?void 0:e.sender,n,null==a?void 0:a.name,null==a?void 0:a.username,s]);return e?l.jsx("div",{className:"text-token-text-primary w-full bg-transparent",children:l.jsx("div",{className:"m-auto p-4 py-2 md:gap-6",children:l.jsxs("div",{className:"final-completion group mx-auto flex flex-1 gap-3 md:max-w-3xl md:px-5 lg:max-w-[40rem] lg:px-1 xl:max-w-[48rem] xl:px-5",children:[l.jsx(RU,{iconData:r}),l.jsx(AU,{message:e,messageLabel:o,fontSize:t})]})})}):null}function OU(){var e;const t=qN(),n=pk(),{showToast:a}=Ds(),{isAuthenticated:s}=nk(),r=j(N_.search),o=r.debouncedQuery,{data:i,isLoading:c,isError:d,fetchNextPage:u,isFetchingNextPage:m,hasNextPage:p}=((e,t)=>{const{sortBy:n,sortDirection:a,pageSize:s,conversationId:r,messageId:o,search:i}=e;return vs({queryKey:[Fh.messages,{sortBy:n,sortDirection:a,pageSize:s,conversationId:r,messageId:o,search:i}],queryFn:({pageParam:e})=>Jh.listMessages({sortBy:n,sortDirection:a,pageSize:s,conversationId:r,messageId:o,search:i,cursor:null==e?void 0:e.toString()}),getNextPageParam:e=>(null==e?void 0:e.nextCursor)??void 0,keepPreviousData:!0,staleTime:3e5,cacheTime:18e5,...t})})({search:o||void 0},{enabled:s&&!!o,staleTime:3e4,cacheTime:3e5}),{containerRef:h}=PC({nextCursor:null==(e=null==i?void 0:i.pages[i.pages.length-1])?void 0:e.nextCursor,setShowLoading:()=>({}),fetchNextPage:u,isFetchingNext:m}),g=Ca((()=>{const e=(null==i?void 0:i.pages.flatMap((e=>e.messages.map((e=>e.files&&n?{...e,files:e.files.map((e=>n[e.file_id??""]??e))}:e)))))||[];return 0===e.length?null:e}),[n,null==i?void 0:i.pages]);ya((()=>{d&&o&&a({message:"An error occurred during search",status:"error"})}),[d,o,a]);return r.isTyping||c||m?l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsx(Xs,{className:"text-text-primary"})}):o?l.jsxs(EU,{ref:h,className:"relative flex h-full pt-4",children:[g&&0===g.length||null==g?l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsx("div",{className:"rounded-lg bg-white p-6 text-lg text-gray-500 dark:border-gray-800/50 dark:bg-gray-800 dark:text-gray-300",children:t("com_ui_nothing_found")})}):l.jsxs(l.Fragment,{children:[g.map((e=>l.jsx(PU,{message:e},e.messageId))),m&&l.jsx("div",{className:"flex justify-center py-4",children:l.jsx(Xs,{className:"text-text-primary"})})]}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-[5%] bg-gradient-to-t from-gray-50 to-transparent dark:from-gray-800"})]}):null}const LU=({open:e,onOpenChange:t,onAccept:n,onDecline:a,title:s,modalContent:r})=>{const o=qN(),{showToast:i}=Ds(),c=(e=>{const t=xs();return fs((()=>Jh.acceptTerms()),{onSuccess:(n,a,s)=>{var r;t.setQueryData([Fh.userTerms],{termsAccepted:!0}),null==(r=null==e?void 0:e.onSuccess)||r.call(e,n,a,s)},onError:null==e?void 0:e.onError,onMutate:null==e?void 0:e.onMutate})})({onSuccess:()=>{n(),t(!1)},onError:()=>{i({message:"Failed to accept terms"})}}),d=Ca((()=>"string"==typeof r?r:Array.isArray(r)?r.join("\n"):""),[r]);return l.jsx(rr,{open:e,onOpenChange:n=>{e&&!n||t(n)},children:l.jsx(lo,{title:s??o("com_ui_terms_and_conditions"),className:"w-11/12 max-w-3xl sm:w-3/4 md:w-1/2 lg:w-2/5",showCloseButton:!1,showCancelButton:!1,main:l.jsx("section",{tabIndex:0,className:"max-h-[60vh] overflow-y-auto p-4","aria-label":o("com_ui_terms_and_conditions"),children:l.jsx("div",{className:"prose dark:prose-invert w-full max-w-none !text-text-primary",children:""!==d?l.jsx(fA,{content:d}):l.jsx("p",{children:o("com_ui_no_terms_content")})})}),buttons:l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:()=>{a(),t(!1)},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-surface-active",children:o("com_ui_decline")}),l.jsx("button",{onClick:()=>{c.mutate()},className:"inline-flex h-10 items-center justify-center rounded-lg border border-border-heavy bg-surface-secondary px-4 py-2 text-sm text-text-primary hover:bg-green-500 hover:text-white focus:bg-green-500 focus:text-white dark:hover:bg-green-600 dark:focus:bg-green-600",children:o("com_ui_accept")})]})})})};function MU(){const e=qN(),[t,n]=X(oT),a=[{value:"text-xs",label:e("com_nav_font_size_xs")},{value:"text-sm",label:e("com_nav_font_size_sm")},{value:"text-base",label:e("com_nav_font_size_base")},{value:"text-lg",label:e("com_nav_font_size_lg")},{value:"text-xl",label:e("com_nav_font_size_xl")}],s="font-size-selector-label";return l.jsxs("div",{className:"flex w-full items-center justify-between",children:[l.jsx("div",{id:s,children:e("com_nav_font_size")}),l.jsx(yo,{value:t,options:a,onChange:e=>{n(e)},testId:"font-size-selector",sizeClasses:"w-[150px]",className:"z-50","aria-labelledby":s})]})}const DU=()=>{const e=qN(),[t,n]=b(N_.forkSetting),[a,s]=b(N_.splitAtTarget),[r,o]=b(N_.rememberDefaultFork),i=[{value:Gm.DIRECT_PATH,label:e("com_ui_fork_visible")},{value:Gm.INCLUDE_BRANCHES,label:e("com_ui_fork_branches")},{value:Gm.TARGET_LEVEL,label:e("com_ui_fork_all_target")}];return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"pb-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{id:"remember-default-fork-label",children:[" ",e("com_ui_fork_default")," "]}),l.jsx(dr,{id:"rememberDefaultFork",checked:r,onCheckedChange:o,className:"ml-4","data-testid":"rememberDefaultFork","aria-labelledby":"remember-default-fork-label"})]})}),r&&l.jsx("div",{className:"pb-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{id:"fork-change-default-label",children:e("com_ui_fork_change_default")}),l.jsx(xr,{side:fr.Bottom,text:e("com_nav_info_fork_change_default")})]}),l.jsx(yo,{value:t,onChange:n,options:i,sizeClasses:"w-[200px]",testId:"fork-setting-dropdown",className:"z-[50]","aria-labelledby":"fork-change-default-label"})]})}),l.jsx("div",{className:"pb-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx("div",{id:"split-at-target-label",children:e("com_ui_fork_split_target_setting")}),l.jsx(xr,{side:fr.Bottom,text:e("com_nav_info_fork_split_target_setting")})]}),l.jsx(dr,{id:"splitAtTarget",checked:a,onCheckedChange:s,className:"ml-4","data-testid":"splitAtTarget","aria-labelledby":"split-at-target-label"})]})})]})},FU=()=>{const[e,t]=b(N_.chatDirection),n=qN();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center space-x-2",children:l.jsx("span",{id:"chat-direction-label",children:n("com_nav_chat_direction")})}),l.jsx(Ys,{variant:"outline","aria-label":n("com_nav_chat_direction_selected",{direction:n("LTR"===e?"chat_direction_left_to_right":"chat_direction_right_to_left")}),onClick:()=>{t((e=>"LTR"===e?"RTL":"LTR"))},"data-testid":"chatDirection",children:e.toLowerCase()})]})},UU=[{stateAtom:N_.enterToSend,localizationKey:"com_nav_enter_to_send",switchId:"enterToSend",hoverCardText:"com_nav_info_enter_to_send",key:"enterToSend"},{stateAtom:N_.maximizeChatSpace,localizationKey:"com_nav_maximize_chat_space",switchId:"maximizeChatSpace",hoverCardText:void 0,key:"maximizeChatSpace"},{stateAtom:N_.centerFormOnLanding,localizationKey:"com_nav_center_chat_input",switchId:"centerFormOnLanding",hoverCardText:void 0,key:"centerFormOnLanding"},{stateAtom:HA,localizationKey:"com_nav_show_thinking",switchId:"showThinking",hoverCardText:void 0,key:"showThinking"},{stateAtom:N_.showCode,localizationKey:"com_nav_show_code",switchId:"showCode",hoverCardText:void 0,key:"showCode"},{stateAtom:N_.LaTeXParsing,localizationKey:"com_nav_latex_parsing",switchId:"latexParsing",hoverCardText:"com_nav_info_latex_parsing",key:"latexParsing"},{stateAtom:N_.saveDrafts,localizationKey:"com_nav_save_drafts",switchId:"saveDrafts",hoverCardText:"com_nav_info_save_draft",key:"saveDrafts"},{stateAtom:N_.showScrollButton,localizationKey:"com_nav_scroll_button",switchId:"showScrollButton",hoverCardText:void 0,key:"showScrollButton"},{stateAtom:N_.saveBadgesState,localizationKey:"com_nav_save_badges_state",switchId:"showBadges",hoverCardText:"com_nav_info_save_badges_state",key:"showBadges"},{stateAtom:N_.modularChat,localizationKey:"com_nav_modular_chat",switchId:"modularChat",hoverCardText:void 0,key:"modularChat"},{stateAtom:N_.defaultTemporaryChat,localizationKey:"com_nav_default_temporary_chat",switchId:"defaultTemporaryChat",hoverCardText:"com_nav_info_default_temporary_chat",key:"defaultTemporaryChat"}];const zU=Sa((function(){return l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(MU,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(FU,{})}),UU.map((e=>l.jsx("div",{className:"pb-3",children:l.jsx(gL,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,hoverCardText:e.hoverCardText,switchId:e.switchId})},e.key))),l.jsx(DU,{})]})}));function VU(){const e=qN(),t=xs(),{showToast:n}=Ds(),a=ba(null),[s,r]=ja(!1),o=ka((()=>{n({message:e("com_ui_import_conversation_success"),status:lx.SUCCESS}),r(!1)}),[e,n]),i=ka((t=>{cx.error("Import error:",t),r(!1);const a=null==t?void 0:t.toString().includes("Unsupported import type");n({message:e(a?"com_ui_import_conversation_file_type_error":"com_ui_import_conversation_error"),status:lx.ERROR})}),[e,n]),c=Eb({onSuccess:o,onError:i,onMutate:()=>r(!0)}),d=ka((async a=>{try{const s=t.getQueryData([Fh.startupConfig]),o=null==s?void 0:s.conversationImportMaxFileSize;if(o&&a.size>o){const t=(o/1048576).toFixed(2);return n({message:e("com_error_files_upload_too_large",{0:t}),status:lx.ERROR}),void r(!1)}const i=new FormData;i.append("file",a,encodeURIComponent(a.name||"File")),c.mutate(i)}catch(s){cx.error("File processing error:",s),r(!1),n({message:e("com_ui_import_conversation_upload_error"),status:lx.ERROR})}}),[c,n,e,t]),u=ka((e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];n&&(r(!0),d(n)),e.target.value=""}),[d]),m=ka((()=>{var e;null==(e=a.current)||e.click()}),[]),p=ka((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),m())}),[m]),h=s;return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(er,{id:"import-conversation-label",children:e("com_ui_import_conversation_info")}),l.jsx(Ys,{variant:"outline",onClick:m,onKeyDown:p,disabled:h,"aria-label":e("com_ui_import"),"aria-labelledby":"import-conversation-label",children:s?l.jsxs(l.Fragment,{children:[l.jsx(Xs,{className:"mr-1 w-4"}),l.jsx("span",{children:e("com_ui_importing")})]}):l.jsxs(l.Fragment,{children:[l.jsx(Gn,{className:"mr-1 flex h-4 w-4 items-center stroke-1","aria-hidden":"true"}),l.jsx("span",{children:e("com_ui_import")})]})}),l.jsx("input",{ref:a,type:"file",className:Qf("hidden"),accept:".json",onChange:u,"aria-hidden":"true"})]})}const $U=({disabled:e=!1,setDialogOpen:t})=>{const n=qN(),[a,s]=ja(!1),r=yN(),o=()=>{t&&t(!1)},i=r.isLoading;return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(er,{id:"revoke-info-label",children:n("com_ui_revoke_info")}),l.jsxs(rr,{open:a,onOpenChange:s,children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{variant:"destructive",onClick:()=>s(!0),disabled:e,"aria-labelledby":"revoke-info-label",children:n("com_ui_revoke")})}),l.jsx(hr,{showCloseButton:!1,title:n("com_ui_revoke_keys"),className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:n("com_ui_revoke_keys_confirm")}),selection:{selectHandler:()=>{r.mutate({},{onSuccess:o})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:i?l.jsx(Xs,{}):n("com_ui_revoke")}})]})]})},BU=({disabled:e=!1})=>{const t=qN(),[n,a]=ja(!1),[s,r]=ja(!0),[o,i]=ja(!1),[c,d]=ja(!1),u=ba(null);di(u,(()=>o&&i(!1)),[]);const m=ka((async()=>{const e=await caches.open("tts-responses"),t=await e.keys();r(0===t.length)}),[]);ya((()=>{m()}),[m]);const p=ka((async()=>{d(!0);const e=await caches.open("tts-responses");await e.keys().then((t=>Promise.all(t.map((t=>e.delete(t)))))),d(!1)}),[]);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(er,{id:"delete-cache-label",children:t("com_nav_delete_cache_storage")}),l.jsxs(rr,{open:n,onOpenChange:a,children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{variant:"destructive",onClick:()=>a(!0),disabled:e||s,"aria-labelledby":"delete-cache-label",children:t("com_ui_delete")})}),l.jsx(hr,{showCloseButton:!1,title:t("com_nav_confirm_clear"),className:"max-w-[450px]",main:l.jsx(er,{className:"text-left text-sm font-medium",children:t("com_nav_clear_cache_confirm_message")}),selection:{selectHandler:p,selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:c?l.jsx(Xs,{}):t("com_ui_delete")}})]})]})},HU=()=>{const e=qN(),[t,n]=ja(!1),{newConversation:a}=_C(),s=_N();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(er,{id:"clear-all-chats-label",children:e("com_nav_clear_all_chats")}),l.jsxs(rr,{open:t,onOpenChange:n,children:[l.jsx(or,{asChild:!0,children:l.jsx(Ys,{"aria-labelledby":"clear-all-chats-label",variant:"destructive",onClick:()=>n(!0),children:e("com_ui_delete")})}),l.jsx(hr,{showCloseButton:!1,title:e("com_nav_confirm_clear"),className:"max-w-[450px]",main:l.jsx(er,{className:"break-words",children:e("com_nav_clear_conversation_confirm_message")}),selection:{selectHandler:()=>{s.mutate({},{onSuccess:()=>{Pf(),a()}})},selectClasses:"bg-destructive text-white transition-all duration-200 hover:bg-destructive/80",selectText:s.isLoading?l.jsx(Xs,{}):e("com_ui_delete")}})]})]})},GU={pageSize:25,isPublic:!0,sortBy:"createdAt",sortDirection:"desc",search:""};function KU(){const e=qN(),{showToast:t}=Ds(),n=vr("(max-width: 768px)"),a=j(N_.search),[s,r]=ja(GU),[o,i]=ja(null),[c,d]=ja(!1),[u,m]=ja(!1),{data:p,fetchNextPage:h,hasNextPage:g,isFetchingNextPage:x,refetch:f,isLoading:v}=gb(s,{enabled:u,staleTime:0,cacheTime:3e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),_=ka((e=>{const t=encodeURIComponent(e.trim());r((e=>({...e,search:t})))}),[]),b=Ca((()=>xi(_,300)),[_]);ya((()=>()=>{b.cancel()}),[b]);const y=Ca((()=>(null==p?void 0:p.pages)?p.pages.flatMap((e=>e.links.filter(Boolean))):[]),[null==p?void 0:p.pages]),w=kb({onSuccess:async()=>{d(!1),i(null),await f()}}),N=ka((async n=>{const a=n.filter((e=>"string"==typeof e.shareId&&e.shareId.length>0));if(0!==a.length)try{for(const e of a)await w.mutateAsync({shareId:e.shareId});t({message:e(1===a.length?"com_ui_shared_link_delete_success":"com_ui_shared_link_bulk_delete_success"),severity:lx.SUCCESS})}catch(s){console.error("Failed to delete shared links:",s),t({message:e("com_ui_bulk_delete_error"),severity:lx.ERROR})}else t({message:e("com_ui_no_valid_items"),severity:lx.WARNING})}),[w,t,e]),k=ka((async()=>{!0!==g||x||await h()}),[h,g,x]),C=ka((()=>{o&&N([o]),d(!1)}),[o,N]),S=Ca((()=>[{accessorKey:"title",header:({column:t})=>{const n=t.getIsSorted();let a=Nt,s="none";return"desc"===n?(a=Ct,s="descending"):"asc"===n&&(a=St,s="ascending"),l.jsxs(Ys,{variant:"ghost",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm","aria-sort":s,"aria-label":e("com_ui_name_sort"),"aria-current":n?"true":"false",children:[e("com_ui_name"),l.jsx(a,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{const{title:t,shareId:n}=e.original;return l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs(Fa,{to:`/share/${n}`,target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-1 truncate rounded-sm text-blue-600 underline decoration-1 underline-offset-2 hover:decoration-2 focus:outline-none focus:ring-2 focus:ring-ring",title:t,children:[l.jsx("span",{className:"truncate",children:t}),l.jsx(we,{className:"size-3 flex-shrink-0 opacity-70 group-hover:opacity-100","aria-hidden":"true"})]})})},meta:{size:"35%",mobileSize:"50%"}},{accessorKey:"createdAt",header:({column:t})=>{const n=t.getIsSorted();let a=Nt,s="none";return"desc"===n?(a=Ct,s="descending"):"asc"===n&&(a=St,s="ascending"),l.jsxs(Ys,{variant:"ghost",onClick:()=>t.toggleSorting("asc"===t.getIsSorted()),className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm","aria-sort":s,"aria-label":e("com_ui_creation_date_sort"),"aria-current":n?"true":"false",children:[e("com_ui_date"),l.jsx(a,{className:"ml-2 h-3 w-4 sm:h-4 sm:w-4"})]})},cell:({row:e})=>{var t;return bx((null==(t=e.original.createdAt)?void 0:t.toString())??"",n)},meta:{size:"10%",mobileSize:"20%"}},{accessorKey:"actions",header:()=>l.jsx(er,{className:"px-2 py-0 text-xs hover:bg-surface-hover sm:px-2 sm:py-2 sm:text-sm",children:e("com_assistants_actions")}),meta:{size:"7%",mobileSize:"25%"},cell:({row:t})=>l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(pr,{description:e("com_ui_open_source_chat_new_tab"),render:l.jsx("a",{href:`/c/${t.original.conversationId}`,target:"_blank",rel:"noopener noreferrer",className:"flex h-8 w-8 items-center justify-center rounded-md p-0 transition-colors hover:bg-surface-hover focus:outline-none focus:ring-2 focus:ring-ring","aria-label":e("com_ui_open_source_chat_new_tab_title",{title:t.original.title||e("com_ui_untitled")}),children:l.jsx(xt,{className:"size-4","aria-hidden":"true"})})}),l.jsx(pr,{description:e("com_ui_delete_shared_link_heading"),render:l.jsx(Ys,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-surface-hover",onClick:()=>{i(t.original),d(!0)},"aria-label":e("com_ui_delete_shared_link",{title:t.original.title||e("com_ui_untitled")}),"aria-haspopup":"dialog","aria-controls":"delete-shared-link-dialog",children:l.jsx(Kt,{className:"size-4","aria-hidden":"true"})})})]})}]),[n,e]);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(er,{id:"shared-links-label",children:e("com_nav_shared_links")}),l.jsxs(rr,{open:u,onOpenChange:m,children:[l.jsx(or,{asChild:!0,onClick:()=>m(!0),children:l.jsx(Ys,{"aria-labelledby":"shared-links-label",variant:"outline",children:e("com_ui_manage")})}),l.jsxs(ir,{title:e("com_nav_shared_links"),className:"w-11/12 max-w-5xl bg-background text-text-primary shadow-2xl",children:[l.jsx(br,{children:l.jsx(lr,{children:e("com_nav_shared_links")})}),l.jsx(Bo,{columns:S,data:y,onDelete:N,filterColumn:"title",hasNextPage:g,isFetchingNextPage:x,fetchNextPage:k,showCheckboxes:!1,onFilterChange:b,filterValue:s.search,isLoading:v,enableSearch:a})]})]}),l.jsx(rr,{open:c,onOpenChange:d,children:l.jsx(hr,{showCloseButton:!1,title:e("com_ui_delete_shared_link_heading"),className:"max-w-[450px]",main:l.jsx(l.Fragment,{children:l.jsx("div",{id:"delete-shared-link-dialog",className:"flex w-full flex-col items-center gap-2",children:l.jsx("div",{className:"grid w-full items-center gap-2",children:l.jsx(er,{htmlFor:"dialog-confirm-delete",className:"text-left text-sm font-medium",children:l.jsx(Ai,{i18nKey:"com_ui_delete_confirm_strong",values:{title:null==o?void 0:o.title},components:{strong:l.jsx("strong",{})}})})})})}),selection:{selectHandler:C,selectClasses:"bg-red-700 dark:bg-red-600 hover:bg-red-800 dark:hover:bg-red-800 text-white "+(w.isLoading?"cursor-not-allowed opacity-80":""),selectText:w.isLoading?l.jsx(Xs,{}):e("com_ui_delete")}})})]})}const WU=_a.memo((function(){const e=ba(null),[t,n]=ja(!1);return di(e,(()=>t&&n(!1)),[]),l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(VU,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(KU,{})}),l.jsx("div",{className:"pb-3",children:l.jsx($U,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(BU,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(HU,{})})]})}));function qU({onCheckedChange:e}){const t=j(N_.textToSpeech);return l.jsx(gL,{stateAtom:N_.cloudBrowserVoices,localizationKey:"com_nav_enable_cloud_browser_voice",switchId:"CloudBrowserVoices",onCheckedChange:e,disabled:!t})}function QU({onCheckedChange:e}){return l.jsx(gL,{stateAtom:N_.automaticPlayback,localizationKey:"com_nav_automatic_playback",switchId:"AutomaticPlayback",onCheckedChange:e})}function YU({onCheckedChange:e}){return l.jsx(gL,{stateAtom:N_.textToSpeech,localizationKey:"com_nav_text_to_speech",switchId:"TextToSpeech",onCheckedChange:e,strongLabel:!0})}const XU=({external:e})=>{const t=qN(),[n,a]=b(N_.engineTTS),s=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}],r="engine-tts-dropdown-label";return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:r,children:t("com_nav_engine")}),l.jsx(yo,{value:n,onChange:e=>{a(e)},options:s,sizeClasses:"w-[180px]",testId:"EngineTTSDropdown",className:"z-50","aria-labelledby":r})]})};function JU({onCheckedChange:e}){const t=j(N_.textToSpeech);return l.jsx(gL,{stateAtom:N_.cacheTTS,localizationKey:"com_nav_enable_cache_tts",switchId:"CacheTTS",onCheckedChange:e,disabled:!t})}const ZU={[tx.browser]:function(){const e=qN(),{voices:t=[]}=Yb(),[n,a]=b(N_.voice),s="browser-voice-dropdown-label";return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:s,children:e("com_nav_voice_select")}),l.jsx(yo,{value:n??"",options:t,onChange:e=>{cx.log("Browser Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return a(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"BrowserVoiceDropdown",className:"z-50","aria-labelledby":s},`browser-voice-dropdown-${t.length}`)]})},[tx.external]:function(){const e=qN(),{voices:t=[]}=Qb(),[n,a]=b(N_.voice),s="external-voice-dropdown-label";return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:s,children:e("com_nav_voice_select")}),l.jsx(yo,{value:n??"",options:t,onChange:e=>{cx.log("External Voice changed:",e);const t="string"==typeof e?e:null==e?void 0:e.value;if(null!=t)return a(t.toString())},sizeClasses:"min-w-[200px] !max-w-[400px] [--anchor-max-width:400px]",testId:"ExternalVoiceDropdown",className:"z-50","aria-labelledby":s},`external-voice-dropdown-${t.length}`)]})}};function ez(){const e=j(N_.engineTTS),t=ZU[e];return t?l.jsx(t,{}):null}function tz(){const e=qN(),t=j(N_.textToSpeech),[n,a]=b(N_.playbackRate);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:"playback-rate-label",children:e("com_nav_playback_rate")}),l.jsx("div",{className:"w-2"}),l.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"1"}),")"]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(Gr,{value:[n??1],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(null),min:.1,max:2,step:.1,className:"ml-4 flex h-4 w-24",disabled:!t,"aria-labelledby":"playback-rate-label"}),l.jsx("div",{className:"w-2"}),l.jsx(Hr,{value:n??1,disabled:!t,onChange:e=>a(e?e[0]:0),min:.1,max:2,"aria-labelledby":"playback-rate-label",className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function nz(){const e=qN(),t=j(N_.speechToText),[n,a]=b(N_.autoSendText),[s,r]=ja(-1!==n),[o,i]=ja(-1===n?3:n);ya((()=>{r(-1!==n),-1!==n&&i(n)}),[n]);const c="auto-send-text-label";return l.jsxs("div",{className:"flex flex-col gap-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center space-x-2",children:l.jsx("div",{id:c,children:e("com_nav_auto_send_text")})}),l.jsx(dr,{id:"autoSendTextToggle",checked:s,onCheckedChange:e=>{r(e),a(e?o:-1)},className:"ml-4","data-testid":"autoSendTextToggle","aria-labelledby":c,disabled:!t})]}),s&&l.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("div",{id:"auto-send-delay-label",className:"text-sm text-text-secondary",children:e("com_nav_setting_delay")})}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(Gr,{value:[o],onValueChange:e=>{const t=e[0];i(t),s&&a(t)},onDoubleClick:()=>{i(3),s&&a(3)},min:0,max:60,step:1,className:"ml-4 flex h-4 w-24",disabled:!t||!s,"aria-labelledby":"auto-send-delay-label"}),l.jsx("div",{className:"w-2"}),l.jsx(Hr,{value:`${o} s`,disabled:!t||!s,onChange:e=>{const t=e?e[0]:3;i(t),s&&a(t)},min:0,max:60,"aria-labelledby":"auto-send-delay-label",className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})]})}function az({onCheckedChange:e}){return l.jsx(gL,{stateAtom:N_.speechToText,localizationKey:"com_nav_speech_to_text",switchId:"SpeechToText",onCheckedChange:e,strongLabel:!0})}const sz=({external:e})=>{const t=qN(),[n,a]=b(N_.engineSTT),s=e?[{value:"browser",label:t("com_nav_browser")},{value:"external",label:t("com_nav_external")}]:[{value:"browser",label:t("com_nav_browser")}],r="engine-stt-dropdown-label";return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:r,children:t("com_nav_engine")}),l.jsx(yo,{value:n,onChange:e=>{a(e)},options:s,sizeClasses:"w-[180px]",testId:"EngineSTTDropdown",className:"z-50","aria-labelledby":r})]})};function rz(){const e=qN(),t=j(N_.speechToText),[n,a]=b(N_.decibelValue);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:"decibel-selector-label",children:e("com_nav_db_sensitivity")}),l.jsx("div",{className:"w-2"}),l.jsxs("small",{className:"opacity-40",children:["(",e("com_endpoint_default_with_num",{0:"-45"}),")"]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(Gr,{value:[n??-45],onValueChange:e=>a(e[0]),onDoubleClick:()=>a(-45),min:-100,max:-30,step:1,className:"ml-4 flex h-4 w-24",disabled:!t,"aria-labelledby":"decibel-selector-label"}),l.jsx("div",{className:"w-2"}),l.jsx(Hr,{value:n,disabled:!t,onChange:e=>a(e?e[0]:0),min:-100,max:-30,"aria-labelledby":"decibel-selector-label",className:Qf(ov,Qf(iv,"reset-rc-number-input reset-rc-number-input-text-right h-auto w-12 border-0 group-hover/temp:border-gray-200"))})]})]})}function oz({onCheckedChange:e}){const t=j(N_.speechToText);return l.jsx(gL,{stateAtom:N_.autoTranscribeAudio,localizationKey:"com_nav_auto_transcribe_audio",switchId:"AutoTranscribeAudio",onCheckedChange:e,disabled:!t})}function iz(){const e=qN(),[t,n]=b(N_.languageSTT),a="language-stt-dropdown-label";return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{id:a,children:e("com_nav_language")}),l.jsx(yo,{value:t,onChange:e=>{n(e)},options:[{value:"af",label:"Afrikaans"},{value:"eu",label:"Basque"},{value:"bg",label:"Bulgarian"},{value:"ca",label:"Catalan"},{value:"ar-EG",label:"Arabic (Egypt)"},{value:"ar-JO",label:"Arabic (Jordan)"},{value:"ar-KW",label:"Arabic (Kuwait)"},{value:"ar-LB",label:"Arabic (Lebanon)"},{value:"ar-QA",label:"Arabic (Qatar)"},{value:"ar-AE",label:"Arabic (UAE)"},{value:"ar-MA",label:"Arabic (Morocco)"},{value:"ar-IQ",label:"Arabic (Iraq)"},{value:"ar-DZ",label:"Arabic (Algeria)"},{value:"ar-BH",label:"Arabic (Bahrain)"},{value:"ar-LY",label:"Arabic (Libya)"},{value:"ar-OM",label:"Arabic (Oman)"},{value:"ar-SA",label:"Arabic (Saudi Arabia)"},{value:"ar-TN",label:"Arabic (Tunisia)"},{value:"ar-YE",label:"Arabic (Yemen)"},{value:"cs",label:"Czech"},{value:"nl-NL",label:"Dutch"},{value:"en-AU",label:"English (Australia)"},{value:"en-CA",label:"English (Canada)"},{value:"en-IN",label:"English (India)"},{value:"en-NZ",label:"English (New Zealand)"},{value:"en-ZA",label:"English (South Africa)"},{value:"en-GB",label:"English (UK)"},{value:"en-US",label:"English (US)"},{value:"et-EE",label:"Estonian"},{value:"fi",label:"Finnish"},{value:"fr-FR",label:"French"},{value:"gl",label:"Galician"},{value:"de-DE",label:"German"},{value:"el-GR",label:"Greek"},{value:"he",label:"Hebrew"},{value:"hu",label:"Hungarian"},{value:"is",label:"Icelandic"},{value:"it-IT",label:"Italian"},{value:"id",label:"Indonesian"},{value:"ja",label:"Japanese"},{value:"ko",label:"Korean"},{value:"la",label:"Latin"},{value:"lv-LV",label:"Latvian"},{value:"lt-LT",label:"Lithuanian"},{value:"zh-CN",label:"Mandarin Chinese"},{value:"zh-TW",label:"Taiwanese"},{value:"zh-HK",label:"Cantonese"},{value:"ms-MY",label:"Malaysian"},{value:"no-NO",label:"Norwegian"},{value:"pl",label:"Polish"},{value:"xx-piglatin",label:"Pig Latin"},{value:"pt-PT",label:"Portuguese"},{value:"pt-br",label:"Portuguese (Brasil)"},{value:"ro-RO",label:"Romanian"},{value:"ru",label:"Russian"},{value:"sr-SP",label:"Serbian"},{value:"sk",label:"Slovak"},{value:"es-AR",label:"Spanish (Argentina)"},{value:"es-BO",label:"Spanish (Bolivia)"},{value:"es-CL",label:"Spanish (Chile)"},{value:"es-CO",label:"Spanish (Colombia)"},{value:"es-CR",label:"Spanish (Costa Rica)"},{value:"es-DO",label:"Spanish (Dominican Republic)"},{value:"es-EC",label:"Spanish (Ecuador)"},{value:"es-SV",label:"Spanish (El Salvador)"},{value:"es-GT",label:"Spanish (Guatemala)"},{value:"es-HN",label:"Spanish (Honduras)"},{value:"es-MX",label:"Spanish (Mexico)"},{value:"es-NI",label:"Spanish (Nicaragua)"},{value:"es-PA",label:"Spanish (Panama)"},{value:"es-PY",label:"Spanish (Paraguay)"},{value:"es-PE",label:"Spanish (Peru)"},{value:"es-PR",label:"Spanish (Puerto Rico)"},{value:"es-ES",label:"Spanish (Spain)"},{value:"es-US",label:"Spanish (US)"},{value:"es-UY",label:"Spanish (Uruguay)"},{value:"es-VE",label:"Spanish (Venezuela)"},{value:"sv-SE",label:"Swedish"},{value:"tr",label:"Turkish"},{value:"zu",label:"Zulu"}],sizeClasses:"[--anchor-max-height:256px]",testId:"LanguageSTTDropdown",className:"z-50","aria-labelledby":a})]})}function lz({onCheckedChange:e}){const t=j(N_.speechToText),n=j(N_.textToSpeech),[,a]=b(N_.autoSendText),[,s]=b(N_.decibelValue),[,r]=b(N_.autoTranscribeAudio);return l.jsx(gL,{stateAtom:N_.conversationMode,localizationKey:"com_nav_conversation_mode",switchId:"ConversationMode",onCheckedChange:t=>{r(t),a(3),s(-45),e&&e(t)},disabled:!n||!t,strongLabel:!0})}const cz=_a.memo((function(){const e=qN(),[t,n]=ja(!1),{data:a}=RN(),s=vr("(max-width: 767px)"),[r,o]=ja(!1),[i,c]=ja(!1),[d,u]=b(N_.advancedMode),[m,p]=b(N_.autoTranscribeAudio),[h,g]=b(N_.conversationMode),[x,f]=b(N_.speechToText),[v,_]=b(N_.textToSpeech),[y,j]=b(N_.cacheTTS),[w,N]=b(N_.engineSTT),[k,C]=b(N_.languageSTT),[S,T]=b(N_.decibelValue),[E,I]=b(N_.autoSendText),[R,A]=b(N_.engineTTS),[P,O]=b(N_.voice),[L,M]=b(N_.cloudBrowserVoices),[D,F]=b(N_.languageTTS),[z,V]=b(N_.automaticPlayback),[$,B]=b(N_.playbackRate),H=ka(((e,t)=>{const n={sttExternal:{value:r,setFunc:o},ttsExternal:{value:i,setFunc:c},conversationMode:{value:h,setFunc:g},advancedMode:{value:d,setFunc:u},speechToText:{value:x,setFunc:f},textToSpeech:{value:v,setFunc:_},cacheTTS:{value:y,setFunc:j},engineSTT:{value:w,setFunc:N},languageSTT:{value:k,setFunc:C},autoTranscribeAudio:{value:m,setFunc:p},decibelValue:{value:S,setFunc:T},autoSendText:{value:E,setFunc:I},engineTTS:{value:R,setFunc:A},voice:{value:P,setFunc:O},cloudBrowserVoices:{value:L,setFunc:M},languageTTS:{value:D,setFunc:F},automaticPlayback:{value:z,setFunc:V},playbackRate:{value:$,setFunc:B}}[e];n&&n.setFunc(t)}),[r,i,h,d,x,v,y,w,k,m,S,E,R,P,L,D,z,$,o,c,g,u,f,_,j,N,C,p,T,I,A,O,M,F,V,B]);ya((()=>{a&&"not_found"!==a.message&&Object.entries(a).forEach((([e,t])=>{null===localStorage.getItem(e)&&"sttExternal"!==e&&"ttsExternal"!==e?H(e,t):"sttExternal"!==e&&"ttsExternal"!==e||H(e,t)}))}),[a]),ya((()=>{["browser","external"].includes(R)||A("browser")}),[R,A]);const G=ba(null);return di(G,(()=>t&&n(!1)),[]),l.jsxs(ts,{defaultValue:"simple",orientation:"horizontal",value:d?"advanced":"simple",children:[l.jsx("div",{className:"sticky -top-1 z-50 mb-4 bg-white dark:bg-gray-700",children:l.jsxs(ss,{className:"flex justify-center bg-background",children:[l.jsxs(rs,{onClick:()=>u(!1),className:Qf("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",s?"flex-row rounded-lg":"rounded-xl","w-full"),value:"simple",style:{userSelect:"none"},children:[l.jsx(U,{"aria-hidden":"true"}),e("com_ui_simple")]}),l.jsxs(rs,{onClick:()=>u(!0),className:Qf("group m-1 flex items-center justify-center gap-2 bg-transparent px-4 py-2 text-sm text-text-secondary transition-all duration-200 ease-in-out radix-state-active:bg-secondary radix-state-active:text-foreground radix-state-active:shadow-lg",s?"flex-row rounded-lg":"rounded-xl","w-full"),value:"advanced",style:{userSelect:"none"},children:[l.jsx(Kn,{"aria-hidden":"true"}),e("com_ui_advanced")]})]})}),l.jsx(es,{value:"simple",tabIndex:-1,children:l.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[l.jsx(az,{}),l.jsx(sz,{external:r}),l.jsx(iz,{}),l.jsx("div",{className:"h-px bg-border-medium",role:"none"}),l.jsx(YU,{}),l.jsx(XU,{external:i}),l.jsx(ez,{})]})}),l.jsx(es,{value:"advanced",tabIndex:-1,children:l.jsxs("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:[l.jsx(lz,{}),l.jsx("div",{className:"mt-2 h-px bg-border-medium",role:"none"}),l.jsx(az,{}),l.jsx(sz,{external:r}),l.jsx(iz,{}),l.jsx("div",{className:"pb-2",children:l.jsx(oz,{})}),m&&l.jsx("div",{className:"pb-2",children:l.jsx(rz,{})}),l.jsx("div",{className:"pb-2",children:l.jsx(nz,{})}),l.jsx("div",{className:"h-px bg-border-medium",role:"none"}),l.jsx("div",{className:"pb-3",children:l.jsx(YU,{})}),l.jsx(QU,{}),l.jsx(XU,{external:i}),l.jsx(ez,{}),"browser"===R&&l.jsx("div",{className:"pb-2",children:l.jsx(qU,{})}),l.jsx("div",{className:"pb-2",children:l.jsx(tz,{})}),l.jsx(JU,{})]})})]})})),dz=({tokenCredits:e})=>{const t=qN();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(er,{className:"font-light",children:t("com_nav_balance")}),l.jsx(xr,{side:fr.Bottom,text:t("com_nav_info_balance")})]}),l.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:void 0!==e?e.toFixed(2):"0.00"})]})},uz=(e,t,n)=>{const a=new Date(e);switch(n){case"seconds":a.setSeconds(a.getSeconds()+t);break;case"minutes":a.setMinutes(a.getMinutes()+t);break;case"hours":a.setHours(a.getHours()+t);break;case"days":a.setDate(a.getDate()+t);break;case"weeks":a.setDate(a.getDate()+7*t);break;case"months":a.setMonth(a.getMonth()+t)}return a};const mz=({lastRefill:e,refillAmount:t,refillIntervalUnit:n,refillIntervalValue:a})=>{const s=qN(),r=e?new Date(e):null,o=r?function(e,t,n){const a=new Date;if(e>a)return uz(e,t,n);if("months"===n){let s=new Date(e);for(;s<=a;)s=uz(s,t,n);return s}const s={seconds:1e3*t,minutes:1e3*t*60,hours:1e3*t*60*60,days:1e3*t*60*60*24,weeks:1e3*t*60*60*24*7}[n];if(s<=0)return uz(e,t,n);const r=a.getTime()-e.getTime(),o=Math.floor(r/s)+1,i=e.getTime()+o*s;return new Date(i)}(r,a,n):null;return l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-medium",children:s("com_nav_balance_auto_refill_settings")}),l.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[l.jsx("span",{children:s("com_nav_balance_last_refill")}),l.jsx("span",{children:r?r.toLocaleString():"-"})]}),l.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[l.jsx("span",{children:s("com_nav_balance_refill_amount")}),l.jsx("span",{children:void 0!==t?t:"-"})]}),l.jsxs("div",{className:"mb-1 flex justify-between text-sm",children:[l.jsx("span",{children:s("com_nav_balance_interval")}),l.jsxs("span",{children:[s("com_nav_balance_every")," ",a," ",((e,t)=>{let n;switch(t){case"seconds":n=1===e?"com_nav_balance_second":"com_nav_balance_seconds";break;case"minutes":n=1===e?"com_nav_balance_minute":"com_nav_balance_minutes";break;case"hours":n=1===e?"com_nav_balance_hour":"com_nav_balance_hours";break;case"days":n=1===e?"com_nav_balance_day":"com_nav_balance_days";break;case"weeks":n=1===e?"com_nav_balance_week":"com_nav_balance_weeks";break;case"months":n=1===e?"com_nav_balance_month":"com_nav_balance_months";break;default:n="com_nav_balance_seconds"}return s(n)})(a,n)]})]}),l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(er,{className:"font-light",children:s("com_nav_balance_next_refill")}),l.jsx(xr,{side:fr.Bottom,text:s("com_nav_balance_next_refill_info")})]}),l.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",role:"note",children:o?o.toLocaleString():"-"})]})]})};const pz=_a.memo((function(){var e;const t=qN(),{isAuthenticated:n}=nk(),{data:a}=K_(),s=sb({enabled:!!n&&!!(null==(e=null==a?void 0:a.balance)?void 0:e.enabled)}).data,{tokenCredits:r=0,autoRefillEnabled:o=!1,lastRefill:i,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}=s??{},m=void 0!==i&&void 0!==c&&void 0!==d&&void 0!==u;return l.jsxs("div",{className:"flex flex-col gap-4 p-4 text-sm text-text-primary",children:[l.jsx(dz,{tokenCredits:r}),o?m?l.jsx(mz,{lastRefill:i,refillAmount:c,refillIntervalUnit:d,refillIntervalValue:u}):l.jsx("div",{className:"text-sm text-red-600",children:t("com_nav_balance_auto_refill_error")}):l.jsx("div",{className:"text-sm text-gray-600",children:t("com_nav_balance_auto_refill_disabled")})]})}));function hz(){const e=qN(),[t,n]=b(N_.UsernameDisplay);return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(er,{id:"user-name-display-label",children:e("com_nav_user_name_display")}),l.jsx(xr,{side:fr.Bottom,text:e("com_nav_info_user_name_display")})]}),l.jsx(dr,{id:"UsernameDisplay",checked:t,onCheckedChange:e=>{n(e)},className:"ml-4","data-testid":"UsernameDisplay","aria-labelledby":"user-name-display-label"})]})}const gz=({disabled:e=!1})=>{const t=qN(),{user:n,logout:a}=nk(),{mutate:s,isLoading:r}=(e=>{const t=xs(),n=T_(),a=S(N_.defaultPreset);return fs([$h.deleteUser],{mutationFn:()=>Jh.deleteUser(),...e||{},onSuccess:(...s)=>{var r;a(),n(),Pf(),t.removeQueries(),null==(r=null==e?void 0:e.onSuccess)||r.call(e,...s)}})})({onMutate:()=>a()}),[o,i]=ja(!1),[c,d]=ja(!0),u=ka((e=>{const t=e.trim().toLowerCase()===(null==n?void 0:n.email.trim().toLowerCase());d(!t)}),[null==n?void 0:n.email]);return l.jsx(l.Fragment,{children:l.jsxs(rr,{open:o,onOpenChange:i,children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(er,{id:"delete-account-label",children:t("com_nav_delete_account")}),l.jsx(or,{asChild:!0,children:l.jsx(Ys,{"aria-labelledby":"delete-account-label",variant:"destructive",onClick:()=>i(!0),disabled:e,children:t("com_ui_delete")})})]}),l.jsxs(ir,{className:"w-11/12 max-w-md",children:[l.jsx(br,{children:l.jsx(lr,{className:"text-lg font-medium leading-6",children:t("com_nav_delete_account_confirm")})}),l.jsx("div",{className:"mb-8 text-sm text-black dark:text-white",children:l.jsxs("ul",{className:"font-semibold text-amber-600",children:[l.jsx("li",{children:t("com_nav_delete_warning")}),l.jsx("li",{children:t("com_nav_delete_data_info")})]})}),l.jsxs("div",{className:"flex-col items-center justify-center",children:[l.jsx("div",{className:"mb-4",children:xz(t("com_nav_delete_account_email_placeholder"),"email-confirm-input",(null==n?void 0:n.email)??"",(e=>u(e.target.value)))}),fz((()=>{c||s(void 0)}),r,c,t)]})]})]})})},xz=(e,t,n,a)=>l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"mb-1 block text-sm font-medium text-black dark:text-white",htmlFor:t,children:e}),l.jsx(kr,{id:t,onChange:a,placeholder:n})]}),fz=(e,t,n,a)=>l.jsx("button",{className:Qf("mt-4 flex w-full items-center justify-center rounded-lg bg-surface-tertiary px-4 py-2 transition-all duration-200",n?"cursor-not-allowed opacity-30":"bg-destructive text-destructive-foreground"),onClick:e,disabled:t||n,children:t?l.jsx("div",{className:"flex h-6 justify-center",children:l.jsx(Xs,{className:"icon-sm m-auto"})}):l.jsx(l.Fragment,{children:n?l.jsxs(l.Fragment,{children:[l.jsx(Wn,{className:"size-5","aria-hidden":"true"}),l.jsx("span",{className:"ml-2",children:a("com_ui_locked")})]}):l.jsxs(l.Fragment,{children:[l.jsx(Kt,{className:"size-5","aria-hidden":"true"}),l.jsx("span",{className:"ml-2",children:a("com_nav_delete_account_button")})]})})});function vz(){const e=y(N_.user),[t,n]=ja(1),[a,s]=ja(0),[r,o]=ja({x:.5,y:.5}),[i,c]=ja(!1),d=ba(null),u=ba(null),[m,p]=ja(null),[h,g]=ja(!1),{data:x=xd}=Y_({select:e=>wd(e)}),f=qN(),{showToast:v}=Ds(),{mutate:_,isLoading:b}=Ib({onSuccess:t=>{v({message:f("com_ui_upload_success")}),e((e=>({...e,avatar:t.url})))},onError:e=>{console.error("Error:",e),v({message:f("com_ui_upload_error"),status:"error"})}}),j=ka((e=>{if(null!=x.avatarSizeLimit&&e&&e.size<=x.avatarSizeLimit)p(e),n(1),s(0),o({x:.5,y:.5});else{const e=null!=x.avatarSizeLimit?jx(x.avatarSizeLimit):2;v({message:f("com_ui_upload_invalid_var",{0:e+""}),status:"error"})}}),[x.avatarSizeLimit,f,v]),w=ka((e=>{e.preventDefault();const t=e.dataTransfer.files[0];j(t)}),[j]),N=ka((e=>{e.preventDefault()}),[]),k=ka((()=>{var e;null==(e=u.current)||e.click()}),[]),C=ka((()=>{p(null),n(1),s(0),o({x:.5,y:.5})}),[]);return l.jsxs(rr,{open:h,onOpenChange:e=>{g(e),e||C()},children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{children:f("com_nav_profile_picture")}),l.jsx(or,{asChild:!0,children:l.jsxs(Ys,{variant:"outline",children:[l.jsx(wn,{className:"mr-2 flex w-[22px] items-center","aria-hidden":"true"}),l.jsx("span",{children:f("com_nav_change_picture")})]})})]}),l.jsxs(ir,{showCloseButton:!1,className:"w-11/12 max-w-md",children:[l.jsx(br,{children:l.jsx(lr,{className:"text-lg font-medium leading-6 text-text-primary",children:f(null!=m?"com_ui_preview":"com_ui_upload_image")})}),l.jsx("div",{className:"flex flex-col items-center justify-center p-2",children:null!=m?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:Qf("relative overflow-hidden rounded-full ring-4 ring-gray-200 transition-all dark:ring-gray-700",i&&"cursor-move ring-blue-500 dark:ring-blue-400"),onMouseDown:()=>c(!0),onMouseUp:()=>c(!1),onMouseLeave:()=>c(!1),children:[l.jsx(qn,{ref:d,image:m,width:280,height:280,border:0,borderRadius:140,color:[255,255,255,.6],scale:t,rotate:a,position:r,onPositionChange:e=>{o(e)},className:"cursor-move"}),!i&&l.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center opacity-0 transition-opacity hover:opacity-100",children:l.jsx("div",{className:"rounded-full bg-black/50 p-2",children:l.jsx(Qn,{className:"h-6 w-6 text-white","aria-hidden":"true"})})})]}),l.jsxs("div",{className:"mt-6 w-full space-y-6",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(er,{htmlFor:"zoom-slider",className:"text-sm font-medium",children:f("com_ui_zoom")}),l.jsxs("span",{className:"text-sm text-text-secondary",children:[Math.round(100*t),"%"]})]}),l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx(Ys,{type:"button",variant:"outline",size:"sm",onClick:()=>{n((e=>Math.max(e-.2,1)))},disabled:t<=1,"aria-label":f("com_ui_zoom_out"),className:"shrink-0",children:l.jsx(Yn,{className:"h-4 w-4","aria-hidden":"true"})}),l.jsx(Gr,{id:"zoom-slider",value:[t],min:1,max:5,step:.1,onValueChange:e=>{n(e[0])},className:"flex-1","aria-label":f("com_ui_zoom_level")}),l.jsx(Ys,{type:"button",variant:"outline",size:"sm",onClick:()=>{n((e=>Math.min(e+.2,5)))},disabled:t>=5,"aria-label":f("com_ui_zoom_in"),className:"shrink-0",children:l.jsx(Xn,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),l.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[l.jsxs(Ys,{type:"button",variant:"outline",onClick:()=>{s((e=>(e+90)%360))},className:"flex items-center space-x-2","aria-label":f("com_ui_rotate_90"),children:[l.jsx(xn,{className:"h-4 w-4","aria-hidden":"true"}),l.jsx("span",{className:"text-sm",children:f("com_ui_rotate")})]}),l.jsxs(Ys,{type:"button",variant:"outline",onClick:()=>{n(1),s(0),o({x:.5,y:.5})},className:"flex items-center space-x-2","aria-label":f("com_ui_reset_adjustments"),children:[l.jsx(re,{className:"h-4 w-4","aria-hidden":"true"}),l.jsx("span",{className:"text-sm",children:f("com_ui_reset")})]})]}),l.jsx("p",{className:"text-center text-xs text-gray-500 dark:text-gray-400",children:f("com_ui_editor_instructions")})]}),l.jsxs("div",{className:"mt-6 flex w-full space-x-3",children:[l.jsx(Ys,{type:"button",variant:"outline",className:"flex-1",onClick:C,disabled:b,children:f("com_ui_cancel")}),l.jsxs(Ys,{variant:"submit",type:"button",className:Qf("w-full",b?"cursor-not-allowed opacity-90":""),onClick:()=>{if(d.current){d.current.getImageScaledToCanvas().toBlob((e=>{if(e){const t=new FormData;t.append("file",e,"avatar.png"),t.append("manual","true"),_(t)}}),"image/png")}},disabled:b,children:[b?l.jsx(Xs,{className:"icon-sm mr-2"}):l.jsx(Bn,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),f("com_ui_upload")]})]})]}):l.jsxs("div",{className:"flex h-72 w-full flex-col items-center justify-center rounded-lg border-2 border-dashed border-gray-300 bg-transparent transition-colors hover:border-gray-400 dark:border-gray-600 dark:hover:border-gray-500",onDrop:w,onDragOver:N,role:"button",tabIndex:0,onClick:k,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),k())},"aria-label":f("com_ui_upload_avatar_label"),children:[l.jsx(wn,{className:"mb-4 size-16 text-gray-400"}),l.jsx("p",{className:"mb-2 text-center text-sm font-medium text-text-primary",children:f("com_ui_drag_drop")}),l.jsx("p",{className:"mb-4 text-center text-xs text-text-secondary",children:f("com_ui_max_file_size",{0:null!=x.avatarSizeLimit?jx(x.avatarSizeLimit):"2MB"})}),l.jsx(Ys,{type:"button",variant:"secondary",onClick:e=>{e.stopPropagation(),k()},children:f("com_ui_select_file")}),l.jsx("input",{ref:u,type:"file",className:"hidden",accept:".png, .jpg, .jpeg",onChange:e=>{var t;const n=null==(t=e.target.files)?void 0:t[0];j(n)},"aria-label":f("com_ui_file_input_avatar_label")})]})})]})]})}const _z={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},bz=({backupCodes:e,onDownload:t,downloaded:n,onNext:a})=>{const s=qN();return l.jsxs(fl.div,{..._z,className:"space-y-6",children:[l.jsx(er,{className:"break-keep text-sm",children:s("com_ui_download_backup_tooltip")}),l.jsx("div",{className:"grid grid-cols-2 gap-4 rounded-xl bg-surface-secondary p-6",children:e.map(((e,t)=>l.jsx(fl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"rounded-lg bg-surface-tertiary p-3",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("span",{className:"hidden text-sm text-text-secondary sm:inline",children:["#",t+1]}),l.jsx("span",{className:"font-mono text-lg",children:e})]})},e)))}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs(Ys,{variant:"outline",onClick:t,className:"flex-1 gap-2",children:[l.jsx(Qt,{className:"h-4 w-4","aria-hidden":"true"}),l.jsx("span",{className:"hidden sm:inline",children:s("com_ui_download_backup")})]}),l.jsx(Ys,{onClick:a,disabled:!n,className:"flex-1",children:s("com_ui_complete_setup")})]})]})},yz={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},jz=({secret:e,otpauthUrl:t,onNext:n})=>{const a=qN(),[s,r]=ja(!1);return l.jsxs(fl.div,{...yz,className:"space-y-6",children:[l.jsxs("div",{className:"flex flex-col items-center space-y-6",children:[l.jsx(fl.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"rounded-2xl bg-white p-4 shadow-lg",children:l.jsx(Vi,{value:t,size:240})}),l.jsxs("div",{className:"w-full space-y-3",children:[l.jsx(er,{className:"text-sm font-medium text-text-secondary",children:a("com_ui_secret_key")}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(kr,{value:e,readOnly:!0,className:"font-mono text-lg tracking-wider"}),l.jsx(Ys,{size:"sm",variant:"outline",onClick:async()=>{await navigator.clipboard.writeText(e),r(!0),setTimeout((()=>r(!1)),2e3)},className:Qf("h-auto shrink-0",s?"cursor-default":""),children:s?l.jsx(Yt,{className:"size-4","aria-hidden":"true"}):l.jsx(ue,{className:"size-4","aria-hidden":"true"})})]})]})]}),l.jsx(Ys,{onClick:n,className:"w-full",children:a("com_ui_continue")})]})},wz={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},Nz=({token:e,onTokenChange:t,isVerifying:n,onNext:a})=>{const s=qN();return l.jsxs(fl.div,{...wz,className:"space-y-8",children:[l.jsx("div",{className:"flex justify-center",children:l.jsxs(tr,{value:e,onChange:t,maxLength:6,pattern:te,className:"gap-2",children:[l.jsx(nr,{children:Array.from({length:3}).map(((e,t)=>l.jsx(ar,{index:t},t)))}),l.jsx(sr,{}),l.jsx(nr,{children:Array.from({length:3}).map(((e,t)=>l.jsx(ar,{index:t+3},t+3)))})]})}),l.jsx(Ys,{onClick:a,disabled:n||6!==e.length,className:"w-full",children:s("com_ui_verify")})]})},kz={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},Cz=({isGenerating:e,onGenerate:t})=>{const n=qN();return l.jsx(fl.div,{...kz,className:"space-y-6",children:l.jsxs("div",{className:"rounded-xl bg-surface-secondary p-6",children:[l.jsx("h3",{className:"mb-4 flex justify-center text-lg font-medium",children:n("com_ui_2fa_account_security")}),l.jsxs(Ys,{variant:"default",onClick:t,className:"flex w-full",disabled:e,children:[e?l.jsx(Xs,{className:"size-5"}):l.jsx(fn,{className:"size-5","aria-hidden":"true"}),n(e?"com_ui_generating":"com_ui_generate_qrcode")]})]})})},Sz={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2}},Tz=({onDisable:e,isDisabling:t})=>{const n=qN(),[a,s]=ja(""),[r,o]=ja(!1);return l.jsxs(fl.div,{...Sz,className:"space-y-8",children:[l.jsx("div",{className:"flex justify-center",children:l.jsx(tr,{value:a,onChange:s,maxLength:r?8:6,pattern:r?ne:te,className:"gap-2",children:r?l.jsxs(nr,{children:[l.jsx(ar,{index:0}),l.jsx(ar,{index:1}),l.jsx(ar,{index:2}),l.jsx(ar,{index:3}),l.jsx(ar,{index:4}),l.jsx(ar,{index:5}),l.jsx(ar,{index:6}),l.jsx(ar,{index:7})]}):l.jsxs(l.Fragment,{children:[l.jsxs(nr,{children:[l.jsx(ar,{index:0}),l.jsx(ar,{index:1}),l.jsx(ar,{index:2})]}),l.jsx(sr,{}),l.jsxs(nr,{children:[l.jsx(ar,{index:3}),l.jsx(ar,{index:4}),l.jsx(ar,{index:5})]})]})})}),l.jsxs(Ys,{variant:"destructive",onClick:()=>e(a,r),disabled:t||a.length!==(r?8:6),className:"w-full rounded-xl px-6 py-3 transition-all disabled:opacity-50",children:[t&&l.jsx(Xs,{className:"mr-2"}),n(t?"com_ui_disabling":"com_ui_2fa_disable")]}),l.jsx("button",{onClick:()=>o(!r),className:"text-sm text-primary hover:underline",children:n(r?"com_ui_use_2fa_code":"com_ui_use_backup_code")})]})},Ez=({enabled:e,onChange:t,disabled:n,buttonRef:a})=>{const s=qN();return l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center space-x-2",children:l.jsxs(er,{children:[" ",s("com_nav_2fa")]})}),l.jsx("div",{className:"flex items-center gap-3",children:l.jsx(Ys,{ref:a,variant:e?"destructive":"outline",onClick:t,disabled:n,"aria-haspopup":"dialog","aria-controls":"two-factor-authentication-dialog",children:s(e?"com_ui_2fa_disable":"com_ui_2fa_enable")})})]})},Iz={initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1,transition:{duration:.3,ease:"easeOut"}},exit:{opacity:0,scale:.95,transition:{duration:.3,ease:"easeIn"}}},Rz=_a.memo((()=>{const e=qN(),{user:t}=nk(),n=y(N_.user),{showToast:a}=Ds(),s=ba(null),[r,o]=ja(""),[i,c]=ja(""),[d,u]=ja(!1),[m,p]=ja([]),[h,g]=ja(""),[x,f]=ja(!1),[v,_]=ja(""),[b,j]=ja((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),{mutate:w}=(()=>{const e=xs();return fs((e=>Jh.confirmTwoFactor(e)),{onSuccess:t=>{e.setQueryData([Fh.user,"2fa"],t)}})})(),{mutate:N,isLoading:k}=(()=>{const e=xs();return fs((()=>Jh.enableTwoFactor()),{onSuccess:t=>{e.setQueryData([Fh.user,"2fa"],t)}})})(),{mutate:C,isLoading:S}=(()=>{const e=xs();return fs((e=>Jh.verifyTwoFactor(e)),{onSuccess:t=>{e.setQueryData([Fh.user,"2fa"],t)}})})(),{mutate:T,isLoading:E}=(()=>{const e=xs();return fs((e=>Jh.disableTwoFactor(e)),{onSuccess:()=>{e.setQueryData([Fh.user,"2fa"],null)}})})(),I=["Setup","Scan QR","Verify","Backup"],R={setup:"Setup",qr:"Scan QR",verify:"Verify",backup:"Backup",disable:""},A=I.indexOf(R[b]),P=ka((()=>{(null==t?void 0:t.twoFactorEnabled)&&i&&T(void 0,{onError:()=>a({message:e("com_ui_2fa_disable_error"),status:"error"})}),c(""),o(""),p([]),_(""),g(""),j((null==t?void 0:t.twoFactorEnabled)?"disable":"setup"),u(!1)}),[t,i,T,e,a]),O=ka((()=>{N(void 0,{onSuccess:({otpauthUrl:e,backupCodes:t})=>{c(e),o(e.split("secret=")[1].split("&")[0]),p(t),j("qr")},onError:()=>a({message:e("com_ui_2fa_generate_error"),status:"error"})})}),[N,e,a]),L=ka((()=>{v&&C({token:v},{onSuccess:()=>{a({message:e("com_ui_2fa_verified")}),w({token:v},{onSuccess:()=>j("backup"),onError:()=>a({message:e("com_ui_2fa_invalid"),status:"error"})})},onError:()=>a({message:e("com_ui_2fa_invalid"),status:"error"})})}),[v,C,w,e,a]),M=ka((()=>{if(!m.length)return;const e=new Blob([m.join("\n")],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="backup-codes.txt",n.click(),URL.revokeObjectURL(t),u(!0)}),[m]),D=ka((()=>{f(!1),j("disable"),a({message:e("com_ui_2fa_enabled")}),n((e=>({...e,backupCodes:m.map((e=>({code:e,codeHash:e,used:!1,usedAt:null}))),twoFactorEnabled:!0})))}),[n,e,a,m]),F=ka(((t,s)=>{if(!s&&t.trim().length<6)return;if(s&&t.trim().length<8)return;const r={};s?r.backupCode=t.trim():r.token=t.trim(),T(r,{onSuccess:()=>{a({message:e("com_ui_2fa_disabled")}),f(!1),n((e=>({...e,totpSecret:"",backupCodes:[],twoFactorEnabled:!1}))),j("setup"),c("")},onError:()=>a({message:e("com_ui_2fa_invalid"),status:"error"})})}),[T,a,e,n]);return l.jsxs(rr,{open:x,onOpenChange:e=>{f(e),e||P()},triggerRef:s,children:[l.jsx(Ez,{enabled:!!(null==t?void 0:t.twoFactorEnabled),onChange:()=>f(!0),disabled:S||E||k,buttonRef:s}),l.jsx(ir,{className:"w-11/12 max-w-lg p-6",children:l.jsx(xl,{mode:"wait",children:l.jsxs(fl.div,{id:"two-factor-authentication-dialog",variants:Iz,initial:"initial",animate:"animate",exit:"exit",className:"space-y-6",children:[l.jsxs(br,{children:[l.jsxs(lr,{className:"mb-2 flex items-center gap-3 text-2xl font-bold",children:[l.jsx(Jn,{className:"h-6 w-6 text-primary","aria-hidden":"true"}),(null==t?void 0:t.twoFactorEnabled)?e("com_ui_2fa_disable"):e("com_ui_2fa_setup")]}),(null==t?void 0:t.twoFactorEnabled)&&"disable"!==b&&l.jsxs("div",{className:"mt-4 space-y-3",children:[l.jsx(ui,{value:I.indexOf(R[b])/(I.length-1)*100,className:"h-2 rounded-full"}),l.jsx("div",{className:"flex justify-between text-sm",children:I.map(((e,t)=>l.jsx(fl.span,{animate:{color:A>=t?"var(--text-primary)":"var(--text-tertiary)"},className:"font-medium",children:e},e)))})]})]}),l.jsxs(xl,{mode:"wait",children:["setup"===b&&l.jsx(Cz,{isGenerating:k,onGenerate:O,onNext:()=>j("qr"),onError:e=>a({message:e.message,status:"error"})}),"qr"===b&&l.jsx(jz,{secret:r,otpauthUrl:i,onNext:()=>j("verify"),onError:e=>a({message:e.message,status:"error"})}),"verify"===b&&l.jsx(Nz,{token:v,onTokenChange:_,isVerifying:S,onNext:L,onError:e=>a({message:e.message,status:"error"})}),"backup"===b&&l.jsx(bz,{backupCodes:m,onDownload:M,downloaded:d,onNext:D,onError:e=>a({message:e.message,status:"error"})}),"disable"===b&&l.jsx(Tz,{onDisable:F,isDisabling:E,onError:e=>a({message:e.message,status:"error"})})]})]},b)})})]})})),Az=_a.memo((()=>{const e=qN(),{user:t}=nk(),{showToast:n}=Ds(),a=y(N_.user),[s,r]=ja(!1),{mutate:o,isLoading:i}=(()=>{const e=xs();return fs((()=>Jh.regenerateBackupCodes()),{onSuccess:t=>{e.setQueryData([Fh.user,"2fa","backup"],t)}})})(),c=()=>{((t=!1)=>{o(void 0,{onSuccess:s=>{const r=s.backupCodesHash.map((e=>({codeHash:e,used:!1,usedAt:null})));if(a((e=>({...e,backupCodes:r}))),n({message:e("com_ui_backup_codes_regenerated"),status:"success"}),!t&&r.length){const e=s.backupCodes.join("\n"),t=new Blob([e],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="backup-codes.txt",a.click(),URL.revokeObjectURL(n)}},onError:()=>n({message:e("com_ui_backup_codes_regenerate_error"),status:"error"})})})(!1)};return l.jsxs(rr,{open:s,onOpenChange:r,children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("div",{className:"flex items-center space-x-3",children:l.jsx(er,{className:"font-light",children:e("com_ui_backup_codes")})}),l.jsx(or,{asChild:!0,children:l.jsx(Ys,{"aria-label":"Manage Backup Codes",variant:"outline",children:e("com_ui_manage")})})]}),l.jsxs(ir,{className:"w-11/12 max-w-lg",children:[l.jsx(lr,{className:"mb-6 text-2xl font-semibold",children:e("com_ui_backup_codes")}),l.jsx(xl,{children:l.jsx(fl.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mt-4",children:Array.isArray(null==t?void 0:t.backupCodes)&&(null==t?void 0:t.backupCodes.length)>0?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"border-warning-300 bg-warning-50 dark:border-warning-700 dark:bg-warning-900/20 mb-6 rounded-lg border p-4",children:l.jsx("p",{className:"text-sm text-text-secondary",children:e("com_ui_backup_codes_security_info")})}),l.jsx("h3",{className:"mb-4 text-lg font-medium",children:e("com_ui_backup_codes_status")}),l.jsx("div",{className:"grid grid-cols-2 gap-4",children:null==t?void 0:t.backupCodes.map(((t,n)=>{const a=t.used,s=`Backup code number ${n+1}, ${a?`used on ${t.usedAt?new Date(t.usedAt).toLocaleDateString():"an unknown date"}`:"not used yet"}`;return l.jsx(fl.div,{role:"listitem",tabIndex:0,"aria-label":s,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*n},onFocus:()=>{const e=new CustomEvent("announce",{detail:{message:s}});document.dispatchEvent(e)},className:`flex flex-col rounded-xl border p-4 backdrop-blur-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary ${a?"border-red-200 bg-red-50/80 dark:border-red-800 dark:bg-red-900/20":"border-green-200 bg-green-50/80 dark:border-green-800 dark:bg-green-900/20"} `,children:l.jsxs("div",{className:"flex items-center justify-between","aria-hidden":"true",children:[l.jsx("span",{className:"text-sm font-medium text-text-secondary",children:e("com_ui_backup_code_number",{number:n+1})}),l.jsx(pr,{description:t.usedAt?new Date(t.usedAt).toLocaleDateString():"",disabled:!a,focusable:!1,className:a?"cursor-pointer":"cursor-default",render:l.jsx("span",{className:"rounded-full px-3 py-1 text-sm font-medium "+(a?"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-300":"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300"),children:e(a?"com_ui_used":"com_ui_not_used")})})]})},t.codeHash)}))}),l.jsx("div",{className:"mt-12 flex justify-center",children:l.jsxs(Ys,{onClick:c,disabled:i,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[i?l.jsx(Xs,{className:"mr-2"}):l.jsx(Zn,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),e(i?"com_ui_regenerating":"com_ui_regenerate_backup")]})})]}):l.jsx("div",{className:"flex flex-col items-center gap-4 p-6 text-center",children:l.jsxs(Ys,{onClick:c,disabled:i,variant:"default",className:"px-8 py-3 transition-all disabled:opacity-50",children:[i&&l.jsx(Xs,{className:"mr-2"}),e("com_ui_regenerate_backup")]})})})})]})]})}));const Pz=_a.memo((function(){const{user:e}=nk();return l.jsxs("div",{className:"flex flex-col gap-3 p-1 text-sm text-text-primary",children:[l.jsx("div",{className:"pb-3",children:l.jsx(hz,{})}),l.jsx("div",{className:"pb-3",children:l.jsx(vz,{})}),"local"===(null==e?void 0:e.provider)&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"pb-3",children:l.jsx(Rz,{})}),(null==e?void 0:e.twoFactorEnabled)&&l.jsx("div",{className:"pb-3",children:l.jsx(Az,{})})]}),l.jsx("div",{className:"pb-3",children:l.jsx(gz,{})})]})})),Oz=[{stateAtom:N_.atCommand,localizationKey:"com_nav_at_command_description",switchId:"atCommand",key:"atCommand",permissionType:void 0},{stateAtom:N_.plusCommand,localizationKey:"com_nav_plus_command_description",switchId:"plusCommand",key:"plusCommand",permissionType:Pp.MULTI_CONVO},{stateAtom:N_.slashCommand,localizationKey:"com_nav_slash_command_description",switchId:"slashCommand",key:"slashCommand",permissionType:Pp.PROMPTS}];const Lz=Sa((function(){const e=qN(),t=ak({permissionType:Pp.PROMPTS,permission:Op.USE}),n=ak({permissionType:Pp.MULTI_CONVO,permission:Op.USE});return l.jsxs("div",{className:"space-y-4 p-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:"text-lg font-medium text-text-primary",children:e("com_nav_chat_commands")}),l.jsx(xr,{side:fr.Bottom,text:e("com_nav_chat_commands_info")})]}),l.jsx("div",{className:"flex flex-col gap-3 text-sm text-text-primary",children:Oz.map((e=>{return l.jsx("div",{className:"pb-3",children:l.jsx(gL,{stateAtom:e.stateAtom,localizationKey:e.localizationKey,switchId:e.switchId,showSwitch:(a=e.permissionType,!a||(a===Pp.MULTI_CONVO?!0===n:a!==Pp.PROMPTS||!0===t))})},e.key);var a}))})]})}));function Mz({setNavVisible:e,navVisible:t}){const n=qN(),a=xs(),{newConversation:s}=_C(),r=j(N_.conversationByIndex(0)),{title:o="New Chat"}=r||{};return l.jsxs("div",{className:"bg-token-main-surface-primary sticky top-0 z-10 flex min-h-[40px] items-center justify-center bg-white pl-1 dark:bg-gray-800 dark:text-white md:hidden",children:[l.jsxs("button",{type:"button","data-testid":"mobile-header-new-chat-button","aria-label":n(t?"com_nav_close_sidebar":"com_nav_open_sidebar"),"aria-live":"polite",className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>e((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),children:[l.jsx("span",{className:"sr-only",children:n(t?"com_nav_close_sidebar":"com_nav_open_sidebar")}),l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 8C3 7.44772 3.44772 7 4 7H20C20.5523 7 21 7.44772 21 8C21 8.55228 20.5523 9 20 9H4C3.44772 9 3 8.55228 3 8ZM3 16C3 15.4477 3.44772 15 4 15H14C14.5523 15 15 15.4477 15 16C15 16.5523 14.5523 17 14 17H4C3.44772 17 3 16.5523 3 16Z",fill:"currentColor"})})]}),l.jsx("h1",{className:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap text-center text-sm font-normal",children:o??n("com_ui_new_chat")}),l.jsx("button",{type:"button","aria-label":n("com_ui_new_chat"),className:"m-1 inline-flex size-10 items-center justify-center rounded-full hover:bg-surface-hover",onClick:()=>{mf(a,null==r?void 0:r.conversationId),a.invalidateQueries([Fh.messages]),s()},children:l.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"icon-md",children:l.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7929 2.79289C18.0118 1.57394 19.9882 1.57394 21.2071 2.79289C22.4261 4.01184 22.4261 5.98815 21.2071 7.20711L12.7071 15.7071C12.5196 15.8946 12.2652 16 12 16H9C8.44772 16 8 15.5523 8 15V12C8 11.7348 8.10536 11.4804 8.29289 11.2929L16.7929 2.79289ZM19.7929 4.20711C19.355 3.7692 18.645 3.7692 18.2071 4.2071L10 12.4142V14H11.5858L19.7929 5.79289C20.2308 5.35499 20.2308 4.64501 19.7929 4.20711ZM6 5C5.44772 5 5 5.44771 5 6V18C5 18.5523 5.44772 19 6 19H18C18.5523 19 19 18.5523 19 18V14C19 13.4477 19.4477 13 20 13C20.5523 13 21 13.4477 21 14V18C21 19.6569 19.6569 21 18 21H6C4.34315 21 3 19.6569 3 18V6C3 4.34314 4.34315 3 6 3H10C10.5523 3 11 3.44771 11 4C11 4.55228 10.5523 5 10 5H6Z",fill:"currentColor"})})})]})}const Dz=Ta(((e,t)=>{const n=qN(),a=T(),s=xs(),r=E(),{isSmallScreen:o}=e,[i,c]=ja(""),d=ba(null),[u,m]=ja(!1),{newConversation:p}=_C(),[h,g]=b(N_.search),x=ka((e=>{((null==e?void 0:e.includes("/search"))||"/c/new"===e)&&(s.removeQueries([Fh.messages]),p({disableFocus:!0}),r("/c/new"))}),[p,r,s]),f=ka((e=>{var t;m(!1),c(""),g((e=>({...e,query:"",debouncedQuery:"",isTyping:!1}))),x(e),null==(t=d.current)||t.focus()}),[g,x]),v=ka((e=>{const{value:t}=e.target;"Backspace"===e.key&&""===t&&f(a.pathname)}),[f,a.pathname]),_=ka((e=>{e&&s.invalidateQueries([Fh.messages])}),[s]),y=Ca((()=>xi((e=>{g((t=>({...t,debouncedQuery:e,isTyping:!1}))),_(e)}),500)),[g,_]);return ya((()=>{h.isTyping&&!h.isSearching&&h.debouncedQuery===h.query&&g((e=>({...e,isTyping:!1})))}),[h.isTyping,h.isSearching,h.debouncedQuery,h.query,g]),l.jsxs("div",{ref:t,className:"group relative my-1 flex h-10 cursor-pointer items-center gap-3 rounded-lg border-2 border-transparent px-3 py-2 text-text-primary focus-within:border-ring-primary focus-within:bg-surface-hover hover:bg-surface-hover",children:[l.jsx(_e,{"aria-hidden":"true",className:"absolute left-3 h-4 w-4 text-text-secondary group-focus-within:text-text-primary group-hover:text-text-primary"}),l.jsx("input",{type:"text",ref:d,className:"m-0 mr-0 w-full border-none bg-transparent p-0 pl-7 text-sm leading-tight placeholder-text-secondary placeholder-opacity-100 focus-visible:outline-none group-focus-within:placeholder-text-primary group-hover:placeholder-text-primary",value:i,onChange:e=>{const t=e.target.value;m(t.length>0),c(t),g((e=>({...e,query:t,isTyping:!0}))),y(t),t.length>0&&"/search"!==a.pathname&&r("/search",{replace:!0})},onKeyDown:e=>{"Space"===e.code&&e.stopPropagation()},"aria-label":n("com_nav_search_placeholder"),placeholder:n("com_nav_search_placeholder"),onKeyUp:v,onFocus:()=>g((e=>({...e,isSearching:!0}))),onBlur:()=>g((e=>({...e,isSearching:!1}))),autoComplete:"off",dir:"auto"}),l.jsx("button",{type:"button","aria-label":n("com_ui_clear_search"),className:Qf("absolute right-[7px] flex h-5 w-5 items-center justify-center rounded-full border-none bg-transparent p-0 transition-opacity duration-200",u?"opacity-100":"opacity-0",!0===o?"right-[16px]":""),onClick:()=>f(a.pathname),tabIndex:u?0:-1,disabled:!u,children:l.jsx(re,{className:"h-5 w-5 cursor-pointer","aria-hidden":"true"})})]})}));const Fz=La((()=>ul((()=>import("./BookmarkNav.CM8dWCHL.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url))),Uz=La((()=>ul((()=>import("./AccountSettings.-B2YI5yP.js")),__vite__mapDeps([27,1,2,3,4,5,6,8,7,10,11,12,13,14,9,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url))),zz="260px",Vz=Sa((()=>l.jsx("div",{className:Qf("flex h-10 items-center py-2"),children:l.jsx(Ms,{className:"h-10 w-full rounded-lg"})})));Vz.displayName="SearchBarSkeleton";const $z=Sa((({navVisible:e,toggleNavVisible:t})=>l.jsx("div",{id:"mobile-nav-mask-toggle",role:"button",tabIndex:0,className:"nav-mask transition-opacity duration-200 ease-in-out "+(e?"active opacity-100":"opacity-0"),onClick:t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||t()},"aria-label":"Toggle navigation"}))),Bz=Sa((function({index:e=0,toggleNav:t,subHeaders:n,isSmallScreen:a,headerButtons:s}){const r=xs(),{newConversation:o}=_C(e),i=E(),c=qN(),{conversation:d}=N_.useCreateConversationAtom(e),u=ka((()=>{t(),setTimeout((()=>{var e;null==(e=document.getElementById(lO))||e.focus()}),250)}),[t]),m=ka((e=>{0!==e.button||!e.ctrlKey&&!e.metaKey?(mf(r,null==d?void 0:d.conversationId),r.invalidateQueries([Fh.messages]),o(),i("/c/new",{state:{focusChat:!0}}),a&&t()):window.open("/c/new","_blank")}),[r,d,o,i,t,a]);return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center justify-between py-[2px] md:py-2",children:[l.jsx(pr,{description:c("com_nav_close_sidebar"),render:l.jsxs(Ys,{id:iO,size:"icon",variant:"outline","data-testid":"close-sidebar-button","aria-label":c("com_nav_close_sidebar"),"aria-expanded":!0,className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:u,children:[l.jsx(bo,{"aria-hidden":"true",className:"max-md:hidden"}),l.jsx(mi,{"aria-hidden":"true",className:"m-1 inline-flex size-10 items-center justify-center md:hidden"})]})}),l.jsxs("div",{className:"flex gap-0.5",children:[s,l.jsx(pr,{description:c("com_ui_new_chat"),render:l.jsx(Ys,{size:"icon",variant:"outline","data-testid":"nav-new-chat-button","aria-label":c("com_ui_new_chat"),className:"rounded-full border-none bg-transparent p-2 hover:bg-surface-hover md:rounded-xl",onClick:m,children:l.jsx(To,{className:"icon-lg text-text-primary"})})})]})]}),null!=n?n:null]})})),Hz=Sa((({navVisible:e,setNavVisible:t})=>{const n=qN(),{isAuthenticated:a}=nk(),[s,r]=ja(zz),o=vr("(max-width: 768px)"),[i,c]=JS("newUser",!0),[d,u]=JS("chatsExpanded",!0),[m,p]=ja(!1),[h,g]=ja([]),x=ak({permissionType:Pp.BOOKMARKS,permission:Op.USE}),f=j(N_.search),{data:v,fetchNextPage:_,isFetchingNextPage:b,isLoading:y,isFetching:w,refetch:N}=hb({tags:0===h.length?void 0:h,search:f.debouncedQuery||void 0},{enabled:a,staleTime:3e4,cacheTime:3e5}),k=Ca((()=>{if((null==v?void 0:v.pages)&&v.pages.length>0){return null!==v.pages[v.pages.length-1].nextCursor}return!1}),[null==v?void 0:v.pages]),C=ba(null),S=ba(null),{moveToTop:T}=PC({setShowLoading:p,fetchNextPage:async e=>k?_(e):Promise.resolve({}),isFetchingNext:b}),E=Ca((()=>v?v.pages.flatMap((e=>e.conversations)):[]),[v]),I=ka((()=>{t((e=>(localStorage.setItem("navVisible",JSON.stringify(!e)),!e))),i&&c(!1)}),[i,t,c]),R=ka((()=>{o&&I()}),[o,I]);ya((()=>{if(o){null===localStorage.getItem("navVisible")&&I(),r("320px")}else r(zz)}),[o,I]),ya((()=>{N()}),[h,N]);const A=ka((()=>{!b&&k&&_()}),[b,k,_]),P=Ca((()=>l.jsxs(l.Fragment,{children:[null===f.enabled&&l.jsx(Vz,{}),!0===f.enabled&&l.jsx(Dz,{isSmallScreen:o})]})),[f.enabled,o]),O=Ca((()=>l.jsx(l.Fragment,{children:x&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"mt-1.5"}),l.jsx(Ia,{fallback:null,children:l.jsx(Fz,{tags:h,setTags:g})})]})})),[x,h]),[L,M]=ja(!!f.query&&(f.isTyping||y||w));return ya((()=>{f.isTyping?M(!0):y||w?f.query&&(y||w)&&M(!0):M(!1)}),[f.query,f.isTyping,y,w]),l.jsxs(l.Fragment,{children:[l.jsx(xl,{initial:!1,children:e&&l.jsx(fl.div,{"data-testid":"nav",className:Qf("nav active max-w-[320px] flex-shrink-0 overflow-x-hidden bg-surface-primary-alt","md:max-w-[260px]"),initial:{width:0},animate:{width:s},exit:{width:0},transition:{duration:.2},children:l.jsx("div",{className:"h-full w-[320px] md:w-[260px]",children:l.jsx("div",{className:"flex h-full flex-col",children:l.jsxs("nav",{id:"chat-history-nav","aria-label":n("com_ui_chat_history"),className:"flex h-full flex-col px-2 pb-3.5",children:[l.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",ref:C,children:[l.jsx(Bz,{subHeaders:P,toggleNav:I,headerButtons:O,isSmallScreen:o}),l.jsx("div",{className:"flex min-h-0 flex-grow flex-col overflow-hidden",children:l.jsx(kD,{conversations:E,moveToTop:T,toggleNav:R,containerRef:S,loadMoreConversations:A,isLoading:b||m||y,isSearchLoading:L,isChatsExpanded:d,setIsChatsExpanded:u})})]}),l.jsx(Ia,{fallback:l.jsx(Ms,{className:"mt-1 h-12 w-full rounded-xl"}),children:l.jsx(Uz,{})})]})})})},"nav")}),o&&l.jsx($z,{navVisible:e,toggleNavVisible:I})]})}));function Gz(){var e,t,n,a;const[s,r]=ja(!1),[o,i]=ja(0),[c,d]=ja((()=>{const e=localStorage.getItem("navVisible");return null===e||JSON.parse(e)})),{isAuthenticated:u,logout:m}=nk();((e=!1)=>{const t=xs(),n=ba(!1),a=ba(null),s=ba(null);ya((()=>{if(!e)return;if(n.current)return;n.current=!0;const r=setTimeout((()=>{const e=async()=>{try{await t.fetchQuery([Fh.health],(()=>Jh.healthCheck()),{retry:!1,cacheTime:0,staleTime:0})}catch(e){console.error("Health check failed:",e)}};e(),a.current=setInterval(e,Om.TEN_MINUTES);const n=async()=>{const n=t.getQueryState([Fh.health]);if(!(null==n?void 0:n.dataUpdatedAt))return void(await e());const a=new Date(n.dataUpdatedAt),s=new Date(Date.now()-Om.TEN_MINUTES);cx.log(`Last health check: ${a.toISOString()}`),cx.log(`Ten minutes ago: ${s.toISOString()}`),a<s&&await e()};s.current=n,window.addEventListener("focus",n)}),500);return()=>{clearTimeout(r),a.current&&(clearInterval(a.current),a.current=null),s.current&&(window.removeEventListener("focus",s.current),s.current=null)}}),[e,t])})(u);const p=function({isAuthenticated:e}){const{data:t={}}=vb(Yl.assistants,void 0,{select:e=>mx(e.data),enabled:e}),{data:n={}}=vb(Yl.azureAssistants,void 0,{select:e=>mx(e.data),enabled:e});return{[Yl.assistants]:t,[Yl.azureAssistants]:n}}({isAuthenticated:u}),h=GN({isAuthenticated:u}),g=function({isAuthenticated:e}){const{data:t}=q_({select:ux,enabled:e});return t}({isAuthenticated:u}),{data:x}=K_(),{data:f}=(e=>gs([Fh.userTerms],(()=>Jh.getUserTerms()),{refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,...e}))({enabled:u&&!0===(null==(t=null==(e=null==x?void 0:x.interface)?void 0:e.termsOfService)?void 0:t.modalAcceptance)});!function(e){const t=y(N_.search),n=rb({enabled:e});ya((()=>{!0===n.data?t((e=>({...e,enabled:!0}))):!1===n.data?t((e=>({...e,enabled:!1}))):n.isError&&(cx.error("Failed to get search enabled: ",n.error),t((e=>({...e,enabled:!1}))))}),[n.data,n.error,n.isError,t])}(u),ya((()=>{f&&r(!f.termsAccepted)}),[f]);return u?l.jsx(vv,{children:l.jsx(mk.Provider,{value:g,children:l.jsxs(Ek.Provider,{value:p,children:[l.jsx(KN.Provider,{value:h,children:l.jsxs(nC,{children:[l.jsx(CO,{onHeightChange:i}),l.jsx("div",{className:"flex",style:{height:`calc(100dvh - ${o}px)`},children:l.jsxs("div",{className:"relative z-0 flex h-full w-full overflow-hidden",children:[l.jsx(Hz,{navVisible:c,setNavVisible:d}),l.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col overflow-hidden",children:[l.jsx(Mz,{navVisible:c,setNavVisible:d}),l.jsx(Dt,{context:{navVisible:c,setNavVisible:d}})]})]})})]})}),!0===(null==(a=null==(n=null==x?void 0:x.interface)?void 0:n.termsOfService)?void 0:a.modalAcceptance)&&l.jsx(LU,{open:s,onOpenChange:r,onAccept:()=>{r(!1)},onDecline:()=>{r(!1),m("/login?redirect=false")},title:x.interface.termsOfService.modalTitle,modalContent:x.interface.termsOfService.modalContent})]})})}):null}Hz.displayName="Nav",Ta(((e,t)=>{const{svg:n,text:a,clickHandler:s,disabled:r,className:o=""}=e,i={className:Qf("w-full flex gap-2 rounded p-2.5 text-sm cursor-pointer group items-center transition-colors duration-200 text-text-primary",o,{"opacity-50 pointer-events-none":r})};return s&&(i.onClick=s),l.jsxs("button",{...i,ref:t,children:[n(),a]})}));const Kz=()=>l.jsxs(tk,{children:[l.jsx(Dt,{}),l.jsx(fT,{})]}),Wz=document.querySelector("base"),qz=(null==Wz?void 0:Wz.getAttribute("href"))||"/",Qz=Ua([{path:"share/:shareId",element:l.jsx(qM,{}),errorElement:l.jsx(wO,{})},{path:"oauth",errorElement:l.jsx(wO,{}),children:[{path:"success",element:l.jsx(_O,{})},{path:"error",element:l.jsx(bO,{})}]},{path:"/",element:l.jsx(IO,{}),errorElement:l.jsx(wO,{}),children:[{path:"register",element:l.jsx(hT,{})},{path:"forgot-password",element:l.jsx(bT,{})},{path:"reset-password",element:l.jsx(gT,{})}]},{path:"verify",element:l.jsx(xT,{}),errorElement:l.jsx(wO,{})},{element:l.jsx(Kz,{}),errorElement:l.jsx(wO,{}),children:[{path:"/",element:l.jsx(RO,{}),children:[{path:"login",element:l.jsx(pT,{})},{path:"login/2fa",element:l.jsx(yT,{})}]},cL,{path:"/",element:l.jsx(Gz,{}),children:[{index:!0,element:l.jsx(Ht,{to:"/c/new",replace:!0})},{path:"c/:conversationId?",element:l.jsx(TU,{})},{path:"search",element:l.jsx(OU,{})},{path:"agents",element:l.jsx(jT,{children:l.jsx(vO,{})})},{path:"agents/:category",element:l.jsx(jT,{children:l.jsx(vO,{})})}]}]}],{basename:qz}),Yz=()=>{const{setError:e}=zS(),t=new Cs({queryCache:new Ss({onError:t=>{var n;401===(null==(n=null==t?void 0:t.response)?void 0:n.status)&&e(t)}})});ya((()=>{iT()}),[]);const n=function(){if(!Object.keys(nv).some((e=>e.startsWith("REACT_APP_THEME_"))))return;const e={},t=e=>nv[`REACT_APP_THEME_${e}`];return t("TEXT_PRIMARY")&&(e["rgb-text-primary"]=t("TEXT_PRIMARY")),t("TEXT_SECONDARY")&&(e["rgb-text-secondary"]=t("TEXT_SECONDARY")),t("TEXT_TERTIARY")&&(e["rgb-text-tertiary"]=t("TEXT_TERTIARY")),t("TEXT_WARNING")&&(e["rgb-text-warning"]=t("TEXT_WARNING")),t("SURFACE_PRIMARY")&&(e["rgb-surface-primary"]=t("SURFACE_PRIMARY")),t("SURFACE_SECONDARY")&&(e["rgb-surface-secondary"]=t("SURFACE_SECONDARY")),t("SURFACE_TERTIARY")&&(e["rgb-surface-tertiary"]=t("SURFACE_TERTIARY")),t("SURFACE_SUBMIT")&&(e["rgb-surface-submit"]=t("SURFACE_SUBMIT")),t("SURFACE_SUBMIT_HOVER")&&(e["rgb-surface-submit-hover"]=t("SURFACE_SUBMIT_HOVER")),t("SURFACE_DESTRUCTIVE")&&(e["rgb-surface-destructive"]=t("SURFACE_DESTRUCTIVE")),t("SURFACE_DESTRUCTIVE_HOVER")&&(e["rgb-surface-destructive-hover"]=t("SURFACE_DESTRUCTIVE_HOVER")),t("SURFACE_DIALOG")&&(e["rgb-surface-dialog"]=t("SURFACE_DIALOG")),t("SURFACE_CHAT")&&(e["rgb-surface-chat"]=t("SURFACE_CHAT")),t("BORDER_LIGHT")&&(e["rgb-border-light"]=t("BORDER_LIGHT")),t("BORDER_MEDIUM")&&(e["rgb-border-medium"]=t("BORDER_MEDIUM")),t("BORDER_HEAVY")&&(e["rgb-border-heavy"]=t("BORDER_HEAVY")),t("BORDER_XHEAVY")&&(e["rgb-border-xheavy"]=t("BORDER_XHEAVY")),t("BRAND_PURPLE")&&(e["rgb-brand-purple"]=t("BRAND_PURPLE")),t("HEADER_PRIMARY")&&(e["rgb-header-primary"]=t("HEADER_PRIMARY")),t("HEADER_HOVER")&&(e["rgb-header-hover"]=t("HEADER_HOVER")),t("PRESENTATION")&&(e["rgb-presentation"]=t("PRESENTATION")),Object.keys(e).length>0?e:void 0}();return l.jsx(Ts,{client:t,children:l.jsx(ea,{children:l.jsx(cT,{children:l.jsx(pi,{...n&&{initialTheme:"system",themeRGB:n},children:l.jsx(os,{children:l.jsx(hi,{children:l.jsxs(ps,{backend:hs,children:[l.jsx(za,{router:Qz}),l.jsx(sT,{}),l.jsx(Es,{initialIsOpen:!1,position:"top-right"}),l.jsx(gi,{}),l.jsx(is,{className:"pointer-events-none fixed inset-0 z-[1000] mx-auto my-2 flex max-w-[560px] flex-col items-stretch justify-start md:pb-5"})]})})})})})})})},Xz=()=>l.jsxs(RC,{children:[l.jsx(Yz,{}),l.jsx("iframe",{src:"assets/silence.mp3",allow:"autoplay",id:"audio",title:"audio-silence",style:{display:"none"}})]}),Jz=document.getElementById("root");ta.createRoot(Jz).render(l.jsx(US,{children:l.jsx(Xz,{})}));export{Pz as A,wk as B,zU as C,WU as D,Jh as F,_L as G,GP as M,cz as S,qN as a,C_ as b,Qf as c,tb as d,ak as e,Op as f,K_ as g,zm as h,Lz as i,pz as j,nk as k,sb as l,Pp as m,Nk as u,Fh as y};
