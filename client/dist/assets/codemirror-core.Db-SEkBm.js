import{c as e,E as t,S as n,a as o,f as r,b as l,R as i,M as a,d as s,A as c,T as u,e as d,P as p,C as f,F as h,g as m,h as g,i as y,j as b,k as v}from"./codemirror-state.BpbzyhTO.js";import{E as w,D as x,k,W as C,V as A,g as S,s as D,l as T,a as O}from"./codemirror-view.BXpYK4Vr.js";import{s as I,i as E,I as $,g as B,a as M,b as L,m as R,L as N,c as P,d as j,f as F,e as z,h as q,j as V,k as J,l as U,n as X,o as H}from"./codemirror-language.BxChQYYl.js";import{N as W,p as _,d as G,I as K,e as Y,f as Z,g as Q}from"./vendor.CphWSTLN.js";class ee{constructor(e,t,n,o){this.state=e,this.pos=t,this.explicit=n,this.view=o,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let t=I(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),n=Math.max(t.from,this.pos-250),o=t.text.slice(n-t.from,this.pos-t.from),r=o.search(le(e,!1));return r<0?null:{from:n+r,to:this.pos,text:o.slice(r)}}get aborted(){return null==this.abortListeners}addEventListener(e,t,n){"abort"==e&&this.abortListeners&&(this.abortListeners.push(t),n&&n.onDocChange&&(this.abortOnDocChange=!0))}}function te(e){let t=Object.keys(e).join(""),n=/\w/.test(t);return n&&(t=t.replace(/\w/g,"")),`[${n?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function ne(e){let t=e.map((e=>"string"==typeof e?{label:e}:e)),[n,o]=t.every((e=>/^\w+$/.test(e.label)))?[/\w*$/,/\w+$/]:function(e){let t=Object.create(null),n=Object.create(null);for(let{label:r}of e){t[r[0]]=!0;for(let e=1;e<r.length;e++)n[r[e]]=!0}let o=te(t)+te(n)+"*$";return[new RegExp("^"+o),new RegExp(o)]}(t);return e=>{let r=e.matchBefore(o);return r||e.explicit?{from:r?r.from:e.pos,options:t,validFor:n}:null}}class oe{constructor(e,t,n,o){this.completion=e,this.source=t,this.match=n,this.score=o}}function re(e){return e.selection.main.from}function le(e,t){var n;let{source:o}=e,r=t&&"^"!=o[0],l="$"!=o[o.length-1];return r||l?new RegExp(`${r?"^":""}(?:${o})${l?"$":""}`,null!==(n=e.flags)&&void 0!==n?n:e.ignoreCase?"i":""):e}const ie=c.define();const ae=new WeakMap;function se(e){if(!Array.isArray(e))return e;let t=ae.get(e);return t||ae.set(e,t=ne(e)),t}const ce=l.define(),ue=l.define();class de{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let n=0;n<t.length;){let r=e(t,n),l=o(r);this.chars.push(r);let i=t.slice(n,n+l),a=i.toUpperCase();this.folded.push(e(a==i?i.toLowerCase():a,0)),n+=l}this.astral=t.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,this}match(t){if(0==this.pattern.length)return this.ret(-100,[]);if(t.length<this.pattern.length)return null;let{chars:n,folded:l,any:i,precise:a,byWord:s}=this;if(1==n.length){let r=e(t,0),i=o(r),a=i==t.length?0:-100;if(r==n[0]);else{if(r!=l[0])return null;a+=-200}return this.ret(a,[0,i])}let c=t.indexOf(this.pattern);if(0==c)return this.ret(t.length==this.pattern.length?0:-100,[0,this.pattern.length]);let u=n.length,d=0;if(c<0){for(let r=0,a=Math.min(t.length,200);r<a&&d<u;){let a=e(t,r);a!=n[d]&&a!=l[d]||(i[d++]=r),r+=o(a)}if(d<u)return null}let p=0,f=0,h=!1,m=0,g=-1,y=-1,b=/[a-z]/.test(t),v=!0;for(let w=0,x=Math.min(t.length,200),k=0;w<x&&f<u;){let i=e(t,w);c<0&&(p<u&&i==n[p]&&(a[p++]=w),m<u&&(i==n[m]||i==l[m]?(0==m&&(g=w),y=w+1,m++):m=0));let d,x=i<255?i>=48&&i<=57||i>=97&&i<=122?2:i>=65&&i<=90?1:0:(d=r(i))!=d.toLowerCase()?1:d!=d.toUpperCase()?2:0;(!w||1==x&&b||0==k&&0!=x)&&(n[f]==i||l[f]==i&&(h=!0)?s[f++]=w:s.length&&(v=!1)),k=x,w+=o(i)}return f==u&&0==s[0]&&v?this.result((h?-200:0)-100,s,t):m==u&&0==g?this.ret(-200-t.length+(y==t.length?0:-100),[0,y]):c>-1?this.ret(-700-t.length,[c,c+this.pattern.length]):m==u?this.ret(-900-t.length,[g,y]):f==u?this.result((h?-200:0)-100-700+(v?0:-1100),s,t):2==n.length?null:this.result((i[0]?-700:0)-200-1100,i,t)}result(t,n,r){let l=[],i=0;for(let a of n){let t=a+(this.astral?o(e(r,a)):1);i&&l[i-1]==a?l[i-1]=t:(l[i++]=a,l[i++]=t)}return this.ret(t-r.length,l)}}class pe{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let t=e.slice(0,this.pattern.length),n=t==this.pattern?0:t.toLowerCase()==this.folded?-200:null;return null==n?null:(this.matched=[0,t.length],this.score=n+(e.length==this.pattern.length?0:-100),this)}}const fe=h.define({combine:e=>m(e,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:me,filterStrict:!1,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>n=>he(e(n),t(n)),optionClass:(e,t)=>n=>he(e(n),t(n)),addToOptions:(e,t)=>e.concat(t),filterStrict:(e,t)=>e||t})});function he(e,t){return e?t?e+" "+t:e:t}function me(e,t,n,o,r,l){let i,a,s=e.textDirection==O.RTL,c=s,u=!1,d="top",p=t.left-r.left,f=r.right-t.right,h=o.right-o.left,m=o.bottom-o.top;if(c&&p<Math.min(h,f)?c=!1:!c&&f<Math.min(h,p)&&(c=!0),h<=(c?p:f))i=Math.max(r.top,Math.min(n.top,r.bottom-m))-t.top,a=Math.min(400,c?p:f);else{u=!0,a=Math.min(400,(s?t.right:r.right-t.left)-30);let e=r.bottom-t.bottom;e>=m||e>t.top?i=n.bottom-t.top:(d="bottom",i=t.bottom-n.top)}return{style:`${d}: ${i/((t.bottom-t.top)/l.offsetHeight)}px; max-width: ${a/((t.right-t.left)/l.offsetWidth)}px`,class:"cm-completionInfo-"+(u?s?"left-narrow":"right-narrow":c?"left":"right")}}function ge(e,t,n){if(e<=n)return{from:0,to:e};if(t<0&&(t=0),t<=e>>1){let e=Math.floor(t/n);return{from:e*n,to:(e+1)*n}}let o=Math.floor((e-t)/n);return{from:e-(o+1)*n,to:e-o*n}}class ye{constructor(e,t,n){this.view=e,this.stateField=t,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:e=>this.placeInfo(e),key:this},this.space=null,this.currentClass="";let o=e.state.field(t),{options:r,selected:l}=o.open,i=e.state.facet(fe);this.optionContent=function(e){let t=e.addToOptions.slice();return e.icons&&t.push({render(e){let t=document.createElement("div");return t.classList.add("cm-completionIcon"),e.type&&t.classList.add(...e.type.split(/\s+/g).map((e=>"cm-completionIcon-"+e))),t.setAttribute("aria-hidden","true"),t},position:20}),t.push({render(e,t,n,o){let r=document.createElement("span");r.className="cm-completionLabel";let l=e.displayLabel||e.label,i=0;for(let a=0;a<o.length;){let e=o[a++],t=o[a++];e>i&&r.appendChild(document.createTextNode(l.slice(i,e)));let n=r.appendChild(document.createElement("span"));n.appendChild(document.createTextNode(l.slice(e,t))),n.className="cm-completionMatchedText",i=t}return i<l.length&&r.appendChild(document.createTextNode(l.slice(i))),r},position:50},{render(e){if(!e.detail)return null;let t=document.createElement("span");return t.className="cm-completionDetail",t.textContent=e.detail,t},position:80}),t.sort(((e,t)=>e.position-t.position)).map((e=>e.render))}(i),this.optionClass=i.optionClass,this.tooltipClass=i.tooltipClass,this.range=ge(r.length,l,i.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",(n=>{let{options:o}=e.state.field(t).open;for(let t,r=n.target;r&&r!=this.dom;r=r.parentNode)if("LI"==r.nodeName&&(t=/-(\d+)$/.exec(r.id))&&+t[1]<o.length)return this.applyCompletion(e,o[+t[1]]),void n.preventDefault()})),this.dom.addEventListener("focusout",(t=>{let n=e.state.field(this.stateField,!1);n&&n.tooltip&&e.state.facet(fe).closeOnBlur&&t.relatedTarget!=e.contentDOM&&e.dispatch({effects:ue.of(null)})})),this.showOptions(r,o.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",(()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)}))}update(e){var t;let n=e.state.field(this.stateField),o=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),n!=o){let{options:r,selected:l,disabled:i}=n.open;o.open&&o.open.options==r||(this.range=ge(r.length,l,e.state.facet(fe).maxRenderedOptions),this.showOptions(r,n.id)),this.updateSel(),i!=(null===(t=o.open)||void 0===t?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!i)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let e of this.currentClass.split(" "))e&&this.dom.classList.remove(e);for(let e of t.split(" "))e&&this.dom.classList.add(e);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=ge(t.options.length,t.selected,this.view.state.facet(fe).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:n}=t.options[t.selected],{info:o}=n;if(!o)return;let r="string"==typeof o?document.createTextNode(o):o(n);if(!r)return;"then"in r?r.then((t=>{t&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(t,n)})).catch((e=>T(this.view.state,e,"completion info"))):this.addInfoPane(r,n)}}addInfoPane(e,t){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",null!=e.nodeType)n.appendChild(e),this.infoDestroy=null;else{let{dom:t,destroy:o}=e;n.appendChild(t),this.infoDestroy=o||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let n=this.list.firstChild,o=this.range.from;n;n=n.nextSibling,o++)"LI"==n.nodeName&&n.id?o==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),t=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected"):o--;return t&&function(e,t){let n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),r=n.height/e.offsetHeight;o.top<n.top?e.scrollTop-=(n.top-o.top)/r:o.bottom>n.bottom&&(e.scrollTop+=(o.bottom-n.bottom)/r)}(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),o=e.getBoundingClientRect(),r=this.space;if(!r){let e=this.dom.ownerDocument.defaultView||window;r={left:0,top:0,right:e.innerWidth,bottom:e.innerHeight}}return o.top>Math.min(r.bottom,t.bottom)-10||o.bottom<Math.max(r.top,t.top)+10?null:this.view.state.facet(fe).positionInfo(this.view,t,o,n,r,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,n){const o=document.createElement("ul");o.id=t,o.setAttribute("role","listbox"),o.setAttribute("aria-expanded","true"),o.setAttribute("aria-label",this.view.state.phrase("Completions"));let r=null;for(let l=n.from;l<n.to;l++){let{completion:i,match:a}=e[l],{section:s}=i;if(s){let e="string"==typeof s?s:s.name;if(e!=r&&(l>n.from||0==n.from))if(r=e,"string"!=typeof s&&s.header)o.appendChild(s.header(s));else{o.appendChild(document.createElement("completion-section")).textContent=e}}const c=o.appendChild(document.createElement("li"));c.id=t+"-"+l,c.setAttribute("role","option");let u=this.optionClass(i);u&&(c.className=u);for(let e of this.optionContent){let t=e(i,this.view.state,this.view,a);t&&c.appendChild(t)}}return n.from&&o.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&o.classList.add("cm-completionListIncompleteBottom"),o}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function be(e,t){return n=>new ye(n,e,t)}function ve(e){return 100*(e.boost||0)+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}class we{constructor(e,t,n,o,r,l){this.options=e,this.attrs=t,this.tooltip=n,this.timestamp=o,this.selected=r,this.disabled=l}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new we(this.options,Ae(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,n,o,r){let l=function(e,t){let n=[],o=null,r=e=>{n.push(e);let{section:t}=e.completion;if(t){o||(o=[]);let e="string"==typeof t?t:t.name;o.some((t=>t.name==e))||o.push("string"==typeof t?{name:e}:t)}},l=t.facet(fe);for(let c of e)if(c.hasResult()){let e=c.result.getMatch;if(!1===c.result.filter)for(let t of c.result.options)r(new oe(t,c.source,e?e(t):[],1e9-n.length));else{let n,o=t.sliceDoc(c.from,c.to),i=l.filterStrict?new pe(o):new de(o);for(let t of c.result.options)if(n=i.match(t.label)){let o=t.displayLabel?e?e(t,n.matched):[]:n.matched;r(new oe(t,c.source,o,n.score+(t.boost||0)))}}}if(o){let e=Object.create(null),t=0,r=(e,t)=>{var n,o;return(null!==(n=e.rank)&&void 0!==n?n:1e9)-(null!==(o=t.rank)&&void 0!==o?o:1e9)||(e.name<t.name?-1:1)};for(let n of o.sort(r))t-=1e5,e[n.name]=t;for(let o of n){let{section:t}=o.completion;t&&(o.score+=e["string"==typeof t?t:t.name])}}let i=[],a=null,s=l.compareCompletions;for(let c of n.sort(((e,t)=>t.score-e.score||s(e.completion,t.completion)))){let e=c.completion;!a||a.label!=e.label||a.detail!=e.detail||null!=a.type&&null!=e.type&&a.type!=e.type||a.apply!=e.apply||a.boost!=e.boost?i.push(c):ve(c.completion)>ve(a)&&(i[i.length-1]=c),a=c.completion}return i}(e,t);if(!l.length)return o&&e.some((e=>1==e.state))?new we(o.options,o.attrs,o.tooltip,o.timestamp,o.selected,!0):null;let i=t.facet(fe).selectOnOpen?0:-1;if(o&&o.selected!=i&&-1!=o.selected){let e=o.options[o.selected].completion;for(let t=0;t<l.length;t++)if(l[t].completion==e){i=t;break}}return new we(l,Ae(n,i),{pos:e.reduce(((e,t)=>t.hasResult()?Math.min(e,t.from):e),1e8),create:Me,above:r.aboveCursor},o?o.timestamp:Date.now(),i,!1)}map(e){return new we(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class xe{constructor(e,t,n){this.active=e,this.id=t,this.open=n}static start(){return new xe(Se,"cm-ac-"+Math.floor(2e6*Math.random()).toString(36),null)}update(e){let{state:t}=e,n=t.facet(fe),o=(n.override||t.languageDataAt("autocomplete",re(t)).map(se)).map((t=>(this.active.find((e=>e.source==t))||new Te(t,this.active.some((e=>0!=e.state))?1:0)).update(e,n)));o.length==this.active.length&&o.every(((e,t)=>e==this.active[t]))&&(o=this.active);let r=this.open;r&&e.docChanged&&(r=r.map(e.changes)),e.selection||o.some((t=>t.hasResult()&&e.changes.touchesRange(t.from,t.to)))||!function(e,t){if(e==t)return!0;for(let n=0,o=0;;){for(;n<e.length&&!e[n].hasResult;)n++;for(;o<t.length&&!t[o].hasResult;)o++;let r=n==e.length,l=o==t.length;if(r||l)return r==l;if(e[n++].result!=t[o++].result)return!1}}(o,this.active)?r=we.build(o,t,this.id,r,n):r&&r.disabled&&!o.some((e=>1==e.state))&&(r=null),!r&&o.every((e=>1!=e.state))&&o.some((e=>e.hasResult()))&&(o=o.map((e=>e.hasResult()?new Te(e.source,0):e)));for(let l of e.effects)l.is(Ee)&&(r=r&&r.setSelected(l.value,this.id));return o==this.active&&r==this.open?this:new xe(o,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?ke:Ce}}const ke={"aria-autocomplete":"list"},Ce={};function Ae(e,t){let n={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":e};return t>-1&&(n["aria-activedescendant"]=e+"-"+t),n}const Se=[];function De(e,t){if(e.isUserEvent("input.complete")){let n=e.annotation(ie);if(n&&t.activateOnCompletion(n))return 12}let n=e.isUserEvent("input.type");return n&&t.activateOnTyping?5:n?1:e.isUserEvent("delete.backward")?2:e.selection?8:e.docChanged?16:0}class Te{constructor(e,t,n=-1){this.source=e,this.state=t,this.explicitPos=n}hasResult(){return!1}update(e,t){let n=De(e,t),o=this;(8&n||16&n&&this.touches(e))&&(o=new Te(o.source,0)),4&n&&0==o.state&&(o=new Te(this.source,1)),o=o.updateFor(e,n);for(let r of e.effects)if(r.is(ce))o=new Te(o.source,1,r.value?re(e.state):-1);else if(r.is(ue))o=new Te(o.source,0);else if(r.is(Ie))for(let e of r.value)e.source==o.source&&(o=e);return o}updateFor(e,t){return this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Te(this.source,this.state,e.mapPos(this.explicitPos))}touches(e){return e.changes.touchesRange(re(e.state))}}class Oe extends Te{constructor(e,t,n,o,r){super(e,2,t),this.result=n,this.from=o,this.to=r}hasResult(){return!0}updateFor(e,t){var n;if(!(3&t))return this.map(e.changes);let o=this.result;o.map&&!e.changes.empty&&(o=o.map(o,e.changes));let r=e.changes.mapPos(this.from),l=e.changes.mapPos(this.to,1),i=re(e.state);if((this.explicitPos<0?i<=r:i<this.from)||i>l||!o||2&t&&re(e.startState)==this.from)return new Te(this.source,4&t?1:0);let a=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);return function(e,t,n,o){if(!e)return!1;let r=t.sliceDoc(n,o);return"function"==typeof e?e(r,n,o,t):le(e,!0).test(r)}(o.validFor,e.state,r,l)?new Oe(this.source,a,o,r,l):o.update&&(o=o.update(o,r,l,new ee(e.state,i,a>=0)))?new Oe(this.source,a,o,o.from,null!==(n=o.to)&&void 0!==n?n:re(e.state)):new Te(this.source,1,a)}map(e){if(e.empty)return this;return(this.result.map?this.result.map(this.result,e):this.result)?new Oe(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new Te(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}const Ie=l.define({map:(e,t)=>e.map((e=>e.map(t)))}),Ee=l.define(),$e=n.define({create:()=>xe.start(),update:(e,t)=>e.update(t),provide:e=>[D.from(e,(e=>e.tooltip)),w.contentAttributes.from(e,(e=>e.attrs))]});function Be(e,n){const o=n.completion.apply||n.completion.label;let r=e.state.field($e).active.find((e=>e.source==n.source));return r instanceof Oe&&("string"==typeof o?e.dispatch(Object.assign(Object.assign({},function(e,n,o,r){let{main:l}=e.selection,i=o-l.from,a=r-l.from;return Object.assign(Object.assign({},e.changeByRange((s=>s!=l&&o!=r&&e.sliceDoc(s.from+i,s.from+a)!=e.sliceDoc(o,r)?{range:s}:{changes:{from:s.from+i,to:r==l.from?s.to:s.from+a,insert:n},range:t.cursor(s.from+i+n.length)}))),{scrollIntoView:!0,userEvent:"input.complete"})}(e.state,o,r.from,r.to)),{annotations:ie.of(n.completion)})):o(e,n.completion,r.from,r.to),!0)}const Me=be($e,Be);function Le(e,t="option"){return n=>{let o=n.state.field($e,!1);if(!o||!o.open||o.open.disabled||Date.now()-o.open.timestamp<n.state.facet(fe).interactionDelay)return!1;let r,l=1;"page"==t&&(r=S(n,o.open.tooltip))&&(l=Math.max(2,Math.floor(r.dom.offsetHeight/r.dom.querySelector("li").offsetHeight)-1));let{length:i}=o.open.options,a=o.open.selected>-1?o.open.selected+l*(e?1:-1):e?0:i-1;return a<0?a="page"==t?0:i-1:a>=i&&(a="page"==t?i-1:0),n.dispatch({effects:Ee.of(a)}),!0}}class Re{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const Ne=A.fromClass(class{constructor(e){this.view=e,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of e.state.field($e).active)1==t.state&&this.startQuery(t)}update(e){let t=e.state.field($e),n=e.state.facet(fe);if(!e.selectionSet&&!e.docChanged&&e.startState.field($e)==t)return;let o=e.transactions.some((e=>{let t=De(e,n);return 8&t||(e.selection||e.docChanged)&&!(3&t)}));for(let i=0;i<this.running.length;i++){let t=this.running[i];if(o||t.context.abortOnDocChange&&e.docChanged||t.updates.length+e.transactions.length>50&&Date.now()-t.time>1e3){for(let e of t.context.abortListeners)try{e()}catch(l){T(this.view.state,l)}t.context.abortListeners=null,this.running.splice(i--,1)}else t.updates.push(...e.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),e.transactions.some((e=>e.effects.some((e=>e.is(ce)))))&&(this.pendingStart=!0);let r=this.pendingStart?50:n.activateOnTypingDelay;if(this.debounceUpdate=t.active.some((e=>1==e.state&&!this.running.some((t=>t.active.source==e.source))))?setTimeout((()=>this.startUpdate()),r):-1,0!=this.composing)for(let i of e.transactions)i.isUserEvent("input.type")?this.composing=2:2==this.composing&&i.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:e}=this.view,t=e.field($e);for(let n of t.active)1!=n.state||this.running.some((e=>e.active.source==n.source))||this.startQuery(n)}startQuery(e){let{state:t}=this.view,n=re(t),o=new ee(t,n,e.explicitPos==n,this.view),r=new Re(e,o);this.running.push(r),Promise.resolve(e.source(o)).then((e=>{r.context.aborted||(r.done=e||null,this.scheduleAccept())}),(e=>{this.view.dispatch({effects:ue.of(null)}),T(this.view.state,e)}))}scheduleAccept(){this.running.every((e=>void 0!==e.done))?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout((()=>this.accept()),this.view.state.facet(fe).updateSyncTime))}accept(){var e;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],n=this.view.state.facet(fe);for(let o=0;o<this.running.length;o++){let r=this.running[o];if(void 0===r.done)continue;if(this.running.splice(o--,1),r.done){let o=new Oe(r.active.source,r.active.explicitPos,r.done,r.done.from,null!==(e=r.done.to)&&void 0!==e?e:re(r.updates.length?r.updates[0].startState:this.view.state));for(let e of r.updates)o=o.update(e,n);if(o.hasResult()){t.push(o);continue}}let l=this.view.state.field($e).active.find((e=>e.source==r.active.source));if(l&&1==l.state)if(null==r.done){let e=new Te(r.active.source,0);for(let t of r.updates)e=e.update(t,n);1!=e.state&&t.push(e)}else this.startQuery(l)}t.length&&this.view.dispatch({effects:Ie.of(t)})}},{eventHandlers:{blur(e){let t=this.view.state.field($e,!1);if(t&&t.tooltip&&this.view.state.facet(fe).closeOnBlur){let n=t.open&&S(this.view,t.open.tooltip);n&&n.dom.contains(e.relatedTarget)||setTimeout((()=>this.view.dispatch({effects:ue.of(null)})),10)}},compositionstart(){this.composing=1},compositionend(){3==this.composing&&setTimeout((()=>this.view.dispatch({effects:ce.of(!1)})),20),this.composing=0}}}),Pe="object"==typeof navigator&&/Win/.test(navigator.platform),je=p.highest(w.domEventHandlers({keydown(e,t){let n=t.state.field($e,!1);if(!n||!n.open||n.open.disabled||n.open.selected<0||e.key.length>1||e.ctrlKey&&(!Pe||!e.altKey)||e.metaKey)return!1;let o=n.open.options[n.open.selected],r=n.active.find((e=>e.source==o.source)),l=o.completion.commitCharacters||r.result.commitCharacters;return l&&l.indexOf(e.key)>-1&&Be(t,o),!1}})),Fe=w.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"¬∑¬∑¬∑"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'∆í'"}},".cm-completionIcon-class":{"&:after":{content:"'‚óã'"}},".cm-completionIcon-interface":{"&:after":{content:"'‚óå'"}},".cm-completionIcon-variable":{"&:after":{content:"'ùë•'"}},".cm-completionIcon-constant":{"&:after":{content:"'ùê∂'"}},".cm-completionIcon-type":{"&:after":{content:"'ùë°'"}},".cm-completionIcon-enum":{"&:after":{content:"'‚à™'"}},".cm-completionIcon-property":{"&:after":{content:"'‚ñ°'"}},".cm-completionIcon-keyword":{"&:after":{content:"'üîëÔ∏é'"}},".cm-completionIcon-namespace":{"&:after":{content:"'‚ñ¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class ze{constructor(e,t,n,o){this.field=e,this.line=t,this.from=n,this.to=o}}class qe{constructor(e,t,n){this.field=e,this.from=t,this.to=n}map(e){let t=e.mapPos(this.from,-1,a.TrackDel),n=e.mapPos(this.to,1,a.TrackDel);return null==t||null==n?null:new qe(this.field,t,n)}}class Ve{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let n=[],o=[t],r=e.doc.lineAt(t),l=/^\s*/.exec(r.text)[0];for(let i of this.lines){if(n.length){let n=l,r=/^\t*/.exec(i)[0].length;for(let t=0;t<r;t++)n+=e.facet(E);o.push(t+n.length-r),i=n+i.slice(r)}n.push(i),t+=i.length+1}return{text:n,ranges:this.fieldPositions.map((e=>new qe(e.field,o[e.line]+e.from,o[e.line]+e.to)))}}static parse(e){let t,n=[],o=[],r=[];for(let l of e.split(/\r\n?|\n/)){for(;t=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(l);){let e=t[1]?+t[1]:null,i=t[2]||t[3]||"",a=-1,s=i.replace(/\\[{}]/g,(e=>e[1]));for(let t=0;t<n.length;t++)(null!=e?n[t].seq==e:s&&n[t].name==s)&&(a=t);if(a<0){let t=0;for(;t<n.length&&(null==e||null!=n[t].seq&&n[t].seq<e);)t++;n.splice(t,0,{seq:e,name:s}),a=t;for(let e of r)e.field>=a&&e.field++}r.push(new ze(a,o.length,t.index,t.index+s.length)),l=l.slice(0,t.index)+i+l.slice(t.index+t[0].length)}l=l.replace(/\\([{}])/g,((e,t,n)=>{for(let l of r)l.line==o.length&&l.from>n&&(l.from--,l.to--);return t})),o.push(l)}return new Ve(o,r)}}let Je=x.widget({widget:new class extends C{toDOM(){let e=document.createElement("span");return e.className="cm-snippetFieldPosition",e}ignoreEvent(){return!1}}}),Ue=x.mark({class:"cm-snippetField"});class Xe{constructor(e,t){this.ranges=e,this.active=t,this.deco=x.set(e.map((e=>(e.from==e.to?Je:Ue).range(e.from,e.to))))}map(e){let t=[];for(let n of this.ranges){let o=n.map(e);if(!o)return null;t.push(o)}return new Xe(t,this.active)}selectionInsideField(e){return e.ranges.every((e=>this.ranges.some((t=>t.field==this.active&&t.from<=e.from&&t.to>=e.to))))}}const He=l.define({map:(e,t)=>e&&e.map(t)}),We=l.define(),_e=n.define({create:()=>null,update(e,t){for(let n of t.effects){if(n.is(He))return n.value;if(n.is(We)&&e)return new Xe(e.ranges,n.value)}return e&&t.docChanged&&(e=e.map(t.changes)),e&&t.selection&&!e.selectionInsideField(t.selection)&&(e=null),e},provide:e=>w.decorations.from(e,(e=>e?e.deco:x.none))});function Ge(e,n){return t.create(e.filter((e=>e.field==n)).map((e=>t.range(e.from,e.to))))}function Ke(e){let t=Ve.parse(e);return(e,n,o,r)=>{let{text:i,ranges:a}=t.instantiate(e.state,o),s={changes:{from:o,to:r,insert:d.of(i)},scrollIntoView:!0,annotations:n?[ie.of(n),u.userEvent.of("input.complete")]:void 0};if(a.length&&(s.selection=Ge(a,0)),a.some((e=>e.field>0))){let t=new Xe(a,0),n=s.effects=[He.of(t)];void 0===e.state.field(_e,!1)&&n.push(l.appendConfig.of([_e,et,nt,Fe]))}e.dispatch(e.state.update(s))}}function Ye(e){return({state:t,dispatch:n})=>{let o=t.field(_e,!1);if(!o||e<0&&0==o.active)return!1;let r=o.active+e,l=e>0&&!o.ranges.some((t=>t.field==r+e));return n(t.update({selection:Ge(o.ranges,r),effects:He.of(l?null:new Xe(o.ranges,r)),scrollIntoView:!0})),!0}}const Ze=[{key:"Tab",run:Ye(1),shift:Ye(-1)},{key:"Escape",run:({state:e,dispatch:t})=>!!e.field(_e,!1)&&(t(e.update({effects:He.of(null)})),!0)}],Qe=h.define({combine:e=>e.length?e[0]:Ze}),et=p.highest(k.compute([Qe],(e=>e.facet(Qe))));function tt(e,t){return Object.assign(Object.assign({},t),{apply:Ke(e)})}const nt=w.domEventHandlers({mousedown(e,t){let n,o=t.state.field(_e,!1);if(!o||null==(n=t.posAtCoords({x:e.clientX,y:e.clientY})))return!1;let r=o.ranges.find((e=>e.from<=n&&e.to>=n));return!(!r||r.field==o.active)&&(t.dispatch({selection:Ge(o.ranges,r.field),effects:He.of(o.ranges.some((e=>e.field>r.field))?new Xe(o.ranges,r.field):null),scrollIntoView:!0}),!0)}}),ot={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},rt=l.define({map(e,t){let n=t.mapPos(e,-1,a.TrackAfter);return null==n?void 0:n}}),lt=new class extends s{};lt.startSide=1,lt.endSide=-1;const it=n.define({create:()=>i.empty,update(e,t){if(e=e.map(t.changes),t.selection){let n=t.state.doc.lineAt(t.selection.main.head);e=e.update({filter:e=>e>=n.from&&e<=n.to})}for(let n of t.effects)n.is(rt)&&(e=e.update({add:[lt.range(n.value,n.value+1)]}));return e}});function at(){return[pt,it]}const st="()[]{}<>";function ct(e){for(let t=0;t<st.length;t+=2)if(st.charCodeAt(t)==e)return st.charAt(t+1);return r(e<128?e:e+1)}function ut(e,t){return e.languageDataAt("closeBrackets",t)[0]||ot}const dt="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),pt=w.inputHandler.of(((t,n,r,l)=>{if((dt?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let i=t.state.selection.main;if(l.length>2||2==l.length&&1==o(e(l,0))||n!=i.from||r!=i.to)return!1;let a=function(t,n){let o=ut(t,t.selection.main.head),r=o.brackets||ot.brackets;for(let l of r){let i=ct(e(l,0));if(n==l)return i==l?bt(t,l,r.indexOf(l+l+l)>-1,o):gt(t,l,i,o.before||ot.before);if(n==i&&ht(t,t.selection.main.from))return yt(t,l,i)}return null}(t.state,l);return!!a&&(t.dispatch(a),!0)})),ft=[{key:"Backspace",run:({state:n,dispatch:r})=>{if(n.readOnly)return!1;let l=ut(n,n.selection.main.head).brackets||ot.brackets,i=null,a=n.changeByRange((r=>{if(r.empty){let i=function(t,n){let r=t.sliceString(n-2,n);return o(e(r,0))==r.length?r:r.slice(1)}(n.doc,r.head);for(let o of l)if(o==i&&mt(n.doc,r.head)==ct(e(o,0)))return{changes:{from:r.head-o.length,to:r.head+o.length},range:t.cursor(r.head-o.length)}}return{range:i=r}}));return i||r(n.update(a,{scrollIntoView:!0,userEvent:"delete.backward"})),!i}}];function ht(e,t){let n=!1;return e.field(it).between(0,e.doc.length,(e=>{e==t&&(n=!0)})),n}function mt(t,n){let r=t.sliceString(n,n+2);return r.slice(0,o(e(r,0)))}function gt(e,n,o,r){let l=null,i=e.changeByRange((i=>{if(!i.empty)return{changes:[{insert:n,from:i.from},{insert:o,from:i.to}],effects:rt.of(i.to+n.length),range:t.range(i.anchor+n.length,i.head+n.length)};let a=mt(e.doc,i.head);return!a||/\s/.test(a)||r.indexOf(a)>-1?{changes:{insert:n+o,from:i.head},effects:rt.of(i.head+n.length),range:t.cursor(i.head+n.length)}:{range:l=i}}));return l?null:e.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function yt(e,n,o){let r=null,l=e.changeByRange((n=>n.empty&&mt(e.doc,n.head)==o?{changes:{from:n.head,to:n.head+o.length,insert:o},range:t.cursor(n.head+o.length)}:r={range:n}));return r?null:e.update(l,{scrollIntoView:!0,userEvent:"input.type"})}function bt(e,n,o,r){let l=r.stringPrefixes||ot.stringPrefixes,i=null,a=e.changeByRange((r=>{if(!r.empty)return{changes:[{insert:n,from:r.from},{insert:n,from:r.to}],effects:rt.of(r.to+n.length),range:t.range(r.anchor+n.length,r.head+n.length)};let a,s=r.head,c=mt(e.doc,s);if(c==n){if(vt(e,s))return{changes:{insert:n+n,from:s},effects:rt.of(s+n.length),range:t.cursor(s+n.length)};if(ht(e,s)){let r=o&&e.sliceDoc(s,s+3*n.length)==n+n+n?n+n+n:n;return{changes:{from:s,to:s+r.length,insert:r},range:t.cursor(s+r.length)}}}else{if(o&&e.sliceDoc(s-2*n.length,s)==n+n&&(a=wt(e,s-2*n.length,l))>-1&&vt(e,a))return{changes:{insert:n+n+n+n,from:s},effects:rt.of(s+n.length),range:t.cursor(s+n.length)};if(e.charCategorizer(s)(c)!=f.Word&&wt(e,s,l)>-1&&!function(e,t,n,o){let r=I(e).resolveInner(t,-1),l=o.reduce(((e,t)=>Math.max(e,t.length)),0);for(let i=0;i<5;i++){let i=e.sliceDoc(r.from,Math.min(r.to,r.from+n.length+l)),a=i.indexOf(n);if(!a||a>-1&&o.indexOf(i.slice(0,a))>-1){let t=r.firstChild;for(;t&&t.from==r.from&&t.to-t.from>n.length+a;){if(e.sliceDoc(t.to-n.length,t.to)==n)return!1;t=t.firstChild}return!0}let s=r.to==t&&r.parent;if(!s)break;r=s}return!1}(e,s,n,l))return{changes:{insert:n+n,from:s},effects:rt.of(s+n.length),range:t.cursor(s+n.length)}}return{range:i=r}}));return i?null:e.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function vt(e,t){let n=I(e).resolveInner(t+1);return n.parent&&n.from==t}function wt(e,t,n){let o=e.charCategorizer(t);if(o(e.sliceDoc(t-1,t))!=f.Word)return t;for(let r of n){let n=t-r.length;if(e.sliceDoc(n,t)==r&&o(e.sliceDoc(n-1,n))!=f.Word)return n}return-1}function xt(e={}){return[je,$e,fe.of(e),Ne,Ct,Fe]}const kt=[{key:"Ctrl-Space",run:e=>!!e.state.field($e,!1)&&(e.dispatch({effects:ce.of(!0)}),!0)},{key:"Escape",run:e=>{let t=e.state.field($e,!1);return!(!t||!t.active.some((e=>0!=e.state)))&&(e.dispatch({effects:ue.of(null)}),!0)}},{key:"ArrowDown",run:Le(!0)},{key:"ArrowUp",run:Le(!1)},{key:"PageDown",run:Le(!0,"page")},{key:"PageUp",run:Le(!1,"page")},{key:"Enter",run:e=>{let t=e.state.field($e,!1);return!(e.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<e.state.facet(fe).interactionDelay)&&Be(e,t.open.options[t.open.selected])}}],Ct=p.highest(k.computeN([fe],(e=>e.facet(fe).defaultKeymap?[kt]:[])));function At(e,t){return({state:n,dispatch:o})=>{if(n.readOnly)return!1;let r=e(t,n);return!!r&&(o(n.update(r)),!0)}}const St=At($t,0),Dt=At(Et,0),Tt=At(((e,t)=>Et(e,t,function(e){let t=[];for(let n of e.selection.ranges){let o=e.doc.lineAt(n.from),r=n.to<=o.to?o:e.doc.lineAt(n.to),l=t.length-1;l>=0&&t[l].to>o.from?t[l].to=r.to:t.push({from:o.from+/^\s*/.exec(o.text)[0].length,to:r.to})}return t}(t))),0);function Ot(e,t){let n=e.languageDataAt("commentTokens",t);return n.length?n[0]:{}}const It=50;function Et(e,t,n=t.selection.ranges){let o=n.map((e=>Ot(t,e.from).block));if(!o.every((e=>e)))return null;let r=n.map(((e,n)=>function(e,{open:t,close:n},o,r){let l,i,a=e.sliceDoc(o-It,o),s=e.sliceDoc(r,r+It),c=/\s*$/.exec(a)[0].length,u=/^\s*/.exec(s)[0].length,d=a.length-c;if(a.slice(d-t.length,d)==t&&s.slice(u,u+n.length)==n)return{open:{pos:o-c,margin:c&&1},close:{pos:r+u,margin:u&&1}};r-o<=2*It?l=i=e.sliceDoc(o,r):(l=e.sliceDoc(o,o+It),i=e.sliceDoc(r-It,r));let p=/^\s*/.exec(l)[0].length,f=/\s*$/.exec(i)[0].length,h=i.length-f-n.length;return l.slice(p,p+t.length)==t&&i.slice(h,h+n.length)==n?{open:{pos:o+p+t.length,margin:/\s/.test(l.charAt(p+t.length))?1:0},close:{pos:r-f-n.length,margin:/\s/.test(i.charAt(h-1))?1:0}}:null}(t,o[n],e.from,e.to)));if(2!=e&&!r.every((e=>e)))return{changes:t.changes(n.map(((e,t)=>r[t]?[]:[{from:e.from,insert:o[t].open+" "},{from:e.to,insert:" "+o[t].close}])))};if(1!=e&&r.some((e=>e))){let e=[];for(let t,n=0;n<r.length;n++)if(t=r[n]){let r=o[n],{open:l,close:i}=t;e.push({from:l.pos-r.open.length,to:l.pos+l.margin},{from:i.pos-i.margin,to:i.pos+r.close.length})}return{changes:e}}return null}function $t(e,t,n=t.selection.ranges){let o=[],r=-1;for(let{from:l,to:i}of n){let e=o.length,n=1e9,a=Ot(t,l).line;if(a){for(let e=l;e<=i;){let s=t.doc.lineAt(e);if(s.from>r&&(l==i||i>s.from)){r=s.from;let e=/^\s*/.exec(s.text)[0].length,t=e==s.length,l=s.text.slice(e,e+a.length)==a?e:-1;e<s.text.length&&e<n&&(n=e),o.push({line:s,comment:l,token:a,indent:e,empty:t,single:!1})}e=s.to+1}if(n<1e9)for(let t=e;t<o.length;t++)o[t].indent<o[t].line.text.length&&(o[t].indent=n);o.length==e+1&&(o[e].single=!0)}}if(2!=e&&o.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:r,indent:l,empty:i,single:a}of o)!a&&i||e.push({from:t.from+l,insert:r+" "});let n=t.changes(e);return{changes:n,selection:t.selection.map(n,1)}}if(1!=e&&o.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:n,token:r}of o)if(n>=0){let o=t.from+n,l=o+r.length;" "==t.text[l-t.from]&&l++,e.push({from:o,to:l})}return{changes:e}}return null}const Bt=c.define(),Mt=c.define(),Lt=h.define(),Rt=h.define({combine:e=>m(e,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(n,o)=>e(n,o)||t(n,o)})}),Nt=n.define({create:()=>Qt.empty,update(e,t){let n=t.state.facet(Rt),o=t.annotation(Bt);if(o){let r=Jt.fromTransaction(t,o.selection),l=o.side,i=0==l?e.undone:e.done;return i=r?Ut(i,i.length,n.minDepth,r):_t(i,t.startState.selection),new Qt(0==l?o.rest:i,0==l?i:o.rest)}let r=t.annotation(Mt);if("full"!=r&&"before"!=r||(e=e.isolate()),!1===t.annotation(u.addToHistory))return t.changes.empty?e:e.addMapping(t.changes.desc);let l=Jt.fromTransaction(t),i=t.annotation(u.time),a=t.annotation(u.userEvent);return l?e=e.addChanges(l,i,a,n,t):t.selection&&(e=e.addSelection(t.startState.selection,i,a,n.newGroupDelay)),"full"!=r&&"after"!=r||(e=e.isolate()),e},toJSON:e=>({done:e.done.map((e=>e.toJSON())),undone:e.undone.map((e=>e.toJSON()))}),fromJSON:e=>new Qt(e.done.map(Jt.fromJSON),e.undone.map(Jt.fromJSON))});function Pt(e={}){return[Nt,Rt.of(e),w.domEventHandlers({beforeinput(e,t){let n="historyUndo"==e.inputType?Ft:"historyRedo"==e.inputType?zt:null;return!!n&&(e.preventDefault(),n(t))}})]}function jt(e,t){return function({state:n,dispatch:o}){if(!t&&n.readOnly)return!1;let r=n.field(Nt,!1);if(!r)return!1;let l=r.pop(e,n,t);return!!l&&(o(l),!0)}}const Ft=jt(0,!1),zt=jt(1,!1),qt=jt(0,!0),Vt=jt(1,!0);class Jt{constructor(e,t,n,o,r){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=o,this.selectionsAfter=r}setSelAfter(e){return new Jt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(n=this.startSelection)||void 0===n?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new Jt(e.changes&&b.fromJSON(e.changes),[],e.mapped&&v.fromJSON(e.mapped),e.startSelection&&t.fromJSON(e.startSelection),e.selectionsAfter.map(t.fromJSON))}static fromTransaction(e,t){let n=Ht;for(let o of e.startState.facet(Lt)){let t=o(e);t.length&&(n=n.concat(t))}return!n.length&&e.changes.empty?null:new Jt(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,Ht)}static selection(e){return new Jt(void 0,Ht,void 0,void 0,e)}}function Ut(e,t,n,o){let r=t+1>n+20?t-n-1:0,l=e.slice(r,t);return l.push(o),l}function Xt(e,t){return e.length?t.length?e.concat(t):e:t}const Ht=[],Wt=200;function _t(e,t){if(e.length){let n=e[e.length-1],o=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-Wt));return o.length&&o[o.length-1].eq(t)?e:(o.push(t),Ut(e,e.length-1,1e9,n.setSelAfter(o)))}return[Jt.selection([t])]}function Gt(e){let t=e[e.length-1],n=e.slice();return n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),n}function Kt(e,t){if(!e.length)return e;let n=e.length,o=Ht;for(;n;){let r=Yt(e[n-1],t,o);if(r.changes&&!r.changes.empty||r.effects.length){let t=e.slice(0,n);return t[n-1]=r,t}t=r.mapped,n--,o=r.selectionsAfter}return o.length?[Jt.selection(o)]:Ht}function Yt(e,t,n){let o=Xt(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(t))):Ht,n);if(!e.changes)return Jt.selection(o);let r=e.changes.map(t),i=t.mapDesc(e.changes,!0),a=e.mapped?e.mapped.composeDesc(i):i;return new Jt(r,l.mapEffects(e.effects,t),a,e.startSelection.map(i),o)}const Zt=/^(input\.type|delete)($|\.)/;class Qt{constructor(e,t,n=0,o=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=o}isolate(){return this.prevTime?new Qt(this.done,this.undone):this}addChanges(e,t,n,o,r){let l=this.done,i=l[l.length-1];return l=i&&i.changes&&!i.changes.empty&&e.changes&&(!n||Zt.test(n))&&(!i.selectionsAfter.length&&t-this.prevTime<o.newGroupDelay&&o.joinToEvent(r,function(e,t){let n=[],o=!1;return e.iterChangedRanges(((e,t)=>n.push(e,t))),t.iterChangedRanges(((e,t,r,l)=>{for(let i=0;i<n.length;){let e=n[i++],t=n[i++];l>=e&&r<=t&&(o=!0)}})),o}(i.changes,e.changes))||"input.type.compose"==n)?Ut(l,l.length-1,o.minDepth,new Jt(e.changes.compose(i.changes),Xt(e.effects,i.effects),i.mapped,i.startSelection,Ht)):Ut(l,l.length,o.minDepth,e),new Qt(l,Ht,t,n)}addSelection(e,t,n,o){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:Ht;return r.length>0&&t-this.prevTime<o&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&(l=r[r.length-1],i=e,l.ranges.length==i.ranges.length&&0===l.ranges.filter(((e,t)=>e.empty!=i.ranges[t].empty)).length)?this:new Qt(_t(this.done,e),this.undone,t,n);var l,i}addMapping(e){return new Qt(Kt(this.done,e),Kt(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let o=0==e?this.done:this.undone;if(0==o.length)return null;let r=o[o.length-1],l=r.selectionsAfter[0]||t.selection;if(n&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:Bt.of({side:e,rest:Gt(o),selection:l}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let n=1==o.length?Ht:o.slice(0,o.length-1);return r.mapped&&(n=Kt(n,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:Bt.of({side:e,rest:n,selection:l}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}Qt.empty=new Qt(Ht,Ht);const en=[{key:"Mod-z",run:Ft,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:zt,preventDefault:!0},{linux:"Ctrl-Shift-z",run:zt,preventDefault:!0},{key:"Mod-u",run:qt,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Vt,preventDefault:!0}];function tn(e,n){return t.create(e.ranges.map(n),e.mainIndex)}function nn(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function on({state:e,dispatch:t},n){let o=tn(e.selection,n);return!o.eq(e.selection,!0)&&(t(nn(e,o)),!0)}function rn(e,n){return t.cursor(n?e.to:e.from)}function ln(e,t){return on(e,(n=>n.empty?e.moveByChar(n,t):rn(n,t)))}function an(e){return e.textDirectionAt(e.state.selection.main.head)==O.LTR}const sn=e=>ln(e,!an(e)),cn=e=>ln(e,an(e));function un(e,t){return on(e,(n=>n.empty?e.moveByGroup(n,t):rn(n,t)))}function dn(e,t,n){if(t.type.prop(n))return!0;let o=t.to-t.from;return o&&(o>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function pn(e,n,o){let r,l,i=I(e).resolveInner(n.head),a=o?W.closedBy:W.openedBy;for(let t=n.head;;){let n=o?i.childAfter(t):i.childBefore(t);if(!n)break;dn(e,n,a)?i=n:t=o?n.to:n.from}return l=i.type.prop(a)&&(r=o?R(e,i.from,1):R(e,i.to,-1))&&r.matched?o?r.end.to:r.end.from:o?i.to:i.from,t.cursor(l,o?-1:1)}function fn(e,t){return on(e,(n=>{if(!n.empty)return rn(n,t);let o=e.moveVertically(n,t);return o.head!=n.head?o:e.moveToLineBoundary(n,t)}))}const hn=e=>fn(e,!1),mn=e=>fn(e,!0);function gn(e){let t,n=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,o=0,r=0;if(n){for(let t of e.state.facet(w.scrollMargins)){let n=t(e);(null==n?void 0:n.top)&&(o=Math.max(null==n?void 0:n.top,o)),(null==n?void 0:n.bottom)&&(r=Math.max(null==n?void 0:n.bottom,r))}t=e.scrollDOM.clientHeight-o-r}else t=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:o,marginBottom:r,selfScroll:n,height:Math.max(e.defaultLineHeight,t-5)}}function yn(e,t){let n,o=gn(e),{state:r}=e,l=tn(r.selection,(n=>n.empty?e.moveVertically(n,t,o.height):rn(n,t)));if(l.eq(r.selection))return!1;if(o.selfScroll){let t=e.coordsAtPos(r.selection.main.head),i=e.scrollDOM.getBoundingClientRect(),a=i.top+o.marginTop,s=i.bottom-o.marginBottom;t&&t.top>a&&t.bottom<s&&(n=w.scrollIntoView(l.main.head,{y:"start",yMargin:t.top-a}))}return e.dispatch(nn(r,l),{effects:n}),!0}const bn=e=>yn(e,!1),vn=e=>yn(e,!0);function wn(e,n,o){let r=e.lineBlockAt(n.head),l=e.moveToLineBoundary(n,o);if(l.head==n.head&&l.head!=(o?r.to:r.from)&&(l=e.moveToLineBoundary(n,o,!1)),!o&&l.head==r.from&&r.length){let o=/^\s*/.exec(e.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;o&&n.head!=r.from+o&&(l=t.cursor(r.from+o))}return l}function xn(e,n){let o=tn(e.state.selection,(e=>{let o=n(e);return t.range(e.anchor,o.head,o.goalColumn,o.bidiLevel||void 0)}));return!o.eq(e.state.selection)&&(e.dispatch(nn(e.state,o)),!0)}function kn(e,t){return xn(e,(n=>e.moveByChar(n,t)))}const Cn=e=>kn(e,!an(e)),An=e=>kn(e,an(e));function Sn(e,t){return xn(e,(n=>e.moveByGroup(n,t)))}function Dn(e,t){return xn(e,(n=>e.moveVertically(n,t)))}const Tn=e=>Dn(e,!1),On=e=>Dn(e,!0);function In(e,t){return xn(e,(n=>e.moveVertically(n,t,gn(e).height)))}const En=e=>In(e,!1),$n=e=>In(e,!0),Bn=({state:e,dispatch:t})=>(t(nn(e,{anchor:0})),!0),Mn=({state:e,dispatch:t})=>(t(nn(e,{anchor:e.doc.length})),!0),Ln=({state:e,dispatch:t})=>(t(nn(e,{anchor:e.selection.main.anchor,head:0})),!0),Rn=({state:e,dispatch:t})=>(t(nn(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0);function Nn(e,n){if(e.state.readOnly)return!1;let o="delete.selection",{state:r}=e,l=r.changeByRange((r=>{let{from:l,to:i}=r;if(l==i){let t=n(r);t<l?(o="delete.backward",t=Pn(e,t,!1)):t>l&&(o="delete.forward",t=Pn(e,t,!0)),l=Math.min(l,t),i=Math.max(i,t)}else l=Pn(e,l,!1),i=Pn(e,i,!0);return l==i?{range:r}:{changes:{from:l,to:i},range:t.cursor(l,l<r.head?-1:1)}}));return!l.changes.empty&&(e.dispatch(r.update(l,{scrollIntoView:!0,userEvent:o,effects:"delete.selection"==o?w.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function Pn(e,t,n){if(e instanceof w)for(let o of e.state.facet(w.atomicRanges).map((t=>t(e))))o.between(t,t,((e,o)=>{e<t&&o>t&&(t=n?o:e)}));return t}const jn=(e,t,n)=>Nn(e,(o=>{let r,l,i=o.from,{state:a}=e,s=a.doc.lineAt(i);if(n&&!t&&i>s.from&&i<s.from+200&&!/[^ \t]/.test(r=s.text.slice(0,i-s.from))){if("\t"==r[r.length-1])return i-1;let e=g(r,a.tabSize)%L(a)||L(a);for(let t=0;t<e&&" "==r[r.length-1-t];t++)i--;l=i}else l=y(s.text,i-s.from,t,t)+s.from,l==i&&s.number!=(t?a.doc.lines:1)?l+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(s.text.slice(l-s.from,i-s.from))&&(l=y(s.text,l-s.from,!1,!1)+s.from);return l})),Fn=e=>jn(e,!1,!0),zn=e=>jn(e,!0,!1),qn=(e,t)=>Nn(e,(n=>{let o=n.head,{state:r}=e,l=r.doc.lineAt(o),i=r.charCategorizer(o);for(let e=null;;){if(o==(t?l.to:l.from)){o==n.head&&l.number!=(t?r.doc.lines:1)&&(o+=t?1:-1);break}let a=y(l.text,o-l.from,t)+l.from,s=l.text.slice(Math.min(o,a)-l.from,Math.max(o,a)-l.from),c=i(s);if(null!=e&&c!=e)break;" "==s&&o==n.head||(e=c),o=a}return o})),Vn=e=>qn(e,!1);function Jn(e){let t=[],n=-1;for(let o of e.selection.ranges){let r=e.doc.lineAt(o.from),l=e.doc.lineAt(o.to);if(o.empty||o.to!=l.from||(l=e.doc.lineAt(o.to-1)),n>=r.number){let e=t[t.length-1];e.to=l.to,e.ranges.push(o)}else t.push({from:r.from,to:l.to,ranges:[o]});n=l.number+1}return t}function Un(e,n,o){if(e.readOnly)return!1;let r=[],l=[];for(let i of Jn(e)){if(o?i.to==e.doc.length:0==i.from)continue;let n=e.doc.lineAt(o?i.to+1:i.from-1),a=n.length+1;if(o){r.push({from:i.to,to:n.to},{from:i.from,insert:n.text+e.lineBreak});for(let n of i.ranges)l.push(t.range(Math.min(e.doc.length,n.anchor+a),Math.min(e.doc.length,n.head+a)))}else{r.push({from:n.from,to:i.from},{from:i.to,insert:e.lineBreak+n.text});for(let e of i.ranges)l.push(t.range(e.anchor-a,e.head-a))}}return!!r.length&&(n(e.update({changes:r,scrollIntoView:!0,selection:t.create(l,e.selection.mainIndex),userEvent:"move.line"})),!0)}function Xn(e,t,n){if(e.readOnly)return!1;let o=[];for(let r of Jn(e))n?o.push({from:r.from,insert:e.doc.slice(r.from,r.to)+e.lineBreak}):o.push({from:r.to,insert:e.lineBreak+e.doc.slice(r.from,r.to)});return t(e.update({changes:o,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Hn=Wn(!1);function Wn(e){return({state:n,dispatch:o})=>{if(n.readOnly)return!1;let r=n.changeByRange((o=>{let{from:r,to:l}=o,i=n.doc.lineAt(r),a=!e&&r==l&&function(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let n,o=I(e).resolveInner(t),r=o.childBefore(t),l=o.childAfter(t);return r&&l&&r.to<=t&&l.from>=t&&(n=r.type.prop(W.closedBy))&&n.indexOf(l.name)>-1&&e.doc.lineAt(r.to).from==e.doc.lineAt(l.from).from&&!/\S/.test(e.sliceDoc(r.to,l.from))?{from:r.to,to:l.from}:null}(n,r);e&&(r=l=(l<=i.to?i:n.doc.lineAt(l)).to);let s=new $(n,{simulateBreak:r,simulateDoubleBreak:!!a}),c=B(s,r);for(null==c&&(c=g(/^\s*/.exec(n.doc.lineAt(r).text)[0],n.tabSize));l<i.to&&/\s/.test(i.text[l-i.from]);)l++;a?({from:r,to:l}=a):r>i.from&&r<i.from+100&&!/\S/.test(i.text.slice(0,r))&&(r=i.from);let u=["",M(n,c)];return a&&u.push(M(n,s.lineIndent(i.from,-1))),{changes:{from:r,to:l,insert:d.of(u)},range:t.cursor(r+1+u[1].length)}}));return o(n.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function _n(e,n){let o=-1;return e.changeByRange((r=>{let l=[];for(let t=r.from;t<=r.to;){let i=e.doc.lineAt(t);i.number>o&&(r.empty||r.to>i.from)&&(n(i,l,r),o=i.number),t=i.to+1}let i=e.changes(l);return{changes:l,range:t.range(i.mapPos(r.anchor,1),i.mapPos(r.head,1))}}))}const Gn=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(_n(e,((t,n)=>{n.push({from:t.from,insert:e.facet(E)})})),{userEvent:"input.indent"})),!0),Kn=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(_n(e,((t,n)=>{let o=/^\s*/.exec(t.text)[0];if(!o)return;let r=g(o,e.tabSize),l=0,i=M(e,Math.max(0,r-L(e)));for(;l<o.length&&l<i.length&&o.charCodeAt(l)==i.charCodeAt(l);)l++;n.push({from:t.from+l,to:t.from+o.length,insert:i.slice(l)})})),{userEvent:"delete.dedent"})),!0),Yn=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:e=>on(e,(t=>pn(e.state,t,!an(e)))),shift:e=>xn(e,(t=>pn(e.state,t,!an(e))))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:e=>on(e,(t=>pn(e.state,t,an(e)))),shift:e=>xn(e,(t=>pn(e.state,t,an(e))))},{key:"Alt-ArrowUp",run:({state:e,dispatch:t})=>Un(e,t,!1)},{key:"Shift-Alt-ArrowUp",run:({state:e,dispatch:t})=>Xn(e,t,!1)},{key:"Alt-ArrowDown",run:({state:e,dispatch:t})=>Un(e,t,!0)},{key:"Shift-Alt-ArrowDown",run:({state:e,dispatch:t})=>Xn(e,t,!0)},{key:"Escape",run:({state:e,dispatch:n})=>{let o=e.selection,r=null;return o.ranges.length>1?r=t.create([o.main]):o.main.empty||(r=t.create([t.cursor(o.main.head)])),!!r&&(n(nn(e,r)),!0)}},{key:"Mod-Enter",run:Wn(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:e,dispatch:n})=>{let o=Jn(e).map((({from:n,to:o})=>t.range(n,Math.min(o+1,e.doc.length))));return n(e.update({selection:t.create(o),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:e,dispatch:n})=>{let o=tn(e.selection,(n=>{var o;for(let r=I(e).resolveStack(n.from,1);r;r=r.next){let{node:e}=r;if((e.from<n.from&&e.to>=n.to||e.to>n.to&&e.from<=n.from)&&(null===(o=e.parent)||void 0===o?void 0:o.parent))return t.range(e.to,e.from)}return n}));return n(nn(e,o)),!0},preventDefault:!0},{key:"Mod-[",run:Kn},{key:"Mod-]",run:Gn},{key:"Mod-Alt-\\",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=Object.create(null),o=new $(e,{overrideIndentation:e=>{let t=n[e];return null==t?-1:t}}),r=_n(e,((t,r,l)=>{let i=B(o,t.from);if(null==i)return;/\S/.test(t.text)||(i=0);let a=/^\s*/.exec(t.text)[0],s=M(e,i);(a!=s||l.from<t.from+a.length)&&(n[t.from]=i,r.push({from:t.from,to:t.from+a.length,insert:s}))}));return r.changes.empty||t(e.update(r,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:e=>{if(e.state.readOnly)return!1;let{state:t}=e,n=t.changes(Jn(t).map((({from:e,to:n})=>(e>0?e--:n<t.doc.length&&n++,{from:e,to:n})))),o=tn(t.selection,(t=>{let n;if(e.lineWrapping){let o=e.lineBlockAt(t.head),r=e.coordsAtPos(t.head,t.assoc||1);r&&(n=o.bottom+e.documentTop-r.bottom+e.defaultLineHeight/2)}return e.moveVertically(t,!0,n)})).map(n);return e.dispatch({changes:n,selection:o,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:e,dispatch:n})=>function(e,n,o){let r=!1,l=tn(e.selection,(n=>{let o=R(e,n.head,-1)||R(e,n.head,1)||n.head>0&&R(e,n.head-1,1)||n.head<e.doc.length&&R(e,n.head+1,-1);if(!o||!o.end)return n;r=!0;let l=o.start.from==n.head?o.end.to:o.end.from;return t.cursor(l)}));return!!r&&(n(nn(e,l)),!0)}(e,n)},{key:"Mod-/",run:e=>{let{state:t}=e,n=t.doc.lineAt(t.selection.main.from),o=Ot(e.state,n.from);return o.line?St(e):!!o.block&&Tt(e)}},{key:"Alt-A",run:Dt},{key:"Ctrl-m",mac:"Shift-Alt-m",run:e=>(e.setTabFocusMode(),!0)}].concat([{key:"ArrowLeft",run:sn,shift:Cn,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:e=>un(e,!an(e)),shift:e=>Sn(e,!an(e)),preventDefault:!0},{mac:"Cmd-ArrowLeft",run:e=>on(e,(t=>wn(e,t,!an(e)))),shift:e=>xn(e,(t=>wn(e,t,!an(e)))),preventDefault:!0},{key:"ArrowRight",run:cn,shift:An,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:e=>un(e,an(e)),shift:e=>Sn(e,an(e)),preventDefault:!0},{mac:"Cmd-ArrowRight",run:e=>on(e,(t=>wn(e,t,an(e)))),shift:e=>xn(e,(t=>wn(e,t,an(e)))),preventDefault:!0},{key:"ArrowUp",run:hn,shift:Tn,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Bn,shift:Ln},{mac:"Ctrl-ArrowUp",run:bn,shift:En},{key:"ArrowDown",run:mn,shift:On,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Mn,shift:Rn},{mac:"Ctrl-ArrowDown",run:vn,shift:$n},{key:"PageUp",run:bn,shift:En},{key:"PageDown",run:vn,shift:$n},{key:"Home",run:e=>on(e,(t=>wn(e,t,!1))),shift:e=>xn(e,(t=>wn(e,t,!1))),preventDefault:!0},{key:"Mod-Home",run:Bn,shift:Ln},{key:"End",run:e=>on(e,(t=>wn(e,t,!0))),shift:e=>xn(e,(t=>wn(e,t,!0))),preventDefault:!0},{key:"Mod-End",run:Mn,shift:Rn},{key:"Enter",run:Hn},{key:"Mod-a",run:({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:Fn,shift:Fn},{key:"Delete",run:zn},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Vn},{key:"Mod-Delete",mac:"Alt-Delete",run:e=>qn(e,!0)},{mac:"Mod-Backspace",run:e=>Nn(e,(t=>{let n=e.moveToLineBoundary(t,!1).head;return t.head>n?n:Math.max(0,t.head-1)}))},{mac:"Mod-Delete",run:e=>Nn(e,(t=>{let n=e.moveToLineBoundary(t,!0).head;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}))}].concat([{key:"Ctrl-b",run:sn,shift:Cn,preventDefault:!0},{key:"Ctrl-f",run:cn,shift:An},{key:"Ctrl-p",run:hn,shift:Tn},{key:"Ctrl-n",run:mn,shift:On},{key:"Ctrl-a",run:e=>on(e,(n=>t.cursor(e.lineBlockAt(n.head).from,1))),shift:e=>xn(e,(n=>t.cursor(e.lineBlockAt(n.head).from)))},{key:"Ctrl-e",run:e=>on(e,(n=>t.cursor(e.lineBlockAt(n.head).to,-1))),shift:e=>xn(e,(n=>t.cursor(e.lineBlockAt(n.head).to)))},{key:"Ctrl-d",run:zn},{key:"Ctrl-h",run:Fn},{key:"Ctrl-k",run:e=>Nn(e,(t=>{let n=e.lineBlockAt(t.head).to;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}))},{key:"Ctrl-Alt-h",run:Vn},{key:"Ctrl-o",run:({state:e,dispatch:n})=>{if(e.readOnly)return!1;let o=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:d.of(["",""])},range:t.cursor(e.from)})));return n(e.update(o,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:e,dispatch:n})=>{if(e.readOnly)return!1;let o=e.changeByRange((n=>{if(!n.empty||0==n.from||n.from==e.doc.length)return{range:n};let o=n.from,r=e.doc.lineAt(o),l=o==r.from?o-1:y(r.text,o-r.from,!1)+r.from,i=o==r.to?o+1:y(r.text,o-r.from,!0)+r.from;return{changes:{from:l,to:i,insert:e.doc.slice(o,i).append(e.doc.slice(l,o))},range:t.cursor(i)}}));return!o.changes.empty&&(n(e.update(o,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:vn}].map((e=>({mac:e.key,run:e.run,shift:e.shift})))));let Zn=null;function Qn(){if(!Zn&&"object"==typeof document&&document.body){let{style:e}=document.body,t=[],n=new Set;for(let o in e)"cssText"!=o&&"cssFloat"!=o&&"string"==typeof e[o]&&(/[A-Z]/.test(o)&&(o=o.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))),n.has(o)||(t.push(o),n.add(o)));Zn=t.sort().map((e=>({type:"property",label:e})))}return Zn||[]}const eo=["active","after","any-link","autofill","backdrop","before","checked","cue","default","defined","disabled","empty","enabled","file-selector-button","first","first-child","first-letter","first-line","first-of-type","focus","focus-visible","focus-within","fullscreen","has","host","host-context","hover","in-range","indeterminate","invalid","is","lang","last-child","last-of-type","left","link","marker","modal","not","nth-child","nth-last-child","nth-last-of-type","nth-of-type","only-child","only-of-type","optional","out-of-range","part","placeholder","placeholder-shown","read-only","read-write","required","right","root","scope","selection","slotted","target","target-text","valid","visited","where"].map((e=>({type:"class",label:e}))),to=["above","absolute","activeborder","additive","activecaption","after-white-space","ahead","alias","all","all-scroll","alphabetic","alternate","always","antialiased","appworkspace","asterisks","attr","auto","auto-flow","avoid","avoid-column","avoid-page","avoid-region","axis-pan","background","backwards","baseline","below","bidi-override","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","bullets","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","calc","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-decimal","clear","clip","close-quote","col-resize","collapse","color","color-burn","color-dodge","column","column-reverse","compact","condensed","contain","content","contents","content-box","context-menu","continuous","copy","counter","counters","cover","crop","cross","crosshair","currentcolor","cursive","cyclic","darken","dashed","decimal","decimal-leading-zero","default","default-button","dense","destination-atop","destination-in","destination-out","destination-over","difference","disc","discard","disclosure-closed","disclosure-open","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic-abegede-gez","ethiopic-halehame-aa-er","ethiopic-halehame-gez","ew-resize","exclusion","expanded","extends","extra-condensed","extra-expanded","fantasy","fast","fill","fill-box","fixed","flat","flex","flex-end","flex-start","footnotes","forwards","from","geometricPrecision","graytext","grid","groove","hand","hard-light","help","hidden","hide","higher","highlight","highlighttext","horizontal","hsl","hsla","hue","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-flex","inline-grid","inline-table","inset","inside","intrinsic","invert","italic","justify","keep-all","landscape","large","larger","left","level","lighter","lighten","line-through","linear","linear-gradient","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-hexadecimal","lower-latin","lower-norwegian","lowercase","ltr","luminosity","manipulation","match","matrix","matrix3d","medium","menu","menutext","message-box","middle","min-intrinsic","mix","monospace","move","multiple","multiple_mask_images","multiply","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","numbers","numeric","nw-resize","nwse-resize","oblique","opacity","open-quote","optimizeLegibility","optimizeSpeed","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","perspective","pinch-zoom","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radial-gradient","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeating-linear-gradient","repeating-radial-gradient","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","rotate","rotate3d","rotateX","rotateY","rotateZ","round","row","row-resize","row-reverse","rtl","run-in","running","s-resize","sans-serif","saturation","scale","scale3d","scaleX","scaleY","scaleZ","screen","scroll","scrollbar","scroll-position","se-resize","self-start","self-end","semi-condensed","semi-expanded","separate","serif","show","single","skew","skewX","skewY","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","soft-light","solid","source-atop","source-in","source-out","source-over","space","space-around","space-between","space-evenly","spell-out","square","start","static","status-bar","stretch","stroke","stroke-box","sub","subpixel-antialiased","svg_masks","super","sw-resize","symbolic","symbols","system-ui","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","text","text-bottom","text-top","textarea","textfield","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","to","top","transform","translate","translate3d","translateX","translateY","translateZ","transparent","ultra-condensed","ultra-expanded","underline","unidirectional-pan","unset","up","upper-latin","uppercase","url","var","vertical","vertical-text","view-box","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","words","wrap","wrap-reverse","x-large","x-small","xor","xx-large","xx-small"].map((e=>({type:"keyword",label:e}))).concat(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"].map((e=>({type:"constant",label:e})))),no=["a","abbr","address","article","aside","b","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","dd","del","details","dfn","dialog","div","dl","dt","em","figcaption","figure","footer","form","header","hgroup","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","main","meter","nav","ol","output","p","pre","ruby","section","select","small","source","span","strong","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","tr","u","ul"].map((e=>({type:"type",label:e}))),oo=/^(\w[\w-]*|-\w[\w-]*|)$/,ro=/^-(-[\w-]*)?$/;const lo=new G,io=["Declaration"];function ao(e){for(let t=e;;){if(t.type.isTop)return t;if(!(t=t.parent))return e}}function so(e,t,n){if(t.to-t.from>4096){let o=lo.get(t);if(o)return o;let r=[],l=new Set,i=t.cursor(K.IncludeAnonymous);if(i.firstChild())do{for(let t of so(e,i.node,n))l.has(t.label)||(l.add(t.label),r.push(t))}while(i.nextSibling());return lo.set(t,r),r}{let o=[],r=new Set;return t.cursor().iterate((t=>{var l;if(n(t)&&t.matchContext(io)&&":"==(null===(l=t.node.nextSibling)||void 0===l?void 0:l.name)){let n=e.sliceString(t.from,t.to);r.has(n)||(r.add(n),o.push({label:n,type:"variable"}))}})),o}}const co=(e=>t=>{let{state:n,pos:o}=t,r=I(n).resolveInner(o,-1),l=r.type.isError&&r.from==r.to-1&&"-"==n.doc.sliceString(r.from,r.to);if("PropertyName"==r.name||(l||"TagName"==r.name)&&/^(Block|Styles)$/.test(r.resolve(r.to).name))return{from:r.from,options:Qn(),validFor:oo};if("ValueName"==r.name)return{from:r.from,options:to,validFor:oo};if("PseudoClassName"==r.name)return{from:r.from,options:eo,validFor:oo};if(e(r)||(t.explicit||l)&&function(e,t){var n;if(("("==e.name||e.type.isError)&&(e=e.parent||e),"ArgList"!=e.name)return!1;let o=null===(n=e.parent)||void 0===n?void 0:n.firstChild;return"Callee"==(null==o?void 0:o.name)&&"var"==t.sliceString(o.from,o.to)}(r,n.doc))return{from:e(r)||l?r.from:o,options:so(n.doc,ao(r),e),validFor:ro};if("TagName"==r.name){for(let{parent:e}=r;e;e=e.parent)if("Block"==e.name)return{from:r.from,options:Qn(),validFor:oo};return{from:r.from,options:no,validFor:oo}}if(!t.explicit)return null;let i=r.resolve(o),a=i.childBefore(o);return a&&":"==a.name&&"PseudoClassSelector"==i.name?{from:o,options:eo,validFor:oo}:a&&":"==a.name&&"Declaration"==i.name||"ArgList"==i.name?{from:o,options:to,validFor:oo}:"Block"==i.name||"Styles"==i.name?{from:o,options:Qn(),validFor:oo}:null})((e=>"VariableName"==e.name)),uo=P.define({name:"css",parser:_.configure({props:[j.add({Declaration:z()}),F.add({"Block KeyframeList":q})]}),languageData:{commentTokens:{block:{open:"/*",close:"*/"}},indentOnInput:/^\s*\}$/,wordChars:"-"}});function po(){return new N(uo,uo.data.of({autocomplete:co}))}const fo=[tt("function ${name}(${params}) {\n\t${}\n}",{label:"function",detail:"definition",type:"keyword"}),tt("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n\t${}\n}",{label:"for",detail:"loop",type:"keyword"}),tt("for (let ${name} of ${collection}) {\n\t${}\n}",{label:"for",detail:"of loop",type:"keyword"}),tt("do {\n\t${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),tt("while (${}) {\n\t${}\n}",{label:"while",detail:"loop",type:"keyword"}),tt("try {\n\t${}\n} catch (${error}) {\n\t${}\n}",{label:"try",detail:"/ catch block",type:"keyword"}),tt("if (${}) {\n\t${}\n}",{label:"if",detail:"block",type:"keyword"}),tt("if (${}) {\n\t${}\n} else {\n\t${}\n}",{label:"if",detail:"/ else block",type:"keyword"}),tt("class ${name} {\n\tconstructor(${params}) {\n\t\t${}\n\t}\n}",{label:"class",detail:"definition",type:"keyword"}),tt('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),tt('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],ho=fo.concat([tt("interface ${name} {\n\t${}\n}",{label:"interface",detail:"definition",type:"keyword"}),tt("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),tt("enum ${name} {\n\t${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),mo=new G,go=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function yo(e){return(t,n)=>{let o=t.node.getChild("VariableDefinition");return o&&n(o,e),!0}}const bo=["FunctionDeclaration"],vo={FunctionDeclaration:yo("function"),ClassDeclaration:yo("class"),ClassExpression:()=>!0,EnumDeclaration:yo("constant"),TypeAliasDeclaration:yo("type"),NamespaceDeclaration:yo("namespace"),VariableDefinition(e,t){e.matchContext(bo)||t(e,"variable")},TypeDefinition(e,t){t(e,"type")},__proto__:null};function wo(e,t){let n=mo.get(t);if(n)return n;let o=[],r=!0;function l(t,n){let r=e.sliceString(t.from,t.to);o.push({label:r,type:n})}return t.cursor(K.IncludeAnonymous).iterate((t=>{if(r)r=!1;else if(t.name){let e=vo[t.name];if(e&&e(t,l)||go.has(t.name))return!1}else if(t.to-t.from>8192){for(let n of wo(e,t.node))o.push(n);return!1}})),mo.set(t,o),o}const xo=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,ko=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName",".","?."];function Co(e){let t=I(e.state).resolveInner(e.pos,-1);if(ko.indexOf(t.name)>-1)return null;let n="VariableName"==t.name||t.to-t.from<20&&xo.test(e.state.sliceDoc(t.from,t.to));if(!n&&!e.explicit)return null;let o=[];for(let r=t;r;r=r.parent)go.has(r.name)&&(o=o.concat(wo(e.state.doc,r)));return{options:o,from:n?t.from:e.pos,validFor:xo}}const Ao=P.define({name:"javascript",parser:Y.configure({props:[j.add({IfStatement:z({except:/^\s*({|else\b)/}),TryStatement:z({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:J,SwitchBody:e=>{let t=e.textAfter,n=/^\s*\}/.test(t),o=/^\s*(case|default)\b/.test(t);return e.baseIndent+(n?0:o?1:2)*e.unit},Block:V({closing:"}"}),ArrowFunction:e=>e.baseIndent+e.unit,"TemplateString BlockComment":()=>null,"Statement Property":z({except:/^{/}),JSXElement(e){let t=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},JSXEscape(e){let t=/\s*\}/.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},"JSXOpenTag JSXSelfClosingTag":e=>e.column(e.node.from)+e.unit}),F.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":q,BlockComment:e=>({from:e.from+2,to:e.to-2})})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),So={test:e=>/^JSX/.test(e.name),facet:X({commentTokens:{block:{open:"{/*",close:"*/}"}}})},Do=Ao.configure({dialect:"ts"},"typescript"),To=Ao.configure({dialect:"jsx",props:[U.add((e=>e.isTop?[So]:void 0))]}),Oo=Ao.configure({dialect:"jsx ts",props:[U.add((e=>e.isTop?[So]:void 0))]},"typescript");let Io=e=>({label:e,type:"keyword"});const Eo="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(Io),$o=Eo.concat(["declare","implements","private","protected","public"].map(Io));function Bo(e={}){let t=e.jsx?e.typescript?Oo:To:e.typescript?Do:Ao,n=e.typescript?ho.concat($o):fo.concat(Eo);return new N(t,[Ao.data.of({autocomplete:(o=ko,r=ne(n),e=>{for(let t=I(e.state).resolveInner(e.pos,-1);t;t=t.parent){if(o.indexOf(t.name)>-1)return null;if(t.type.isTop)break}return r(e)})}),Ao.data.of({autocomplete:Co}),e.jsx?Ro:[]]);var o,r}function Mo(e,t,n=e.length){for(let o=null==t?void 0:t.firstChild;o;o=o.nextSibling)if("JSXIdentifier"==o.name||"JSXBuiltin"==o.name||"JSXNamespacedName"==o.name||"JSXMemberExpression"==o.name)return e.sliceString(o.from,Math.min(o.to,n));return""}const Lo="object"==typeof navigator&&/Android\b/.test(navigator.userAgent),Ro=w.inputHandler.of(((e,n,o,r,l)=>{if((Lo?e.composing:e.compositionStarted)||e.state.readOnly||n!=o||">"!=r&&"/"!=r||!Ao.isActiveAt(e.state,n,-1))return!1;let i=l(),{state:a}=i,s=a.changeByRange((e=>{var n;let o,{head:l}=e,i=I(a).resolveInner(l-1,-1);if("JSXStartTag"==i.name&&(i=i.parent),a.doc.sliceString(l-1,l)!=r||"JSXAttributeValue"==i.name&&i.to>l);else{if(">"==r&&"JSXFragmentTag"==i.name)return{range:e,changes:{from:l,insert:"</>"}};if("/"==r&&"JSXStartCloseTag"==i.name){let e=i.parent,r=e.parent;if(r&&e.from==l-2&&((o=Mo(a.doc,r.firstChild,l))||"JSXFragmentTag"==(null===(n=r.firstChild)||void 0===n?void 0:n.name))){let e=`${o}>`;return{range:t.cursor(l+e.length,-1),changes:{from:l,insert:e}}}}else if(">"==r){let t=function(e){for(;;){if("JSXOpenTag"==e.name||"JSXSelfClosingTag"==e.name||"JSXFragmentTag"==e.name)return e;if("JSXEscape"==e.name||!e.parent)return null;e=e.parent}}(i);if(t&&"JSXOpenTag"==t.name&&!/^\/?>|^<\//.test(a.doc.sliceString(l,l+2))&&(o=Mo(a.doc,t,l)))return{range:e,changes:{from:l,insert:`</${o}>`}}}}return{range:e}}));return!s.changes.empty&&(e.dispatch([i,a.update(s,{userEvent:"input.complete",scrollIntoView:!0})]),!0)})),No=["_blank","_self","_top","_parent"],Po=["ascii","utf-8","utf-16","latin1","latin1"],jo=["get","post","put","delete"],Fo=["application/x-www-form-urlencoded","multipart/form-data","text/plain"],zo=["true","false"],qo={},Vo={a:{attrs:{href:null,ping:null,type:null,media:null,target:No,hreflang:null}},abbr:qo,address:qo,area:{attrs:{alt:null,coords:null,href:null,target:null,ping:null,media:null,hreflang:null,type:null,shape:["default","rect","circle","poly"]}},article:qo,aside:qo,audio:{attrs:{src:null,mediagroup:null,crossorigin:["anonymous","use-credentials"],preload:["none","metadata","auto"],autoplay:["autoplay"],loop:["loop"],controls:["controls"]}},b:qo,base:{attrs:{href:null,target:No}},bdi:qo,bdo:qo,blockquote:{attrs:{cite:null}},body:qo,br:qo,button:{attrs:{form:null,formaction:null,name:null,value:null,autofocus:["autofocus"],disabled:["autofocus"],formenctype:Fo,formmethod:jo,formnovalidate:["novalidate"],formtarget:No,type:["submit","reset","button"]}},canvas:{attrs:{width:null,height:null}},caption:qo,center:qo,cite:qo,code:qo,col:{attrs:{span:null}},colgroup:{attrs:{span:null}},command:{attrs:{type:["command","checkbox","radio"],label:null,icon:null,radiogroup:null,command:null,title:null,disabled:["disabled"],checked:["checked"]}},data:{attrs:{value:null}},datagrid:{attrs:{disabled:["disabled"],multiple:["multiple"]}},datalist:{attrs:{data:null}},dd:qo,del:{attrs:{cite:null,datetime:null}},details:{attrs:{open:["open"]}},dfn:qo,div:qo,dl:qo,dt:qo,em:qo,embed:{attrs:{src:null,type:null,width:null,height:null}},eventsource:{attrs:{src:null}},fieldset:{attrs:{disabled:["disabled"],form:null,name:null}},figcaption:qo,figure:qo,footer:qo,form:{attrs:{action:null,name:null,"accept-charset":Po,autocomplete:["on","off"],enctype:Fo,method:jo,novalidate:["novalidate"],target:No}},h1:qo,h2:qo,h3:qo,h4:qo,h5:qo,h6:qo,head:{children:["title","base","link","style","meta","script","noscript","command"]},header:qo,hgroup:qo,hr:qo,html:{attrs:{manifest:null}},i:qo,iframe:{attrs:{src:null,srcdoc:null,name:null,width:null,height:null,sandbox:["allow-top-navigation","allow-same-origin","allow-forms","allow-scripts"],seamless:["seamless"]}},img:{attrs:{alt:null,src:null,ismap:null,usemap:null,width:null,height:null,crossorigin:["anonymous","use-credentials"]}},input:{attrs:{alt:null,dirname:null,form:null,formaction:null,height:null,list:null,max:null,maxlength:null,min:null,name:null,pattern:null,placeholder:null,size:null,src:null,step:null,value:null,width:null,accept:["audio/*","video/*","image/*"],autocomplete:["on","off"],autofocus:["autofocus"],checked:["checked"],disabled:["disabled"],formenctype:Fo,formmethod:jo,formnovalidate:["novalidate"],formtarget:No,multiple:["multiple"],readonly:["readonly"],required:["required"],type:["hidden","text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","number","range","color","checkbox","radio","file","submit","image","reset","button"]}},ins:{attrs:{cite:null,datetime:null}},kbd:qo,keygen:{attrs:{challenge:null,form:null,name:null,autofocus:["autofocus"],disabled:["disabled"],keytype:["RSA"]}},label:{attrs:{for:null,form:null}},legend:qo,li:{attrs:{value:null}},link:{attrs:{href:null,type:null,hreflang:null,media:null,sizes:["all","16x16","16x16 32x32","16x16 32x32 64x64"]}},map:{attrs:{name:null}},mark:qo,menu:{attrs:{label:null,type:["list","context","toolbar"]}},meta:{attrs:{content:null,charset:Po,name:["viewport","application-name","author","description","generator","keywords"],"http-equiv":["content-language","content-type","default-style","refresh"]}},meter:{attrs:{value:null,min:null,low:null,high:null,max:null,optimum:null}},nav:qo,noscript:qo,object:{attrs:{data:null,type:null,name:null,usemap:null,form:null,width:null,height:null,typemustmatch:["typemustmatch"]}},ol:{attrs:{reversed:["reversed"],start:null,type:["1","a","A","i","I"]},children:["li","script","template","ul","ol"]},optgroup:{attrs:{disabled:["disabled"],label:null}},option:{attrs:{disabled:["disabled"],label:null,selected:["selected"],value:null}},output:{attrs:{for:null,form:null,name:null}},p:qo,param:{attrs:{name:null,value:null}},pre:qo,progress:{attrs:{value:null,max:null}},q:{attrs:{cite:null}},rp:qo,rt:qo,ruby:qo,samp:qo,script:{attrs:{type:["text/javascript"],src:null,async:["async"],defer:["defer"],charset:Po}},section:qo,select:{attrs:{form:null,name:null,size:null,autofocus:["autofocus"],disabled:["disabled"],multiple:["multiple"]}},slot:{attrs:{name:null}},small:qo,source:{attrs:{src:null,type:null,media:null}},span:qo,strong:qo,style:{attrs:{type:["text/css"],media:null,scoped:null}},sub:qo,summary:qo,sup:qo,table:qo,tbody:qo,td:{attrs:{colspan:null,rowspan:null,headers:null}},template:qo,textarea:{attrs:{dirname:null,form:null,maxlength:null,name:null,placeholder:null,rows:null,cols:null,autofocus:["autofocus"],disabled:["disabled"],readonly:["readonly"],required:["required"],wrap:["soft","hard"]}},tfoot:qo,th:{attrs:{colspan:null,rowspan:null,headers:null,scope:["row","col","rowgroup","colgroup"]}},thead:qo,time:{attrs:{datetime:null}},title:qo,tr:qo,track:{attrs:{src:null,label:null,default:null,kind:["subtitles","captions","descriptions","chapters","metadata"],srclang:null}},ul:{children:["li","script","template","ul","ol"]},var:qo,video:{attrs:{src:null,poster:null,width:null,height:null,crossorigin:["anonymous","use-credentials"],preload:["auto","metadata","none"],autoplay:["autoplay"],mediagroup:["movie"],muted:["muted"],controls:["controls"]}},wbr:qo},Jo={accesskey:null,class:null,contenteditable:zo,contextmenu:null,dir:["ltr","rtl","auto"],draggable:["true","false","auto"],dropzone:["copy","move","link","string:","file:"],hidden:["hidden"],id:null,inert:["inert"],itemid:null,itemprop:null,itemref:null,itemscope:["itemscope"],itemtype:null,lang:["ar","bn","de","en-GB","en-US","es","fr","hi","id","ja","pa","pt","ru","tr","zh"],spellcheck:zo,autocorrect:zo,autocapitalize:zo,style:null,tabindex:null,title:null,translate:["yes","no"],rel:["stylesheet","alternate","author","bookmark","help","license","next","nofollow","noreferrer","prefetch","prev","search","tag"],role:"alert application article banner button cell checkbox complementary contentinfo dialog document feed figure form grid gridcell heading img list listbox listitem main navigation region row rowgroup search switch tab table tabpanel textbox timer".split(" "),"aria-activedescendant":null,"aria-atomic":zo,"aria-autocomplete":["inline","list","both","none"],"aria-busy":zo,"aria-checked":["true","false","mixed","undefined"],"aria-controls":null,"aria-describedby":null,"aria-disabled":zo,"aria-dropeffect":null,"aria-expanded":["true","false","undefined"],"aria-flowto":null,"aria-grabbed":["true","false","undefined"],"aria-haspopup":zo,"aria-hidden":zo,"aria-invalid":["true","false","grammar","spelling"],"aria-label":null,"aria-labelledby":null,"aria-level":null,"aria-live":["off","polite","assertive"],"aria-multiline":zo,"aria-multiselectable":zo,"aria-owns":null,"aria-posinset":null,"aria-pressed":["true","false","mixed","undefined"],"aria-readonly":zo,"aria-relevant":null,"aria-required":zo,"aria-selected":["true","false","undefined"],"aria-setsize":null,"aria-sort":["ascending","descending","none","other"],"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null,"aria-valuetext":null},Uo="beforeunload copy cut dragstart dragover dragleave dragenter dragend drag paste focus blur change click load mousedown mouseenter mouseleave mouseup keydown keyup resize scroll unload".split(" ").map((e=>"on"+e));for(let cr of Uo)Jo[cr]=null;class Xo{constructor(e,t){this.tags=Object.assign(Object.assign({},Vo),e),this.globalAttrs=Object.assign(Object.assign({},Jo),t),this.allTags=Object.keys(this.tags),this.globalAttrNames=Object.keys(this.globalAttrs)}}function Ho(e,t,n=e.length){if(!t)return"";let o=t.firstChild,r=o&&o.getChild("TagName");return r?e.sliceString(r.from,Math.min(r.to,n)):""}function Wo(e,t=!1){for(;e;e=e.parent)if("Element"==e.name){if(!t)return e;t=!1}return null}function _o(e,t,n){let o=n.tags[Ho(e,Wo(t))];return(null==o?void 0:o.children)||n.allTags}function Go(e,t){let n=[];for(let o=Wo(t);o&&!o.type.isTop;o=Wo(o.parent)){let r=Ho(e,o);if(r&&"CloseTag"==o.lastChild.name)break;r&&n.indexOf(r)<0&&("EndTag"==t.name||t.from>=o.firstChild.to)&&n.push(r)}return n}Xo.default=new Xo;const Ko=/^[:\-\.\w\u00b7-\uffff]*$/;function Yo(e,t,n,o,r){let l=/\s*>/.test(e.sliceDoc(r,r+5))?"":">",i=Wo(n,!0);return{from:o,to:r,options:_o(e.doc,i,t).map((e=>({label:e,type:"type"}))).concat(Go(e.doc,n).map(((e,t)=>({label:"/"+e,apply:"/"+e+l,type:"type",boost:99-t})))),validFor:/^\/?[:\-\.\w\u00b7-\uffff]*$/}}function Zo(e,t,n,o){let r=/\s*>/.test(e.sliceDoc(o,o+5))?"":">";return{from:n,to:o,options:Go(e.doc,t).map(((e,t)=>({label:e,apply:e+r,type:"type",boost:99-t}))),validFor:Ko}}function Qo(e,t){let{state:n,pos:o}=t,r=I(n).resolveInner(o,-1),l=r.resolve(o);for(let i,a=o;l==r&&(i=r.childBefore(a));){let e=i.lastChild;if(!e||!e.type.isError||e.from<e.to)break;l=r=i,a=e.from}return"TagName"==r.name?r.parent&&/CloseTag$/.test(r.parent.name)?Zo(n,r,r.from,o):Yo(n,e,r,r.from,o):"StartTag"==r.name?Yo(n,e,r,o,o):"StartCloseTag"==r.name||"IncompleteCloseTag"==r.name?Zo(n,r,o,o):"OpenTag"==r.name||"SelfClosingTag"==r.name||"AttributeName"==r.name?function(e,t,n,o,r){let l=Wo(n),i=l?t.tags[Ho(e.doc,l)]:null,a=i&&i.attrs?Object.keys(i.attrs):[];return{from:o,to:r,options:(i&&!1===i.globalAttrs?a:a.length?a.concat(t.globalAttrNames):t.globalAttrNames).map((e=>({label:e,type:"property"}))),validFor:Ko}}(n,e,r,"AttributeName"==r.name?r.from:o,o):"Is"==r.name||"AttributeValue"==r.name||"UnquotedAttributeValue"==r.name?function(e,t,n,o,r){var l;let i,a=null===(l=n.parent)||void 0===l?void 0:l.getChild("AttributeName"),s=[];if(a){let l=e.sliceDoc(a.from,a.to),c=t.globalAttrs[l];if(!c){let o=Wo(n),r=o?t.tags[Ho(e.doc,o)]:null;c=(null==r?void 0:r.attrs)&&r.attrs[l]}if(c){let t=e.sliceDoc(o,r).toLowerCase(),n='"',l='"';/^['"]/.test(t)?(i='"'==t[0]?/^[^"]*$/:/^[^']*$/,n="",l=e.sliceDoc(r,r+1)==t[0]?"":t[0],t=t.slice(1),o++):i=/^[^\s<>='"]*$/;for(let e of c)s.push({label:e,apply:n+e+l,type:"constant"})}}return{from:o,to:r,options:s,validFor:i}}(n,e,r,"Is"==r.name?o:r.from,o):!t.explicit||"Element"!=l.name&&"Text"!=l.name&&"Document"!=l.name?null:function(e,t,n,o){let r=[],l=0;for(let i of _o(e.doc,n,t))r.push({label:"<"+i,type:"type"});for(let i of Go(e.doc,n))r.push({label:"</"+i+">",type:"type",boost:99-l++});return{from:o,to:o,options:r,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}(n,e,r,o)}function er(e){let{extraTags:t,extraGlobalAttributes:n}=e,o=n||t?new Xo(t,n):Xo.default;return e=>Qo(o,e)}const tr=Ao.parser.configure({top:"SingleExpression"}),nr=[{tag:"script",attrs:e=>"text/typescript"==e.type||"ts"==e.lang,parser:Do.parser},{tag:"script",attrs:e=>"text/babel"==e.type||"text/jsx"==e.type,parser:To.parser},{tag:"script",attrs:e=>"text/typescript-jsx"==e.type,parser:Oo.parser},{tag:"script",attrs:e=>/^(importmap|speculationrules|application\/(.+\+)?json)$/i.test(e.type),parser:tr},{tag:"script",attrs:e=>!e.type||/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i.test(e.type),parser:Ao.parser},{tag:"style",attrs:e=>(!e.lang||"css"==e.lang)&&(!e.type||/^(text\/)?(x-)?(stylesheet|css)$/i.test(e.type)),parser:uo.parser}],or=[{name:"style",parser:uo.parser.configure({top:"Styles"})}].concat(Uo.map((e=>({name:e,parser:Ao.parser})))),rr=P.define({name:"html",parser:Q.configure({props:[j.add({Element(e){let t=/^(\s*)(<\/)?/.exec(e.textAfter);return e.node.to<=e.pos+t[0].length?e.continue():e.lineIndent(e.node.from)+(t[2]?0:e.unit)},"OpenTag CloseTag SelfClosingTag":e=>e.column(e.node.from)+e.unit,Document(e){if(e.pos+/\s*/.exec(e.textAfter)[0].length<e.node.to)return e.continue();let t,n=null;for(let o=e.node;;){let e=o.lastChild;if(!e||"Element"!=e.name||e.to!=o.to)break;n=o=e}return n&&(!(t=n.lastChild)||"CloseTag"!=t.name&&"SelfClosingTag"!=t.name)?e.lineIndent(n.from)+e.unit:null}}),F.add({Element(e){let t=e.firstChild,n=e.lastChild;return t&&"OpenTag"==t.name?{from:t.to,to:"CloseTag"==n.name?n.from:e.to}:null}}),H.add({"OpenTag CloseTag":e=>e.getChild("TagName")})]}),languageData:{commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}},indentOnInput:/^\s*<\/\w+\W$/,wordChars:"-._"}}),lr=rr.configure({wrap:Z(nr,or)});function ir(e={}){let t,n="";!1===e.matchClosingTags&&(n="noMatch"),!0===e.selfClosingTags&&(n=(n?n+" ":"")+"selfClosing"),(e.nestedLanguages&&e.nestedLanguages.length||e.nestedAttributes&&e.nestedAttributes.length)&&(t=Z((e.nestedLanguages||[]).concat(nr),(e.nestedAttributes||[]).concat(or)));let o=t?rr.configure({wrap:t,dialect:n}):n?lr.configure({dialect:n}):lr;return new N(o,[lr.data.of({autocomplete:er(e)}),!1!==e.autoCloseTags?sr:[],Bo().support,po().support])}const ar=new Set("area base br col command embed frame hr img input keygen link meta param source track wbr menuitem".split(" ")),sr=w.inputHandler.of(((e,n,o,r,l)=>{if(e.composing||e.state.readOnly||n!=o||">"!=r&&"/"!=r||!lr.isActiveAt(e.state,n,-1))return!1;let i=l(),{state:a}=i,s=a.changeByRange((e=>{var n,o,l;let i,s=a.doc.sliceString(e.from-1,e.to)==r,{head:c}=e,u=I(a).resolveInner(c,-1);if(s&&">"==r&&"EndTag"==u.name){let t=u.parent;if("CloseTag"!=(null===(o=null===(n=t.parent)||void 0===n?void 0:n.lastChild)||void 0===o?void 0:o.name)&&(i=Ho(a.doc,t.parent,c))&&!ar.has(i)){return{range:e,changes:{from:c,to:c+(">"===a.doc.sliceString(c,c+1)?1:0),insert:`</${i}>`}}}}else if(s&&"/"==r&&"IncompleteCloseTag"==u.name){let e=u.parent;if(u.from==c-2&&"CloseTag"!=(null===(l=e.lastChild)||void 0===l?void 0:l.name)&&(i=Ho(a.doc,e,c))&&!ar.has(i)){let e=c+(">"===a.doc.sliceString(c,c+1)?1:0),n=`${i}>`;return{range:t.cursor(c+n.length,-1),changes:{from:c,to:e,insert:n}}}}return{range:e}}));return!s.changes.empty&&(e.dispatch([i,a.update(s,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}));export{Vn as a,Pt as b,ft as c,Yn as d,at as e,po as f,ir as g,en as h,Gn as i,Bo as j,Kn as k,xt as l,kt as m};
